!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@formio/js")):"function"==typeof define&&define.amd?define(["exports","@formio/js"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).FormioFileUpload={},global.Formio)}(this,function(exports,js){"use strict";function _typeof$8(o){return _typeof$8="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$8(o)}function _callSuper$1(t,o,e){return o=_getPrototypeOf$1(o),function(self,call){if(call&&("object"===_typeof$8(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}(t,_isNativeReflectConstruct$1()?Reflect.construct(o,e||[],_getPrototypeOf$1(t).constructor):o.apply(t,e))}function _wrapNativeSuper(Class){var _cache="function"==typeof Map?new Map:void 0;return _wrapNativeSuper=function(Class){if(null===Class||!function(fn){try{return-1!==Function.toString.call(fn).indexOf("[native code]")}catch(e){return"function"==typeof fn}}(Class))return Class;if("function"!=typeof Class)throw new TypeError("Super expression must either be null or a function");if(void 0!==_cache){if(_cache.has(Class))return _cache.get(Class);_cache.set(Class,Wrapper)}function Wrapper(){return function(t,e,r){if(_isNativeReflectConstruct$1())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var p=new(t.bind.apply(t,o));return r&&_setPrototypeOf$1(p,r.prototype),p}(Class,arguments,_getPrototypeOf$1(this).constructor)}return Wrapper.prototype=Object.create(Class.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf$1(Wrapper,Class)},_wrapNativeSuper(Class)}function _isNativeReflectConstruct$1(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct$1=function(){return!!t})()}function _setPrototypeOf$1(o,p){return _setPrototypeOf$1=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o},_setPrototypeOf$1(o,p)}function _getPrototypeOf$1(o){return _getPrototypeOf$1=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf$1(o)}var DetailedError=function(_Error){function DetailedError(message){var _this,causingErr=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,req=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,res=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,DetailedError),(_this=_callSuper$1(this,DetailedError,[message])).originalRequest=req,_this.originalResponse=res,_this.causingError=causingErr,null!=causingErr&&(message+=", caused by ".concat(causingErr.toString())),null!=req){var requestId=req.getHeader("X-Request-ID")||"n/a",method=req.getMethod(),url=req.getURL(),status=res?res.getStatus():"n/a",body=res?res.getBody()||"":"n/a";message+=", originated from request (method: ".concat(method,", url: ").concat(url,", response code: ").concat(status,", response text: ").concat(body,", request id: ").concat(requestId,")")}return _this.message=message,_this}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf$1(subClass,superClass)}(DetailedError,_Error),Constructor=DetailedError,Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor;var Constructor}(_wrapNativeSuper(Error));function _typeof$7(o){return _typeof$7="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$7(o)}function _createClass$7(Constructor,protoProps,staticProps){return protoProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$7(descriptor.key),descriptor)}}(Constructor.prototype,protoProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey$7(t){var i=function(t,r){if("object"!=_typeof$7(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$7(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$7(i)?i:i+""}var NoopUrlStorage=function(){return _createClass$7(function NoopUrlStorage(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,NoopUrlStorage)},[{key:"listAllUploads",value:function(){return Promise.resolve([])}},{key:"findUploadsByFingerprint",value:function(_fingerprint){return Promise.resolve([])}},{key:"removeUpload",value:function(_urlStorageKey){return Promise.resolve()}},{key:"addUpload",value:function(_fingerprint,_upload){return Promise.resolve(null)}}])}();const _hasBuffer="function"==typeof Buffer,_TE=("function"==typeof TextDecoder&&new TextDecoder,"function"==typeof TextEncoder?new TextEncoder:void 0),b64chs=Array.prototype.slice.call("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="),b64tab=(a=>{let tab={};return a.forEach((c,i)=>tab[c]=i),tab})(b64chs),b64re=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/,_fromCC=String.fromCharCode.bind(String),_mkUriSafe=("function"==typeof Uint8Array.from&&Uint8Array.from.bind(Uint8Array),src=>src.replace(/=/g,"").replace(/[+\/]/g,m0=>"+"==m0?"-":"_")),_tidyB64=s=>s.replace(/[^A-Za-z0-9\+\/]/g,""),btoaPolyfill=bin=>{let u32,c0,c1,c2,asc="";const pad=bin.length%3;for(let i=0;i<bin.length;){if((c0=bin.charCodeAt(i++))>255||(c1=bin.charCodeAt(i++))>255||(c2=bin.charCodeAt(i++))>255)throw new TypeError("invalid character found");u32=c0<<16|c1<<8|c2,asc+=b64chs[u32>>18&63]+b64chs[u32>>12&63]+b64chs[u32>>6&63]+b64chs[63&u32]}return pad?asc.slice(0,pad-3)+"===".substring(pad):asc},_btoa="function"==typeof btoa?bin=>btoa(bin):_hasBuffer?bin=>Buffer.from(bin,"binary").toString("base64"):btoaPolyfill,_fromUint8Array=_hasBuffer?u8a=>Buffer.from(u8a).toString("base64"):u8a=>{let strs=[];for(let i=0,l=u8a.length;i<l;i+=4096)strs.push(_fromCC.apply(null,u8a.subarray(i,i+4096)));return _btoa(strs.join(""))},cb_utob=c=>{if(c.length<2)return(cc=c.charCodeAt(0))<128?c:cc<2048?_fromCC(192|cc>>>6)+_fromCC(128|63&cc):_fromCC(224|cc>>>12&15)+_fromCC(128|cc>>>6&63)+_fromCC(128|63&cc);var cc=65536+1024*(c.charCodeAt(0)-55296)+(c.charCodeAt(1)-56320);return _fromCC(240|cc>>>18&7)+_fromCC(128|cc>>>12&63)+_fromCC(128|cc>>>6&63)+_fromCC(128|63&cc)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=u=>u.replace(re_utob,cb_utob),_encode=_hasBuffer?s=>Buffer.from(s,"utf8").toString("base64"):_TE?s=>_fromUint8Array(_TE.encode(s)):s=>_btoa(utob(s)),encode$1=(src,urlsafe=!1)=>urlsafe?_mkUriSafe(_encode(src)):_encode(src),atobPolyfill=asc=>{if(asc=asc.replace(/\s+/g,""),!b64re.test(asc))throw new TypeError("malformed base64.");let u24,r1,r2;asc+="==".slice(2-(3&asc.length));let binArray=[];for(let i=0;i<asc.length;)u24=b64tab[asc.charAt(i++)]<<18|b64tab[asc.charAt(i++)]<<12|(r1=b64tab[asc.charAt(i++)])<<6|(r2=b64tab[asc.charAt(i++)]),64===r1?binArray.push(_fromCC(u24>>16&255)):64===r2?binArray.push(_fromCC(u24>>16&255,u24>>8&255)):binArray.push(_fromCC(u24>>16&255,u24>>8&255,255&u24));return binArray.join("")},gBase64_encode=encode$1;var commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var querystringify$1={},has=Object.prototype.hasOwnProperty;function decode(input){try{return decodeURIComponent(input.replace(/\+/g," "))}catch(e){return null}}function encode(input){try{return encodeURIComponent(input)}catch(e){return null}}querystringify$1.stringify=function(obj,prefix){prefix=prefix||"";var value,key,pairs=[];for(key in"string"!=typeof prefix&&(prefix="?"),obj)if(has.call(obj,key)){if((value=obj[key])||null!=value&&!isNaN(value)||(value=""),key=encode(key),value=encode(value),null===key||null===value)continue;pairs.push(key+"="+value)}return pairs.length?prefix+pairs.join("&"):""},querystringify$1.parse=function(query){for(var part,parser=/([^=?#&]+)=?([^&]*)/g,result={};part=parser.exec(query);){var key=decode(part[1]),value=decode(part[2]);null===key||null===value||key in result||(result[key]=value)}return result};var required=function(port,protocol){if(protocol=protocol.split(":")[0],!(port=+port))return!1;switch(protocol){case"http":case"ws":return 80!==port;case"https":case"wss":return 443!==port;case"ftp":return 21!==port;case"gopher":return 70!==port;case"file":return!1}return 0!==port},qs=querystringify$1,controlOrWhitespace=/^[\x00-\x20\u00a0\u1680\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]+/,CRHTLF=/[\n\r\t]/g,slashes=/^[A-Za-z][A-Za-z0-9+-.]*:\/\//,port=/:\d+$/,protocolre=/^([a-z][a-z0-9.+-]*:)?(\/\/)?([\\/]+)?([\S\s]*)/i,windowsDriveLetter=/^[a-zA-Z]:/;function trimLeft(str){return(str||"").toString().replace(controlOrWhitespace,"")}var rules=[["#","hash"],["?","query"],function(address,url){return isSpecial(url.protocol)?address.replace(/\\/g,"/"):address},["/","pathname"],["@","auth",1],[NaN,"host",void 0,1,1],[/:(\d*)$/,"port",void 0,1],[NaN,"hostname",void 0,1,1]],ignore={hash:1,query:1};function lolcation(loc){var key,location=("undefined"!=typeof window?window:void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof self?self:{}).location||{},finaldestination={},type=typeof(loc=loc||location);if("blob:"===loc.protocol)finaldestination=new Url$1(unescape(loc.pathname),{});else if("string"===type)for(key in finaldestination=new Url$1(loc,{}),ignore)delete finaldestination[key];else if("object"===type){for(key in loc)key in ignore||(finaldestination[key]=loc[key]);void 0===finaldestination.slashes&&(finaldestination.slashes=slashes.test(loc.href))}return finaldestination}function isSpecial(scheme){return"file:"===scheme||"ftp:"===scheme||"http:"===scheme||"https:"===scheme||"ws:"===scheme||"wss:"===scheme}function extractProtocol(address,location){address=(address=trimLeft(address)).replace(CRHTLF,""),location=location||{};var rest,match=protocolre.exec(address),protocol=match[1]?match[1].toLowerCase():"",forwardSlashes=!!match[2],otherSlashes=!!match[3],slashesCount=0;return forwardSlashes?otherSlashes?(rest=match[2]+match[3]+match[4],slashesCount=match[2].length+match[3].length):(rest=match[2]+match[4],slashesCount=match[2].length):otherSlashes?(rest=match[3]+match[4],slashesCount=match[3].length):rest=match[4],"file:"===protocol?slashesCount>=2&&(rest=rest.slice(2)):isSpecial(protocol)?rest=match[4]:protocol?forwardSlashes&&(rest=rest.slice(2)):slashesCount>=2&&isSpecial(location.protocol)&&(rest=match[4]),{protocol:protocol,slashes:forwardSlashes||isSpecial(protocol),slashesCount:slashesCount,rest:rest}}function Url$1(address,location,parser){if(address=(address=trimLeft(address)).replace(CRHTLF,""),!(this instanceof Url$1))return new Url$1(address,location,parser);var relative,extracted,parse,instruction,index,key,instructions=rules.slice(),type=typeof location,url=this,i=0;for("object"!==type&&"string"!==type&&(parser=location,location=null),parser&&"function"!=typeof parser&&(parser=qs.parse),relative=!(extracted=extractProtocol(address||"",location=lolcation(location))).protocol&&!extracted.slashes,url.slashes=extracted.slashes||relative&&location.slashes,url.protocol=extracted.protocol||location.protocol||"",address=extracted.rest,("file:"===extracted.protocol&&(2!==extracted.slashesCount||windowsDriveLetter.test(address))||!extracted.slashes&&(extracted.protocol||extracted.slashesCount<2||!isSpecial(url.protocol)))&&(instructions[3]=[/(.*)/,"pathname"]);i<instructions.length;i++)"function"!=typeof(instruction=instructions[i])?(parse=instruction[0],key=instruction[1],parse!=parse?url[key]=address:"string"==typeof parse?~(index="@"===parse?address.lastIndexOf(parse):address.indexOf(parse))&&("number"==typeof instruction[2]?(url[key]=address.slice(0,index),address=address.slice(index+instruction[2])):(url[key]=address.slice(index),address=address.slice(0,index))):(index=parse.exec(address))&&(url[key]=index[1],address=address.slice(0,index.index)),url[key]=url[key]||relative&&instruction[3]&&location[key]||"",instruction[4]&&(url[key]=url[key].toLowerCase())):address=instruction(address,url);parser&&(url.query=parser(url.query)),relative&&location.slashes&&"/"!==url.pathname.charAt(0)&&(""!==url.pathname||""!==location.pathname)&&(url.pathname=function(relative,base){if(""===relative)return base;for(var path=(base||"/").split("/").slice(0,-1).concat(relative.split("/")),i=path.length,last=path[i-1],unshift=!1,up=0;i--;)"."===path[i]?path.splice(i,1):".."===path[i]?(path.splice(i,1),up++):up&&(0===i&&(unshift=!0),path.splice(i,1),up--);return unshift&&path.unshift(""),"."!==last&&".."!==last||path.push(""),path.join("/")}(url.pathname,location.pathname)),"/"!==url.pathname.charAt(0)&&isSpecial(url.protocol)&&(url.pathname="/"+url.pathname),required(url.port,url.protocol)||(url.host=url.hostname,url.port=""),url.username=url.password="",url.auth&&(~(index=url.auth.indexOf(":"))?(url.username=url.auth.slice(0,index),url.username=encodeURIComponent(decodeURIComponent(url.username)),url.password=url.auth.slice(index+1),url.password=encodeURIComponent(decodeURIComponent(url.password))):url.username=encodeURIComponent(decodeURIComponent(url.auth)),url.auth=url.password?url.username+":"+url.password:url.username),url.origin="file:"!==url.protocol&&isSpecial(url.protocol)&&url.host?url.protocol+"//"+url.host:"null",url.href=url.toString()}Url$1.prototype={set:function(part,value,fn){var url=this;switch(part){case"query":"string"==typeof value&&value.length&&(value=(fn||qs.parse)(value)),url[part]=value;break;case"port":url[part]=value,required(value,url.protocol)?value&&(url.host=url.hostname+":"+value):(url.host=url.hostname,url[part]="");break;case"hostname":url[part]=value,url.port&&(value+=":"+url.port),url.host=value;break;case"host":url[part]=value,port.test(value)?(value=value.split(":"),url.port=value.pop(),url.hostname=value.join(":")):(url.hostname=value,url.port="");break;case"protocol":url.protocol=value.toLowerCase(),url.slashes=!fn;break;case"pathname":case"hash":if(value){var char="pathname"===part?"/":"#";url[part]=value.charAt(0)!==char?char+value:value}else url[part]=value;break;case"username":case"password":url[part]=encodeURIComponent(value);break;case"auth":var index=value.indexOf(":");~index?(url.username=value.slice(0,index),url.username=encodeURIComponent(decodeURIComponent(url.username)),url.password=value.slice(index+1),url.password=encodeURIComponent(decodeURIComponent(url.password))):url.username=encodeURIComponent(decodeURIComponent(value))}for(var i=0;i<rules.length;i++){var ins=rules[i];ins[4]&&(url[ins[1]]=url[ins[1]].toLowerCase())}return url.auth=url.password?url.username+":"+url.password:url.username,url.origin="file:"!==url.protocol&&isSpecial(url.protocol)&&url.host?url.protocol+"//"+url.host:"null",url.href=url.toString(),url},toString:function(stringify){stringify&&"function"==typeof stringify||(stringify=qs.stringify);var query,url=this,host=url.host,protocol=url.protocol;protocol&&":"!==protocol.charAt(protocol.length-1)&&(protocol+=":");var result=protocol+(url.protocol&&url.slashes||isSpecial(url.protocol)?"//":"");return url.username?(result+=url.username,url.password&&(result+=":"+url.password),result+="@"):url.password?(result+=":"+url.password,result+="@"):"file:"!==url.protocol&&isSpecial(url.protocol)&&!host&&"/"!==url.pathname&&(result+="@"),(":"===host[host.length-1]||port.test(url.hostname)&&!url.port)&&(host+=":"),result+=host+url.pathname,(query="object"==typeof url.query?stringify(url.query):url.query)&&(result+="?"!==query.charAt(0)?"?"+query:query),url.hash&&(result+=url.hash),result}},Url$1.extractProtocol=extractProtocol,Url$1.location=lolcation,Url$1.trimLeft=trimLeft,Url$1.qs=qs;var URL$1=getDefaultExportFromCjs(Url$1);function _regeneratorRuntime$1(){_regeneratorRuntime$1=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof$6(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof$6(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _slicedToArray(arr,i){return function(arr){if(Array.isArray(arr))return arr}(arr)||function(r,l){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var e,n,i,u,a=[],f=!0,o=!1;try{if(i=(t=t.call(r)).next,0===l);else for(;!(f=(e=i.call(t)).done)&&(a.push(e.value),a.length!==l);f=!0);}catch(r){o=!0,n=r}finally{try{if(!f&&null!=t.return&&(u=t.return(),Object(u)!==u))return}finally{if(o)throw n}}return a}}(arr,i)||_unsupportedIterableToArray(arr,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _typeof$6(o){return _typeof$6="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$6(o)}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function ownKeys$1(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread$1(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys$1(Object(t),!0).forEach(function(r){_defineProperty$1(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys$1(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty$1(obj,key,value){return(key=_toPropertyKey$6(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _defineProperties$6(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$6(descriptor.key),descriptor)}}function _toPropertyKey$6(t){var i=function(t,r){if("object"!=_typeof$6(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$6(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$6(i)?i:i+""}var PROTOCOL_TUS_V1="tus-v1",PROTOCOL_IETF_DRAFT_03="ietf-draft-03",PROTOCOL_IETF_DRAFT_05="ietf-draft-05",defaultOptions$9={endpoint:null,uploadUrl:null,metadata:{},metadataForPartialUploads:{},fingerprint:null,uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,onUploadUrlAvailable:null,overridePatchMethod:!1,headers:{},addRequestId:!1,onBeforeRequest:null,onAfterResponse:null,onShouldRetry:defaultOnShouldRetry,chunkSize:Number.POSITIVE_INFINITY,retryDelays:[0,1e3,3e3,5e3],parallelUploads:1,parallelUploadBoundaries:null,storeFingerprintForResuming:!0,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1,urlStorage:null,fileReader:null,httpStack:null,protocol:PROTOCOL_TUS_V1},BaseUpload=function(){function BaseUpload(file,options){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,BaseUpload),"resume"in options&&console.log("tus: The `resume` option has been removed in tus-js-client v2. Please use the URL storage API instead."),this.options=options,this.options.chunkSize=Number(this.options.chunkSize),this._urlStorage=this.options.urlStorage,this.file=file,this.url=null,this._req=null,this._fingerprint=null,this._urlStorageKey=null,this._offset=null,this._aborted=!1,this._size=null,this._source=null,this._retryAttempt=0,this._retryTimeout=null,this._offsetBeforeRetry=0,this._parallelUploads=null,this._parallelUploadUrls=null}return Constructor=BaseUpload,protoProps=[{key:"findPreviousUploads",value:function(){var _this=this;return this.options.fingerprint(this.file,this.options).then(function(fingerprint){return _this._urlStorage.findUploadsByFingerprint(fingerprint)})}},{key:"resumeFromPreviousUpload",value:function(previousUpload){this.url=previousUpload.uploadUrl||null,this._parallelUploadUrls=previousUpload.parallelUploadUrls||null,this._urlStorageKey=previousUpload.urlStorageKey}},{key:"start",value:function(){var _this2=this,file=this.file;if(file)if([PROTOCOL_TUS_V1,PROTOCOL_IETF_DRAFT_03,PROTOCOL_IETF_DRAFT_05].includes(this.options.protocol))if(this.options.endpoint||this.options.uploadUrl||this.url){var retryDelays=this.options.retryDelays;if(null==retryDelays||"[object Array]"===Object.prototype.toString.call(retryDelays)){if(this.options.parallelUploads>1)for(var _i=0,_arr=["uploadUrl","uploadSize","uploadLengthDeferred"];_i<_arr.length;_i++){var optionName=_arr[_i];if(this.options[optionName])return void this._emitError(new Error("tus: cannot use the ".concat(optionName," option when parallelUploads is enabled")))}if(this.options.parallelUploadBoundaries){if(this.options.parallelUploads<=1)return void this._emitError(new Error("tus: cannot use the `parallelUploadBoundaries` option when `parallelUploads` is disabled"));if(this.options.parallelUploads!==this.options.parallelUploadBoundaries.length)return void this._emitError(new Error("tus: the `parallelUploadBoundaries` must have the same length as the value of `parallelUploads`"))}this.options.fingerprint(file,this.options).then(function(fingerprint){return _this2._fingerprint=fingerprint,_this2._source?_this2._source:_this2.options.fileReader.openFile(file,_this2.options.chunkSize)}).then(function(source){if(_this2._source=source,_this2.options.uploadLengthDeferred)_this2._size=null;else if(null!=_this2.options.uploadSize){if(_this2._size=Number(_this2.options.uploadSize),Number.isNaN(_this2._size))return void _this2._emitError(new Error("tus: cannot convert `uploadSize` option into a number"))}else if(_this2._size=_this2._source.size,null==_this2._size)return void _this2._emitError(new Error("tus: cannot automatically derive upload's size from input. Specify it manually using the `uploadSize` option or use the `uploadLengthDeferred` option"));_this2.options.parallelUploads>1||null!=_this2._parallelUploadUrls?_this2._startParallelUpload():_this2._startSingleUpload()}).catch(function(err){_this2._emitError(err)})}else this._emitError(new Error("tus: the `retryDelays` option must either be an array or null"))}else this._emitError(new Error("tus: neither an endpoint or an upload URL is provided"));else this._emitError(new Error("tus: unsupported protocol ".concat(this.options.protocol)));else this._emitError(new Error("tus: no file or stream to upload provided"))}},{key:"_startParallelUpload",value:function(){var _this$options$paralle,_this3=this,totalSize=this._size,totalProgress=0;this._parallelUploads=[];var partCount=null!=this._parallelUploadUrls?this._parallelUploadUrls.length:this.options.parallelUploads,parts=null!==(_this$options$paralle=this.options.parallelUploadBoundaries)&&void 0!==_this$options$paralle?_this$options$paralle:function(totalSize,partCount){for(var partSize=Math.floor(totalSize/partCount),parts=[],i=0;i<partCount;i++)parts.push({start:partSize*i,end:partSize*(i+1)});return parts[partCount-1].end=totalSize,parts}(this._source.size,partCount);this._parallelUploadUrls&&parts.forEach(function(part,index){part.uploadUrl=_this3._parallelUploadUrls[index]||null}),this._parallelUploadUrls=new Array(parts.length);var req,uploads=parts.map(function(part,index){var lastPartProgress=0;return _this3._source.slice(part.start,part.end).then(function(_ref){var value=_ref.value;return new Promise(function(resolve,reject){var options=_objectSpread$1(_objectSpread$1({},_this3.options),{},{uploadUrl:part.uploadUrl||null,storeFingerprintForResuming:!1,removeFingerprintOnSuccess:!1,parallelUploads:1,parallelUploadBoundaries:null,metadata:_this3.options.metadataForPartialUploads,headers:_objectSpread$1(_objectSpread$1({},_this3.options.headers),{},{"Upload-Concat":"partial"}),onSuccess:resolve,onError:reject,onProgress:function(newPartProgress){totalProgress=totalProgress-lastPartProgress+newPartProgress,lastPartProgress=newPartProgress,_this3._emitProgress(totalProgress,totalSize)},onUploadUrlAvailable:function(){_this3._parallelUploadUrls[index]=upload.url,_this3._parallelUploadUrls.filter(function(u){return Boolean(u)}).length===parts.length&&_this3._saveUploadInUrlStorage()}}),upload=new BaseUpload(value,options);upload.start(),_this3._parallelUploads.push(upload)})})});Promise.all(uploads).then(function(){(req=_this3._openRequest("POST",_this3.options.endpoint)).setHeader("Upload-Concat","final;".concat(_this3._parallelUploadUrls.join(" ")));var metadata=encodeMetadata(_this3.options.metadata);return""!==metadata&&req.setHeader("Upload-Metadata",metadata),_this3._sendRequest(req,null)}).then(function(res){if(inStatusCategory(res.getStatus(),200)){var location=res.getHeader("Location");null!=location?(_this3.url=resolveUrl(_this3.options.endpoint,location),"Created upload at ".concat(_this3.url),_this3._emitSuccess(res)):_this3._emitHttpError(req,res,"tus: invalid or missing Location header")}else _this3._emitHttpError(req,res,"tus: unexpected response while creating upload")}).catch(function(err){_this3._emitError(err)})}},{key:"_startSingleUpload",value:function(){return this._aborted=!1,null!=this.url?("Resuming upload from previous URL: ".concat(this.url),void this._resumeUpload()):null!=this.options.uploadUrl?("Resuming upload from provided URL: ".concat(this.options.uploadUrl),this.url=this.options.uploadUrl,void this._resumeUpload()):void this._createUpload()}},{key:"abort",value:function(shouldTerminate){var _this4=this;if(null!=this._parallelUploads){var _step,_iterator=function(o,allowArrayLike){var it="undefined"!=typeof Symbol&&o[Symbol.iterator]||o["@@iterator"];if(!it){if(Array.isArray(o)||(it=_unsupportedIterableToArray(o))||allowArrayLike){it&&(o=it);var i=0,F=function(){};return{s:F,n:function(){return i>=o.length?{done:!0}:{done:!1,value:o[i++]}},e:function(_e){throw _e},f:F}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var err,normalCompletion=!0,didErr=!1;return{s:function(){it=it.call(o)},n:function(){var step=it.next();return normalCompletion=step.done,step},e:function(_e2){didErr=!0,err=_e2},f:function(){try{normalCompletion||null==it.return||it.return()}finally{if(didErr)throw err}}}}(this._parallelUploads);try{for(_iterator.s();!(_step=_iterator.n()).done;)_step.value.abort(shouldTerminate)}catch(err){_iterator.e(err)}finally{_iterator.f()}}return null!==this._req&&this._req.abort(),this._aborted=!0,null!=this._retryTimeout&&(clearTimeout(this._retryTimeout),this._retryTimeout=null),shouldTerminate&&null!=this.url?BaseUpload.terminate(this.url,this.options).then(function(){return _this4._removeFromUrlStorage()}):Promise.resolve()}},{key:"_emitHttpError",value:function(req,res,message,causingErr){this._emitError(new DetailedError(message,causingErr,req,res))}},{key:"_emitError",value:function(err){var _this5=this;if(!this._aborted){if(null!=this.options.retryDelays&&(null!=this._offset&&this._offset>this._offsetBeforeRetry&&(this._retryAttempt=0),shouldRetry(err,this._retryAttempt,this.options))){var delay=this.options.retryDelays[this._retryAttempt++];return this._offsetBeforeRetry=this._offset,void(this._retryTimeout=setTimeout(function(){_this5.start()},delay))}if("function"!=typeof this.options.onError)throw err;this.options.onError(err)}}},{key:"_emitSuccess",value:function(lastResponse){this.options.removeFingerprintOnSuccess&&this._removeFromUrlStorage(),"function"==typeof this.options.onSuccess&&this.options.onSuccess({lastResponse:lastResponse})}},{key:"_emitProgress",value:function(bytesSent,bytesTotal){"function"==typeof this.options.onProgress&&this.options.onProgress(bytesSent,bytesTotal)}},{key:"_emitChunkComplete",value:function(chunkSize,bytesAccepted,bytesTotal){"function"==typeof this.options.onChunkComplete&&this.options.onChunkComplete(chunkSize,bytesAccepted,bytesTotal)}},{key:"_createUpload",value:function(){var _this6=this;if(this.options.endpoint){var req=this._openRequest("POST",this.options.endpoint);this.options.uploadLengthDeferred?req.setHeader("Upload-Defer-Length","1"):req.setHeader("Upload-Length","".concat(this._size));var promise,metadata=encodeMetadata(this.options.metadata);""!==metadata&&req.setHeader("Upload-Metadata",metadata),this.options.uploadDataDuringCreation&&!this.options.uploadLengthDeferred?(this._offset=0,promise=this._addChunkToRequest(req)):(this.options.protocol!==PROTOCOL_IETF_DRAFT_03&&this.options.protocol!==PROTOCOL_IETF_DRAFT_05||req.setHeader("Upload-Complete","?0"),promise=this._sendRequest(req,null)),promise.then(function(res){if(inStatusCategory(res.getStatus(),200)){var location=res.getHeader("Location");if(null!=location){if(_this6.url=resolveUrl(_this6.options.endpoint,location),"Created upload at ".concat(_this6.url),"function"==typeof _this6.options.onUploadUrlAvailable&&_this6.options.onUploadUrlAvailable(),0===_this6._size)return _this6._emitSuccess(res),void _this6._source.close();_this6._saveUploadInUrlStorage().then(function(){_this6.options.uploadDataDuringCreation?_this6._handleUploadResponse(req,res):(_this6._offset=0,_this6._performUpload())})}else _this6._emitHttpError(req,res,"tus: invalid or missing Location header")}else _this6._emitHttpError(req,res,"tus: unexpected response while creating upload")}).catch(function(err){_this6._emitHttpError(req,null,"tus: failed to create upload",err)})}else this._emitError(new Error("tus: unable to create upload because no endpoint is provided"))}},{key:"_resumeUpload",value:function(){var _this7=this,req=this._openRequest("HEAD",this.url);this._sendRequest(req,null).then(function(res){var status=res.getStatus();if(!inStatusCategory(status,200))return 423===status?void _this7._emitHttpError(req,res,"tus: upload is currently locked; retry later"):(inStatusCategory(status,400)&&_this7._removeFromUrlStorage(),_this7.options.endpoint?(_this7.url=null,void _this7._createUpload()):void _this7._emitHttpError(req,res,"tus: unable to resume upload (new upload cannot be created without an endpoint)"));var offset=Number.parseInt(res.getHeader("Upload-Offset"),10);if(Number.isNaN(offset))_this7._emitHttpError(req,res,"tus: invalid or missing offset value");else{var length=Number.parseInt(res.getHeader("Upload-Length"),10);!Number.isNaN(length)||_this7.options.uploadLengthDeferred||_this7.options.protocol!==PROTOCOL_TUS_V1?("function"==typeof _this7.options.onUploadUrlAvailable&&_this7.options.onUploadUrlAvailable(),_this7._saveUploadInUrlStorage().then(function(){if(offset===length)return _this7._emitProgress(length,length),void _this7._emitSuccess(res);_this7._offset=offset,_this7._performUpload()})):_this7._emitHttpError(req,res,"tus: invalid or missing length value")}}).catch(function(err){_this7._emitHttpError(req,null,"tus: failed to resume upload",err)})}},{key:"_performUpload",value:function(){var req,_this8=this;this._aborted||(this.options.overridePatchMethod?(req=this._openRequest("POST",this.url)).setHeader("X-HTTP-Method-Override","PATCH"):req=this._openRequest("PATCH",this.url),req.setHeader("Upload-Offset","".concat(this._offset)),this._addChunkToRequest(req).then(function(res){inStatusCategory(res.getStatus(),200)?_this8._handleUploadResponse(req,res):_this8._emitHttpError(req,res,"tus: unexpected response while uploading chunk")}).catch(function(err){_this8._aborted||_this8._emitHttpError(req,null,"tus: failed to upload chunk at offset ".concat(_this8._offset),err)}))}},{key:"_addChunkToRequest",value:function(req){var _this9=this,start=this._offset,end=this._offset+this.options.chunkSize;return req.setProgressHandler(function(bytesSent){_this9._emitProgress(start+bytesSent,_this9._size)}),this.options.protocol===PROTOCOL_TUS_V1?req.setHeader("Content-Type","application/offset+octet-stream"):this.options.protocol===PROTOCOL_IETF_DRAFT_05&&req.setHeader("Content-Type","application/partial-upload"),(end===Number.POSITIVE_INFINITY||end>this._size)&&!this.options.uploadLengthDeferred&&(end=this._size),this._source.slice(start,end).then(function(_ref2){var value=_ref2.value,done=_ref2.done,valueSize=null!=value&&value.size?value.size:0;_this9.options.uploadLengthDeferred&&done&&(_this9._size=_this9._offset+valueSize,req.setHeader("Upload-Length","".concat(_this9._size)));var newSize=_this9._offset+valueSize;return!_this9.options.uploadLengthDeferred&&done&&newSize!==_this9._size?Promise.reject(new Error("upload was configured with a size of ".concat(_this9._size," bytes, but the source is done after ").concat(newSize," bytes"))):null===value?_this9._sendRequest(req):(_this9.options.protocol!==PROTOCOL_IETF_DRAFT_03&&_this9.options.protocol!==PROTOCOL_IETF_DRAFT_05||req.setHeader("Upload-Complete",done?"?1":"?0"),_this9._emitProgress(_this9._offset,_this9._size),_this9._sendRequest(req,value))})}},{key:"_handleUploadResponse",value:function(req,res){var offset=Number.parseInt(res.getHeader("Upload-Offset"),10);if(Number.isNaN(offset))this._emitHttpError(req,res,"tus: invalid or missing offset value");else{if(this._emitProgress(offset,this._size),this._emitChunkComplete(offset-this._offset,offset,this._size),this._offset=offset,offset===this._size)return this._emitSuccess(res),void this._source.close();this._performUpload()}}},{key:"_openRequest",value:function(method,url){var req=openRequest(method,url,this.options);return this._req=req,req}},{key:"_removeFromUrlStorage",value:function(){var _this10=this;this._urlStorageKey&&(this._urlStorage.removeUpload(this._urlStorageKey).catch(function(err){_this10._emitError(err)}),this._urlStorageKey=null)}},{key:"_saveUploadInUrlStorage",value:function(){var _this11=this;if(!this.options.storeFingerprintForResuming||!this._fingerprint||null!==this._urlStorageKey)return Promise.resolve();var storedUpload={size:this._size,metadata:this.options.metadata,creationTime:(new Date).toString()};return this._parallelUploads?storedUpload.parallelUploadUrls=this._parallelUploadUrls:storedUpload.uploadUrl=this.url,this._urlStorage.addUpload(this._fingerprint,storedUpload).then(function(urlStorageKey){_this11._urlStorageKey=urlStorageKey})}},{key:"_sendRequest",value:function(req){return sendRequest(req,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,this.options)}}],staticProps=[{key:"terminate",value:function(url){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},req=openRequest("DELETE",url,options);return sendRequest(req,null,options).then(function(res){if(204!==res.getStatus())throw new DetailedError("tus: unexpected response while terminating upload",null,req,res)}).catch(function(err){if(err instanceof DetailedError||(err=new DetailedError("tus: failed to terminate upload",err,req,null)),!shouldRetry(err,0,options))throw err;var delay=options.retryDelays[0],remainingDelays=options.retryDelays.slice(1),newOptions=_objectSpread$1(_objectSpread$1({},options),{},{retryDelays:remainingDelays});return new Promise(function(resolve){return setTimeout(resolve,delay)}).then(function(){return BaseUpload.terminate(url,newOptions)})})}}],protoProps&&_defineProperties$6(Constructor.prototype,protoProps),staticProps&&_defineProperties$6(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor;var Constructor,protoProps,staticProps}();function encodeMetadata(metadata){return Object.entries(metadata).map(function(_ref3){var _ref4=_slicedToArray(_ref3,2),key=_ref4[0],value=_ref4[1];return"".concat(key," ").concat(gBase64_encode(String(value)))}).join(",")}function inStatusCategory(status,category){return status>=category&&status<category+100}function openRequest(method,url,options){var req=options.httpStack.createRequest(method,url);options.protocol===PROTOCOL_IETF_DRAFT_03?req.setHeader("Upload-Draft-Interop-Version","5"):options.protocol===PROTOCOL_IETF_DRAFT_05?req.setHeader("Upload-Draft-Interop-Version","6"):req.setHeader("Tus-Resumable","1.0.0");for(var headers=options.headers||{},_i2=0,_Object$entries=Object.entries(headers);_i2<_Object$entries.length;_i2++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i2],2),name=_Object$entries$_i[0],value=_Object$entries$_i[1];req.setHeader(name,value)}if(options.addRequestId){var requestId="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=16*Math.random()|0;return("x"===c?r:3&r|8).toString(16)});req.setHeader("X-Request-ID",requestId)}return req}function sendRequest(_x,_x2,_x3){return _sendRequest2.apply(this,arguments)}function _sendRequest2(){var fn;return fn=_regeneratorRuntime$1().mark(function _callee(req,body,options){var res;return _regeneratorRuntime$1().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if("function"!=typeof options.onBeforeRequest){_context.next=3;break}return _context.next=3,options.onBeforeRequest(req);case 3:return _context.next=5,req.send(body);case 5:if(res=_context.sent,"function"!=typeof options.onAfterResponse){_context.next=9;break}return _context.next=9,options.onAfterResponse(req,res);case 9:return _context.abrupt("return",res);case 10:case"end":return _context.stop()}},_callee)}),_sendRequest2=function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep$1(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})},_sendRequest2.apply(this,arguments)}function shouldRetry(err,retryAttempt,options){return!(null==options.retryDelays||retryAttempt>=options.retryDelays.length||null==err.originalRequest)&&(options&&"function"==typeof options.onShouldRetry?options.onShouldRetry(err,retryAttempt,options):defaultOnShouldRetry(err))}function defaultOnShouldRetry(err){var online,status=err.originalResponse?err.originalResponse.getStatus():0;return(!inStatusCategory(status,400)||409===status||423===status)&&(online=!0,"undefined"!=typeof navigator&&!1===navigator.onLine&&(online=!1),online)}function resolveUrl(origin,link){return new URL$1(link,origin).toString()}BaseUpload.defaultOptions=defaultOptions$9;var isReactNative$1=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase()};function uriToBlob(uri){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;xhr.responseType="blob",xhr.onload=function(){var blob=xhr.response;resolve(blob)},xhr.onerror=function(err){reject(err)},xhr.open("GET",uri),xhr.send()})}function _typeof$5(o){return _typeof$5="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$5(o)}function _createClass$5(Constructor,protoProps,staticProps){return protoProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$5(descriptor.key),descriptor)}}(Constructor.prototype,protoProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey$5(t){var i=function(t,r){if("object"!=_typeof$5(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$5(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$5(i)?i:i+""}var FileSource=function(){return _createClass$5(function FileSource(file){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FileSource),this._file=file,this.size=file.size},[{key:"slice",value:function(start,end){if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova))return chunk=this._file.slice(start,end),new Promise(function(resolve,reject){var reader=new FileReader;reader.onload=function(){var value=new Uint8Array(reader.result);resolve({value:value})},reader.onerror=function(err){reject(err)},reader.readAsArrayBuffer(chunk)});var chunk,value=this._file.slice(start,end),done=end>=this.size;return Promise.resolve({value:value,done:done})}},{key:"close",value:function(){}}])}();function _typeof$4(o){return _typeof$4="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$4(o)}function _createClass$4(Constructor,protoProps,staticProps){return protoProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$4(descriptor.key),descriptor)}}(Constructor.prototype,protoProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey$4(t){var i=function(t,r){if("object"!=_typeof$4(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$4(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$4(i)?i:i+""}function len(blobOrArray){return void 0===blobOrArray?0:void 0!==blobOrArray.size?blobOrArray.size:blobOrArray.length}var StreamSource=function(){return _createClass$4(function StreamSource(reader){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,StreamSource),this._buffer=void 0,this._bufferOffset=0,this._reader=reader,this._done=!1},[{key:"slice",value:function(start,end){return start<this._bufferOffset?Promise.reject(new Error("Requested data is before the reader's current offset")):this._readUntilEnoughDataOrDone(start,end)}},{key:"_readUntilEnoughDataOrDone",value:function(start,end){var _this=this,hasEnoughData=end<=this._bufferOffset+len(this._buffer);if(this._done||hasEnoughData){var value=this._getDataFromBuffer(start,end),done=null==value&&this._done;return Promise.resolve({value:value,done:done})}return this._reader.read().then(function(_ref){var value=_ref.value;return _ref.done?_this._done=!0:void 0===_this._buffer?_this._buffer=value:_this._buffer=function(a,b){if(a.concat)return a.concat(b);if(a instanceof Blob)return new Blob([a,b],{type:a.type});if(a.set){var c=new a.constructor(a.length+b.length);return c.set(a),c.set(b,a.length),c}throw new Error("Unknown data type")}(_this._buffer,value),_this._readUntilEnoughDataOrDone(start,end)})}},{key:"_getDataFromBuffer",value:function(start,end){start>this._bufferOffset&&(this._buffer=this._buffer.slice(start-this._bufferOffset),this._bufferOffset=start);var hasAllDataBeenRead=0===len(this._buffer);return this._done&&hasAllDataBeenRead?null:this._buffer.slice(0,end-start)}},{key:"close",value:function(){this._reader.cancel&&this._reader.cancel()}}])}();function _typeof$3(o){return _typeof$3="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$3(o)}function _regeneratorRuntime(){_regeneratorRuntime=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof$3(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof$3(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function asyncGeneratorStep(gen,resolve,reject,_next,_throw,key,arg){try{var info=gen[key](arg),value=info.value}catch(error){return void reject(error)}info.done?resolve(value):Promise.resolve(value).then(_next,_throw)}function _createClass$3(Constructor,protoProps,staticProps){return protoProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$3(descriptor.key),descriptor)}}(Constructor.prototype,protoProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey$3(t){var i=function(t,r){if("object"!=_typeof$3(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$3(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$3(i)?i:i+""}var FileReader$1=function(){return _createClass$3(function FileReader(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,FileReader)},[{key:"openFile",value:(fn=_regeneratorRuntime().mark(function _callee(input,chunkSize){var blob;return _regeneratorRuntime().wrap(function(_context){for(;;)switch(_context.prev=_context.next){case 0:if(!isReactNative$1()||!input||void 0===input.uri){_context.next=11;break}return _context.prev=1,_context.next=4,uriToBlob(input.uri);case 4:return blob=_context.sent,_context.abrupt("return",new FileSource(blob));case 8:throw _context.prev=8,_context.t0=_context.catch(1),new Error("tus: cannot fetch `file.uri` as Blob, make sure the uri is correct and accessible. ".concat(_context.t0));case 11:if("function"!=typeof input.slice||void 0===input.size){_context.next=13;break}return _context.abrupt("return",Promise.resolve(new FileSource(input)));case 13:if("function"!=typeof input.read){_context.next=18;break}if(chunkSize=Number(chunkSize),Number.isFinite(chunkSize)){_context.next=17;break}return _context.abrupt("return",Promise.reject(new Error("cannot create source for stream without a finite value for the `chunkSize` option")));case 17:return _context.abrupt("return",Promise.resolve(new StreamSource(input,chunkSize)));case 18:return _context.abrupt("return",Promise.reject(new Error("source object may only be an instance of File, Blob, or Reader in this environment")));case 19:case"end":return _context.stop()}},_callee,null,[[1,8]])}),_openFile=function(){var self=this,args=arguments;return new Promise(function(resolve,reject){var gen=fn.apply(self,args);function _next(value){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"next",value)}function _throw(err){asyncGeneratorStep(gen,resolve,reject,_next,_throw,"throw",err)}_next(void 0)})},function(_x,_x2){return _openFile.apply(this,arguments)})}]);var fn,_openFile}();function _typeof$2(o){return _typeof$2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$2(o)}function _classCallCheck$2(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _createClass$2(Constructor,protoProps,staticProps){return protoProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$2(descriptor.key),descriptor)}}(Constructor.prototype,protoProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey$2(t){var i=function(t,r){if("object"!=_typeof$2(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$2(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$2(i)?i:i+""}var XHRHttpStack=function(){return _createClass$2(function XHRHttpStack(){_classCallCheck$2(this,XHRHttpStack)},[{key:"createRequest",value:function(method,url){return new Request(method,url)}},{key:"getName",value:function(){return"XHRHttpStack"}}])}(),Request=function(){return _createClass$2(function Request(method,url){_classCallCheck$2(this,Request),this._xhr=new XMLHttpRequest,this._xhr.open(method,url,!0),this._method=method,this._url=url,this._headers={}},[{key:"getMethod",value:function(){return this._method}},{key:"getURL",value:function(){return this._url}},{key:"setHeader",value:function(header,value){this._xhr.setRequestHeader(header,value),this._headers[header]=value}},{key:"getHeader",value:function(header){return this._headers[header]}},{key:"setProgressHandler",value:function(progressHandler){"upload"in this._xhr&&(this._xhr.upload.onprogress=function(e){e.lengthComputable&&progressHandler(e.loaded)})}},{key:"send",value:function(){var _this=this,body=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;return new Promise(function(resolve,reject){_this._xhr.onload=function(){resolve(new Response(_this._xhr))},_this._xhr.onerror=function(err){reject(err)},_this._xhr.send(body)})}},{key:"abort",value:function(){return this._xhr.abort(),Promise.resolve()}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}(),Response=function(){return _createClass$2(function Response(xhr){_classCallCheck$2(this,Response),this._xhr=xhr},[{key:"getStatus",value:function(){return this._xhr.status}},{key:"getHeader",value:function(header){return this._xhr.getResponseHeader(header)}},{key:"getBody",value:function(){return this._xhr.responseText}},{key:"getUnderlyingObject",value:function(){return this._xhr}}])}();function _typeof$1(o){return _typeof$1="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof$1(o)}function _createClass$1(Constructor,protoProps,staticProps){return protoProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey$1(descriptor.key),descriptor)}}(Constructor.prototype,protoProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _toPropertyKey$1(t){var i=function(t,r){if("object"!=_typeof$1(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof$1(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==_typeof$1(i)?i:i+""}var hasStorage=!1;try{hasStorage="localStorage"in window;var key="tusSupport",originalValue=localStorage.getItem(key);localStorage.setItem(key,originalValue),null===originalValue&&localStorage.removeItem(key)}catch(e){if(e.code!==e.SECURITY_ERR&&e.code!==e.QUOTA_EXCEEDED_ERR)throw e;hasStorage=!1}var canStoreURLs=hasStorage,WebStorageUrlStorage=function(){return _createClass$1(function WebStorageUrlStorage(){!function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,WebStorageUrlStorage)},[{key:"findAllUploads",value:function(){var results=this._findEntries("tus::");return Promise.resolve(results)}},{key:"findUploadsByFingerprint",value:function(fingerprint){var results=this._findEntries("tus::".concat(fingerprint,"::"));return Promise.resolve(results)}},{key:"removeUpload",value:function(urlStorageKey){return localStorage.removeItem(urlStorageKey),Promise.resolve()}},{key:"addUpload",value:function(fingerprint,upload){var id=Math.round(1e12*Math.random()),key="tus::".concat(fingerprint,"::").concat(id);return localStorage.setItem(key,JSON.stringify(upload)),Promise.resolve(key)}},{key:"_findEntries",value:function(prefix){for(var results=[],i=0;i<localStorage.length;i++){var _key=localStorage.key(i);if(0===_key.indexOf(prefix))try{var upload=JSON.parse(localStorage.getItem(_key));upload.urlStorageKey=_key,results.push(upload)}catch(_e){}}return results}}])}();function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _createClass(Constructor,protoProps,staticProps){return staticProps&&function(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _callSuper(t,o,e){return o=_getPrototypeOf(o),function(self,call){if(call&&("object"===_typeof(call)||"function"==typeof call))return call;if(void 0!==call)throw new TypeError("Derived constructors may only return object or undefined");return function(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}(self)}(t,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t).constructor):o.apply(t,e))}function _isNativeReflectConstruct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_isNativeReflectConstruct=function(){return!!t})()}function _getPrototypeOf(o){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(o){return o.__proto__||Object.getPrototypeOf(o)},_getPrototypeOf(o)}function _setPrototypeOf(o,p){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(o,p){return o.__proto__=p,o},_setPrototypeOf(o,p)}function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _defineProperty(obj,key,value){return(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toPropertyKey(t){var i=function(t,r){if("object"!=_typeof(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=_typeof(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==_typeof(i)?i:i+""}var defaultOptions$8=_objectSpread(_objectSpread({},BaseUpload.defaultOptions),{},{httpStack:new XHRHttpStack,fileReader:new FileReader$1,urlStorage:canStoreURLs?new WebStorageUrlStorage:new NoopUrlStorage,fingerprint:function(file,options){return isReactNative$1()?Promise.resolve(function(file,options){var exifHash=file.exif?function(str){var hash=0;if(0===str.length)return hash;for(var i=0;i<str.length;i++){hash=(hash<<5)-hash+str.charCodeAt(i),hash&=hash}return hash}(JSON.stringify(file.exif)):"noexif";return["tus-rn",file.name||"noname",file.size||"nosize",exifHash,options.endpoint].join("/")}(file,options)):Promise.resolve(["tus-br",file.name,file.type,file.size,file.lastModified,options.endpoint].join("-"))}}),Upload=function(_BaseUpload){function Upload(){var file=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}(this,Upload),_callSuper(this,Upload,[file,options=_objectSpread(_objectSpread({},defaultOptions$8),options)])}return function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),Object.defineProperty(subClass,"prototype",{writable:!1}),superClass&&_setPrototypeOf(subClass,superClass)}(Upload,_BaseUpload),_createClass(Upload,0,[{key:"terminate",value:function(url){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return options=_objectSpread(_objectSpread({},defaultOptions$8),options),BaseUpload.terminate(url,options)}}])}(BaseUpload);exports.UploadStatus=void 0,function(UploadStatus){UploadStatus.PENDING="pending",UploadStatus.UPLOADING="uploading",UploadStatus.PROCESSING="processing",UploadStatus.COMPLETED="completed",UploadStatus.FAILED="failed",UploadStatus.CANCELLED="cancelled"}(exports.UploadStatus||(exports.UploadStatus={}));const isDevelopment="undefined"!=typeof process&&"development"===process.env.NODE_ENV,logger={error:(msg,meta)=>{isDevelopment&&console.error(`[ERROR] ${msg}`,meta)},warn:(msg,meta)=>{isDevelopment&&console.warn(`[WARN] ${msg}`,meta)},info:(msg,meta)=>{isDevelopment&&console.log(`[INFO] ${msg}`,meta)},debug:(msg,meta)=>{isDevelopment&&console.log(`[DEBUG] ${msg}`,meta)}},FILE_SIGNATURES={"image/jpeg":{mime:"image/jpeg",signatures:[[255,216,255,219],[255,216,255,224],[255,216,255,225],[255,216,255,226],[255,216,255,227]],description:"JPEG Image"},"image/png":{mime:"image/png",signatures:[[137,80,78,71,13,10,26,10]],description:"PNG Image"},"image/gif":{mime:"image/gif",signatures:[[71,73,70,56,55,97],[71,73,70,56,57,97]],description:"GIF Image"},"image/webp":{mime:"image/webp",signatures:[[82,73,70,70,null,null,null,null,87,69,66,80]],description:"WebP Image"},"image/bmp":{mime:"image/bmp",signatures:[[66,77]],description:"BMP Image"},"image/tiff":{mime:"image/tiff",signatures:[[73,73,42,0],[77,77,0,42]],description:"TIFF Image"},"application/pdf":{mime:"application/pdf",signatures:[[37,80,68,70,45]],description:"PDF Document"},"application/zip":{mime:"application/zip",signatures:[[80,75,3,4],[80,75,5,6],[80,75,7,8]],description:"ZIP Archive"},"application/x-rar-compressed":{mime:"application/x-rar-compressed",signatures:[[82,97,114,33,26,7,0],[82,97,114,33,26,7,1,0]],description:"RAR Archive"},"application/x-7z-compressed":{mime:"application/x-7z-compressed",signatures:[[55,122,188,175,39,28]],description:"7-Zip Archive"},"application/vnd.openxmlformats-officedocument.wordprocessingml.document":{mime:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",signatures:[[80,75,3,4]],description:"Microsoft Word Document (DOCX)"},"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":{mime:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",signatures:[[80,75,3,4]],description:"Microsoft Excel Spreadsheet (XLSX)"},"video/mp4":{mime:"video/mp4",signatures:[[0,0,0,null,102,116,121,112]],description:"MP4 Video"},"video/webm":{mime:"video/webm",signatures:[[26,69,223,163]],description:"WebM Video"},"audio/mpeg":{mime:"audio/mpeg",signatures:[[255,251],[255,243],[255,242],[73,68,51]],description:"MP3 Audio"},"audio/wav":{mime:"audio/wav",signatures:[[82,73,70,70,null,null,null,null,87,65,86,69]],description:"WAV Audio"}};async function verifyFileType(file,expectedType){try{const signature=FILE_SIGNATURES[expectedType];if(!signature)return logger.warn(`[Security] No signature defined for MIME type: ${expectedType}`),!0;const buffer=await file.slice(0,12).arrayBuffer(),bytes=new Uint8Array(buffer),isValid=signature.signatures.some(sig=>matchesSignature(bytes,sig));return isValid||logger.warn(`[Security] File signature mismatch for ${file.name}`,{declaredType:expectedType,fileBytes:Array.from(bytes.slice(0,8)).map(b=>`0x${b.toString(16).toUpperCase().padStart(2,"0")}`).join(" "),expectedSignatures:signature.signatures.map(s=>s.map(b=>null===b?"XX":`0x${b.toString(16).toUpperCase().padStart(2,"0")}`).join(" "))}),isValid}catch(error){return logger.error("[Security] Error verifying file type:",{error:error}),!1}}function matchesSignature(bytes,signature){return signature.every((expectedByte,index)=>null===expectedByte||bytes[index]===expectedByte)}const DANGEROUS_EXTENSIONS=[".exe",".com",".bat",".cmd",".sh",".bash",".zsh",".js",".mjs",".cjs",".vbs",".vbe",".ps1",".psm1",".php",".php3",".php4",".php5",".phtml",".phps",".asp",".aspx",".jsp",".jspx",".cgi",".pl",".py",".rb",".htaccess",".htpasswd",".ini",".conf",".scr",".pif",".application",".gadget",".msi",".msp",".jar",".war",".ear",".lnk",".url",".desktop",".hta",".htr"],DANGEROUS_CHARS=/[<>:"/\\|?*'\x00-\x1f\x7f]/g,PATH_TRAVERSAL=/\.\.[/\\]/g,RESERVED_NAMES=["CON","PRN","AUX","NUL","COM1","COM2","COM3","COM4","COM5","COM6","COM7","COM8","COM9","LPT1","LPT2","LPT3","LPT4","LPT5","LPT6","LPT7","LPT8","LPT9"];function sanitizeFilename(filename,options={}){const{replacement:replacement="_",maxLength:maxLength=200,preserveExtension:preserveExtension=!1,addTimestamp:addTimestamp=!0,lowercase:lowercase=!1,allowUnicode:allowUnicode=!0}=options;if(!filename||"string"!=typeof filename)return generateSafeFallbackName();let safe=filename;safe=safe.replace(/\0/g,""),safe=safe.replace(/^.*[/\\]/,""),safe=safe.replace(PATH_TRAVERSAL,replacement);const lastDotIndex=safe.lastIndexOf(".");let name=lastDotIndex>0?safe.substring(0,lastDotIndex):safe,ext=lastDotIndex>0?safe.substring(lastDotIndex):"";if(lowercase&&(name=name.toLowerCase(),ext=ext.toLowerCase()),!preserveExtension){DANGEROUS_EXTENSIONS.some(dangerousExt=>{const extLower=ext.toLowerCase(),nameLower=name.toLowerCase();return extLower===dangerousExt||!!nameLower.endsWith(dangerousExt)})&&(logger.warn(`[Security] Dangerous extension detected in: ${filename}`),ext=ext.replace(/\./g,"_")+".safe",name=name.replace(/\./g,"_"))}name=name.replace(DANGEROUS_CHARS,replacement),ext=ext.replace(DANGEROUS_CHARS,replacement),allowUnicode||(name=name.replace(/[^\x00-\x7F]/g,replacement),ext=ext.replace(/[^\x00-\x7F]/g,replacement)),name=name.replace(/^[.\s]+|[.\s]+$/g,""),ext=ext.replace(/^[.\s]+|[.\s]+$/g,"");const nameUpper=name.toUpperCase();RESERVED_NAMES.includes(nameUpper)&&(logger.warn(`[Security] Reserved Windows filename detected: ${name}`),name=`file_${name}`);const multipleReplacement=new RegExp(`${escapeRegex(replacement)}{2,}`,"g");if(name=name.replace(multipleReplacement,replacement),name&&name!==replacement||(name="unnamed"),addTimestamp){const timestamp=Date.now();name=`${name}_${timestamp}`}const maxNameLength=Math.min(maxLength,255-ext.length-1);name.length>maxNameLength&&(name=name.substring(0,maxNameLength),name=name.replace(new RegExp(`${escapeRegex(replacement)}+$`),"")),ext&&!ext.startsWith(".")&&(ext="."+ext);const sanitized=name+ext;return sanitized.length>255?(logger.warn(`[Security] Filename too long after sanitization: ${sanitized.length} bytes`),generateSafeFallbackName()):(sanitized!==filename&&logger.info(`[Security] Filename sanitized: "${filename}" -> "${sanitized}"`),sanitized)}function generateSafeFallbackName(){return`file_${Date.now()}_${Math.random().toString(36).substring(2,8)}`}function escapeRegex(str){return str.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function fileSizeValidator(context){const{component:component,value:value}=context;if(!value)return!0;const files=Array.isArray(value)?value:[value],maxSize=parseFileSize(component.fileMaxSize),minSize=parseFileSize(component.fileMinSize);for(const file of files){if(maxSize&&file.size>maxSize)return`File ${file.name} exceeds maximum size of ${component.fileMaxSize}`;if(minSize&&file.size<minSize)return`File ${file.name} is smaller than minimum size of ${component.fileMinSize}`}return!0}function fileTypeValidator(context){const{component:component,value:value}=context;if(!value||!component.filePattern||"*"===component.filePattern)return!0;const files=Array.isArray(value)?value:[value],allowedTypes=(pattern=component.filePattern)&&"*"!==pattern?pattern.split(",").map(p=>p.trim()):["*"];var pattern;for(const file of files){const fileExt=file.name.substring(file.name.lastIndexOf(".")).toLowerCase(),fileMime=file.type;let isAllowed=!1;for(const pattern of allowedTypes){if(pattern.startsWith(".")&&fileExt===pattern){isAllowed=!0;break}if(pattern.includes("/")&&fileMime.match(new RegExp(pattern.replace("*",".*")))){isAllowed=!0;break}}if(!isAllowed)return`File type ${fileExt} is not allowed. Allowed types: ${component.filePattern}`}return!0}async function virusScanValidator(context){const{component:component,value:value}=context;return value&&component.virusScan,!0}function imageResolutionValidator(context){const{component:component,value:value}=context;if(!value||!component.imageMinResolution&&!component.imageMaxResolution)return!0;const files=Array.isArray(value)?value:[value];for(const file of files)file.type.startsWith("image/");return!0}function parseFileSize(size){if(!size)return null;const match=size.match(/^(\d+(?:\.\d+)?)\s*([KMGT]?B)$/i);if(!match)return null;return parseFloat(match[1])*({B:1,KB:1024,MB:1048576,GB:1073741824,TB:1099511627776}[match[2].toUpperCase()]||1)}const FileComponent$2=js.Components.components.file;class TusFileUploadComponent extends FileComponent$2{static schema(...extend){return FileComponent$2.schema({type:"tusupload",label:"TUS File Upload",key:"tusupload",storage:"tus",url:"",options:{uploadOnly:!1},filePattern:"*",fileMinSize:"0KB",fileMaxSize:"1GB",uploadOnly:!1,...extend})}static get builderInfo(){return{title:"TUS File Upload",icon:"cloud-upload",group:"premium",documentation:"/userguide/forms/premium-components#file-upload",weight:100,schema:TusFileUploadComponent.schema()}}static editForm(){return FileComponent$2.editForm([{key:"display",components:[{key:"displayBasic",components:[{type:"textfield",key:"tusEndpoint",label:"TUS Upload Endpoint",placeholder:"https://example.com/files",weight:25,tooltip:"The TUS server endpoint for resumable uploads",input:!0},{type:"number",key:"chunkSize",label:"Chunk Size (MB)",defaultValue:8,weight:26,tooltip:"Size of each upload chunk in megabytes",input:!0},{type:"checkbox",key:"resumable",label:"Enable Resumable Uploads",defaultValue:!0,weight:27,tooltip:"Allow uploads to resume after connection loss",input:!0}]}]},{key:"validation",components:[{key:"validationBasic",components:[{type:"textfield",key:"filePattern",label:"File Pattern",placeholder:"*.pdf,*.doc,*.docx",weight:10,tooltip:"Allowed file extensions",input:!0},{type:"textfield",key:"fileMinSize",label:"Minimum File Size",placeholder:"1KB",weight:11,tooltip:"Minimum allowed file size",input:!0},{type:"textfield",key:"fileMaxSize",label:"Maximum File Size",placeholder:"10MB",weight:12,tooltip:"Maximum allowed file size",input:!0}]}]}])}constructor(component,options,data){super(component,options,data),this.currentFile=null,this.uploadQueue=[],this.isUploading=!1,this.rafPending=!1,this.cachedTusConfig=null,this.component.storage="tus",this.component.url=this.component.tusEndpoint||this.component.url||"/files"}init(){super.init(),this.initializeTusClient()}initializeTusClient(){this.cachedTusConfig={endpoint:this.component.url||"/files",chunkSize:1024*(this.component.chunkSize||8)*1024,retryDelays:[0,3e3,5e3,1e4,2e4],headers:this.getHeaders()},this.tusUpload=null}getHeaders(){const headers={"x-jwt-token":this.root?.token||""};return this.component.headers&&Object.assign(headers,this.component.headers),headers}getMetadata(){return{filename:"",filetype:"",formId:this.root?.formId||"",submissionId:this.root?.submissionId||"",fieldKey:this.component.key||""}}attach(element){this.loadRefs(element,{fileDrop:"single",fileBrowse:"single",galleryButton:"single",cameraButton:"single",fileUpload:"single",hiddenFileInputElement:"single",fileList:"single",camera:"single",canvas:"single",fileStatusUploading:"multiple",fileImage:"multiple",fileError:"multiple",fileLink:"multiple",removeLink:"multiple",fileStatusRemove:"multiple",fileSize:"multiple",fileUploadingStatus:"multiple",fileProcessingStatus:"multiple",fileProgress:"multiple",fileProgressInner:"multiple"});const superAttach=super.attach(element);return this.refs.fileBrowse&&this.addEventListener(this.refs.fileBrowse,"click",event=>{event.preventDefault(),event.stopPropagation(),this.refs.hiddenFileInputElement&&this.refs.hiddenFileInputElement.click()}),superAttach}async upload(files){this.uploadQueue=files;const parallelLimit=this.component.parallelUploads||3,results=[];for(let i=0;i<files.length;i+=parallelLimit){const batch=files.slice(i,i+parallelLimit),batchResults=await Promise.all(batch.map(async file=>{this.isUploading=!0;try{const validationResult=await this.validateFile(file);if(!validationResult.valid)throw new Error(validationResult.error||"File validation failed");const result=await this.uploadFile(file);return this.emit("fileUploadComplete",result),result}catch(error){return logger.error("[TUS] Upload error:",{error:error}),this.emit("fileUploadError",error),{error:error}}}));results.push(...batchResults)}return this.isUploading=!1,this.uploadQueue=[],results}async validateFile(file){const maxSize=this.parseFileSize(this.component.fileMaxSize),minSize=this.parseFileSize(this.component.fileMinSize);if(maxSize&&file.size>maxSize)return{valid:!1,error:`File size exceeds maximum allowed (${this.component.fileMaxSize})`};if(minSize&&file.size<minSize)return{valid:!1,error:`File size is below minimum required (${this.component.fileMinSize})`};if(this.component.filePattern&&"*"!==this.component.filePattern){const allowedTypes=this.parseFilePattern(this.component.filePattern),fileExt=file.name.substring(file.name.lastIndexOf(".")).toLowerCase();if(!allowedTypes.some(pattern=>pattern.startsWith(".")?fileExt===pattern:!!pattern.includes("/")&&file.type.match(new RegExp(pattern.replace("*",".*")))))return{valid:!1,error:`File type not allowed. Allowed: ${this.component.filePattern}`}}return{valid:!0}}parseFileSize(size){if(!size)return null;const match=size.match(/^(\d+(?:\.\d+)?)\s*([KMGT]?B)$/i);if(!match)return null;return parseFloat(match[1])*({B:1,KB:1024,MB:1048576,GB:1073741824}[match[2].toUpperCase()]||1)}parseFilePattern(pattern){return pattern&&"*"!==pattern?pattern.split(",").map(p=>p.trim()):["*"]}async uploadFile(file){return new Promise(async(resolve,reject)=>{const safeName=sanitizeFilename(file.name,{addTimestamp:!0,preserveExtension:!1});if(!await verifyFileType(file,file.type))return void reject({id:this.generateFileId(),name:safeName,size:file.size,type:file.type,storage:"tus",status:exports.UploadStatus.FAILED,error:{code:"INVALID_FILE_TYPE",message:"File content does not match declared type. This file may be dangerous."},createdAt:new Date,updatedAt:new Date});const uploadFile={id:this.generateFileId(),name:safeName,originalName:file.name,size:file.size,type:file.type,storage:"tus",status:exports.UploadStatus.PENDING,createdAt:new Date,updatedAt:new Date},upload=new Upload(file,{...this.cachedTusConfig,metadata:{...this.getMetadata(),filename:safeName,originalFilename:file.name,filetype:file.type||"application/octet-stream"},onError:error=>{logger.error("[TUS] Upload failed:",{error:error.message,stack:error.stack}),uploadFile.status=exports.UploadStatus.FAILED,uploadFile.error={code:"UPLOAD_ERROR",message:error.message},reject(uploadFile)},onProgress:(bytesUploaded,bytesTotal)=>{const percentage=(bytesUploaded/bytesTotal*100).toFixed(2);uploadFile.progress=parseFloat(percentage),uploadFile.status=exports.UploadStatus.UPLOADING,this.updateProgress(uploadFile)},onSuccess:()=>{uploadFile.status=exports.UploadStatus.COMPLETED,uploadFile.url=upload.url??void 0,uploadFile.uploadId=upload.url?.split("/").pop();const fileData={name:uploadFile.name,size:uploadFile.size,type:uploadFile.type,url:uploadFile.url,storage:"tus",originalName:file.name,uploadId:uploadFile.uploadId};if(this.component.multiple){const currentValue=this.dataValue||[];this.dataValue=Array.isArray(currentValue)?[...currentValue,fileData]:[fileData]}else this.dataValue=fileData;this.updateValue(),this.triggerChange(),this.updateProgress(uploadFile),resolve(uploadFile)}});this.tusUpload=upload,this.currentFile=uploadFile,upload.start(),this.emit("fileUploadStart",uploadFile)})}updateProgress(file){this.rafPending||(this.rafPending=!0,requestAnimationFrame(()=>{if(this.refs.fileProgress&&this.refs.fileProgress.length>0){const progressBar=this.refs.fileProgress[0];progressBar&&(progressBar.style.width=`${file.progress||0}%`)}this.emit("fileUploadProgress",{file:file,progress:file.progress||0}),this.rafPending=!1}))}pauseUpload(){this.tusUpload&&(this.tusUpload.abort(),this.emit("fileUploadPaused",this.currentFile))}resumeUpload(){this.tusUpload&&(this.tusUpload.start(),this.emit("fileUploadResumed",this.currentFile))}cancelUpload(){this.tusUpload&&(this.tusUpload.abort(),this.tusUpload=null,this.currentFile=null,this.emit("fileUploadCancelled"))}generateFileId(){return`tus_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getValue(){return this.dataValue}setValue(value,flags={}){const changed=super.setValue(value,flags);return changed&&(this.redraw(),this.triggerChange()),changed}getValueAsString(value){return Array.isArray(value)?value.map(val=>val.name||val.url||"").join(", "):value?.name||value?.url||""}getView(value){return value?Array.isArray(value)?value.map(file=>`<a href="${file.url}" target="_blank" rel="noopener noreferrer">${file.name}</a>`).join("<br>"):`<a href="${value.url}" target="_blank" rel="noopener noreferrer">${value.name}</a>`:""}}function hasProperty(object,key){return Object.hasOwn(object,key)}const DATA_URL_PATTERN=/^data:([^/]+\/[^,;]+(?:[^,]*?))(;base64)?,([\s\S]*)$/;class ErrorWithCause extends Error{isNetworkError;cause;constructor(message,options){super(message),this.cause=options?.cause,this.cause&&hasProperty(this.cause,"isNetworkError")?this.isNetworkError=this.cause.isNetworkError:this.isNetworkError=!1}}function emaFilter(newValue,previousSmoothedValue,halfLife,dt){return newValue===previousSmoothedValue?newValue:0===dt?previousSmoothedValue:newValue+(previousSmoothedValue-newValue)*2**(-dt/halfLife)}var FOCUSABLE_ELEMENTS=['a[href]:not([tabindex^="-"]):not([inert]):not([aria-hidden])','area[href]:not([tabindex^="-"]):not([inert]):not([aria-hidden])',"input:not([disabled]):not([inert]):not([aria-hidden])","select:not([disabled]):not([inert]):not([aria-hidden])","textarea:not([disabled]):not([inert]):not([aria-hidden])","button:not([disabled]):not([inert]):not([aria-hidden])",'iframe:not([tabindex^="-"]):not([inert]):not([aria-hidden])','object:not([tabindex^="-"]):not([inert]):not([aria-hidden])','embed:not([tabindex^="-"]):not([inert]):not([aria-hidden])','[contenteditable]:not([tabindex^="-"]):not([inert]):not([aria-hidden])','[tabindex]:not([tabindex^="-"]):not([inert]):not([aria-hidden])'];class NetworkError extends Error{cause;isNetworkError;request;constructor(error,xhr=null){super("This looks like a network error, the endpoint might be blocked by an internet provider or a firewall."),this.cause=error,this.isNetworkError=!0,this.request=xhr}}function isDOMElement(obj){return"object"==typeof obj&&null!==obj&&("nodeType"in obj&&obj.nodeType===Node.ELEMENT_NODE)}function findAllDOMElements(element){if("string"==typeof element){const elements=document.querySelectorAll(element);return 0===elements.length?null:Array.from(elements)}return"object"==typeof element&&isDOMElement(element)?[element]:null}function getFileNameAndExtension(fullFileName){const lastDot=fullFileName.lastIndexOf(".");return-1===lastDot||lastDot===fullFileName.length-1?{name:fullFileName,extension:void 0}:{name:fullFileName.slice(0,lastDot),extension:fullFileName.slice(lastDot+1)}}var mimeTypes={__proto__:null,md:"text/markdown",markdown:"text/markdown",mp4:"video/mp4",mp3:"audio/mp3",svg:"image/svg+xml",jpg:"image/jpeg",png:"image/png",webp:"image/webp",gif:"image/gif",heic:"image/heic",heif:"image/heif",yaml:"text/yaml",yml:"text/yaml",csv:"text/csv",tsv:"text/tab-separated-values",tab:"text/tab-separated-values",avi:"video/x-msvideo",mks:"video/x-matroska",mkv:"video/x-matroska",mov:"video/quicktime",dicom:"application/dicom",doc:"application/msword",msg:"application/vnd.ms-outlook",docm:"application/vnd.ms-word.document.macroenabled.12",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",dot:"application/msword",dotm:"application/vnd.ms-word.template.macroenabled.12",dotx:"application/vnd.openxmlformats-officedocument.wordprocessingml.template",xla:"application/vnd.ms-excel",xlam:"application/vnd.ms-excel.addin.macroenabled.12",xlc:"application/vnd.ms-excel",xlf:"application/x-xliff+xml",xlm:"application/vnd.ms-excel",xls:"application/vnd.ms-excel",xlsb:"application/vnd.ms-excel.sheet.binary.macroenabled.12",xlsm:"application/vnd.ms-excel.sheet.macroenabled.12",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xlt:"application/vnd.ms-excel",xltm:"application/vnd.ms-excel.template.macroenabled.12",xltx:"application/vnd.openxmlformats-officedocument.spreadsheetml.template",xlw:"application/vnd.ms-excel",txt:"text/plain",text:"text/plain",conf:"text/plain",log:"text/plain",pdf:"application/pdf",zip:"application/zip","7z":"application/x-7z-compressed",rar:"application/x-rar-compressed",tar:"application/x-tar",gz:"application/gzip",dmg:"application/x-apple-diskimage"};function getFileType(file){if(file.type)return file.type;const fileExtension=file.name?getFileNameAndExtension(file.name).extension?.toLowerCase():null;return fileExtension&&fileExtension in mimeTypes?mimeTypes[fileExtension]:"application/octet-stream"}function encodeFilename(name){let suffix="";return name.replace(/[^A-Z0-9]/gi,character=>(suffix+=`-${function(character){return character.charCodeAt(0).toString(32)}(character)}`,"/"))+suffix}function getSafeFileId(file,instanceId){if(function(file){return!(!file.isRemote||!file.remote)&&new Set(["box","dropbox","drive","facebook","unsplash"]).has(file.remote.provider)}(file))return file.id;const fileType=getFileType(file);return function(file,instanceId){let id=instanceId||"uppy";return"string"==typeof file.name&&(id+=`-${encodeFilename(file.name.toLowerCase())}`),void 0!==file.type&&(id+=`-${file.type}`),file.meta&&"string"==typeof file.meta.relativePath&&(id+=`-${encodeFilename(file.meta.relativePath.toLowerCase())}`),void 0!==file.data.size&&(id+=`-${file.data.size}`),void 0!==file.data.lastModified&&(id+=`-${file.data.lastModified}`),id}({...file,type:fileType},instanceId)}var toArray=Array.from;function getFilesAndDirectoriesFromDirectory(directoryReader,oldEntries,logDropError,{onSuccess:onSuccess}){directoryReader.readEntries(entries=>{const newEntries=[...oldEntries,...entries];entries.length?queueMicrotask(()=>{getFilesAndDirectoriesFromDirectory(directoryReader,newEntries,logDropError,{onSuccess:onSuccess})}):onSuccess(newEntries)},error=>{logDropError(error),onSuccess(oldEntries)})}function getAsFileSystemHandleFromEntry(entry,logDropError){return null==entry?entry:{kind:entry.isFile?"file":entry.isDirectory?"directory":void 0,name:entry.name,getFile:()=>new Promise((resolve,reject)=>entry.file(resolve,reject)),async*values(){const directoryReader=entry.createReader(),entries=await new Promise(resolve=>{getFilesAndDirectoriesFromDirectory(directoryReader,[],logDropError,{onSuccess:dirEntries=>resolve(dirEntries.map(file=>getAsFileSystemHandleFromEntry(file,logDropError)))})});yield*entries},isSameEntry:void 0}}async function*createPromiseToAddFileOrParseDirectory(entry,relativePath,lastResortFile=void 0){const getNextRelativePath=()=>`${relativePath}/${entry.name}`;if("file"===entry.kind){const file=await entry.getFile();null!=file?(file.relativePath=relativePath?getNextRelativePath():null,yield file):null!=lastResortFile&&(yield lastResortFile)}else if("directory"===entry.kind)for await(const handle of entry.values())yield*createPromiseToAddFileOrParseDirectory(handle,relativePath?getNextRelativePath():entry.name);else null!=lastResortFile&&(yield lastResortFile)}async function getDroppedFiles(dataTransfer,options){const logDropError=options?.logDropError??Function.prototype;try{const accumulator=[];for await(const file of async function*(dataTransfer,logDropError){const fileSystemHandles=await Promise.all(Array.from(dataTransfer.items,async item=>{let fileSystemHandle;return fileSystemHandle??=getAsFileSystemHandleFromEntry("function"==typeof item.getAsEntry?item.getAsEntry():item.webkitGetAsEntry(),logDropError),{fileSystemHandle:fileSystemHandle,lastResortFile:item.getAsFile()}}));for(const{lastResortFile:lastResortFile,fileSystemHandle:fileSystemHandle}of fileSystemHandles)if(null!=fileSystemHandle)try{yield*createPromiseToAddFileOrParseDirectory(fileSystemHandle,"",lastResortFile)}catch(err){null!=lastResortFile?yield lastResortFile:logDropError(err)}else null!=lastResortFile&&(yield lastResortFile)}(dataTransfer,logDropError))accumulator.push(file);return accumulator}catch{return function(dataTransfer){const files=toArray(dataTransfer.files);return Promise.resolve(files)}(dataTransfer)}}const mimeToExtensions={__proto__:null,"audio/mp3":"mp3","audio/mp4":"mp4","audio/ogg":"ogg","audio/webm":"webm","image/gif":"gif","image/heic":"heic","image/heif":"heif","image/jpeg":"jpg","image/webp":"webp","image/png":"png","image/svg+xml":"svg","video/mp4":"mp4","video/ogg":"ogv","video/quicktime":"mov","video/webm":"webm","video/x-matroska":"mkv","video/x-msvideo":"avi"};function getFileTypeExtension(mimeType){return[mimeType]=mimeType.split(";",1),mimeToExtensions[mimeType]||null}function pad(number){return number<10?`0${number}`:number.toString()}function getTimeStamp(){const date=new Date;return`${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`}function isDragDropSupported(){if("undefined"==typeof window)return!1;const body=document.body;return null!=body&&null!=window&&("draggable"in body&&"ondragstart"in body&&"ondrop"in body&&("FormData"in window&&"FileReader"in window))}function isObjectURL(url){return url.startsWith("blob:")}function isPreviewSupported(fileType){return!!fileType&&/^[^/]+\/(jpe?g|gif|png|svg|svg\+xml|bmp|webp|avif)$/.test(fileType)}function prettyETA(seconds){const time=(rawSeconds=seconds,{hours:Math.floor(rawSeconds/3600)%24,minutes:Math.floor(rawSeconds/60)%60,seconds:Math.floor(rawSeconds%60)});var rawSeconds;return`${0===time.hours?"":`${time.hours}h`}${0===time.minutes?"":`${0===time.hours?time.minutes:` ${time.minutes.toString(10).padStart(2,"0")}`}m`}${0!==time.hours?"":`${0===time.minutes?time.seconds:` ${time.seconds.toString(10).padStart(2,"0")}`}s`}`}function abortOn(signal){if(null!=signal){const abortPromise=()=>this.abort(signal.reason);signal.addEventListener("abort",abortPromise,{once:!0});const removeAbortListener=()=>{signal.removeEventListener("abort",abortPromise)};this.then?.(removeAbortListener,removeAbortListener)}return this}class RateLimitedQueue{#activeRequests=0;#queuedHandlers=[];#paused=!1;#pauseTimer;#downLimit=1;#upperLimit;#rateLimitingTimer;limit;constructor(limit){this.limit="number"!=typeof limit||0===limit?1/0:limit}#call(fn){this.#activeRequests+=1;let cancelActive,done=!1;try{cancelActive=fn()}catch(err){throw this.#activeRequests-=1,err}return{abort:cause=>{done||(done=!0,this.#activeRequests-=1,cancelActive?.(cause),this.#queueNext())},done:()=>{done||(done=!0,this.#activeRequests-=1,this.#queueNext())}}}#queueNext(){queueMicrotask(()=>this.#next())}#next(){if(this.#paused||this.#activeRequests>=this.limit)return;if(0===this.#queuedHandlers.length)return;const next=this.#queuedHandlers.shift();if(null==next)throw new Error("Invariant violation: next is null");const handler=this.#call(next.fn);next.abort=handler.abort,next.done=handler.done}#queue(fn,options){const handler={fn:fn,priority:options?.priority||0,abort:()=>{this.#dequeue(handler)},done:()=>{throw new Error("Cannot mark a queued request as done: this indicates a bug")}},index=this.#queuedHandlers.findIndex(other=>handler.priority>other.priority);return-1===index?this.#queuedHandlers.push(handler):this.#queuedHandlers.splice(index,0,handler),handler}#dequeue(handler){const index=this.#queuedHandlers.indexOf(handler);-1!==index&&this.#queuedHandlers.splice(index,1)}run(fn,queueOptions){return!this.#paused&&this.#activeRequests<this.limit?this.#call(fn):this.#queue(fn,queueOptions)}wrapSyncFunction(fn,queueOptions){return(...args)=>{const queuedRequest=this.run(()=>(fn(...args),queueMicrotask(()=>queuedRequest.done()),()=>{}),queueOptions);return{abortOn:abortOn,abort(){queuedRequest.abort()}}}}wrapPromiseFunction(fn,queueOptions){return(...args)=>{let queuedRequest;const outerPromise=new Promise((resolve,reject)=>{queuedRequest=this.run(()=>{let cancelError,innerPromise;try{innerPromise=Promise.resolve(fn(...args))}catch(err){innerPromise=Promise.reject(err)}return innerPromise.then(result=>{cancelError?reject(cancelError):(queuedRequest.done(),resolve(result))},err=>{cancelError?reject(cancelError):(queuedRequest.done(),reject(err))}),cause=>{cancelError=function(cause){return new Error("Cancelled",{cause:cause})}(cause)}},queueOptions)});return outerPromise.abort=cause=>{queuedRequest.abort(cause)},outerPromise.abortOn=abortOn,outerPromise}}resume(){this.#paused=!1,clearTimeout(this.#pauseTimer);for(let i=0;i<this.limit;i++)this.#queueNext()}#resume=()=>this.resume();pause(duration=null){this.#paused=!0,clearTimeout(this.#pauseTimer),null!=duration&&(this.#pauseTimer=setTimeout(this.#resume,duration))}rateLimit(duration){clearTimeout(this.#rateLimitingTimer),this.pause(duration),this.limit>1&&Number.isFinite(this.limit)&&(this.#upperLimit=this.limit-1,this.limit=this.#downLimit,this.#rateLimitingTimer=setTimeout(this.#increaseLimit,duration))}#increaseLimit=()=>{if(this.#paused)this.#rateLimitingTimer=setTimeout(this.#increaseLimit,0);else{this.#downLimit=this.limit,this.limit=Math.ceil((this.#upperLimit+this.#downLimit)/2);for(let i=this.#downLimit;i<=this.limit;i++)this.#queueNext();this.#upperLimit-this.#downLimit>3?this.#rateLimitingTimer=setTimeout(this.#increaseLimit,2e3):this.#downLimit=Math.floor(this.#downLimit/2)}};get isPaused(){return this.#paused}}function insertReplacement(source,rx,replacement){const newParts=[];return source.forEach(chunk=>"string"!=typeof chunk?newParts.push(chunk):rx[Symbol.split](chunk).forEach((raw,i,list)=>{""!==raw&&newParts.push(raw),i<list.length-1&&newParts.push(replacement)})),newParts}function interpolate(phrase,options){const dollarRegex=/\$/g;let interpolated=[phrase];if(null==options)return interpolated;for(const arg of Object.keys(options))if("_"!==arg){let replacement=options[arg];"string"==typeof replacement&&(replacement=dollarRegex[Symbol.replace](replacement,"$$$$")),interpolated=insertReplacement(interpolated,new RegExp(`%\\{${arg}\\}`,"g"),replacement)}return interpolated}const defaultOnMissingKey=key=>{throw new Error(`missing string: ${key}`)};class Translator{locale;constructor(locales,{onMissingKey:onMissingKey=defaultOnMissingKey}={}){this.locale={strings:{},pluralize:n=>1===n?0:1},Array.isArray(locales)?locales.forEach(this.#apply,this):this.#apply(locales),this.#onMissingKey=onMissingKey}#onMissingKey;#apply(locale){if(!locale?.strings)return;const prevLocale=this.locale;Object.assign(this.locale,{strings:{...prevLocale.strings,...locale.strings},pluralize:locale.pluralize||prevLocale.pluralize})}translate(key,options){return this.translateArray(key,options).join("")}translateArray(key,options){let string=this.locale.strings[key];null==string&&(this.#onMissingKey(key),string=key);if("object"==typeof string){if(options&&void 0!==options.smart_count){return interpolate(string[this.locale.pluralize(options.smart_count)],options)}throw new Error("Attempted to use a string with plural forms, but no value was given for %{smart_count}")}if("string"!=typeof string)throw new Error("string was not a string");return interpolate(string,options)}}function truncateString(string,maxLength){if(0===maxLength)return"";if(string.length<=maxLength)return string;if(maxLength<=4)return`${string.slice(0,maxLength-1)}`;const charsToShow=maxLength-3,frontChars=Math.ceil(charsToShow/2),backChars=Math.floor(charsToShow/2);return string.slice(0,frontChars)+"..."+string.slice(-backChars)}class UserFacingApiError extends Error{name="UserFacingApiError"}var n$1,l$2,u$3,i$2,r$2,o$2,e$2,f$3,c$2,s$2,a$2,p$2={},v$2=[],y$2=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,w$2=Array.isArray;function d$2(n,l){for(var u in l)n[u]=l[u];return n}function g$1(n){n&&n.parentNode&&n.parentNode.removeChild(n)}function _$1(l,u,t){var i,r,o,e={};for(o in u)"key"==o?i=u[o]:"ref"==o?r=u[o]:e[o]=u[o];if(arguments.length>2&&(e.children=arguments.length>3?n$1.call(arguments,2):t),"function"==typeof l&&null!=l.defaultProps)for(o in l.defaultProps)void 0===e[o]&&(e[o]=l.defaultProps[o]);return m$2(l,e,i,r,null)}function m$2(n,t,i,r,o){var e={type:n,props:t,key:i,ref:r,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==o?++u$3:o,__i:-1,__u:0};return null==o&&null!=l$2.vnode&&l$2.vnode(e),e}function k$2(n){return n.children}function x(n,l){this.props=n,this.context=l}function S$1(n,l){if(null==l)return n.__?S$1(n.__,n.__i+1):null;for(var u;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e)return u.__e;return"function"==typeof n.type?S$1(n):null}function C$1(n){var l,u;if(null!=(n=n.__)&&null!=n.__c){for(n.__e=n.__c.base=null,l=0;l<n.__k.length;l++)if(null!=(u=n.__k[l])&&null!=u.__e){n.__e=n.__c.base=u.__e;break}return C$1(n)}}function M$1(n){(!n.__d&&(n.__d=!0)&&i$2.push(n)&&!$$1.__r++||r$2!=l$2.debounceRendering)&&((r$2=l$2.debounceRendering)||o$2)($$1)}function $$1(){for(var n,u,t,r,o,f,c,s=1;i$2.length;)i$2.length>s&&i$2.sort(e$2),n=i$2.shift(),s=i$2.length,n.__d&&(t=void 0,r=void 0,o=(r=(u=n).__v).__e,f=[],c=[],u.__P&&((t=d$2({},r)).__v=r.__v+1,l$2.vnode&&l$2.vnode(t),O$1(u.__P,t,r,u.__n,u.__P.namespaceURI,32&r.__u?[o]:null,f,null==o?S$1(r):o,!!(32&r.__u),c),t.__v=r.__v,t.__.__k[t.__i]=t,N$1(f,t,c),r.__e=r.__=null,t.__e!=o&&C$1(t)));$$1.__r=0}function I$1(n,l,u,t,i,r,o,e,f,c,s){var a,h,y,w,d,g,_,m=t&&t.__k||v$2,b=l.length;for(f=function(n,l,u,t,i){var r,o,e,f,c,s=u.length,a=s,h=0;for(n.__k=new Array(i),r=0;r<i;r++)null!=(o=l[r])&&"boolean"!=typeof o&&"function"!=typeof o?(f=r+h,(o=n.__k[r]="string"==typeof o||"number"==typeof o||"bigint"==typeof o||o.constructor==String?m$2(null,o,null,null,null):w$2(o)?m$2(k$2,{children:o},null,null,null):null==o.constructor&&o.__b>0?m$2(o.type,o.props,o.key,o.ref?o.ref:null,o.__v):o).__=n,o.__b=n.__b+1,e=null,-1!=(c=o.__i=L$1(o,u,f,a))&&(a--,(e=u[c])&&(e.__u|=2)),null==e||null==e.__v?(-1==c&&(i>s?h--:i<s&&h++),"function"!=typeof o.type&&(o.__u|=4)):c!=f&&(c==f-1?h--:c==f+1?h++:(c>f?h--:h++,o.__u|=4))):n.__k[r]=null;if(a)for(r=0;r<s;r++)null!=(e=u[r])&&!(2&e.__u)&&(e.__e==t&&(t=S$1(e)),D$2(e,e));return t}(u,l,m,f,b),a=0;a<b;a++)null!=(y=u.__k[a])&&(h=-1==y.__i?p$2:m[y.__i]||p$2,y.__i=a,g=O$1(n,y,h,i,r,o,e,f,c,s),w=y.__e,y.ref&&h.ref!=y.ref&&(h.ref&&B$2(h.ref,null,y),s.push(y.ref,y.__c||w,y)),null==d&&null!=w&&(d=w),(_=!!(4&y.__u))||h.__k===y.__k?f=A$2(y,f,n,_):"function"==typeof y.type&&void 0!==g?f=g:w&&(f=w.nextSibling),y.__u&=-7);return u.__e=d,f}function A$2(n,l,u,t){var i,r;if("function"==typeof n.type){for(i=n.__k,r=0;i&&r<i.length;r++)i[r]&&(i[r].__=n,l=A$2(i[r],l,u,t));return l}n.__e!=l&&(t&&(l&&n.type&&!l.parentNode&&(l=S$1(n)),u.insertBefore(n.__e,l||null)),l=n.__e);do{l=l&&l.nextSibling}while(null!=l&&8==l.nodeType);return l}function H$1(n,l){return l=l||[],null==n||"boolean"==typeof n||(w$2(n)?n.some(function(n){H$1(n,l)}):l.push(n)),l}function L$1(n,l,u,t){var i,r,o,e=n.key,f=n.type,c=l[u],s=null!=c&&!(2&c.__u);if(null===c&&null==n.key||s&&e==c.key&&f==c.type)return u;if(t>(s?1:0))for(i=u-1,r=u+1;i>=0||r<l.length;)if(null!=(c=l[o=i>=0?i--:r++])&&!(2&c.__u)&&e==c.key&&f==c.type)return o;return-1}function T$2(n,l,u){"-"==l[0]?n.setProperty(l,null==u?"":u):n[l]=null==u?"":"number"!=typeof u||y$2.test(l)?u:u+"px"}function j$2(n,l,u,t,i){var r,o;n:if("style"==l)if("string"==typeof u)n.style.cssText=u;else{if("string"==typeof t&&(n.style.cssText=t=""),t)for(l in t)u&&l in u||T$2(n.style,l,"");if(u)for(l in u)t&&u[l]==t[l]||T$2(n.style,l,u[l])}else if("o"==l[0]&&"n"==l[1])r=l!=(l=l.replace(f$3,"$1")),o=l.toLowerCase(),l=o in n||"onFocusOut"==l||"onFocusIn"==l?o.slice(2):l.slice(2),n.l||(n.l={}),n.l[l+r]=u,u?t?u.u=t.u:(u.u=c$2,n.addEventListener(l,r?a$2:s$2,r)):n.removeEventListener(l,r?a$2:s$2,r);else{if("http://www.w3.org/2000/svg"==i)l=l.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=l&&"height"!=l&&"href"!=l&&"list"!=l&&"form"!=l&&"tabIndex"!=l&&"download"!=l&&"rowSpan"!=l&&"colSpan"!=l&&"role"!=l&&"popover"!=l&&l in n)try{n[l]=null==u?"":u;break n}catch(n){}"function"==typeof u||(null==u||!1===u&&"-"!=l[4]?n.removeAttribute(l):n.setAttribute(l,"popover"==l&&1==u?"":u))}}function F$1(n){return function(u){if(this.l){var t=this.l[u.type+n];if(null==u.t)u.t=c$2++;else if(u.t<t.u)return;return t(l$2.event?l$2.event(u):u)}}}function O$1(n,u,t,i,r,o,e,f,c,s){var a,h,p,v,y,_,m,b,S,C,M,$,P,A,H,L,T,j=u.type;if(null!=u.constructor)return null;128&t.__u&&(c=!!(32&t.__u),o=[f=u.__e=t.__e]),(a=l$2.__b)&&a(u);n:if("function"==typeof j)try{if(b=u.props,S="prototype"in j&&j.prototype.render,C=(a=j.contextType)&&i[a.__c],M=a?C?C.props.value:a.__:i,t.__c?m=(h=u.__c=t.__c).__=h.__E:(S?u.__c=h=new j(b,M):(u.__c=h=new x(b,M),h.constructor=j,h.render=E$1),C&&C.sub(h),h.props=b,h.state||(h.state={}),h.context=M,h.__n=i,p=h.__d=!0,h.__h=[],h._sb=[]),S&&null==h.__s&&(h.__s=h.state),S&&null!=j.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=d$2({},h.__s)),d$2(h.__s,j.getDerivedStateFromProps(b,h.__s))),v=h.props,y=h.state,h.__v=u,p)S&&null==j.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),S&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(S&&null==j.getDerivedStateFromProps&&b!==v&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(b,M),!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(b,h.__s,M)||u.__v==t.__v){for(u.__v!=t.__v&&(h.props=b,h.state=h.__s,h.__d=!1),u.__e=t.__e,u.__k=t.__k,u.__k.some(function(n){n&&(n.__=u)}),$=0;$<h._sb.length;$++)h.__h.push(h._sb[$]);h._sb=[],h.__h.length&&e.push(h);break n}null!=h.componentWillUpdate&&h.componentWillUpdate(b,h.__s,M),S&&null!=h.componentDidUpdate&&h.__h.push(function(){h.componentDidUpdate(v,y,_)})}if(h.context=M,h.props=b,h.__P=n,h.__e=!1,P=l$2.__r,A=0,S){for(h.state=h.__s,h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),H=0;H<h._sb.length;H++)h.__h.push(h._sb[H]);h._sb=[]}else do{h.__d=!1,P&&P(u),a=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++A<25);h.state=h.__s,null!=h.getChildContext&&(i=d$2(d$2({},i),h.getChildContext())),S&&!p&&null!=h.getSnapshotBeforeUpdate&&(_=h.getSnapshotBeforeUpdate(v,y)),L=a,null!=a&&a.type===k$2&&null==a.key&&(L=V$1(a.props.children)),f=I$1(n,w$2(L)?L:[L],u,t,i,r,o,e,f,c,s),h.base=u.__e,u.__u&=-161,h.__h.length&&e.push(h),m&&(h.__E=h.__=null)}catch(n){if(u.__v=null,c||null!=o)if(n.then){for(u.__u|=c?160:128;f&&8==f.nodeType&&f.nextSibling;)f=f.nextSibling;o[o.indexOf(f)]=null,u.__e=f}else{for(T=o.length;T--;)g$1(o[T]);z$2(u)}else u.__e=t.__e,u.__k=t.__k,n.then||z$2(u);l$2.__e(n,u,t)}else null==o&&u.__v==t.__v?(u.__k=t.__k,u.__e=t.__e):f=u.__e=function(u,t,i,r,o,e,f,c,s){var a,h,v,y,d,_,m,b=i.props,k=t.props,x=t.type;if("svg"==x?o="http://www.w3.org/2000/svg":"math"==x?o="http://www.w3.org/1998/Math/MathML":o||(o="http://www.w3.org/1999/xhtml"),null!=e)for(a=0;a<e.length;a++)if((d=e[a])&&"setAttribute"in d==!!x&&(x?d.localName==x:3==d.nodeType)){u=d,e[a]=null;break}if(null==u){if(null==x)return document.createTextNode(k);u=document.createElementNS(o,x,k.is&&k),c&&(l$2.__m&&l$2.__m(t,e),c=!1),e=null}if(null==x)b===k||c&&u.data==k||(u.data=k);else{if(e=e&&n$1.call(u.childNodes),b=i.props||p$2,!c&&null!=e)for(b={},a=0;a<u.attributes.length;a++)b[(d=u.attributes[a]).name]=d.value;for(a in b)if(d=b[a],"children"==a);else if("dangerouslySetInnerHTML"==a)v=d;else if(!(a in k)){if("value"==a&&"defaultValue"in k||"checked"==a&&"defaultChecked"in k)continue;j$2(u,a,null,d,o)}for(a in k)d=k[a],"children"==a?y=d:"dangerouslySetInnerHTML"==a?h=d:"value"==a?_=d:"checked"==a?m=d:c&&"function"!=typeof d||b[a]===d||j$2(u,a,d,b[a],o);if(h)c||v&&(h.__html==v.__html||h.__html==u.innerHTML)||(u.innerHTML=h.__html),t.__k=[];else if(v&&(u.innerHTML=""),I$1("template"==t.type?u.content:u,w$2(y)?y:[y],t,i,r,"foreignObject"==x?"http://www.w3.org/1999/xhtml":o,e,f,e?e[0]:i.__k&&S$1(i,0),c,s),null!=e)for(a=e.length;a--;)g$1(e[a]);c||(a="value","progress"==x&&null==_?u.removeAttribute("value"):null!=_&&(_!==u[a]||"progress"==x&&!_||"option"==x&&_!=b[a])&&j$2(u,a,_,b[a],o),a="checked",null!=m&&m!=u[a]&&j$2(u,a,m,b[a],o))}return u}(t.__e,u,t,i,r,o,e,c,s);return(a=l$2.diffed)&&a(u),128&u.__u?void 0:f}function z$2(n){n&&n.__c&&(n.__c.__e=!0),n&&n.__k&&n.__k.forEach(z$2)}function N$1(n,u,t){for(var i=0;i<t.length;i++)B$2(t[i],t[++i],t[++i]);l$2.__c&&l$2.__c(u,n),n.some(function(u){try{n=u.__h,u.__h=[],n.some(function(n){n.call(u)})}catch(n){l$2.__e(n,u.__v)}})}function V$1(n){return"object"!=typeof n||null==n||n.__b&&n.__b>0?n:w$2(n)?n.map(V$1):d$2({},n)}function B$2(n,u,t){try{if("function"==typeof n){var i="function"==typeof n.__u;i&&n.__u(),i&&null==u||(n.__u=n(u))}else n.current=u}catch(n){l$2.__e(n,t)}}function D$2(n,u,t){var i,r;if(l$2.unmount&&l$2.unmount(n),(i=n.ref)&&(i.current&&i.current!=n.__e||B$2(i,null,u)),null!=(i=n.__c)){if(i.componentWillUnmount)try{i.componentWillUnmount()}catch(n){l$2.__e(n,u)}i.base=i.__P=null}if(i=n.__k)for(r=0;r<i.length;r++)i[r]&&D$2(i[r],u,t||"function"!=typeof n.type);t||g$1(n.__e),n.__c=n.__=n.__e=void 0}function E$1(n,l,u){return this.constructor(n,u)}function G(u,t,i){var o,e,f;t==document&&(t=document.documentElement),l$2.__&&l$2.__(u,t),o=!1?null:t.__k,e=[],f=[],O$1(t,u=t.__k=_$1(k$2,null,[u]),o||p$2,p$2,t.namespaceURI,o?null:t.firstChild?n$1.call(t.childNodes):null,e,o?o.__e:t.firstChild,false,f),N$1(e,u,f)}function K$1(l,u,t){var i,r,o,e,f=d$2({},l.props);for(o in l.type&&l.type.defaultProps&&(e=l.type.defaultProps),u)"key"==o?i=u[o]:"ref"==o?r=u[o]:f[o]=void 0===u[o]&&null!=e?e[o]:u[o];return arguments.length>2&&(f.children=arguments.length>3?n$1.call(arguments,2):t),m$2(l.type,f,i||l.key,r||l.ref,null)}n$1=v$2.slice,l$2={__e:function(n,l,u,t){for(var i,r,o;l=l.__;)if((i=l.__c)&&!i.__)try{if((r=i.constructor)&&null!=r.getDerivedStateFromError&&(i.setState(r.getDerivedStateFromError(n)),o=i.__d),null!=i.componentDidCatch&&(i.componentDidCatch(n,t||{}),o=i.__d),o)return i.__E=i}catch(l){n=l}throw n}},u$3=0,x.prototype.setState=function(n,l){var u;u=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=d$2({},this.state),"function"==typeof n&&(n=n(d$2({},u),this.props)),n&&d$2(u,n),null!=n&&this.__v&&(l&&this._sb.push(l),M$1(this))},x.prototype.forceUpdate=function(n){this.__v&&(this.__e=!0,n&&this.__h.push(n),M$1(this))},x.prototype.render=k$2,i$2=[],o$2="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,e$2=function(n,l){return n.__v.__b-l.__v.__b},$$1.__r=0,f$3=/(PointerCapture)$|Capture$/i,c$2=0,s$2=F$1(!1),a$2=F$1(!0);var f$2=0;function u$2(e,t,n,o,i,u){t||(t={});var a,c,p=t;if("ref"in p)for(c in p={},t)"ref"==c?a=t[c]:p[c]=t[c];var l={type:e,props:p,key:n,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--f$2,__i:-1,__u:0,__source:i,__self:u};if("function"==typeof e&&(a=e.defaultProps))for(c in a)void 0===p[c]&&(p[c]=a[c]);return l$2.vnode&&l$2.vnode(l),l}var t$1,r$1,u$1,i$1,o$1=0,f$1=[],c$1=l$2,e$1=c$1.__b,a$1=c$1.__r,v$1=c$1.diffed,l$1=c$1.__c,m$1=c$1.unmount,s$1=c$1.__;function p$1(n,t){c$1.__h&&c$1.__h(r$1,n,o$1||t),o$1=0;var u=r$1.__H||(r$1.__H={__:[],__h:[]});return n>=u.__.length&&u.__.push({}),u.__[n]}function d$1(n){return o$1=1,function(n,u){var o=p$1(t$1++,2);if(o.t=n,!o.__c&&(o.__=[D$1(void 0,u),function(n){var t=o.__N?o.__N[0]:o.__[0],r=o.t(t,n);t!==r&&(o.__N=[r,o.__[1]],o.__c.setState({}))}],o.__c=r$1,!r$1.__f)){var f=function(n,t,r){if(!o.__c.__H)return!0;var u=o.__c.__H.__.filter(function(n){return!!n.__c});if(u.every(function(n){return!n.__N}))return!c||c.call(this,n,t,r);var i=o.__c.props!==n;return u.forEach(function(n){if(n.__N){var t=n.__[0];n.__=n.__N,n.__N=void 0,t!==n.__[0]&&(i=!0)}}),c&&c.call(this,n,t,r)||i};r$1.__f=!0;var c=r$1.shouldComponentUpdate,e=r$1.componentWillUpdate;r$1.componentWillUpdate=function(n,t,r){if(this.__e){var u=c;c=void 0,f(n,t,r),c=u}e&&e.call(this,n,t,r)},r$1.shouldComponentUpdate=f}return o.__N||o.__}(D$1,n)}function y$1(n,u){var i=p$1(t$1++,3);!c$1.__s&&C(i.__H,u)&&(i.__=n,i.u=u,r$1.__H.__h.push(i))}function A$1(n){return o$1=5,T$1(function(){return{current:n}},[])}function T$1(n,r){var u=p$1(t$1++,7);return C(u.__H,r)&&(u.__=n(),u.__H=r,u.__h=n),u.__}function q$1(n,t){return o$1=8,T$1(function(){return n},t)}function j$1(){for(var n;n=f$1.shift();)if(n.__P&&n.__H)try{n.__H.__h.forEach(z$1),n.__H.__h.forEach(B$1),n.__H.__h=[]}catch(t){n.__H.__h=[],c$1.__e(t,n.__v)}}c$1.__b=function(n){r$1=null,e$1&&e$1(n)},c$1.__=function(n,t){n&&t.__k&&t.__k.__m&&(n.__m=t.__k.__m),s$1&&s$1(n,t)},c$1.__r=function(n){a$1&&a$1(n),t$1=0;var i=(r$1=n.__c).__H;i&&(u$1===r$1?(i.__h=[],r$1.__h=[],i.__.forEach(function(n){n.__N&&(n.__=n.__N),n.u=n.__N=void 0})):(i.__h.forEach(z$1),i.__h.forEach(B$1),i.__h=[],t$1=0)),u$1=r$1},c$1.diffed=function(n){v$1&&v$1(n);var t=n.__c;t&&t.__H&&(t.__H.__h.length&&(1!==f$1.push(t)&&i$1===c$1.requestAnimationFrame||((i$1=c$1.requestAnimationFrame)||w$1)(j$1)),t.__H.__.forEach(function(n){n.u&&(n.__H=n.u),n.u=void 0})),u$1=r$1=null},c$1.__c=function(n,t){t.some(function(n){try{n.__h.forEach(z$1),n.__h=n.__h.filter(function(n){return!n.__||B$1(n)})}catch(r){t.some(function(n){n.__h&&(n.__h=[])}),t=[],c$1.__e(r,n.__v)}}),l$1&&l$1(n,t)},c$1.unmount=function(n){m$1&&m$1(n);var t,r=n.__c;r&&r.__H&&(r.__H.__.forEach(function(n){try{z$1(n)}catch(n){t=n}}),r.__H=void 0,t&&c$1.__e(t,r.__v))};var k$1="function"==typeof requestAnimationFrame;function w$1(n){var t,r=function(){clearTimeout(u),k$1&&cancelAnimationFrame(t),setTimeout(n)},u=setTimeout(r,35);k$1&&(t=requestAnimationFrame(r))}function z$1(n){var t=r$1,u=n.__c;"function"==typeof u&&(n.__c=void 0,u()),r$1=t}function B$1(n){var t=r$1;n.__c=n.__(),r$1=t}function C(n,t){return!n||n.length!==t.length||t.some(function(t,r){return t!==n[r]})}function D$1(n,t){return"function"==typeof t?t(n):t}const STYLE_INNER={position:"relative",width:"100%",minHeight:"100%"},STYLE_CONTENT={position:"absolute",top:0,left:0,width:"100%",overflow:"visible"};function VirtualList({data:data,rowHeight:rowHeight,renderRow:renderRow,overscanCount:overscanCount=10,padding:padding=4,...props}){const scrollerRef=A$1(null),[offset,setOffset]=d$1(0),[height,setHeight]=d$1(0);y$1(()=>{function resize(){null!=scrollerRef.current&&height!==scrollerRef.current.offsetHeight&&setHeight(scrollerRef.current.offsetHeight)}return resize(),window.addEventListener("resize",resize),()=>{window.removeEventListener("resize",resize)}},[height]);const handleScroll=q$1(()=>{scrollerRef.current&&setOffset(scrollerRef.current.scrollTop)},[]);let start=Math.floor(offset/rowHeight),visibleRowCount=Math.floor(height/rowHeight);overscanCount&&(start=Math.max(0,start-start%overscanCount),visibleRowCount+=overscanCount);const end=start+visibleRowCount+padding,selection=data.slice(start,end),styleInner={...STYLE_INNER,height:data.length*rowHeight},styleContent={...STYLE_CONTENT,top:start*rowHeight};return u$2("div",{onScroll:handleScroll,ref:scrollerRef,...props,children:u$2("div",{role:"presentation",style:styleInner,children:u$2("div",{role:"presentation",style:styleContent,children:selection.map(renderRow)})})})}class BasePlugin{uppy;opts;id;defaultLocale;i18n;i18nArray;type;VERSION;constructor(uppy,opts){this.uppy=uppy,this.opts=opts??{}}getPluginState(){const{plugins:plugins}=this.uppy.getState();return plugins?.[this.id]||{}}setPluginState(update){const{plugins:plugins}=this.uppy.getState();this.uppy.setState({plugins:{...plugins,[this.id]:{...plugins[this.id],...update}}})}setOptions(newOpts){this.opts={...this.opts,...newOpts},this.setPluginState(void 0),this.i18nInit()}i18nInit(){const translator=new Translator([this.defaultLocale,this.uppy.locale,this.opts.locale]);this.i18n=translator.translate.bind(translator),this.i18nArray=translator.translateArray.bind(translator),this.setPluginState(void 0)}addTarget(plugin){throw new Error("Extend the addTarget method to add your plugin to another plugin's target")}install(){}uninstall(){}update(state){}afterUpdate(){}}class EventManager{#uppy;#events=[];constructor(uppy){this.#uppy=uppy}on(event,fn){return this.#events.push([event,fn]),this.#uppy.on(event,fn)}remove(){for(const[event,fn]of this.#events.splice(0))this.#uppy.off(event,fn)}onFilePause(fileID,cb){this.on("upload-pause",(file,isPaused)=>{fileID===file?.id&&cb(isPaused)})}onFileRemove(fileID,cb){this.on("file-removed",file=>{fileID===file.id&&cb(file.id)})}onPause(fileID,cb){this.on("upload-pause",(file,isPaused)=>{fileID===file?.id&&cb(isPaused)})}onRetry(fileID,cb){this.on("upload-retry",file=>{fileID===file?.id&&cb()})}onRetryAll(fileID,cb){this.on("retry-all",()=>{this.#uppy.getFile(fileID)&&cb()})}onPauseAll(fileID,cb){this.on("pause-all",()=>{this.#uppy.getFile(fileID)&&cb()})}onCancelAll(fileID,eventHandler){this.on("cancel-all",(...args)=>{this.#uppy.getFile(fileID)&&eventHandler(...args)})}onResumeAll(fileID,cb){this.on("resume-all",()=>{this.#uppy.getFile(fileID)&&cb()})}}const justErrorsLogger={debug:()=>{},warn:()=>{},error:(...args)=>console.error(`[Uppy] [${getTimeStamp()}]`,...args)},debugLogger={debug:(...args)=>console.debug(`[Uppy] [${getTimeStamp()}]`,...args),warn:(...args)=>console.warn(`[Uppy] [${getTimeStamp()}]`,...args),error:(...args)=>console.error(`[Uppy] [${getTimeStamp()}]`,...args)};var prettierBytes$1=getDefaultExportFromCjs(function(input){if("number"!=typeof input||Number.isNaN(input))throw new TypeError("Expected a number, got "+typeof input);const neg=input<0;let num=Math.abs(input);if(neg&&(num=-num),0===num)return"0 B";const units=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],exponent=Math.min(Math.floor(Math.log(num)/Math.log(1024)),units.length-1),value=Number(num/1024**exponent),unit=units[exponent];return`${value>=10||value%1==0?Math.round(value):value.toFixed(1)} ${unit}`});function WildcardMatcher(text,separator){this.text=text=text||"",this.hasWild=~text.indexOf("*"),this.separator=separator,this.parts=text.split(separator)}WildcardMatcher.prototype.match=function(input){var ii,testParts,matches=!0,parts=this.parts,partsCount=parts.length;if("string"==typeof input||input instanceof String)if(this.hasWild||this.text==input){for(testParts=(input||"").split(this.separator),ii=0;matches&&ii<partsCount;ii++)"*"!==parts[ii]&&(matches=ii<testParts.length&&parts[ii]===testParts[ii]);matches=matches&&testParts}else matches=!1;else if("function"==typeof input.splice)for(matches=[],ii=input.length;ii--;)this.match(input[ii])&&(matches[matches.length]=input[ii]);else if("object"==typeof input)for(var key in matches={},input)this.match(key)&&(matches[key]=input[key]);return matches};var wildcard=function(text,test,separator){var matcher=new WildcardMatcher(text,separator||/[\/\.]/);return void 0!==test?matcher.match(test):matcher},reMimePartSplit=/[\/\+\.]/,mimeMatch=function(target,pattern){function test(pattern){var result=wildcard(pattern,target,reMimePartSplit);return result&&result.length>=2}return pattern?test(pattern.split(";")[0]):test},match=getDefaultExportFromCjs(mimeMatch);const defaultOptions$7={maxFileSize:null,minFileSize:null,maxTotalFileSize:null,maxNumberOfFiles:null,minNumberOfFiles:null,allowedFileTypes:null,requiredMetaFields:[]};class RestrictionError extends Error{isUserFacing;file;constructor(message,opts){super(message),this.isUserFacing=opts?.isUserFacing??!0,opts?.file&&(this.file=opts.file)}isRestriction=!0}class Restricter{getI18n;getOpts;constructor(getOpts,getI18n){this.getI18n=getI18n,this.getOpts=()=>{const opts=getOpts();if(null!=opts.restrictions?.allowedFileTypes&&!Array.isArray(opts.restrictions.allowedFileTypes))throw new TypeError("`restrictions.allowedFileTypes` must be an array");return opts}}validateAggregateRestrictions(existingFiles,addingFiles){const{maxTotalFileSize:maxTotalFileSize,maxNumberOfFiles:maxNumberOfFiles}=this.getOpts().restrictions;if(maxNumberOfFiles){const nonGhostFiles=existingFiles.filter(f=>!f.isGhost);if(nonGhostFiles.length+addingFiles.length>maxNumberOfFiles)throw new RestrictionError(`${this.getI18n()("youCanOnlyUploadX",{smart_count:maxNumberOfFiles})}`)}if(maxTotalFileSize){const totalFilesSize=[...existingFiles,...addingFiles].reduce((total,f)=>total+(f.size??0),0);if(totalFilesSize>maxTotalFileSize)throw new RestrictionError(this.getI18n()("aggregateExceedsSize",{sizeAllowed:prettierBytes$1(maxTotalFileSize),size:prettierBytes$1(totalFilesSize)}))}}validateSingleFile(file){const{maxFileSize:maxFileSize,minFileSize:minFileSize,allowedFileTypes:allowedFileTypes}=this.getOpts().restrictions;if(allowedFileTypes){if(!allowedFileTypes.some(type=>type.includes("/")?!!file.type&&match(file.type.replace(/;.*?$/,""),type):!("."!==type[0]||!file.extension)&&file.extension.toLowerCase()===type.slice(1).toLowerCase())){const allowedFileTypesString=allowedFileTypes.join(", ");throw new RestrictionError(this.getI18n()("youCanOnlyUploadFileTypes",{types:allowedFileTypesString}),{file:file})}}if(maxFileSize&&null!=file.size&&file.size>maxFileSize)throw new RestrictionError(this.getI18n()("exceedsSize",{size:prettierBytes$1(maxFileSize),file:file.name??this.getI18n()("unnamed")}),{file:file});if(minFileSize&&null!=file.size&&file.size<minFileSize)throw new RestrictionError(this.getI18n()("inferiorSize",{size:prettierBytes$1(minFileSize)}),{file:file})}validate(existingFiles,addingFiles){addingFiles.forEach(addingFile=>{this.validateSingleFile(addingFile)}),this.validateAggregateRestrictions(existingFiles,addingFiles)}validateMinNumberOfFiles(files){const{minNumberOfFiles:minNumberOfFiles}=this.getOpts().restrictions;if(minNumberOfFiles&&Object.keys(files).length<minNumberOfFiles)throw new RestrictionError(this.getI18n()("youHaveToAtLeastSelectX",{smart_count:minNumberOfFiles}))}getMissingRequiredMetaFields(file){const error=new RestrictionError(this.getI18n()("missingRequiredMetaFieldOnFile",{fileName:file.name??this.getI18n()("unnamed")})),{requiredMetaFields:requiredMetaFields}=this.getOpts().restrictions,missingFields=[];for(const field of requiredMetaFields)Object.hasOwn(file.meta,field)&&""!==file.meta[field]||missingFields.push(field);return{missingFields:missingFields,error:error}}}class UIPlugin extends BasePlugin{#updateUI;isTargetDOMEl;el;parent;title;getTargetPlugin(target){let targetPlugin;if("function"==typeof target?.addTarget)targetPlugin=target,targetPlugin instanceof UIPlugin||console.warn(new Error("The provided plugin is not an instance of UIPlugin. This is an indication of a bug with the way Uppy is bundled.",{cause:{targetPlugin:targetPlugin,UIPlugin:UIPlugin}}));else if("function"==typeof target){const Target=target;this.uppy.iteratePlugins(p=>{p instanceof Target&&(targetPlugin=p)})}return targetPlugin}mount(target,plugin){const callerPluginName=plugin.id,targetElement=function(element,context=document){return"string"==typeof element?context.querySelector(element):isDOMElement(element)?element:null}(target);if(targetElement){this.isTargetDOMEl=!0;const uppyRootElement=document.createElement("div");return uppyRootElement.classList.add("uppy-Root"),this.#updateUI=function(fn){let latestArgs,calling=null;return(...args)=>(latestArgs=args,calling||(calling=Promise.resolve().then(()=>(calling=null,fn(...latestArgs)))),calling)}(state=>{this.uppy.getPlugin(this.id)&&(G(this.render(state,uppyRootElement),uppyRootElement),this.afterUpdate())}),this.uppy.log(`Installing ${callerPluginName} to a DOM element '${target}'`),this.opts.replaceTargetContent&&(targetElement.innerHTML=""),G(this.render(this.uppy.getState(),uppyRootElement),uppyRootElement),this.el=uppyRootElement,targetElement.appendChild(uppyRootElement),uppyRootElement.dir=this.opts.direction||function(element){for(;element&&!element.dir;)element=element.parentNode;return element?.dir}(uppyRootElement)||"ltr",this.onMount(),this.el}const targetPlugin=this.getTargetPlugin(target);if(targetPlugin)return this.uppy.log(`Installing ${callerPluginName} to ${targetPlugin.id}`),this.parent=targetPlugin,this.el=targetPlugin.addTarget(plugin),this.onMount(),this.el;this.uppy.log(`Not installing ${callerPluginName}`);let message=`Invalid target option given to ${callerPluginName}.`;throw message+="function"==typeof target?" The given target is not a Plugin class. Please check that you're not specifying a React Component instead of a plugin. If you are using @uppy/* packages directly, make sure you have only 1 version of @uppy/core installed: run `npm ls @uppy/core` on the command line and verify that all the versions match and are deduped correctly.":"If you meant to target an HTML element, please make sure that the element exists. Check that the <script> tag initializing Uppy is right before the closing </body> tag at the end of the page. (see https://github.com/transloadit/uppy/issues/1042)\n\nIf you meant to target a plugin, please confirm that your `import` statements or `require` calls are correct.",new Error(message)}render(state,container){throw new Error("Extend the render method to add your plugin to a DOM element")}update(state){null!=this.el&&this.#updateUI?.(state)}unmount(){this.isTargetDOMEl&&this.el?.remove(),this.onUnmount()}onMount(){}onUnmount(){}}var packageJson$b_version="5.0.0";class DefaultStore{static VERSION=packageJson$b_version;state={};#callbacks=new Set;getState(){return this.state}setState(patch){const prevState={...this.state},nextState={...this.state,...patch};this.state=nextState,this.#publish(prevState,nextState,patch)}subscribe(listener){return this.#callbacks.add(listener),()=>{this.#callbacks.delete(listener)}}#publish(...args){this.#callbacks.forEach(listener=>{listener(...args)})}}var isObject_1=function(value){var type=typeof value;return null!=value&&("object"==type||"function"==type)},freeGlobal="object"==typeof commonjsGlobal&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root$2=freeGlobal||freeSelf||Function("return this")(),root$1=root$2,now_1=function(){return root$1.Date.now()},reWhitespace=/\s/;var trimmedEndIndex=function(string){for(var index=string.length;index--&&reWhitespace.test(string.charAt(index)););return index},reTrimStart=/^\s+/;var _baseTrim=function(string){return string?string.slice(0,trimmedEndIndex(string)+1).replace(reTrimStart,""):string},_Symbol=root$2.Symbol,Symbol$2=_Symbol,objectProto$1=Object.prototype,hasOwnProperty=objectProto$1.hasOwnProperty,nativeObjectToString$1=objectProto$1.toString,symToStringTag$1=Symbol$2?Symbol$2.toStringTag:void 0;var _getRawTag=function(value){var isOwn=hasOwnProperty.call(value,symToStringTag$1),tag=value[symToStringTag$1];try{value[symToStringTag$1]=void 0;var unmasked=!0}catch(e){}var result=nativeObjectToString$1.call(value);return unmasked&&(isOwn?value[symToStringTag$1]=tag:delete value[symToStringTag$1]),result},nativeObjectToString=Object.prototype.toString;var getRawTag=_getRawTag,objectToString$1=function(value){return nativeObjectToString.call(value)},symToStringTag=_Symbol?_Symbol.toStringTag:void 0;var baseGetTag=function(value){return null==value?void 0===value?"[object Undefined]":"[object Null]":symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString$1(value)},isObjectLike=function(value){return null!=value&&"object"==typeof value};var baseTrim=_baseTrim,isObject$2=isObject_1,isSymbol=function(value){return"symbol"==typeof value||isObjectLike(value)&&"[object Symbol]"==baseGetTag(value)},reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt;var isObject$1=isObject_1,now=now_1,toNumber=function(value){if("number"==typeof value)return value;if(isSymbol(value))return NaN;if(isObject$2(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject$2(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=baseTrim(value);var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value},nativeMax=Math.max,nativeMin=Math.min;var debounce_1=function(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function(time){var timeWaiting=wait-(time-lastCallTime);return maxing?nativeMin(timeWaiting,maxWait-(time-lastInvokeTime)):timeWaiting}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return function(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}(lastCallTime);if(maxing)return clearTimeout(timerId),timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject$1(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function(){return void 0===timerId?result:trailingEdge(now())},debounced},debounce$2=getDefaultExportFromCjs(debounce_1),debounce=debounce_1,isObject=isObject_1;var throttle$1=getDefaultExportFromCjs(function(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}),namespaceEmitter=function(){var emitter={},_fns=emitter._fns={};return emitter.emit=function(event,arg1,arg2,arg3,arg4,arg5,arg6){var toEmit=function(e){var out=_fns[e]?_fns[e]:[],idx=e.indexOf(":"),args=-1===idx?[e]:[e.substring(0,idx),e.substring(idx+1)],keys=Object.keys(_fns),i=0,l=keys.length;for(;i<l;i++){var key=keys[i];if("*"===key&&(out=out.concat(_fns[key])),2===args.length&&args[0]===key){out=out.concat(_fns[key]);break}}return out}(event);toEmit.length&&function(e,fns,args){var i=0,l=fns.length;for(;i<l&&fns[i];i++)fns[i].event=e,fns[i].apply(fns[i],args)}(event,toEmit,[arg1,arg2,arg3,arg4,arg5,arg6])},emitter.on=function(event,fn){_fns[event]||(_fns[event]=[]),_fns[event].push(fn)},emitter.once=function(event,fn){this.on(event,function one(){fn.apply(this,arguments),emitter.off(event,one)})},emitter.off=function(event,fn){var keep=[];if(event&&fn)for(var fns=this._fns[event],i=0,l=fns?fns.length:0;i<l;i++)fns[i]!==fn&&keep.push(fns[i]);keep.length?this._fns[event]=keep:delete this._fns[event]},emitter},ee$1=getDefaultExportFromCjs(namespaceEmitter);let nanoid=(size=21)=>{let id="",i=0|size;for(;i--;)id+="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict"[64*Math.random()|0];return id};var packageJson$a_version="5.1.0";var locale$7={strings:{addBulkFilesFailed:{0:"Failed to add %{smart_count} file due to an internal error",1:"Failed to add %{smart_count} files due to internal errors"},youCanOnlyUploadX:{0:"You can only upload %{smart_count} file",1:"You can only upload %{smart_count} files"},youHaveToAtLeastSelectX:{0:"You have to select at least %{smart_count} file",1:"You have to select at least %{smart_count} files"},aggregateExceedsSize:"You selected %{size} of files, but maximum allowed size is %{sizeAllowed}",exceedsSize:"%{file} exceeds maximum allowed size of %{size}",missingRequiredMetaField:"Missing required meta fields",missingRequiredMetaFieldOnFile:"Missing required meta fields in %{fileName}",inferiorSize:"This file is smaller than the allowed size of %{size}",youCanOnlyUploadFileTypes:"You can only upload: %{types}",noMoreFilesAllowed:"Cannot add more files",noDuplicates:"Cannot add the duplicate file '%{fileName}', it already exists",companionError:"Connection with Companion failed",authAborted:"Authentication aborted",companionUnauthorizeHint:"To unauthorize to your %{provider} account, please go to %{url}",failedToUpload:"Failed to upload %{file}",noInternetConnection:"No Internet connection",connectedToInternet:"Connected to the Internet",noFilesFound:"You have no files or folders here",noSearchResults:"Unfortunately, there are no results for this search",selectX:{0:"Select %{smart_count}",1:"Select %{smart_count}"},allFilesFromFolderNamed:"All files from folder %{name}",openFolderNamed:"Open folder %{name}",cancel:"Cancel",logOut:"Log out",logIn:"Log in",pickFiles:"Pick files",pickPhotos:"Pick photos",filter:"Filter",resetFilter:"Reset filter",loading:"Loading...",loadedXFiles:"Loaded %{numFiles} files",authenticateWithTitle:"Please authenticate with %{pluginName} to select files",authenticateWith:"Connect to %{pluginName}",signInWithGoogle:"Sign in with Google",searchImages:"Search for images",enterTextToSearch:"Enter text to search for images",search:"Search",resetSearch:"Reset search",emptyFolderAdded:"No files were added from empty folder",addedNumFiles:"Added %{numFiles} file(s)",folderAlreadyAdded:'The folder "%{folder}" was already added',folderAdded:{0:"Added %{smart_count} file from %{folder}",1:"Added %{smart_count} files from %{folder}"},additionalRestrictionsFailed:"%{count} additional restrictions were not fulfilled",unnamed:"Unnamed",pleaseWait:"Please wait"}};function supportsUploadProgress(userAgent){if(null==userAgent&&"undefined"!=typeof navigator&&(userAgent=navigator.userAgent),!userAgent)return!0;const m=/Edge\/(\d+\.\d+)/.exec(userAgent);if(!m)return!0;const version=m[1].split(".",2),major=parseInt(version[0],10),minor=parseInt(version[1],10);return major<15||15===major&&minor<15063||(major>18||18===major&&minor>=18218)}const defaultUploadState={totalProgress:0,allowNewUpload:!0,error:null,recoveredState:null};class Uppy{static VERSION=packageJson$a_version;#plugins=Object.create(null);#restricter;#storeUnsubscribe;#emitter=ee$1();#preProcessors=new Set;#uploaders=new Set;#postProcessors=new Set;defaultLocale;locale;opts;store;i18n;i18nArray;scheduledAutoProceed=null;wasOffline=!1;constructor(opts){this.defaultLocale=locale$7;const defaultOptions={id:"uppy",autoProceed:!1,allowMultipleUploadBatches:!0,debug:!1,restrictions:defaultOptions$7,meta:{},onBeforeFileAdded:(file,files)=>!Object.hasOwn(files,file.id),onBeforeUpload:files=>files,store:new DefaultStore,logger:justErrorsLogger,infoTimeout:5e3},merged={...defaultOptions,...opts};this.opts={...merged,restrictions:{...defaultOptions.restrictions,...opts?.restrictions}},opts?.logger&&opts.debug?this.log("You are using a custom `logger`, but also set `debug: true`, which uses built-in logger to output logs to console. Ignoring `debug: true` and using your custom `logger`.","warning"):opts?.debug&&(this.opts.logger=debugLogger),this.log(`Using Core v${Uppy.VERSION}`),this.i18nInit(),this.store=this.opts.store,this.setState({...defaultUploadState,plugins:{},files:{},currentUploads:{},capabilities:{uploadProgress:supportsUploadProgress(),individualCancellation:!0,resumableUploads:!1},meta:{...this.opts.meta},info:[]}),this.#restricter=new Restricter(()=>this.opts,()=>this.i18n),this.#storeUnsubscribe=this.store.subscribe((prevState,nextState,patch)=>{this.emit("state-update",prevState,nextState,patch),this.updateAll(nextState)}),this.opts.debug&&"undefined"!=typeof window&&(window[this.opts.id]=this),this.#addListeners()}emit(event,...args){this.#emitter.emit(event,...args)}on(event,callback){return this.#emitter.on(event,callback),this}once(event,callback){return this.#emitter.once(event,callback),this}off(event,callback){return this.#emitter.off(event,callback),this}updateAll(state){this.iteratePlugins(plugin=>{plugin.update(state)})}setState(patch){this.store.setState(patch)}getState(){return this.store.getState()}patchFilesState(filesWithNewState){const existingFilesState=this.getState().files;this.setState({files:{...existingFilesState,...Object.fromEntries(Object.entries(filesWithNewState).map(([fileID,newFileState])=>[fileID,{...existingFilesState[fileID],...newFileState}]))}})}setFileState(fileID,state){if(!this.getState().files[fileID])throw new Error(`Cant set state for ${fileID} (the file could have been removed)`);this.patchFilesState({[fileID]:state})}i18nInit(){const translator=new Translator([this.defaultLocale,this.opts.locale],{onMissingKey:key=>this.log(`Missing i18n string: ${key}`,"error")});this.i18n=translator.translate.bind(translator),this.i18nArray=translator.translateArray.bind(translator),this.locale=translator.locale}setOptions(newOpts){this.opts={...this.opts,...newOpts,restrictions:{...this.opts.restrictions,...newOpts?.restrictions}},newOpts.meta&&this.setMeta(newOpts.meta),this.i18nInit(),newOpts.locale&&this.iteratePlugins(plugin=>{plugin.setOptions(newOpts)}),this.setState(void 0)}resetProgress(){const defaultProgress={percentage:0,bytesUploaded:!1,uploadComplete:!1,uploadStarted:null},files={...this.getState().files},updatedFiles=Object.create(null);Object.keys(files).forEach(fileID=>{updatedFiles[fileID]={...files[fileID],progress:{...files[fileID].progress,...defaultProgress},tus:void 0,transloadit:void 0}}),this.setState({files:updatedFiles,...defaultUploadState})}clear(){const{capabilities:capabilities,currentUploads:currentUploads}=this.getState();if(Object.keys(currentUploads).length>0&&!capabilities.individualCancellation)throw new Error("The installed uploader plugin does not allow removing files during an upload.");this.setState({...defaultUploadState,files:{}})}addPreProcessor(fn){this.#preProcessors.add(fn)}removePreProcessor(fn){return this.#preProcessors.delete(fn)}addPostProcessor(fn){this.#postProcessors.add(fn)}removePostProcessor(fn){return this.#postProcessors.delete(fn)}addUploader(fn){this.#uploaders.add(fn)}removeUploader(fn){return this.#uploaders.delete(fn)}setMeta(data){const updatedMeta={...this.getState().meta,...data},updatedFiles={...this.getState().files};Object.keys(updatedFiles).forEach(fileID=>{updatedFiles[fileID]={...updatedFiles[fileID],meta:{...updatedFiles[fileID].meta,...data}}}),this.log("Adding metadata:"),this.log(data),this.setState({meta:updatedMeta,files:updatedFiles})}setFileMeta(fileID,data){const updatedFiles={...this.getState().files};if(!updatedFiles[fileID])return void this.log(`Was trying to set metadata for a file that has been removed: ${fileID}`);const newMeta={...updatedFiles[fileID].meta,...data};updatedFiles[fileID]={...updatedFiles[fileID],meta:newMeta},this.setState({files:updatedFiles})}getFile(fileID){return this.getState().files[fileID]}getFiles(){const{files:files}=this.getState();return Object.values(files)}getFilesByIds(ids){return ids.map(id=>this.getFile(id))}getObjectOfFilesPerState(){const{files:filesObject,totalProgress:totalProgress,error:error}=this.getState(),files=Object.values(filesObject),inProgressFiles=[],newFiles=[],startedFiles=[],uploadStartedFiles=[],pausedFiles=[],completeFiles=[],erroredFiles=[],inProgressNotPausedFiles=[],processingFiles=[];for(const file of files){const{progress:progress}=file;!progress.uploadComplete&&progress.uploadStarted&&(inProgressFiles.push(file),file.isPaused||inProgressNotPausedFiles.push(file)),progress.uploadStarted||newFiles.push(file),(progress.uploadStarted||progress.preprocess||progress.postprocess)&&startedFiles.push(file),progress.uploadStarted&&uploadStartedFiles.push(file),file.isPaused&&pausedFiles.push(file),progress.uploadComplete&&completeFiles.push(file),file.error&&erroredFiles.push(file),(progress.preprocess||progress.postprocess)&&processingFiles.push(file)}return{newFiles:newFiles,startedFiles:startedFiles,uploadStartedFiles:uploadStartedFiles,pausedFiles:pausedFiles,completeFiles:completeFiles,erroredFiles:erroredFiles,inProgressFiles:inProgressFiles,inProgressNotPausedFiles:inProgressNotPausedFiles,processingFiles:processingFiles,isUploadStarted:uploadStartedFiles.length>0,isAllComplete:100===totalProgress&&completeFiles.length===files.length&&0===processingFiles.length,isAllErrored:!!error&&erroredFiles.length===files.length,isAllPaused:0!==inProgressFiles.length&&pausedFiles.length===inProgressFiles.length,isUploadInProgress:inProgressFiles.length>0,isSomeGhost:files.some(file=>file.isGhost)}}#informAndEmit(errors){for(const error of errors)error.isRestriction?this.emit("restriction-failed",error.file,error):this.emit("error",error,error.file),this.log(error,"warning");const userFacingErrors=errors.filter(error=>error.isUserFacing),firstErrors=userFacingErrors.slice(0,4),additionalErrors=userFacingErrors.slice(4);firstErrors.forEach(({message:message,details:details=""})=>{this.info({message:message,details:details},"error",this.opts.infoTimeout)}),additionalErrors.length>0&&this.info({message:this.i18n("additionalRestrictionsFailed",{count:additionalErrors.length})})}validateRestrictions(file,files=this.getFiles()){try{this.#restricter.validate(files,[file])}catch(err){return err}return null}validateSingleFile(file){try{this.#restricter.validateSingleFile(file)}catch(err){return err.message}return null}validateAggregateRestrictions(files){const existingFiles=this.getFiles();try{this.#restricter.validateAggregateRestrictions(existingFiles,files)}catch(err){return err.message}return null}#checkRequiredMetaFieldsOnFile(file){const{missingFields:missingFields,error:error}=this.#restricter.getMissingRequiredMetaFields(file);return missingFields.length>0?(this.setFileState(file.id,{missingRequiredMetaFields:missingFields,error:error.message}),this.log(error.message),this.emit("restriction-failed",file,error),!1):(0===missingFields.length&&file.missingRequiredMetaFields&&this.setFileState(file.id,{missingRequiredMetaFields:[]}),!0)}#checkRequiredMetaFields(files){let success=!0;for(const file of Object.values(files))this.#checkRequiredMetaFieldsOnFile(file)||(success=!1);return success}#assertNewUploadAllowed(file){const{allowNewUpload:allowNewUpload}=this.getState();if(!1===allowNewUpload){const error=new RestrictionError(this.i18n("noMoreFilesAllowed"),{file:file});throw this.#informAndEmit([error]),error}}checkIfFileAlreadyExists(fileID){const{files:files}=this.getState();return!(!files[fileID]||files[fileID].isGhost)}#transformFile(fileDescriptorOrFile){const file=fileDescriptorOrFile instanceof File?{name:fileDescriptorOrFile.name,type:fileDescriptorOrFile.type,size:fileDescriptorOrFile.size,data:fileDescriptorOrFile}:fileDescriptorOrFile,fileType=getFileType(file),fileName=function(fileType,fileDescriptor){return fileDescriptor.name?fileDescriptor.name:"image"===fileType.split("/")[0]?`${fileType.split("/")[0]}.${fileType.split("/")[1]}`:"noname"}(fileType,file),fileExtension=getFileNameAndExtension(fileName).extension,id=getSafeFileId(file,this.getID()),meta=file.meta||{};meta.name=fileName,meta.type=fileType;const size=Number.isFinite(file.data.size)?file.data.size:null;return{source:file.source||"",id:id,name:fileName,extension:fileExtension||"",meta:{...this.getState().meta,...meta},type:fileType,data:file.data,progress:{percentage:0,bytesUploaded:!1,bytesTotal:size,uploadComplete:!1,uploadStarted:null},size:size,isGhost:!1,isRemote:file.isRemote||!1,remote:file.remote,preview:file.preview}}#startIfAutoProceed(){this.opts.autoProceed&&!this.scheduledAutoProceed&&(this.scheduledAutoProceed=setTimeout(()=>{this.scheduledAutoProceed=null,this.upload().catch(err=>{err.isRestriction||this.log(err.stack||err.message||err)})},4))}#checkAndUpdateFileState(filesToAdd){let{files:existingFiles}=this.getState(),nextFilesState={...existingFiles};const validFilesToAdd=[],errors=[];for(const fileToAdd of filesToAdd)try{let newFile=this.#transformFile(fileToAdd);const isGhost=existingFiles[newFile.id]?.isGhost;if(isGhost){newFile={...existingFiles[newFile.id],isGhost:!1,data:fileToAdd.data},this.log(`Replaced the blob in the restored ghost file: ${newFile.name}, ${newFile.id}`)}const onBeforeFileAddedResult=this.opts.onBeforeFileAdded(newFile,nextFilesState);if(existingFiles=this.getState().files,nextFilesState={...existingFiles,...nextFilesState},!onBeforeFileAddedResult&&this.checkIfFileAlreadyExists(newFile.id))throw new RestrictionError(this.i18n("noDuplicates",{fileName:newFile.name??this.i18n("unnamed")}),{file:fileToAdd});if(!1===onBeforeFileAddedResult&&!isGhost)throw new RestrictionError("Cannot add the file because onBeforeFileAdded returned false.",{isUserFacing:!1,file:fileToAdd});"object"==typeof onBeforeFileAddedResult&&null!==onBeforeFileAddedResult&&(newFile=onBeforeFileAddedResult),this.#restricter.validateSingleFile(newFile),nextFilesState[newFile.id]=newFile,validFilesToAdd.push(newFile)}catch(err){errors.push(err)}try{this.#restricter.validateAggregateRestrictions(Object.values(existingFiles),validFilesToAdd)}catch(err){return errors.push(err),{nextFilesState:existingFiles,validFilesToAdd:[],errors:errors}}return{nextFilesState:nextFilesState,validFilesToAdd:validFilesToAdd,errors:errors}}addFile(file){this.#assertNewUploadAllowed(file);const{nextFilesState:nextFilesState,validFilesToAdd:validFilesToAdd,errors:errors}=this.#checkAndUpdateFileState([file]),restrictionErrors=errors.filter(error=>error.isRestriction);if(this.#informAndEmit(restrictionErrors),errors.length>0)throw errors[0];this.setState({files:nextFilesState});const[firstValidFileToAdd]=validFilesToAdd;return this.emit("file-added",firstValidFileToAdd),this.emit("files-added",validFilesToAdd),this.log(`Added file: ${firstValidFileToAdd.name}, ${firstValidFileToAdd.id}, mime type: ${firstValidFileToAdd.type}`),this.#startIfAutoProceed(),firstValidFileToAdd.id}addFiles(fileDescriptors){this.#assertNewUploadAllowed();const{nextFilesState:nextFilesState,validFilesToAdd:validFilesToAdd,errors:errors}=this.#checkAndUpdateFileState(fileDescriptors),restrictionErrors=errors.filter(error=>error.isRestriction);this.#informAndEmit(restrictionErrors);const nonRestrictionErrors=errors.filter(error=>!error.isRestriction);if(nonRestrictionErrors.length>0){let message="Multiple errors occurred while adding files:\n";if(nonRestrictionErrors.forEach(subError=>{message+=`\n * ${subError.message}`}),this.info({message:this.i18n("addBulkFilesFailed",{smart_count:nonRestrictionErrors.length}),details:message},"error",this.opts.infoTimeout),"function"==typeof AggregateError)throw new AggregateError(nonRestrictionErrors,message);{const err=new Error(message);throw err.errors=nonRestrictionErrors,err}}this.setState({files:nextFilesState}),validFilesToAdd.forEach(file=>{this.emit("file-added",file)}),this.emit("files-added",validFilesToAdd),validFilesToAdd.length>5?this.log(`Added batch of ${validFilesToAdd.length} files`):Object.values(validFilesToAdd).forEach(file=>{this.log(`Added file: ${file.name}\n id: ${file.id}\n type: ${file.type}`)}),validFilesToAdd.length>0&&this.#startIfAutoProceed()}removeFiles(fileIDs){const{files:files,currentUploads:currentUploads}=this.getState(),updatedFiles={...files},updatedUploads={...currentUploads},removedFiles=Object.create(null);function fileIsNotRemoved(uploadFileID){return void 0===removedFiles[uploadFileID]}fileIDs.forEach(fileID=>{files[fileID]&&(removedFiles[fileID]=files[fileID],delete updatedFiles[fileID])}),Object.keys(updatedUploads).forEach(uploadID=>{const newFileIDs=currentUploads[uploadID].fileIDs.filter(fileIsNotRemoved);if(0===newFileIDs.length)return void delete updatedUploads[uploadID];const{capabilities:capabilities}=this.getState();if(newFileIDs.length!==currentUploads[uploadID].fileIDs.length&&!capabilities.individualCancellation)throw new Error("The installed uploader plugin does not allow removing files during an upload.");updatedUploads[uploadID]={...currentUploads[uploadID],fileIDs:newFileIDs}});const stateUpdate={currentUploads:updatedUploads,files:updatedFiles};0===Object.keys(updatedFiles).length&&(stateUpdate.allowNewUpload=!0,stateUpdate.error=null,stateUpdate.recoveredState=null),this.setState(stateUpdate),this.#updateTotalProgressThrottled();const removedFileIDs=Object.keys(removedFiles);removedFileIDs.forEach(fileID=>{this.emit("file-removed",removedFiles[fileID])}),removedFileIDs.length>5?this.log(`Removed ${removedFileIDs.length} files`):this.log(`Removed files: ${removedFileIDs.join(", ")}`)}removeFile(fileID){this.removeFiles([fileID])}pauseResume(fileID){if(!this.getState().capabilities.resumableUploads||this.getFile(fileID).progress.uploadComplete)return;const file=this.getFile(fileID),isPaused=!(file.isPaused||!1);return this.setFileState(fileID,{isPaused:isPaused}),this.emit("upload-pause",file,isPaused),isPaused}pauseAll(){const updatedFiles={...this.getState().files};Object.keys(updatedFiles).filter(file=>!updatedFiles[file].progress.uploadComplete&&updatedFiles[file].progress.uploadStarted).forEach(file=>{const updatedFile={...updatedFiles[file],isPaused:!0};updatedFiles[file]=updatedFile}),this.setState({files:updatedFiles}),this.emit("pause-all")}resumeAll(){const updatedFiles={...this.getState().files};Object.keys(updatedFiles).filter(file=>!updatedFiles[file].progress.uploadComplete&&updatedFiles[file].progress.uploadStarted).forEach(file=>{const updatedFile={...updatedFiles[file],isPaused:!1,error:null};updatedFiles[file]=updatedFile}),this.setState({files:updatedFiles}),this.emit("resume-all")}#getFilesToRetry(){const{files:files}=this.getState();return Object.keys(files).filter(fileId=>{const file=files[fileId];return file.error&&(!file.missingRequiredMetaFields||0===file.missingRequiredMetaFields.length)})}async#doRetryAll(){const filesToRetry=this.#getFilesToRetry(),updatedFiles={...this.getState().files};if(filesToRetry.forEach(fileID=>{updatedFiles[fileID]={...updatedFiles[fileID],isPaused:!1,error:null}}),this.setState({files:updatedFiles,error:null}),this.emit("retry-all",this.getFilesByIds(filesToRetry)),0===filesToRetry.length)return{successful:[],failed:[]};const uploadID=this.#createUpload(filesToRetry,{forceAllowNewUpload:!0});return this.#runUpload(uploadID)}async retryAll(){const result=await this.#doRetryAll();return this.emit("complete",result),result}cancelAll(){this.emit("cancel-all");const{files:files}=this.getState(),fileIDs=Object.keys(files);fileIDs.length&&this.removeFiles(fileIDs),this.setState(defaultUploadState)}retryUpload(fileID){this.setFileState(fileID,{error:null,isPaused:!1}),this.emit("upload-retry",this.getFile(fileID));const uploadID=this.#createUpload([fileID],{forceAllowNewUpload:!0});return this.#runUpload(uploadID)}logout(){this.iteratePlugins(plugin=>{plugin.provider?.logout?.()})}#handleUploadProgress=(file,progress)=>{const fileInState=file?this.getFile(file.id):void 0;if(null==file||!fileInState)return void this.log(`Not setting progress for a file that has been removed: ${file?.id}`);if(100===fileInState.progress.percentage)return void this.log(`Not setting progress for a file that has been already uploaded: ${file.id}`);const newProgress={bytesTotal:progress.bytesTotal,percentage:null!=progress.bytesTotal&&Number.isFinite(progress.bytesTotal)&&progress.bytesTotal>0?Math.round(progress.bytesUploaded/progress.bytesTotal*100):void 0};null!=fileInState.progress.uploadStarted?this.setFileState(file.id,{progress:{...fileInState.progress,...newProgress,bytesUploaded:progress.bytesUploaded}}):this.setFileState(file.id,{progress:{...fileInState.progress,...newProgress}}),this.#updateTotalProgressThrottled()};#updateTotalProgress(){const totalProgress=this.#calculateTotalProgress();let totalProgressPercent=null;null!=totalProgress&&(totalProgressPercent=Math.round(100*totalProgress),totalProgressPercent>100?totalProgressPercent=100:totalProgressPercent<0&&(totalProgressPercent=0)),this.emit("progress",totalProgressPercent??0),this.setState({totalProgress:totalProgressPercent??0})}#updateTotalProgressThrottled=throttle$1(()=>this.#updateTotalProgress(),500,{leading:!0,trailing:!0});[Symbol.for("uppy test: updateTotalProgress")](){return this.#updateTotalProgress()}#calculateTotalProgress(){const filesInProgress=this.getFiles().filter(file=>file.progress.uploadStarted||file.progress.preprocess||file.progress.postprocess);if(0===filesInProgress.length)return 0;if(filesInProgress.every(file=>file.progress.uploadComplete))return 1;const isSizedFile=file=>null!=file.progress.bytesTotal&&0!==file.progress.bytesTotal,sizedFilesInProgress=filesInProgress.filter(isSizedFile),unsizedFilesInProgress=filesInProgress.filter(file=>!isSizedFile(file));if(sizedFilesInProgress.every(file=>file.progress.uploadComplete)&&unsizedFilesInProgress.length>0&&!unsizedFilesInProgress.every(file=>file.progress.uploadComplete))return null;const totalFilesSize=sizedFilesInProgress.reduce((acc,file)=>acc+(file.progress.bytesTotal??0),0),totalUploadedSize=sizedFilesInProgress.reduce((acc,file)=>acc+(file.progress.bytesUploaded||0),0);return 0===totalFilesSize?0:totalUploadedSize/totalFilesSize}#addListeners(){const errorHandler=(error,file,response)=>{let errorMsg=error.message||"Unknown error";error.details&&(errorMsg+=` ${error.details}`),this.setState({error:errorMsg}),null!=file&&file.id in this.getState().files&&this.setFileState(file.id,{error:errorMsg,response:response})};this.on("error",errorHandler),this.on("upload-error",(file,error,response)=>{if(errorHandler(error,file,response),"object"==typeof error&&error.message){this.log(error.message,"error");const newError=new Error(this.i18n("failedToUpload",{file:file?.name??""}));newError.isUserFacing=!0,newError.details=error.message,error.details&&(newError.details+=` ${error.details}`),this.#informAndEmit([newError])}else this.#informAndEmit([error])});let uploadStalledWarningRecentlyEmitted=null;this.on("upload-stalled",(error,files)=>{const{message:message}=error,details=files.map(file=>file.meta.name).join(", ");uploadStalledWarningRecentlyEmitted||(this.info({message:message,details:details},"warning",this.opts.infoTimeout),uploadStalledWarningRecentlyEmitted=setTimeout(()=>{uploadStalledWarningRecentlyEmitted=null},this.opts.infoTimeout)),this.log(`${message} ${details}`.trim(),"warning")}),this.on("upload",()=>{this.setState({error:null})});this.on("upload-start",files=>{const filesFiltered=files.filter(file=>{const exists=null!=file&&this.getFile(file.id);return exists||this.log(`Not setting progress for a file that has been removed: ${file?.id}`),exists}),filesState=Object.fromEntries(filesFiltered.map(file=>[file.id,{progress:{uploadStarted:Date.now(),uploadComplete:!1,bytesUploaded:0,bytesTotal:file.size}}]));this.patchFilesState(filesState)}),this.on("upload-progress",this.#handleUploadProgress),this.on("upload-success",(file,uploadResp)=>{if(null==file||!this.getFile(file.id))return void this.log(`Not setting progress for a file that has been removed: ${file?.id}`);const currentProgress=this.getFile(file.id).progress;this.setFileState(file.id,{progress:{...currentProgress,postprocess:this.#postProcessors.size>0?{mode:"indeterminate"}:void 0,uploadComplete:!0,percentage:100,bytesUploaded:currentProgress.bytesTotal},response:uploadResp,uploadURL:uploadResp.uploadURL,isPaused:!1}),null==file.size&&this.setFileState(file.id,{size:uploadResp.bytesUploaded||currentProgress.bytesTotal}),this.#updateTotalProgressThrottled()}),this.on("preprocess-progress",(file,progress)=>{null!=file&&this.getFile(file.id)?this.setFileState(file.id,{progress:{...this.getFile(file.id).progress,preprocess:progress}}):this.log(`Not setting progress for a file that has been removed: ${file?.id}`)}),this.on("preprocess-complete",file=>{if(null==file||!this.getFile(file.id))return void this.log(`Not setting progress for a file that has been removed: ${file?.id}`);const files={...this.getState().files};files[file.id]={...files[file.id],progress:{...files[file.id].progress}},delete files[file.id].progress.preprocess,this.setState({files:files})}),this.on("postprocess-progress",(file,progress)=>{null!=file&&this.getFile(file.id)?this.setFileState(file.id,{progress:{...this.getState().files[file.id].progress,postprocess:progress}}):this.log(`Not setting progress for a file that has been removed: ${file?.id}`)}),this.on("postprocess-complete",file=>{if(null==file||!this.getFile(file.id))return void this.log(`Not setting progress for a file that has been removed: ${file?.id}`);const files={...this.getState().files};files[file.id]={...files[file.id],progress:{...files[file.id].progress}},delete files[file.id].progress.postprocess,this.setState({files:files})}),this.on("restored",()=>{this.#updateTotalProgressThrottled()}),this.on("dashboard:file-edit-complete",file=>{file&&this.#checkRequiredMetaFieldsOnFile(file)}),"undefined"!=typeof window&&window.addEventListener&&(window.addEventListener("online",this.#updateOnlineStatus),window.addEventListener("offline",this.#updateOnlineStatus),setTimeout(this.#updateOnlineStatus,3e3))}updateOnlineStatus(){window.navigator.onLine??!0?(this.emit("is-online"),this.wasOffline&&(this.emit("back-online"),this.info(this.i18n("connectedToInternet"),"success",3e3),this.wasOffline=!1)):(this.emit("is-offline"),this.info(this.i18n("noInternetConnection"),"error",0),this.wasOffline=!0)}#updateOnlineStatus=this.updateOnlineStatus.bind(this);getID(){return this.opts.id}use(Plugin,...args){if("function"!=typeof Plugin){throw new TypeError(`Expected a plugin class, but got ${null===Plugin?"null":typeof Plugin}. Please verify that the plugin was imported and spelled correctly.`)}const plugin=new Plugin(this,...args),pluginId=plugin.id;if(!pluginId)throw new Error("Your plugin must have an id");if(!plugin.type)throw new Error("Your plugin must have a type");const existsPluginAlready=this.getPlugin(pluginId);if(existsPluginAlready){const msg=`Already found a plugin named '${existsPluginAlready.id}'. Tried to use: '${pluginId}'.\nUppy plugins must have unique \`id\` options.`;throw new Error(msg)}return Plugin.VERSION&&this.log(`Using ${pluginId} v${Plugin.VERSION}`),plugin.type in this.#plugins?this.#plugins[plugin.type].push(plugin):this.#plugins[plugin.type]=[plugin],plugin.install(),this.emit("plugin-added",plugin),this}getPlugin(id){for(const plugins of Object.values(this.#plugins)){const foundPlugin=plugins.find(plugin=>plugin.id===id);if(null!=foundPlugin)return foundPlugin}}[Symbol.for("uppy test: getPlugins")](type){return this.#plugins[type]}iteratePlugins(method){Object.values(this.#plugins).flat(1).forEach(method)}removePlugin(instance){this.log(`Removing plugin ${instance.id}`),this.emit("plugin-remove",instance),instance.uninstall&&instance.uninstall();const list=this.#plugins[instance.type],index=list.findIndex(item=>item.id===instance.id);-1!==index&&list.splice(index,1);const updatedState={plugins:{...this.getState().plugins,[instance.id]:void 0}};this.setState(updatedState)}destroy(){this.log(`Closing Uppy instance ${this.opts.id}: removing all files and uninstalling plugins`),this.cancelAll(),this.#storeUnsubscribe(),this.iteratePlugins(plugin=>{this.removePlugin(plugin)}),"undefined"!=typeof window&&window.removeEventListener&&(window.removeEventListener("online",this.#updateOnlineStatus),window.removeEventListener("offline",this.#updateOnlineStatus))}hideInfo(){const{info:info}=this.getState();this.setState({info:info.slice(1)}),this.emit("info-hidden")}info(message,type="info",duration=3e3){const isComplexMessage="object"==typeof message;this.setState({info:[...this.getState().info,{type:type,message:isComplexMessage?message.message:message,details:isComplexMessage?message.details:null}]}),setTimeout(()=>this.hideInfo(),duration),this.emit("info-visible")}log(message,type){const{logger:logger}=this.opts;switch(type){case"error":logger.error(message);break;case"warning":logger.warn(message);break;default:logger.debug(message)}}#requestClientById=new Map;registerRequestClient(id,client){this.#requestClientById.set(id,client)}getRequestClientForFile(file){if(!file.remote)throw new Error(`Tried to get RequestClient for a non-remote file ${file.id}`);const requestClient=this.#requestClientById.get(file.remote.requestClientId);if(null==requestClient)throw new Error(`requestClientId "${file.remote.requestClientId}" not registered for file "${file.id}"`);return requestClient}async restore(uploadID){if(this.log(`Core: attempting to restore upload "${uploadID}"`),!this.getState().currentUploads[uploadID])throw this.#removeUpload(uploadID),new Error("Nonexistent upload");const result=await this.#runUpload(uploadID);return this.emit("complete",result),result}#createUpload(fileIDs,opts={}){const{forceAllowNewUpload:forceAllowNewUpload=!1}=opts,{allowNewUpload:allowNewUpload,currentUploads:currentUploads}=this.getState();if(!allowNewUpload&&!forceAllowNewUpload)throw new Error("Cannot create a new upload: already uploading.");const uploadID=nanoid();return this.emit("upload",uploadID,this.getFilesByIds(fileIDs)),this.setState({allowNewUpload:!1!==this.opts.allowMultipleUploadBatches&&!1!==this.opts.allowMultipleUploads,currentUploads:{...currentUploads,[uploadID]:{fileIDs:fileIDs,step:0,result:{}}}}),uploadID}[Symbol.for("uppy test: createUpload")](...args){return this.#createUpload(...args)}#getUpload(uploadID){const{currentUploads:currentUploads}=this.getState();return currentUploads[uploadID]}addResultData(uploadID,data){if(!this.#getUpload(uploadID))return void this.log(`Not setting result for an upload that has been removed: ${uploadID}`);const{currentUploads:currentUploads}=this.getState(),currentUpload={...currentUploads[uploadID],result:{...currentUploads[uploadID].result,...data}};this.setState({currentUploads:{...currentUploads,[uploadID]:currentUpload}})}#removeUpload(uploadID){const currentUploads={...this.getState().currentUploads};delete currentUploads[uploadID],this.setState({currentUploads:currentUploads})}async#runUpload(uploadID){const getCurrentUpload=()=>{const{currentUploads:currentUploads}=this.getState();return currentUploads[uploadID]};let currentUpload=getCurrentUpload();const steps=[...this.#preProcessors,...this.#uploaders,...this.#postProcessors];try{for(let step=currentUpload.step||0;step<steps.length&&currentUpload;step++){const fn=steps[step];this.setState({currentUploads:{...this.getState().currentUploads,[uploadID]:{...currentUpload,step:step}}});const{fileIDs:fileIDs}=currentUpload;await fn(fileIDs,uploadID),currentUpload=getCurrentUpload()}}catch(err){throw this.#removeUpload(uploadID),err}if(currentUpload){currentUpload.fileIDs.forEach(fileID=>{const file=this.getFile(fileID);file?.progress.postprocess&&this.emit("postprocess-complete",file)});const files=currentUpload.fileIDs.map(fileID=>this.getFile(fileID)),successful=files.filter(file=>!file.error),failed=files.filter(file=>file.error);this.addResultData(uploadID,{successful:successful,failed:failed,uploadID:uploadID}),currentUpload=getCurrentUpload()}let result;return currentUpload&&(result=currentUpload.result,this.#removeUpload(uploadID)),null==result&&(this.log(`Not setting result for an upload that has been removed: ${uploadID}`),result={successful:[],failed:[],uploadID:uploadID}),result}async upload(){this.#plugins.uploader?.length||this.log("No uploader type plugins are used","warning");let{files:files}=this.getState();if(this.#getFilesToRetry().length>0){const retryResult=await this.#doRetryAll();if(!(this.getFiles().filter(file=>null==file.progress.uploadStarted).length>0))return this.emit("complete",retryResult),retryResult;({files:files}=this.getState())}const onBeforeUploadResult=this.opts.onBeforeUpload(files);return!1===onBeforeUploadResult?Promise.reject(new Error("Not starting the upload because onBeforeUpload returned false")):(onBeforeUploadResult&&"object"==typeof onBeforeUploadResult&&(files=onBeforeUploadResult,this.setState({files:files})),Promise.resolve().then(()=>this.#restricter.validateMinNumberOfFiles(files)).catch(err=>{throw this.#informAndEmit([err]),err}).then(()=>{if(!this.#checkRequiredMetaFields(files))throw new RestrictionError(this.i18n("missingRequiredMetaField"))}).catch(err=>{throw err}).then(async()=>{const{currentUploads:currentUploads}=this.getState(),currentlyUploadingFiles=Object.values(currentUploads).flatMap(curr=>curr.fileIDs),waitingFileIDs=[];Object.keys(files).forEach(fileID=>{const file=this.getFile(fileID);file.progress.uploadStarted||-1!==currentlyUploadingFiles.indexOf(fileID)||waitingFileIDs.push(file.id)});const uploadID=this.#createUpload(waitingFileIDs),result=await this.#runUpload(uploadID);return this.emit("complete",result),result}).catch(err=>{throw this.emit("error",err),this.log(err,"error"),err}))}}var classnames={exports:{}};!function(module){!function(){var hasOwn={}.hasOwnProperty;function classNames(){for(var classes="",i=0;i<arguments.length;i++){var arg=arguments[i];arg&&(classes=appendClass(classes,parseValue(arg)))}return classes}function parseValue(arg){if("string"==typeof arg||"number"==typeof arg)return arg;if("object"!=typeof arg)return"";if(Array.isArray(arg))return classNames.apply(null,arg);if(arg.toString!==Object.prototype.toString&&!arg.toString.toString().includes("[native code]"))return arg.toString();var classes="";for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&(classes=appendClass(classes,key));return classes}function appendClass(value,newClass){return newClass?value?value+" "+newClass:value+newClass:value}module.exports?(classNames.default=classNames,module.exports=classNames):window.classNames=classNames}()}(classnames);var classNames=getDefaultExportFromCjs(classnames.exports);function e(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}var t="undefined"!=typeof self?self:global;const s="undefined"!=typeof navigator,i=s&&"undefined"==typeof HTMLImageElement,n=!("undefined"==typeof global||"undefined"==typeof process||!process.versions||!process.versions.node),r=t.Buffer,a=!!r,h=e=>void 0!==e;function f(e){return void 0===e||(e instanceof Map?0===e.size:0===Object.values(e).filter(h).length)}function l(e){let t=new Error(e);throw delete t.stack,t}function o(e){let t=function(e){let t=0;return e.ifd0.enabled&&(t+=1024),e.exif.enabled&&(t+=2048),e.makerNote&&(t+=2048),e.userComment&&(t+=1024),e.gps.enabled&&(t+=512),e.interop.enabled&&(t+=100),e.ifd1.enabled&&(t+=1024),t+2048}(e);return e.jfif.enabled&&(t+=50),e.xmp.enabled&&(t+=2e4),e.iptc.enabled&&(t+=14e3),e.icc.enabled&&(t+=6e3),t}const u=e=>String.fromCharCode.apply(null,e),d="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):void 0;class c{static from(e,t){return e instanceof this&&e.le===t?e:new c(e,void 0,void 0,t)}constructor(e,t=0,s,i){if("boolean"==typeof i&&(this.le=i),Array.isArray(e)&&(e=new Uint8Array(e)),0===e)this.byteOffset=0,this.byteLength=0;else if(e instanceof ArrayBuffer){void 0===s&&(s=e.byteLength-t);let i=new DataView(e,t,s);this._swapDataView(i)}else if(e instanceof Uint8Array||e instanceof DataView||e instanceof c){void 0===s&&(s=e.byteLength-t),(t+=e.byteOffset)+s>e.byteOffset+e.byteLength&&l("Creating view outside of available memory in ArrayBuffer");let i=new DataView(e.buffer,t,s);this._swapDataView(i)}else if("number"==typeof e){let t=new DataView(new ArrayBuffer(e));this._swapDataView(t)}else l("Invalid input argument for BufferView: "+e)}_swapArrayBuffer(e){this._swapDataView(new DataView(e))}_swapBuffer(e){this._swapDataView(new DataView(e.buffer,e.byteOffset,e.byteLength))}_swapDataView(e){this.dataView=e,this.buffer=e.buffer,this.byteOffset=e.byteOffset,this.byteLength=e.byteLength}_lengthToEnd(e){return this.byteLength-e}set(e,t,s=c){return e instanceof DataView||e instanceof c?e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength):e instanceof ArrayBuffer&&(e=new Uint8Array(e)),e instanceof Uint8Array||l("BufferView.set(): Invalid data argument."),this.toUint8().set(e,t),new s(this,t,e.byteLength)}subarray(e,t){return t=t||this._lengthToEnd(e),new c(this,e,t)}toUint8(){return new Uint8Array(this.buffer,this.byteOffset,this.byteLength)}getUint8Array(e,t){return new Uint8Array(this.buffer,this.byteOffset+e,t)}getString(e=0,t=this.byteLength){return i=this.getUint8Array(e,t),d?d.decode(i):a?Buffer.from(i).toString("utf8"):decodeURIComponent(escape(u(i)));var i}getLatin1String(e=0,t=this.byteLength){let s=this.getUint8Array(e,t);return u(s)}getUnicodeString(e=0,t=this.byteLength){const s=[];for(let i=0;i<t&&e+i<this.byteLength;i+=2)s.push(this.getUint16(e+i));return u(s)}getInt8(e){return this.dataView.getInt8(e)}getUint8(e){return this.dataView.getUint8(e)}getInt16(e,t=this.le){return this.dataView.getInt16(e,t)}getInt32(e,t=this.le){return this.dataView.getInt32(e,t)}getUint16(e,t=this.le){return this.dataView.getUint16(e,t)}getUint32(e,t=this.le){return this.dataView.getUint32(e,t)}getFloat32(e,t=this.le){return this.dataView.getFloat32(e,t)}getFloat64(e,t=this.le){return this.dataView.getFloat64(e,t)}getFloat(e,t=this.le){return this.dataView.getFloat32(e,t)}getDouble(e,t=this.le){return this.dataView.getFloat64(e,t)}getUintBytes(e,t,s){switch(t){case 1:return this.getUint8(e,s);case 2:return this.getUint16(e,s);case 4:return this.getUint32(e,s);case 8:return this.getUint64&&this.getUint64(e,s)}}getUint(e,t,s){switch(t){case 8:return this.getUint8(e,s);case 16:return this.getUint16(e,s);case 32:return this.getUint32(e,s);case 64:return this.getUint64&&this.getUint64(e,s)}}toString(e){return this.dataView.toString(e,this.constructor.name)}ensureChunk(){}}function p(e,t){l(`${e} '${t}' was not loaded, try using full build of exifr.`)}class g extends Map{constructor(e){super(),this.kind=e}get(e,t){return this.has(e)||p(this.kind,e),t&&(e in t||function(e,t){l(`Unknown ${e} '${t}'.`)}(this.kind,e),t[e].enabled||p(this.kind,e)),super.get(e)}keyList(){return Array.from(this.keys())}}var m=new g("file parser"),y=new g("segment parser"),b=new g("file reader");let w=t.fetch;function k(e,t){return(i=e).startsWith("data:")||i.length>1e4?v(e,t,"base64"):n&&e.includes("://")?O(e,t,"url",S):n?v(e,t,"fs"):s?O(e,t,"url",S):void l("Invalid input argument");var i}async function O(e,t,s,i){return b.has(s)?v(e,t,s):i?async function(e,t){let s=await t(e);return new c(s)}(e,i):void l(`Parser ${s} is not loaded`)}async function v(e,t,s){let i=new(b.get(s))(e,t);return await i.read(),i}const S=e=>w(e).then(e=>e.arrayBuffer()),A=e=>new Promise((t,s)=>{let i=new FileReader;i.onloadend=()=>t(i.result||new ArrayBuffer),i.onerror=s,i.readAsArrayBuffer(e)}),B=new Map,V=new Map,I=new Map,L=["chunked","firstChunkSize","firstChunkSizeNode","firstChunkSizeBrowser","chunkSize","chunkLimit"],T=["jfif","xmp","icc","iptc","ihdr"],z=["tiff",...T],P=["ifd0","ifd1","exif","gps","interop"],F=[...z,...P],j=["makerNote","userComment"],E=["translateKeys","translateValues","reviveValues","multiSegment"],M=[...E,"sanitize","mergeOutput","silentErrors"];class _{get translate(){return this.translateKeys||this.translateValues||this.reviveValues}}class D extends _{get needed(){return this.enabled||this.deps.size>0}constructor(t,s,i,n){if(super(),e(this,"enabled",!1),e(this,"skip",new Set),e(this,"pick",new Set),e(this,"deps",new Set),e(this,"translateKeys",!1),e(this,"translateValues",!1),e(this,"reviveValues",!1),this.key=t,this.enabled=s,this.parse=this.enabled,this.applyInheritables(n),this.canBeFiltered=P.includes(t),this.canBeFiltered&&(this.dict=B.get(t)),void 0!==i)if(Array.isArray(i))this.parse=this.enabled=!0,this.canBeFiltered&&i.length>0&&this.translateTagSet(i,this.pick);else if("object"==typeof i){if(this.enabled=!0,this.parse=!1!==i.parse,this.canBeFiltered){let{pick:e,skip:t}=i;e&&e.length>0&&this.translateTagSet(e,this.pick),t&&t.length>0&&this.translateTagSet(t,this.skip)}this.applyInheritables(i)}else!0===i||!1===i?this.parse=this.enabled=i:l(`Invalid options argument: ${i}`)}applyInheritables(e){let t,s;for(t of E)s=e[t],void 0!==s&&(this[t]=s)}translateTagSet(e,t){if(this.dict){let s,i,{tagKeys:n,tagValues:r}=this.dict;for(s of e)"string"==typeof s?(i=r.indexOf(s),-1===i&&(i=n.indexOf(Number(s))),-1!==i&&t.add(Number(n[i]))):t.add(s)}else for(let s of e)t.add(s)}finalizeFilters(){!this.enabled&&this.deps.size>0?(this.enabled=!0,X(this.pick,this.deps)):this.enabled&&this.pick.size>0&&X(this.pick,this.deps)}}var N={jfif:!1,tiff:!0,xmp:!1,icc:!1,iptc:!1,ifd0:!0,ifd1:!1,exif:!0,gps:!0,interop:!1,ihdr:void 0,makerNote:!1,userComment:!1,multiSegment:!1,skip:[],pick:[],translateKeys:!0,translateValues:!0,reviveValues:!0,sanitize:!0,mergeOutput:!0,silentErrors:!0,chunked:!0,firstChunkSize:void 0,firstChunkSizeNode:512,firstChunkSizeBrowser:65536,chunkSize:65536,chunkLimit:5},$=new Map;class R extends _{static useCached(e){let t=$.get(e);return void 0!==t||(t=new this(e),$.set(e,t)),t}constructor(e){super(),!0===e?this.setupFromTrue():void 0===e?this.setupFromUndefined():Array.isArray(e)?this.setupFromArray(e):"object"==typeof e?this.setupFromObject(e):l(`Invalid options argument ${e}`),void 0===this.firstChunkSize&&(this.firstChunkSize=s?this.firstChunkSizeBrowser:this.firstChunkSizeNode),this.mergeOutput&&(this.ifd1.enabled=!1),this.filterNestedSegmentTags(),this.traverseTiffDependencyTree(),this.checkLoadedPlugins()}setupFromUndefined(){let e;for(e of L)this[e]=N[e];for(e of M)this[e]=N[e];for(e of j)this[e]=N[e];for(e of F)this[e]=new D(e,N[e],void 0,this)}setupFromTrue(){let e;for(e of L)this[e]=N[e];for(e of M)this[e]=N[e];for(e of j)this[e]=!0;for(e of F)this[e]=new D(e,!0,void 0,this)}setupFromArray(e){let t;for(t of L)this[t]=N[t];for(t of M)this[t]=N[t];for(t of j)this[t]=N[t];for(t of F)this[t]=new D(t,!1,void 0,this);this.setupGlobalFilters(e,void 0,P)}setupFromObject(e){let t;for(t of(P.ifd0=P.ifd0||P.image,P.ifd1=P.ifd1||P.thumbnail,Object.assign(this,e),L))this[t]=W(e[t],N[t]);for(t of M)this[t]=W(e[t],N[t]);for(t of j)this[t]=W(e[t],N[t]);for(t of z)this[t]=new D(t,N[t],e[t],this);for(t of P)this[t]=new D(t,N[t],e[t],this.tiff);this.setupGlobalFilters(e.pick,e.skip,P,F),!0===e.tiff?this.batchEnableWithBool(P,!0):!1===e.tiff?this.batchEnableWithUserValue(P,e):Array.isArray(e.tiff)?this.setupGlobalFilters(e.tiff,void 0,P):"object"==typeof e.tiff&&this.setupGlobalFilters(e.tiff.pick,e.tiff.skip,P)}batchEnableWithBool(e,t){for(let s of e)this[s].enabled=t}batchEnableWithUserValue(e,t){for(let s of e){let e=t[s];this[s].enabled=!1!==e&&void 0!==e}}setupGlobalFilters(e,t,s,i=s){if(e&&e.length){for(let e of i)this[e].enabled=!1;let t=K(e,s);for(let[e,s]of t)X(this[e].pick,s),this[e].enabled=!0}else if(t&&t.length){let e=K(t,s);for(let[t,s]of e)X(this[t].skip,s)}}filterNestedSegmentTags(){let{ifd0:e,exif:t,xmp:s,iptc:i,icc:n}=this;this.makerNote?t.deps.add(37500):t.skip.add(37500),this.userComment?t.deps.add(37510):t.skip.add(37510),s.enabled||e.skip.add(700),i.enabled||e.skip.add(33723),n.enabled||e.skip.add(34675)}traverseTiffDependencyTree(){let{ifd0:e,exif:t,gps:s,interop:i}=this;i.needed&&(t.deps.add(40965),e.deps.add(40965)),t.needed&&e.deps.add(34665),s.needed&&e.deps.add(34853),this.tiff.enabled=P.some(e=>!0===this[e].enabled)||this.makerNote||this.userComment;for(let e of P)this[e].finalizeFilters()}get onlyTiff(){return!T.map(e=>this[e].enabled).some(e=>!0===e)&&this.tiff.enabled}checkLoadedPlugins(){for(let e of z)this[e].enabled&&!y.has(e)&&p("segment parser",e)}}function K(e,t){let s,i,n,r,a=[];for(n of t){for(r of(s=B.get(n),i=[],s))(e.includes(r[0])||e.includes(r[1]))&&i.push(r[0]);i.length&&a.push([n,i])}return a}function W(e,t){return void 0!==e?e:void 0!==t?t:void 0}function X(e,t){for(let s of t)e.add(s)}e(R,"default",N);class H{constructor(t){e(this,"parsers",{}),e(this,"output",{}),e(this,"errors",[]),e(this,"pushToErrors",e=>this.errors.push(e)),this.options=R.useCached(t)}async read(e){this.file=await function(e,t){return"string"==typeof e?k(e,t):s&&!i&&e instanceof HTMLImageElement?k(e.src,t):e instanceof Uint8Array||e instanceof ArrayBuffer||e instanceof DataView?new c(e):s&&e instanceof Blob?O(e,t,"blob",A):void l("Invalid input argument")}(e,this.options)}setup(){if(this.fileParser)return;let{file:e}=this,t=e.getUint16(0);for(let[s,i]of m)if(i.canHandle(e,t))return this.fileParser=new i(this.options,this.file,this.parsers),e[s]=!0;this.file.close&&this.file.close(),l("Unknown file format")}async parse(){let{output:e,errors:t}=this;return this.setup(),this.options.silentErrors?(await this.executeParsers().catch(this.pushToErrors),t.push(...this.fileParser.errors)):await this.executeParsers(),this.file.close&&this.file.close(),this.options.silentErrors&&t.length>0&&(e.errors=t),f(s=e)?void 0:s;var s}async executeParsers(){let{output:e}=this;await this.fileParser.parse();let t=Object.values(this.parsers).map(async t=>{let s=await t.parse();t.assignToOutput(e,s)});this.options.silentErrors&&(t=t.map(e=>e.catch(this.pushToErrors))),await Promise.all(t)}async extractThumbnail(){this.setup();let{options:e,file:t}=this,s=y.get("tiff",e);var i;if(t.tiff?i={start:0,type:"tiff"}:t.jpeg&&(i=await this.fileParser.getOrFindSegment("tiff")),void 0===i)return;let n=await this.fileParser.ensureSegmentChunk(i),r=this.parsers.tiff=new s(n,e,t),a=await r.extractThumbnail();return t.close&&t.close(),a}}class J{static findPosition(e,t){let s=e.getUint16(t+2)+2,i="function"==typeof this.headerLength?this.headerLength(e,t,s):this.headerLength,n=t+i,r=s-i;return{offset:t,length:s,headerLength:i,start:n,size:r,end:n+r}}static parse(e,t={}){return new this(e,new R({[this.type]:t}),e).parse()}normalizeInput(e){return e instanceof c?e:new c(e)}constructor(t,s={},i){e(this,"errors",[]),e(this,"raw",new Map),e(this,"handleError",e=>{if(!this.options.silentErrors)throw e;this.errors.push(e.message)}),this.chunk=this.normalizeInput(t),this.file=i,this.type=this.constructor.type,this.globalOptions=this.options=s,this.localOptions=s[this.type],this.canTranslate=this.localOptions&&this.localOptions.translate}translate(){this.canTranslate&&(this.translated=this.translateBlock(this.raw,this.type))}get output(){return this.translated?this.translated:this.raw?Object.fromEntries(this.raw):void 0}translateBlock(e,t){let s=I.get(t),i=V.get(t),n=B.get(t),r=this.options[t],a=r.reviveValues&&!!s,h=r.translateValues&&!!i,f=r.translateKeys&&!!n,l={};for(let[t,r]of e)a&&s.has(t)?r=s.get(t)(r):h&&i.has(t)&&(r=this.translateValue(r,i.get(t))),f&&n.has(t)&&(t=n.get(t)||t),l[t]=r;return l}translateValue(e,t){return t[e]||t.DEFAULT||e}assignToOutput(e,t){this.assignObjectToOutput(e,this.constructor.type,t)}assignObjectToOutput(e,t,s){if(this.globalOptions.mergeOutput)return Object.assign(e,s);e[t]?Object.assign(e[t],s):e[t]=s}}function q(e){return 192===e||194===e||196===e||219===e||221===e||218===e||254===e}function Q(e){return e>=224&&e<=239}function Z(e,t,s){for(let[i,n]of y)if(n.canHandle(e,t,s))return i}e(J,"headerLength",4),e(J,"type",void 0),e(J,"multiSegment",!1),e(J,"canHandle",()=>!1);class ee extends class{constructor(t,s,i){e(this,"errors",[]),e(this,"ensureSegmentChunk",async e=>{let t=e.start,s=e.size||65536;if(this.file.chunked)if(this.file.available(t,s))e.chunk=this.file.subarray(t,s);else try{e.chunk=await this.file.readChunk(t,s)}catch(t){l(`Couldn't read segment: ${JSON.stringify(e)}. ${t.message}`)}else this.file.byteLength>t+s?e.chunk=this.file.subarray(t,s):void 0===e.size?e.chunk=this.file.subarray(t):l("Segment unreachable: "+JSON.stringify(e));return e.chunk}),this.extendOptions&&this.extendOptions(t),this.options=t,this.file=s,this.parsers=i}injectSegment(e,t){this.options[e].enabled&&this.createParser(e,t)}createParser(e,t){let s=new(y.get(e))(t,this.options,this.file);return this.parsers[e]=s}createParsers(e){for(let t of e){let{type:e,chunk:s}=t,i=this.options[e];if(i&&i.enabled){let t=this.parsers[e];t&&t.append||t||this.createParser(e,s)}}}async readSegments(e){let t=e.map(this.ensureSegmentChunk);await Promise.all(t)}}{constructor(...t){super(...t),e(this,"appSegments",[]),e(this,"jpegSegments",[]),e(this,"unknownSegments",[])}static canHandle(e,t){return 65496===t}async parse(){await this.findAppSegments(),await this.readSegments(this.appSegments),this.mergeMultiSegments(),this.createParsers(this.mergedAppSegments||this.appSegments)}setupSegmentFinderArgs(e){!0===e?(this.findAll=!0,this.wanted=new Set(y.keyList())):(e=void 0===e?y.keyList().filter(e=>this.options[e].enabled):e.filter(e=>this.options[e].enabled&&y.has(e)),this.findAll=!1,this.remaining=new Set(e),this.wanted=new Set(e)),this.unfinishedMultiSegment=!1}async findAppSegments(e=0,t){this.setupSegmentFinderArgs(t);let{file:s,findAll:i,wanted:n,remaining:r}=this;if(!i&&this.file.chunked&&(i=Array.from(n).some(e=>{let t=y.get(e),s=this.options[e];return t.multiSegment&&s.multiSegment}),i&&await this.file.readWhole()),e=this.findAppSegmentsInRange(e,s.byteLength),!this.options.onlyTiff&&s.chunked){let t=!1;for(;r.size>0&&!t&&(s.canReadNextChunk||this.unfinishedMultiSegment);){let{nextChunkOffset:i}=s,n=this.appSegments.some(e=>!this.file.available(e.offset||e.start,e.length||e.size));if(t=e>i&&!n?!await s.readNextChunk(e):!await s.readNextChunk(i),void 0===(e=this.findAppSegmentsInRange(e,s.byteLength)))return}}}findAppSegmentsInRange(e,t){t-=2;let s,i,n,r,a,h,{file:f,findAll:l,wanted:o,remaining:u,options:d}=this;for(;e<t;e++)if(255===f.getUint8(e))if(s=f.getUint8(e+1),Q(s)){if(i=f.getUint16(e+2),n=Z(f,e,i),n&&o.has(n)&&(r=y.get(n),a=r.findPosition(f,e),h=d[n],a.type=n,this.appSegments.push(a),!l&&(r.multiSegment&&h.multiSegment?(this.unfinishedMultiSegment=a.chunkNumber<a.chunkCount,this.unfinishedMultiSegment||u.delete(n)):u.delete(n),0===u.size)))break;d.recordUnknownSegments&&(a=J.findPosition(f,e),a.marker=s,this.unknownSegments.push(a)),e+=i+1}else if(q(s)){if(i=f.getUint16(e+2),218===s&&!1!==d.stopAfterSos)return;d.recordJpegSegments&&this.jpegSegments.push({offset:e,length:i,marker:s}),e+=i+1}return e}mergeMultiSegments(){if(!this.appSegments.some(e=>e.multiSegment))return;let e=function(e){let s,i,n,r=new Map;for(let a=0;a<e.length;a++)s=e[a],i=s.type,r.has(i)?n=r.get(i):r.set(i,n=[]),n.push(s);return Array.from(r)}(this.appSegments);this.mergedAppSegments=e.map(([e,t])=>{let s=y.get(e,this.options);return s.handleMultiSegments?{type:e,chunk:s.handleMultiSegments(t)}:t[0]})}getSegment(e){return this.appSegments.find(t=>t.type===e)}async getOrFindSegment(e){let t=this.getSegment(e);return void 0===t&&(await this.findAppSegments(0,[e]),t=this.getSegment(e)),t}}e(ee,"type","jpeg"),m.set("jpeg",ee);const te=[void 0,1,1,2,4,8,1,1,2,4,8,4,8,4];class se extends J{parseHeader(){var e=this.chunk.getUint16();18761===e?this.le=!0:19789===e&&(this.le=!1),this.chunk.le=this.le,this.headerParsed=!0}parseTags(e,t,s=new Map){let{pick:i,skip:n}=this.options[t];i=new Set(i);let r=i.size>0,a=0===n.size,h=this.chunk.getUint16(e);e+=2;for(let f=0;f<h;f++){let h=this.chunk.getUint16(e);if(r){if(i.has(h)&&(s.set(h,this.parseTag(e,h,t)),i.delete(h),0===i.size))break}else!a&&n.has(h)||s.set(h,this.parseTag(e,h,t));e+=12}return s}parseTag(e,t,s){let{chunk:i}=this,n=i.getUint16(e+2),r=i.getUint32(e+4),a=te[n];if(a*r<=4?e+=8:e=i.getUint32(e+8),(n<1||n>13)&&l(`Invalid TIFF value type. block: ${s.toUpperCase()}, tag: ${t.toString(16)}, type: ${n}, offset ${e}`),e>i.byteLength&&l(`Invalid TIFF value offset. block: ${s.toUpperCase()}, tag: ${t.toString(16)}, type: ${n}, offset ${e} is outside of chunk size ${i.byteLength}`),1===n)return i.getUint8Array(e,r);if(2===n)return""===(h=function(e){for(;e.endsWith("\0");)e=e.slice(0,-1);return e}(h=i.getString(e,r)).trim())?void 0:h;var h;if(7===n)return i.getUint8Array(e,r);if(1===r)return this.parseTagValue(n,e);{let t=new(function(e){switch(e){case 1:return Uint8Array;case 3:return Uint16Array;case 4:return Uint32Array;case 5:case 10:default:return Array;case 6:return Int8Array;case 8:return Int16Array;case 9:return Int32Array;case 11:return Float32Array;case 12:return Float64Array}}(n))(r),s=a;for(let i=0;i<r;i++)t[i]=this.parseTagValue(n,e),e+=s;return t}}parseTagValue(e,t){let{chunk:s}=this;switch(e){case 1:return s.getUint8(t);case 3:return s.getUint16(t);case 4:case 13:return s.getUint32(t);case 5:return s.getUint32(t)/s.getUint32(t+4);case 6:return s.getInt8(t);case 8:return s.getInt16(t);case 9:return s.getInt32(t);case 10:return s.getInt32(t)/s.getInt32(t+4);case 11:return s.getFloat(t);case 12:return s.getDouble(t);default:l(`Invalid tiff type ${e}`)}}}class ie extends se{static canHandle(e,t){return 225===e.getUint8(t+1)&&1165519206===e.getUint32(t+4)&&0===e.getUint16(t+8)}async parse(){this.parseHeader();let{options:e}=this;return e.ifd0.enabled&&await this.parseIfd0Block(),e.exif.enabled&&await this.safeParse("parseExifBlock"),e.gps.enabled&&await this.safeParse("parseGpsBlock"),e.interop.enabled&&await this.safeParse("parseInteropBlock"),e.ifd1.enabled&&await this.safeParse("parseThumbnailBlock"),this.createOutput()}safeParse(e){let t=this[e]();return void 0!==t.catch&&(t=t.catch(this.handleError)),t}findIfd0Offset(){void 0===this.ifd0Offset&&(this.ifd0Offset=this.chunk.getUint32(4))}findIfd1Offset(){if(void 0===this.ifd1Offset){this.findIfd0Offset();let e=this.chunk.getUint16(this.ifd0Offset),t=this.ifd0Offset+2+12*e;this.ifd1Offset=this.chunk.getUint32(t)}}parseBlock(e,t){let s=new Map;return this[t]=s,this.parseTags(e,t,s),s}async parseIfd0Block(){if(this.ifd0)return;let{file:e}=this;this.findIfd0Offset(),this.ifd0Offset<8&&l("Malformed EXIF data"),!e.chunked&&this.ifd0Offset>e.byteLength&&l(`IFD0 offset points to outside of file.\nthis.ifd0Offset: ${this.ifd0Offset}, file.byteLength: ${e.byteLength}`),e.tiff&&await e.ensureChunk(this.ifd0Offset,o(this.options));let t=this.parseBlock(this.ifd0Offset,"ifd0");return 0!==t.size?(this.exifOffset=t.get(34665),this.interopOffset=t.get(40965),this.gpsOffset=t.get(34853),this.xmp=t.get(700),this.iptc=t.get(33723),this.icc=t.get(34675),this.options.sanitize&&(t.delete(34665),t.delete(40965),t.delete(34853),t.delete(700),t.delete(33723),t.delete(34675)),t):void 0}async parseExifBlock(){if(this.exif)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.exifOffset)return;this.file.tiff&&await this.file.ensureChunk(this.exifOffset,o(this.options));let e=this.parseBlock(this.exifOffset,"exif");return this.interopOffset||(this.interopOffset=e.get(40965)),this.makerNote=e.get(37500),this.userComment=e.get(37510),this.options.sanitize&&(e.delete(40965),e.delete(37500),e.delete(37510)),this.unpack(e,41728),this.unpack(e,41729),e}unpack(e,t){let s=e.get(t);s&&1===s.length&&e.set(t,s[0])}async parseGpsBlock(){if(this.gps)return;if(this.ifd0||await this.parseIfd0Block(),void 0===this.gpsOffset)return;let e=this.parseBlock(this.gpsOffset,"gps");return e&&e.has(2)&&e.has(4)&&(e.set("latitude",ne(...e.get(2),e.get(1))),e.set("longitude",ne(...e.get(4),e.get(3)))),e}async parseInteropBlock(){if(!this.interop&&(this.ifd0||await this.parseIfd0Block(),void 0!==this.interopOffset||this.exif||await this.parseExifBlock(),void 0!==this.interopOffset))return this.parseBlock(this.interopOffset,"interop")}async parseThumbnailBlock(e=!1){if(!this.ifd1&&!this.ifd1Parsed&&(!this.options.mergeOutput||e))return this.findIfd1Offset(),this.ifd1Offset>0&&(this.parseBlock(this.ifd1Offset,"ifd1"),this.ifd1Parsed=!0),this.ifd1}async extractThumbnail(){if(this.headerParsed||this.parseHeader(),this.ifd1Parsed||await this.parseThumbnailBlock(!0),void 0===this.ifd1)return;let e=this.ifd1.get(513),t=this.ifd1.get(514);return this.chunk.getUint8Array(e,t)}get image(){return this.ifd0}get thumbnail(){return this.ifd1}createOutput(){let e,t,s,i={};for(t of P)if(e=this[t],!f(e))if(s=this.canTranslate?this.translateBlock(e,t):Object.fromEntries(e),this.options.mergeOutput){if("ifd1"===t)continue;Object.assign(i,s)}else i[t]=s;return this.makerNote&&(i.makerNote=this.makerNote),this.userComment&&(i.userComment=this.userComment),i}assignToOutput(e,t){if(this.globalOptions.mergeOutput)Object.assign(e,t);else for(let[s,i]of Object.entries(t))this.assignObjectToOutput(e,s,i)}}function ne(e,t,s,i){var n=e+t/60+s/3600;return"S"!==i&&"W"!==i||(n*=-1),n}e(ie,"type","tiff"),e(ie,"headerLength",10),y.set("tiff",ie);const ae={ifd0:!1,ifd1:!1,exif:!1,gps:!1,interop:!1,sanitize:!1,reviveValues:!0,translateKeys:!1,translateValues:!1,mergeOutput:!1};Object.assign({},ae,{firstChunkSize:4e4,gps:[1,2,3,4]}),Object.assign({},ae,{tiff:!1,ifd1:!0,mergeOutput:!1});const de=Object.assign({},ae,{firstChunkSize:4e4,ifd0:[274]});const pe=Object.freeze({1:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:0,rad:0},2:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:0,rad:0},3:{dimensionSwapped:!1,scaleX:1,scaleY:1,deg:180,rad:180*Math.PI/180},4:{dimensionSwapped:!1,scaleX:-1,scaleY:1,deg:180,rad:180*Math.PI/180},5:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:90,rad:90*Math.PI/180},6:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:90,rad:90*Math.PI/180},7:{dimensionSwapped:!0,scaleX:1,scaleY:-1,deg:270,rad:270*Math.PI/180},8:{dimensionSwapped:!0,scaleX:1,scaleY:1,deg:270,rad:270*Math.PI/180}});let ge=!0,me=!0;if("object"==typeof navigator){let e=navigator.userAgent;if(e.includes("iPad")||e.includes("iPhone")){let t=e.match(/OS (\d+)_(\d+)/);if(t){let[,e,s]=t,i=Number(e)+.1*Number(s);ge=i<13.4,me=!1}}else if(e.includes("OS X 10")){let[,t]=e.match(/OS X 10[_.](\d+)/);ge=me=Number(t)<15}if(e.includes("Chrome/")){let[,t]=e.match(/Chrome\/(\d+)/);ge=me=Number(t)<81}else if(e.includes("Firefox/")){let[,t]=e.match(/Firefox\/(\d+)/);ge=me=Number(t)<77}}async function ye(e){let t=await async function(e){let t=new H(de);await t.read(e);let s=await t.parse();if(s&&s.ifd0)return s.ifd0[274]}(e);return Object.assign({canvas:ge,css:me},pe[t])}class be extends c{constructor(...t){super(...t),e(this,"ranges",new we),0!==this.byteLength&&this.ranges.add(0,this.byteLength)}_tryExtend(e,t,s){if(0===e&&0===this.byteLength&&s){let e=new DataView(s.buffer||s,s.byteOffset,s.byteLength);this._swapDataView(e)}else{let s=e+t;if(s>this.byteLength){let{dataView:e}=this._extend(s);this._swapDataView(e)}}}_extend(e){let t;t=a?r.allocUnsafe(e):new Uint8Array(e);let s=new DataView(t.buffer,t.byteOffset,t.byteLength);return t.set(new Uint8Array(this.buffer,this.byteOffset,this.byteLength),0),{uintView:t,dataView:s}}subarray(e,t,s=!1){return t=t||this._lengthToEnd(e),s&&this._tryExtend(e,t),this.ranges.add(e,t),super.subarray(e,t)}set(e,t,s=!1){s&&this._tryExtend(t,e.byteLength,e);let i=super.set(e,t);return this.ranges.add(t,i.byteLength),i}async ensureChunk(e,t){this.chunked&&(this.ranges.available(e,t)||await this.readChunk(e,t))}available(e,t){return this.ranges.available(e,t)}}class we{constructor(){e(this,"list",[])}get length(){return this.list.length}add(e,t,s=0){let i=e+t,n=this.list.filter(t=>ke(e,t.offset,i)||ke(e,t.end,i));if(n.length>0){e=Math.min(e,...n.map(e=>e.offset)),i=Math.max(i,...n.map(e=>e.end)),t=i-e;let s=n.shift();s.offset=e,s.length=t,s.end=i,this.list=this.list.filter(e=>!n.includes(e))}else this.list.push({offset:e,length:t,end:i})}available(e,t){let s=e+t;return this.list.some(t=>t.offset<=e&&s<=t.end)}}function ke(e,t,s){return e<=t&&t<=s}class Oe extends be{constructor(t,s){super(0),e(this,"chunksRead",0),this.input=t,this.options=s}async readWhole(){this.chunked=!1,await this.readChunk(this.nextChunkOffset)}async readChunked(){this.chunked=!0,await this.readChunk(0,this.options.firstChunkSize)}async readNextChunk(e=this.nextChunkOffset){if(this.fullyRead)return this.chunksRead++,!1;let t=this.options.chunkSize,s=await this.readChunk(e,t);return!!s&&s.byteLength===t}async readChunk(e,t){if(this.chunksRead++,0!==(t=this.safeWrapAddress(e,t)))return this._readChunk(e,t)}safeWrapAddress(e,t){return void 0!==this.size&&e+t>this.size?Math.max(0,this.size-e):t}get nextChunkOffset(){if(0!==this.ranges.list.length)return this.ranges.list[0].length}get canReadNextChunk(){return this.chunksRead<this.options.chunkLimit}get fullyRead(){return void 0!==this.size&&this.nextChunkOffset===this.size}read(){return this.options.chunked?this.readChunked():this.readWhole()}close(){}}b.set("blob",class extends Oe{async readWhole(){this.chunked=!1;let e=await A(this.input);this._swapArrayBuffer(e)}readChunked(){return this.chunked=!0,this.size=this.input.size,super.readChunked()}async _readChunk(e,t){let s=t?e+t:void 0,i=this.input.slice(e,s),n=await A(i);return this.set(n,e,!0)}});var packageJson$9_version="5.0.1",locale$6={strings:{generatingThumbnails:"Generating thumbnails..."}};function canvasToBlob(canvas,type,quality){try{canvas.getContext("2d").getImageData(0,0,1,1)}catch(err){if(18===err.code)return Promise.reject(new Error("cannot read image, probably an svg with external resources"))}return canvas.toBlob?new Promise(resolve=>{canvas.toBlob(resolve,type,quality)}).then(blob=>{if(null===blob)throw new Error("cannot read image, probably an svg with external resources");return blob}):Promise.resolve().then(()=>function(dataURI,opts){const dataURIData=DATA_URL_PATTERN.exec(dataURI),mimeType=opts.mimeType??dataURIData?.[1]??"plain/text";let data;if(null!=dataURIData?.[2]){const binary=atob(decodeURIComponent(dataURIData[3])),bytes=new Uint8Array(binary.length);for(let i=0;i<binary.length;i++)bytes[i]=binary.charCodeAt(i);data=[bytes]}else null!=dataURIData?.[3]&&(data=[decodeURIComponent(dataURIData[3])]);return new Blob(data,{type:mimeType})}(canvas.toDataURL(type,quality),{})).then(blob=>{if(null===blob)throw new Error("could not extract blob, probably an old browser");return blob})}const defaultOptions$6={thumbnailWidth:null,thumbnailHeight:null,thumbnailType:"image/jpeg",waitForThumbnailsBeforeUpload:!1,lazy:!1};class ThumbnailGenerator extends UIPlugin{static VERSION=packageJson$9_version;queue;queueProcessing;defaultThumbnailDimension;thumbnailType;constructor(uppy,opts){if(super(uppy,{...defaultOptions$6,...opts}),this.type="modifier",this.id=this.opts.id||"ThumbnailGenerator",this.title="Thumbnail Generator",this.queue=[],this.queueProcessing=!1,this.defaultThumbnailDimension=200,this.thumbnailType=this.opts.thumbnailType,this.defaultLocale=locale$6,this.i18nInit(),this.opts.lazy&&this.opts.waitForThumbnailsBeforeUpload)throw new Error("ThumbnailGenerator: The `lazy` and `waitForThumbnailsBeforeUpload` options are mutually exclusive. Please ensure at most one of them is set to `true`.")}createThumbnail(file,targetWidth,targetHeight){const originalUrl=URL.createObjectURL(file.data),onload=new Promise((resolve,reject)=>{const image=new Image;image.src=originalUrl,image.addEventListener("load",()=>{URL.revokeObjectURL(originalUrl),resolve(image)}),image.addEventListener("error",event=>{URL.revokeObjectURL(originalUrl),reject(event.error||new Error("Could not create thumbnail"))})}),orientationPromise=ye(file.data).catch(()=>1);return Promise.all([onload,orientationPromise]).then(([image,orientation])=>{const dimensions=this.getProportionalDimensions(image,targetWidth,targetHeight,orientation.deg),rotatedImage=function(image,translate){let w=image.width,h=image.height;90!==translate.deg&&270!==translate.deg||(w=image.height,h=image.width);const canvas=document.createElement("canvas");canvas.width=w,canvas.height=h;const context=canvas.getContext("2d");return context.translate(w/2,h/2),translate.canvas&&(context.rotate(translate.rad),context.scale(translate.scaleX,translate.scaleY)),context.drawImage(image,-image.width/2,-image.height/2,image.width,image.height),canvas}(image,orientation);return canvasToBlob(this.resizeImage(rotatedImage,dimensions.width,dimensions.height),this.thumbnailType,80)}).then(blob=>URL.createObjectURL(blob))}getProportionalDimensions(img,width,height,deg){let aspect=img.width/img.height;if(90!==deg&&270!==deg||(aspect=img.height/img.width),null!=width){let targetWidth=width;return img.width<width&&(targetWidth=img.width),{width:targetWidth,height:Math.round(targetWidth/aspect)}}if(null!=height){let targetHeight=height;return img.height<height&&(targetHeight=img.height),{width:Math.round(targetHeight*aspect),height:targetHeight}}return{width:this.defaultThumbnailDimension,height:Math.round(this.defaultThumbnailDimension/aspect)}}resizeImage(image,targetWidth,targetHeight){let img=function(image){const ratio=image.width/image.height;let maxW=Math.floor(Math.sqrt(5e6*ratio)),maxH=Math.floor(5e6/Math.sqrt(5e6*ratio));if(maxW>4096&&(maxW=4096,maxH=Math.round(maxW/ratio)),maxH>4096&&(maxH=4096,maxW=Math.round(ratio*maxH)),image.width>maxW){const canvas=document.createElement("canvas");return canvas.width=maxW,canvas.height=maxH,canvas.getContext("2d").drawImage(image,0,0,maxW,maxH),canvas}return image}(image),steps=Math.ceil(Math.log2(img.width/targetWidth));steps<1&&(steps=1);let sW=targetWidth*2**(steps-1),sH=targetHeight*2**(steps-1);for(;steps--;){const canvas=document.createElement("canvas");canvas.width=sW,canvas.height=sH,canvas.getContext("2d").drawImage(img,0,0,sW,sH),img=canvas,sW=Math.round(sW/2),sH=Math.round(sH/2)}return img}setPreviewURL(fileID,preview){this.uppy.setFileState(fileID,{preview:preview})}addToQueue(fileID){this.queue.push(fileID),!1===this.queueProcessing&&this.processQueue()}processQueue(){if(this.queueProcessing=!0,this.queue.length>0){const current=this.uppy.getFile(this.queue.shift());return current?this.requestThumbnail(current).catch(()=>{}).then(()=>this.processQueue()):(this.uppy.log("[ThumbnailGenerator] file was removed before a thumbnail could be generated, but not removed from the queue. This is probably a bug","error"),Promise.resolve())}return this.queueProcessing=!1,this.uppy.log("[ThumbnailGenerator] Emptied thumbnail queue"),this.uppy.emit("thumbnail:all-generated"),Promise.resolve()}requestThumbnail(file){return isPreviewSupported(file.type)&&!file.isRemote?this.createThumbnail(file,this.opts.thumbnailWidth,this.opts.thumbnailHeight).then(preview=>{this.setPreviewURL(file.id,preview),this.uppy.log(`[ThumbnailGenerator] Generated thumbnail for ${file.id}`),this.uppy.emit("thumbnail:generated",this.uppy.getFile(file.id),preview)}).catch(err=>{this.uppy.log(`[ThumbnailGenerator] Failed thumbnail for ${file.id}:`,"warning"),this.uppy.log(err,"warning"),this.uppy.emit("thumbnail:error",this.uppy.getFile(file.id),err)}):Promise.resolve()}onFileAdded=file=>{!file.preview&&file.data&&isPreviewSupported(file.type)&&!file.isRemote&&this.addToQueue(file.id)};onCancelRequest=file=>{const index=this.queue.indexOf(file.id);-1!==index&&this.queue.splice(index,1)};onFileRemoved=file=>{const index=this.queue.indexOf(file.id);-1!==index&&this.queue.splice(index,1),file.preview&&isObjectURL(file.preview)&&URL.revokeObjectURL(file.preview)};onRestored=()=>{this.uppy.getFiles().filter(file=>file.isRestored).forEach(file=>{file.preview&&!isObjectURL(file.preview)||this.addToQueue(file.id)})};onAllFilesRemoved=()=>{this.queue=[]};waitUntilAllProcessed=fileIDs=>{fileIDs.forEach(fileID=>{const file=this.uppy.getFile(fileID);this.uppy.emit("preprocess-progress",file,{mode:"indeterminate",message:this.i18n("generatingThumbnails")})});const emitPreprocessCompleteForAll=()=>{fileIDs.forEach(fileID=>{const file=this.uppy.getFile(fileID);this.uppy.emit("preprocess-complete",file)})};return new Promise(resolve=>{this.queueProcessing?this.uppy.once("thumbnail:all-generated",()=>{emitPreprocessCompleteForAll(),resolve()}):(emitPreprocessCompleteForAll(),resolve())})};install(){this.uppy.on("file-removed",this.onFileRemoved),this.uppy.on("cancel-all",this.onAllFilesRemoved),this.opts.lazy?(this.uppy.on("thumbnail:request",this.onFileAdded),this.uppy.on("thumbnail:cancel",this.onCancelRequest)):(this.uppy.on("thumbnail:request",this.onFileAdded),this.uppy.on("file-added",this.onFileAdded),this.uppy.on("restored",this.onRestored)),this.opts.waitForThumbnailsBeforeUpload&&this.uppy.addPreProcessor(this.waitUntilAllProcessed)}uninstall(){this.uppy.off("file-removed",this.onFileRemoved),this.uppy.off("cancel-all",this.onAllFilesRemoved),this.opts.lazy?(this.uppy.off("thumbnail:request",this.onFileAdded),this.uppy.off("thumbnail:cancel",this.onCancelRequest)):(this.uppy.off("thumbnail:request",this.onFileAdded),this.uppy.off("file-added",this.onFileAdded),this.uppy.off("restored",this.onRestored)),this.opts.waitForThumbnailsBeforeUpload&&this.uppy.removePreProcessor(this.waitUntilAllProcessed)}}var packageJson$8_version="5.0.2";class AddFiles extends x{fileInput=null;folderInput=null;mobilePhotoFileInput=null;mobileVideoFileInput=null;triggerFileInputClick=()=>{this.fileInput?.click()};triggerFolderInputClick=()=>{this.folderInput?.click()};triggerVideoCameraInputClick=()=>{this.mobileVideoFileInput?.click()};triggerPhotoCameraInputClick=()=>{this.mobilePhotoFileInput?.click()};onFileInputChange=event=>{this.props.handleInputChange(event),event.currentTarget.value=""};renderHiddenInput=(isFolder,refCallback)=>u$2("input",{className:"uppy-Dashboard-input",hidden:!0,"aria-hidden":"true",tabIndex:-1,webkitdirectory:isFolder,type:"file",name:"files[]",multiple:1!==this.props.maxNumberOfFiles,onChange:this.onFileInputChange,accept:this.props.allowedFileTypes?.join(", "),ref:refCallback});renderHiddenCameraInput=(type,nativeCameraFacingMode,refCallback)=>{const accept={photo:"image/*",video:"video/*"}[type];return u$2("input",{className:"uppy-Dashboard-input",hidden:!0,"aria-hidden":"true",tabIndex:-1,type:"file",name:`camera-${type}`,onChange:this.onFileInputChange,capture:""===nativeCameraFacingMode?"environment":nativeCameraFacingMode,accept:accept,ref:refCallback})};renderMyDeviceAcquirer=()=>u$2("div",{className:"uppy-DashboardTab",role:"presentation","data-uppy-acquirer-id":"MyDevice",children:u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-DashboardTab-btn",role:"tab",tabIndex:0,"data-uppy-super-focusable":!0,onClick:this.triggerFileInputClick,children:[u$2("div",{className:"uppy-DashboardTab-inner",children:u$2("svg",{className:"uppy-DashboardTab-iconMyDevice","aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32",children:u$2("path",{d:"M8.45 22.087l-1.305-6.674h17.678l-1.572 6.674H8.45zm4.975-12.412l1.083 1.765a.823.823 0 00.715.386h7.951V13.5H8.587V9.675h4.838zM26.043 13.5h-1.195v-2.598c0-.463-.336-.75-.798-.75h-8.356l-1.082-1.766A.823.823 0 0013.897 8H7.728c-.462 0-.815.256-.815.718V13.5h-.956a.97.97 0 00-.746.37.972.972 0 00-.19.81l1.724 8.565c.095.44.484.755.933.755H24c.44 0 .824-.3.929-.727l2.043-8.568a.972.972 0 00-.176-.825.967.967 0 00-.753-.38z",fill:"currentcolor","fill-rule":"evenodd"})})}),u$2("div",{className:"uppy-DashboardTab-name",children:this.props.i18n("myDevice")})]})});renderPhotoCamera=()=>u$2("div",{className:"uppy-DashboardTab",role:"presentation","data-uppy-acquirer-id":"MobilePhotoCamera",children:u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-DashboardTab-btn",role:"tab",tabIndex:0,"data-uppy-super-focusable":!0,onClick:this.triggerPhotoCameraInputClick,children:[u$2("div",{className:"uppy-DashboardTab-inner",children:u$2("svg",{"aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32",children:u$2("path",{d:"M23.5 9.5c1.417 0 2.5 1.083 2.5 2.5v9.167c0 1.416-1.083 2.5-2.5 2.5h-15c-1.417 0-2.5-1.084-2.5-2.5V12c0-1.417 1.083-2.5 2.5-2.5h2.917l1.416-2.167C13 7.167 13.25 7 13.5 7h5c.25 0 .5.167.667.333L20.583 9.5H23.5zM16 11.417a4.706 4.706 0 00-4.75 4.75 4.704 4.704 0 004.75 4.75 4.703 4.703 0 004.75-4.75c0-2.663-2.09-4.75-4.75-4.75zm0 7.825c-1.744 0-3.076-1.332-3.076-3.074 0-1.745 1.333-3.077 3.076-3.077 1.744 0 3.074 1.333 3.074 3.076s-1.33 3.075-3.074 3.075z",fill:"#02B383","fill-rule":"nonzero"})})}),u$2("div",{className:"uppy-DashboardTab-name",children:this.props.i18n("takePictureBtn")})]})});renderVideoCamera=()=>u$2("div",{className:"uppy-DashboardTab",role:"presentation","data-uppy-acquirer-id":"MobileVideoCamera",children:u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-DashboardTab-btn",role:"tab",tabIndex:0,"data-uppy-super-focusable":!0,onClick:this.triggerVideoCameraInputClick,children:[u$2("div",{className:"uppy-DashboardTab-inner",children:u$2("svg",{"aria-hidden":"true",width:"32",height:"32",viewBox:"0 0 32 32",children:u$2("path",{fill:"#FF675E",fillRule:"nonzero",d:"m21.254 14.277 2.941-2.588c.797-.313 1.243.818 1.09 1.554-.01 2.094.02 4.189-.017 6.282-.126.915-1.145 1.08-1.58.34l-2.434-2.142c-.192.287-.504 1.305-.738.468-.104-1.293-.028-2.596-.05-3.894.047-.312.381.823.426 1.069.063-.384.206-.744.362-1.09zm-12.939-3.73c3.858.013 7.717-.025 11.574.02.912.129 1.492 1.237 1.351 2.217-.019 2.412.04 4.83-.03 7.239-.17 1.025-1.166 1.59-2.029 1.429-3.705-.012-7.41.025-11.114-.019-.913-.129-1.492-1.237-1.352-2.217.018-2.404-.036-4.813.029-7.214.136-.82.83-1.473 1.571-1.454z "})})}),u$2("div",{className:"uppy-DashboardTab-name",children:this.props.i18n("recordVideoBtn")})]})});renderBrowseButton=(text,onClickFn)=>u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-Dashboard-browse",onClick:onClickFn,"data-uppy-super-focusable":0===this.props.acquirers.length,children:text});renderDropPasteBrowseTagline=numberOfAcquirers=>{const browseFiles=this.renderBrowseButton(this.props.i18n("browseFiles"),this.triggerFileInputClick),browseFolders=this.renderBrowseButton(this.props.i18n("browseFolders"),this.triggerFolderInputClick),lowerFMSelectionType=this.props.fileManagerSelectionType,camelFMSelectionType=lowerFMSelectionType.charAt(0).toUpperCase()+lowerFMSelectionType.slice(1);return u$2("div",{class:"uppy-Dashboard-AddFiles-title",children:this.props.disableLocalFiles?this.props.i18n("importFiles"):numberOfAcquirers>0?this.props.i18nArray(`dropPasteImport${camelFMSelectionType}`,{browseFiles:browseFiles,browseFolders:browseFolders,browse:browseFiles}):this.props.i18nArray(`dropPaste${camelFMSelectionType}`,{browseFiles:browseFiles,browseFolders:browseFolders,browse:browseFiles})})};[Symbol.for("uppy test: disable unused locale key warning")](){this.props.i18nArray("dropPasteBoth"),this.props.i18nArray("dropPasteFiles"),this.props.i18nArray("dropPasteFolders"),this.props.i18nArray("dropPasteImportBoth"),this.props.i18nArray("dropPasteImportFiles"),this.props.i18nArray("dropPasteImportFolders")}renderAcquirer=acquirer=>u$2("div",{className:"uppy-DashboardTab",role:"presentation","data-uppy-acquirer-id":acquirer.id,children:u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-DashboardTab-btn",role:"tab",tabIndex:0,"data-cy":acquirer.id,"aria-controls":`uppy-DashboardContent-panel--${acquirer.id}`,"aria-selected":this.props.activePickerPanel?.id===acquirer.id,"data-uppy-super-focusable":!0,onClick:()=>this.props.showPanel(acquirer.id),children:[u$2("div",{className:"uppy-DashboardTab-inner",children:acquirer.icon()}),u$2("div",{className:"uppy-DashboardTab-name",children:acquirer.name})]})});renderAcquirers=acquirers=>{const acquirersWithoutLastTwo=[...acquirers],lastTwoAcquirers=acquirersWithoutLastTwo.splice(acquirers.length-2,acquirers.length);return u$2(k$2,{children:[acquirersWithoutLastTwo.map(acquirer=>this.renderAcquirer(acquirer)),u$2("span",{role:"presentation",style:{"white-space":"nowrap"},children:lastTwoAcquirers.map(acquirer=>this.renderAcquirer(acquirer))})]})};renderSourcesList=(acquirers,disableLocalFiles)=>{const{showNativePhotoCameraButton:showNativePhotoCameraButton,showNativeVideoCameraButton:showNativeVideoCameraButton}=this.props;let list=[];disableLocalFiles||list.push({key:"myDevice",elements:this.renderMyDeviceAcquirer()}),showNativePhotoCameraButton&&list.push({key:"nativePhotoCameraButton",elements:this.renderPhotoCamera()}),showNativeVideoCameraButton&&list.push({key:"nativePhotoCameraButton",elements:this.renderVideoCamera()}),list.push(...acquirers.map(acquirer=>({key:acquirer.id,elements:this.renderAcquirer(acquirer)})));1===list.length&&"myDevice"===list[0].key&&(list=[]);const listWithoutLastTwo=[...list],lastTwo=listWithoutLastTwo.splice(list.length-2,list.length);return u$2(k$2,{children:[this.renderDropPasteBrowseTagline(list.length),u$2("div",{className:"uppy-Dashboard-AddFiles-list",role:"tablist",children:[listWithoutLastTwo.map(({key:key,elements:elements})=>u$2(k$2,{children:elements},key)),u$2("span",{role:"presentation",style:{"white-space":"nowrap"},children:lastTwo.map(({key:key,elements:elements})=>u$2(k$2,{children:elements},key))})]})]})};renderPoweredByUppy(){const{i18nArray:i18nArray}=this.props,uppyBranding=u$2("span",{children:[u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon uppy-Dashboard-poweredByIcon",width:"11",height:"11",viewBox:"0 0 11 11",children:u$2("path",{d:"M7.365 10.5l-.01-4.045h2.612L5.5.806l-4.467 5.65h2.604l.01 4.044h3.718z",fillRule:"evenodd"})}),u$2("span",{className:"uppy-Dashboard-poweredByUppy",children:"Uppy"})]});return u$2("a",{tabIndex:-1,href:"https://uppy.io",rel:"noreferrer noopener",target:"_blank",className:"uppy-Dashboard-poweredBy",children:i18nArray("poweredBy",{uppy:uppyBranding})})}render(){const{showNativePhotoCameraButton:showNativePhotoCameraButton,showNativeVideoCameraButton:showNativeVideoCameraButton,nativeCameraFacingMode:nativeCameraFacingMode}=this.props;return u$2("div",{className:"uppy-Dashboard-AddFiles",children:[this.renderHiddenInput(!1,ref=>{this.fileInput=ref}),this.renderHiddenInput(!0,ref=>{this.folderInput=ref}),showNativePhotoCameraButton&&this.renderHiddenCameraInput("photo",nativeCameraFacingMode,ref=>{this.mobilePhotoFileInput=ref}),showNativeVideoCameraButton&&this.renderHiddenCameraInput("video",nativeCameraFacingMode,ref=>{this.mobileVideoFileInput=ref}),this.renderSourcesList(this.props.acquirers,this.props.disableLocalFiles),u$2("div",{className:"uppy-Dashboard-AddFiles-info",children:[this.props.note&&u$2("div",{className:"uppy-Dashboard-note",children:this.props.note}),this.props.proudlyDisplayPoweredByUppy&&this.renderPoweredByUppy()]})]})}}const AddFilesPanel=props=>u$2("div",{className:classNames("uppy-Dashboard-AddFilesPanel",props.className),"data-uppy-panelType":"AddFiles","aria-hidden":!props.showAddFilesPanel,children:[u$2("div",{className:"uppy-DashboardContent-bar",children:[u$2("div",{className:"uppy-DashboardContent-title",role:"heading","aria-level":1,children:props.i18n("addingMoreFiles")}),u$2("button",{className:"uppy-DashboardContent-back",type:"button",onClick:()=>props.toggleAddFilesPanel(!1),children:props.i18n("back")})]}),u$2(AddFiles,{...props})]});function EditorPanel(props){const file=props.files[props.fileCardFor];return u$2("div",{className:classNames("uppy-DashboardContent-panel",props.className),role:"tabpanel","data-uppy-panelType":"FileEditor",id:"uppy-DashboardContent-panel--editor",children:[u$2("div",{className:"uppy-DashboardContent-bar",children:[u$2("div",{className:"uppy-DashboardContent-title",role:"heading","aria-level":1,children:props.i18nArray("editing",{file:u$2("span",{className:"uppy-DashboardContent-titleFile",children:file.meta?file.meta.name:file.name})})}),u$2("button",{className:"uppy-DashboardContent-back",type:"button",onClick:()=>{props.uppy.emit("file-editor:cancel",file),props.closeFileEditor()},children:props.i18n("cancel")}),u$2("button",{className:"uppy-DashboardContent-save",type:"button",onClick:props.saveFileEditor,children:props.i18n("save")})]}),u$2("div",{className:"uppy-DashboardContent-panelBody",children:props.editors.map(target=>props.uppy.getPlugin(target.id).render(props.state))})]})}function getIconByMime(fileType){const defaultChoice={color:"#838999",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("g",{fill:"#A7AFB7",fillRule:"nonzero",children:[u$2("path",{d:"M5.5 22a.5.5 0 0 1-.5-.5v-18a.5.5 0 0 1 .5-.5h10.719a.5.5 0 0 1 .367.16l3.281 3.556a.5.5 0 0 1 .133.339V21.5a.5.5 0 0 1-.5.5h-14zm.5-1h13V7.25L16 4H6v17z"}),u$2("path",{d:"M15 4v3a1 1 0 0 0 1 1h3V7h-3V4h-1z"})]})})};if(!fileType)return defaultChoice;const fileTypeGeneral=fileType.split("/")[0],fileTypeSpecific=fileType.split("/")[1];if("text"===fileTypeGeneral)return{color:"#5a5e69",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("path",{d:"M4.5 7h13a.5.5 0 1 1 0 1h-13a.5.5 0 0 1 0-1zm0 3h15a.5.5 0 1 1 0 1h-15a.5.5 0 1 1 0-1zm0 3h15a.5.5 0 1 1 0 1h-15a.5.5 0 1 1 0-1zm0 3h10a.5.5 0 1 1 0 1h-10a.5.5 0 1 1 0-1z",fill:"#5A5E69",fillRule:"nonzero"})})};if("image"===fileTypeGeneral)return{color:"#686de0",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("g",{fill:"#686DE0",fillRule:"evenodd",children:[u$2("path",{d:"M5 7v10h15V7H5zm0-1h15a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1z",fillRule:"nonzero"}),u$2("path",{d:"M6.35 17.172l4.994-5.026a.5.5 0 0 1 .707 0l2.16 2.16 3.505-3.505a.5.5 0 0 1 .707 0l2.336 2.31-.707.72-1.983-1.97-3.505 3.505a.5.5 0 0 1-.707 0l-2.16-2.159-3.938 3.939-1.409.026z",fillRule:"nonzero"}),u$2("circle",{cx:"7.5",cy:"9.5",r:"1.5"})]})})};if("audio"===fileTypeGeneral)return{color:"#068dbb",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("path",{d:"M9.5 18.64c0 1.14-1.145 2-2.5 2s-2.5-.86-2.5-2c0-1.14 1.145-2 2.5-2 .557 0 1.079.145 1.5.396V7.25a.5.5 0 0 1 .379-.485l9-2.25A.5.5 0 0 1 18.5 5v11.64c0 1.14-1.145 2-2.5 2s-2.5-.86-2.5-2c0-1.14 1.145-2 2.5-2 .557 0 1.079.145 1.5.396V8.67l-8 2v7.97zm8-11v-2l-8 2v2l8-2zM7 19.64c.855 0 1.5-.484 1.5-1s-.645-1-1.5-1-1.5.484-1.5 1 .645 1 1.5 1zm9-2c.855 0 1.5-.484 1.5-1s-.645-1-1.5-1-1.5.484-1.5 1 .645 1 1.5 1z",fill:"#049BCF",fillRule:"nonzero"})})};if("video"===fileTypeGeneral)return{color:"#19af67",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("path",{d:"M16 11.834l4.486-2.691A1 1 0 0 1 22 10v6a1 1 0 0 1-1.514.857L16 14.167V17a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v2.834zM15 9H5v8h10V9zm1 4l5 3v-6l-5 3z",fill:"#19AF67",fillRule:"nonzero"})})};if("application"===fileTypeGeneral&&"pdf"===fileTypeSpecific)return{color:"#e25149",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("path",{d:"M9.766 8.295c-.691-1.843-.539-3.401.747-3.726 1.643-.414 2.505.938 2.39 3.299-.039.79-.194 1.662-.537 3.148.324.49.66.967 1.055 1.51.17.231.382.488.629.757 1.866-.128 3.653.114 4.918.655 1.487.635 2.192 1.685 1.614 2.84-.566 1.133-1.839 1.084-3.416.249-1.141-.604-2.457-1.634-3.51-2.707a13.467 13.467 0 0 0-2.238.426c-1.392 4.051-4.534 6.453-5.707 4.572-.986-1.58 1.38-4.206 4.914-5.375.097-.322.185-.656.264-1.001.08-.353.306-1.31.407-1.737-.678-1.059-1.2-2.031-1.53-2.91zm2.098 4.87c-.033.144-.068.287-.104.427l.033-.01-.012.038a14.065 14.065 0 0 1 1.02-.197l-.032-.033.052-.004a7.902 7.902 0 0 1-.208-.271c-.197-.27-.38-.526-.555-.775l-.006.028-.002-.003c-.076.323-.148.632-.186.8zm5.77 2.978c1.143.605 1.832.632 2.054.187.26-.519-.087-1.034-1.113-1.473-.911-.39-2.175-.608-3.55-.608.845.766 1.787 1.459 2.609 1.894zM6.559 18.789c.14.223.693.16 1.425-.413.827-.648 1.61-1.747 2.208-3.206-2.563 1.064-4.102 2.867-3.633 3.62zm5.345-10.97c.088-1.793-.351-2.48-1.146-2.28-.473.119-.564 1.05-.056 2.405.213.566.52 1.188.908 1.859.18-.858.268-1.453.294-1.984z",fill:"#E2514A",fillRule:"nonzero"})})};return"application"===fileTypeGeneral&&-1!==["zip","x-7z-compressed","x-zip-compressed","x-rar-compressed","x-tar","x-gzip","x-apple-diskimage"].indexOf(fileTypeSpecific)?{color:"#00C469",icon:u$2("svg",{"aria-hidden":"true",focusable:"false",width:"25",height:"25",viewBox:"0 0 25 25",children:u$2("path",{d:"M10.45 2.05h1.05a.5.5 0 0 1 .5.5v.024a.5.5 0 0 1-.5.5h-1.05a.5.5 0 0 1-.5-.5V2.55a.5.5 0 0 1 .5-.5zm2.05 1.024h1.05a.5.5 0 0 1 .5.5V3.6a.5.5 0 0 1-.5.5H12.5a.5.5 0 0 1-.5-.5v-.025a.5.5 0 0 1 .5-.5v-.001zM10.45 0h1.05a.5.5 0 0 1 .5.5v.025a.5.5 0 0 1-.5.5h-1.05a.5.5 0 0 1-.5-.5V.5a.5.5 0 0 1 .5-.5zm2.05 1.025h1.05a.5.5 0 0 1 .5.5v.024a.5.5 0 0 1-.5.5H12.5a.5.5 0 0 1-.5-.5v-.024a.5.5 0 0 1 .5-.5zm-2.05 3.074h1.05a.5.5 0 0 1 .5.5v.025a.5.5 0 0 1-.5.5h-1.05a.5.5 0 0 1-.5-.5v-.025a.5.5 0 0 1 .5-.5zm2.05 1.025h1.05a.5.5 0 0 1 .5.5v.024a.5.5 0 0 1-.5.5H12.5a.5.5 0 0 1-.5-.5v-.024a.5.5 0 0 1 .5-.5zm-2.05 1.024h1.05a.5.5 0 0 1 .5.5v.025a.5.5 0 0 1-.5.5h-1.05a.5.5 0 0 1-.5-.5v-.025a.5.5 0 0 1 .5-.5zm2.05 1.025h1.05a.5.5 0 0 1 .5.5v.025a.5.5 0 0 1-.5.5H12.5a.5.5 0 0 1-.5-.5v-.025a.5.5 0 0 1 .5-.5zm-2.05 1.025h1.05a.5.5 0 0 1 .5.5v.025a.5.5 0 0 1-.5.5h-1.05a.5.5 0 0 1-.5-.5v-.025a.5.5 0 0 1 .5-.5zm2.05 1.025h1.05a.5.5 0 0 1 .5.5v.024a.5.5 0 0 1-.5.5H12.5a.5.5 0 0 1-.5-.5v-.024a.5.5 0 0 1 .5-.5zm-1.656 3.074l-.82 5.946c.52.302 1.174.458 1.976.458.803 0 1.455-.156 1.975-.458l-.82-5.946h-2.311zm0-1.025h2.312c.512 0 .946.378 1.015.885l.82 5.946c.056.412-.142.817-.501 1.026-.686.398-1.515.597-2.49.597-.974 0-1.804-.199-2.49-.597a1.025 1.025 0 0 1-.5-1.026l.819-5.946c.07-.507.503-.885 1.015-.885zm.545 6.6a.5.5 0 0 1-.397-.561l.143-.999a.5.5 0 0 1 .495-.429h.74a.5.5 0 0 1 .495.43l.143.998a.5.5 0 0 1-.397.561c-.404.08-.819.08-1.222 0z",fill:"#00C469",fillRule:"nonzero"})})}:defaultChoice}function ignoreEvent(ev){const{tagName:tagName}=ev.target;"INPUT"!==tagName&&"TEXTAREA"!==tagName?(ev.preventDefault(),ev.stopPropagation()):ev.stopPropagation()}function FilePreview(props){const{file:file}=props;if(file.preview)return u$2("img",{draggable:!1,className:"uppy-Dashboard-Item-previewImg",alt:file.name,src:file.preview});const{color:color,icon:icon}=getIconByMime(file.type);return u$2("div",{className:"uppy-Dashboard-Item-previewIconWrap",children:[u$2("span",{className:"uppy-Dashboard-Item-previewIcon",style:{color:color},children:icon}),u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-Dashboard-Item-previewIconBg",width:"58",height:"76",viewBox:"0 0 58 76",children:u$2("rect",{fill:"#FFF",width:"58",height:"76",rx:"3",fillRule:"evenodd"})})]})}function RenderMetaFields(props){const{computedMetaFields:computedMetaFields,requiredMetaFields:requiredMetaFields,updateMeta:updateMeta,form:form,formState:formState}=props,fieldCSSClasses={text:"uppy-u-reset uppy-c-textInput uppy-Dashboard-FileCard-input"};return computedMetaFields.map(field=>{const id=`uppy-Dashboard-FileCard-input-${field.id}`,required=requiredMetaFields.includes(field.id);return u$2("fieldset",{className:"uppy-Dashboard-FileCard-fieldset",children:[u$2("label",{className:"uppy-Dashboard-FileCard-label",htmlFor:id,children:field.name}),void 0!==field.render?field.render({value:formState[field.id],onChange:newVal=>updateMeta(newVal,field.id),fieldCSSClasses:fieldCSSClasses,required:required,form:form.id},_$1):u$2("input",{className:fieldCSSClasses.text,id:id,form:form.id,type:field.type||"text",required:required,value:formState[field.id],placeholder:field.placeholder,onInput:ev=>updateMeta(ev.target.value,field.id),"data-uppy-super-focusable":!0})]},field.id)})}function FileCard(props){const{files:files,fileCardFor:fileCardFor,toggleFileCard:toggleFileCard,saveFileCard:saveFileCard,metaFields:metaFields,requiredMetaFields:requiredMetaFields,openFileEditor:openFileEditor,i18n:i18n,i18nArray:i18nArray,className:className,canEditFile:canEditFile}=props,file=files[fileCardFor],computedMetaFields=("function"==typeof metaFields?metaFields(files[fileCardFor]):metaFields)??[],showEditButton=canEditFile(file),storedMetaData={};computedMetaFields.forEach(field=>{storedMetaData[field.id]=file.meta[field.id]??""});const[formState,setFormState]=d$1(storedMetaData),handleSave=q$1(ev=>{ev.preventDefault(),saveFileCard(formState,fileCardFor)},[saveFileCard,formState,fileCardFor]),handleCancel=()=>{toggleFileCard(!1)},[form]=d$1(()=>{const formEl=document.createElement("form");return formEl.setAttribute("tabindex","-1"),formEl.id=nanoid(),formEl});return y$1(()=>(document.body.appendChild(form),form.addEventListener("submit",handleSave),()=>{form.removeEventListener("submit",handleSave),form.parentNode&&document.body.removeChild(form)}),[form,handleSave]),u$2("div",{className:classNames("uppy-Dashboard-FileCard",className),"data-uppy-panelType":"FileCard",onDragOver:ignoreEvent,onDragLeave:ignoreEvent,onDrop:ignoreEvent,onPaste:ignoreEvent,children:[u$2("div",{className:"uppy-DashboardContent-bar",children:[u$2("div",{className:"uppy-DashboardContent-title",role:"heading","aria-level":1,children:i18nArray("editing",{file:u$2("span",{className:"uppy-DashboardContent-titleFile",children:file.meta?file.meta.name:file.name})})}),u$2("button",{className:"uppy-DashboardContent-back",type:"button",form:form.id,title:i18n("finishEditingFile"),onClick:handleCancel,children:i18n("cancel")})]}),u$2("div",{className:"uppy-Dashboard-FileCard-inner",children:[u$2("div",{className:"uppy-Dashboard-FileCard-preview",style:{backgroundColor:getIconByMime(file.type).color},children:[u$2(FilePreview,{file:file}),showEditButton&&u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-Dashboard-FileCard-edit",onClick:event=>{handleSave(event),openFileEditor(file)},children:i18n("editImage")})]}),u$2("div",{className:"uppy-Dashboard-FileCard-info",children:u$2(RenderMetaFields,{computedMetaFields:computedMetaFields,requiredMetaFields:requiredMetaFields,updateMeta:(newVal,name)=>{setFormState({...formState,[name]:newVal})},form:form,formState:formState})}),u$2("div",{className:"uppy-Dashboard-FileCard-actions",children:[u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Dashboard-FileCard-actionsBtn",type:"submit",form:form.id,children:i18n("saveChanges")}),u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-c-btn-link uppy-Dashboard-FileCard-actionsBtn",type:"button",onClick:handleCancel,form:form.id,children:i18n("cancel")})]})]})]})}function EditButton({file:file,uploadInProgressOrComplete:uploadInProgressOrComplete,metaFields:metaFields,canEditFile:canEditFile,i18n:i18n,onClick:onClick}){return!uploadInProgressOrComplete&&metaFields&&metaFields.length>0||!uploadInProgressOrComplete&&canEditFile(file)?u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Dashboard-Item-action uppy-Dashboard-Item-action--edit",type:"button","aria-label":i18n("editFileWithFilename",{file:file.meta.name}),title:i18n("editFileWithFilename",{file:file.meta.name}),onClick:()=>onClick(),children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"14",height:"14",viewBox:"0 0 14 14",children:u$2("g",{fillRule:"evenodd",children:[u$2("path",{d:"M1.5 10.793h2.793A1 1 0 0 0 5 10.5L11.5 4a1 1 0 0 0 0-1.414L9.707.793a1 1 0 0 0-1.414 0l-6.5 6.5A1 1 0 0 0 1.5 8v2.793zm1-1V8L9 1.5l1.793 1.793-6.5 6.5H2.5z",fillRule:"nonzero"}),u$2("rect",{x:"1",y:"12.293",width:"11",height:"1",rx:".5"}),u$2("path",{fillRule:"nonzero",d:"M6.793 2.5L9.5 5.207l.707-.707L7.5 1.793z"})]})})}):null}function RemoveButton({i18n:i18n,onClick:onClick,file:file}){return u$2("button",{className:"uppy-u-reset uppy-Dashboard-Item-action uppy-Dashboard-Item-action--remove",type:"button","aria-label":i18n("removeFile",{file:file.meta.name}),title:i18n("removeFile",{file:file.meta.name}),onClick:()=>onClick(),children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"18",height:"18",viewBox:"0 0 18 18",children:[u$2("path",{d:"M9 0C4.034 0 0 4.034 0 9s4.034 9 9 9 9-4.034 9-9-4.034-9-9-9z"}),u$2("path",{fill:"#FFF",d:"M13 12.222l-.778.778L9 9.778 5.778 13 5 12.222 8.222 9 5 5.778 5.778 5 9 8.222 12.222 5l.778.778L9.778 9z"})]})})}function CopyLinkButton({file:file,uppy:uppy,i18n:i18n}){const copyLinkToClipboard=event=>{(function(textToCopy,fallbackString="Copy the URL below"){return new Promise(resolve=>{const textArea=document.createElement("textarea");textArea.setAttribute("style",{position:"fixed",top:0,left:0,width:"2em",height:"2em",padding:0,border:"none",outline:"none",boxShadow:"none",background:"transparent"}),textArea.value=textToCopy,document.body.appendChild(textArea),textArea.select();const magicCopyFailed=()=>{document.body.removeChild(textArea),window.prompt(fallbackString,textToCopy),resolve()};try{return document.execCommand("copy")?(document.body.removeChild(textArea),resolve()):magicCopyFailed()}catch(_err){return document.body.removeChild(textArea),magicCopyFailed()}})})(file.uploadURL,i18n("copyLinkToClipboardFallback")).then(()=>{uppy.log("Link copied to clipboard."),uppy.info(i18n("copyLinkToClipboardSuccess"),"info",3e3)}).catch(uppy.log).then(()=>event.target.focus({preventScroll:!0}))};return u$2("button",{className:"uppy-u-reset uppy-Dashboard-Item-action uppy-Dashboard-Item-action--copyLink",type:"button","aria-label":i18n("copyLink"),title:i18n("copyLink"),onClick:event=>copyLinkToClipboard(event),children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"14",height:"14",viewBox:"0 0 14 12",children:u$2("path",{d:"M7.94 7.703a2.613 2.613 0 0 1-.626 2.681l-.852.851a2.597 2.597 0 0 1-1.849.766A2.616 2.616 0 0 1 2.764 7.54l.852-.852a2.596 2.596 0 0 1 2.69-.625L5.267 7.099a1.44 1.44 0 0 0-.833.407l-.852.851a1.458 1.458 0 0 0 1.03 2.486c.39 0 .755-.152 1.03-.426l.852-.852c.231-.231.363-.522.406-.824l1.04-1.038zm4.295-5.937A2.596 2.596 0 0 0 10.387 1c-.698 0-1.355.272-1.849.766l-.852.851a2.614 2.614 0 0 0-.624 2.688l1.036-1.036c.041-.304.173-.6.407-.833l.852-.852c.275-.275.64-.426 1.03-.426a1.458 1.458 0 0 1 1.03 2.486l-.852.851a1.442 1.442 0 0 1-.824.406l-1.04 1.04a2.596 2.596 0 0 0 2.683-.628l.851-.85a2.616 2.616 0 0 0 0-3.697zm-6.88 6.883a.577.577 0 0 0 .82 0l3.474-3.474a.579.579 0 1 0-.819-.82L5.355 7.83a.579.579 0 0 0 0 .819z"})})})}function Buttons(props){const{uppy:uppy,file:file,uploadInProgressOrComplete:uploadInProgressOrComplete,canEditFile:canEditFile,metaFields:metaFields,showLinkToFileUploadResult:showLinkToFileUploadResult,showRemoveButton:showRemoveButton,i18n:i18n,toggleFileCard:toggleFileCard,openFileEditor:openFileEditor}=props;return u$2("div",{className:"uppy-Dashboard-Item-actionWrapper",children:[u$2(EditButton,{i18n:i18n,file:file,uploadInProgressOrComplete:uploadInProgressOrComplete,canEditFile:canEditFile,metaFields:metaFields,onClick:()=>{metaFields&&metaFields.length>0?toggleFileCard(!0,file.id):openFileEditor(file)}}),showLinkToFileUploadResult&&file.uploadURL?u$2(CopyLinkButton,{file:file,uppy:uppy,i18n:i18n}):null,showRemoveButton?u$2(RemoveButton,{i18n:i18n,file:file,onClick:()=>uppy.removeFile(file.id)}):null]})}function MetaErrorMessage(props){const{file:file,toggleFileCard:toggleFileCard,i18n:i18n,metaFields:metaFields}=props,{missingRequiredMetaFields:missingRequiredMetaFields}=file;if(!missingRequiredMetaFields?.length)return null;const metaFieldsString=missingRequiredMetaFields.map(missingMetaField=>((metaFieldId,metaFields)=>{const field=("function"==typeof metaFields?metaFields():metaFields).filter(f=>f.id===metaFieldId);return field[0].name})(missingMetaField,metaFields)).join(", ");return u$2("div",{className:"uppy-Dashboard-Item-errorMessage",children:[i18n("missingRequiredMetaFields",{smart_count:missingRequiredMetaFields.length,fields:metaFieldsString})," ",u$2("button",{type:"button",class:"uppy-u-reset uppy-Dashboard-Item-errorMessageBtn",onClick:()=>toggleFileCard(!0,file.id),children:i18n("editFile")})]})}const renderFileName=props=>{const{author:author,name:name}=props.file.meta;return u$2("div",{className:"uppy-Dashboard-Item-name",title:name,children:truncateString(name,props.isSingleFile&&props.containerHeight>=350?90:props.containerWidth<=352?35:props.containerWidth<=576?60:author?20:30)})},renderAuthor=props=>{const{author:author}=props.file.meta,providerName=props.file.remote?.providerName;return author?u$2("div",{className:"uppy-Dashboard-Item-author",children:[u$2("a",{href:`${author.url}?utm_source=Companion&utm_medium=referral`,target:"_blank",rel:"noopener noreferrer",children:truncateString(author.name,13)}),providerName?u$2(k$2,{children:["  ",providerName,"  "]}):null]}):null},renderFileSize=props=>props.file.size&&u$2("div",{className:"uppy-Dashboard-Item-statusSize",children:prettierBytes$1(props.file.size)}),ReSelectButton=props=>props.file.isGhost&&u$2("span",{children:["  ",u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Dashboard-Item-reSelect",type:"button",onClick:()=>props.toggleAddFilesPanel(!0),children:props.i18n("reSelect")})]}),ErrorButton=({file:file,onClick:onClick})=>file.error?u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Dashboard-Item-errorDetails","aria-label":file.error,"data-microtip-position":"bottom","data-microtip-size":"medium",onClick:onClick,type:"button",children:"?"}):null;function FileInfo(props){const{file:file,i18n:i18n,toggleFileCard:toggleFileCard,metaFields:metaFields,toggleAddFilesPanel:toggleAddFilesPanel,isSingleFile:isSingleFile,containerHeight:containerHeight,containerWidth:containerWidth}=props;return u$2("div",{className:"uppy-Dashboard-Item-fileInfo","data-uppy-file-source":file.source,children:[u$2("div",{className:"uppy-Dashboard-Item-fileName",children:[renderFileName({file:file,isSingleFile:isSingleFile,containerHeight:containerHeight,containerWidth:containerWidth}),u$2(ErrorButton,{file:file,onClick:()=>alert(file.error)})]}),u$2("div",{className:"uppy-Dashboard-Item-status",children:[renderAuthor({file:file}),renderFileSize({file:file}),ReSelectButton({file:file,toggleAddFilesPanel:toggleAddFilesPanel,i18n:i18n})]}),u$2(MetaErrorMessage,{file:file,i18n:i18n,toggleFileCard:toggleFileCard,metaFields:metaFields})]})}function FilePreviewAndLink(props){const{file:file,i18n:i18n,toggleFileCard:toggleFileCard,metaFields:metaFields,showLinkToFileUploadResult:showLinkToFileUploadResult}=props;return u$2("div",{className:"uppy-Dashboard-Item-previewInnerWrap",style:{backgroundColor:file.preview?"rgba(255, 255, 255, 0.5)":getIconByMime(file.type).color},children:[showLinkToFileUploadResult&&file.uploadURL&&u$2("a",{className:"uppy-Dashboard-Item-previewLink",href:file.uploadURL,rel:"noreferrer noopener",target:"_blank","aria-label":file.meta.name,children:u$2("span",{hidden:!0,children:file.meta.name})}),u$2(FilePreview,{file:file}),u$2(MetaErrorMessage,{file:file,i18n:i18n,toggleFileCard:toggleFileCard,metaFields:metaFields})]})}function progressIndicatorTitle(props){return props.isUploaded?props.i18n("uploadComplete"):props.error?props.i18n("retryUpload"):props.resumableUploads?props.file.isPaused?props.i18n("resumeUpload"):props.i18n("pauseUpload"):props.individualCancellation?props.i18n("cancelUpload"):""}function ProgressIndicatorButton(props){return u$2("div",{className:"uppy-Dashboard-Item-progress",children:u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Dashboard-Item-progressIndicator",type:"button","aria-label":progressIndicatorTitle(props),title:progressIndicatorTitle(props),onClick:()=>function(props){props.isUploaded||(!props.error||props.hideRetryButton?props.resumableUploads&&!props.hidePauseResumeButton?props.uppy.pauseResume(props.file.id):props.individualCancellation&&!props.hideCancelButton&&props.uppy.removeFile(props.file.id):props.uppy.retryUpload(props.file.id))}(props),children:props.children})})}function ProgressCircleContainer({children:children}){return u$2("svg",{"aria-hidden":"true",focusable:"false",width:"70",height:"70",viewBox:"0 0 36 36",className:"uppy-c-icon uppy-Dashboard-Item-progressIcon--circle",children:children})}function ProgressCircle({progress:progress}){const circleLength=2*Math.PI*15;return u$2("g",{children:[u$2("circle",{className:"uppy-Dashboard-Item-progressIcon--bg",r:"15",cx:"18",cy:"18","stroke-width":"2",fill:"none"}),u$2("circle",{className:"uppy-Dashboard-Item-progressIcon--progress",r:"15",cx:"18",cy:"18",transform:"rotate(-90, 18, 18)",fill:"none","stroke-width":"2","stroke-dasharray":circleLength,"stroke-dashoffset":circleLength-circleLength/100*progress})]})}function FileProgress(props){return props.file.progress.uploadStarted?void 0===props.file.progress.percentage?null:props.isUploaded?u$2("div",{className:"uppy-Dashboard-Item-progress",children:u$2("div",{className:"uppy-Dashboard-Item-progressIndicator",children:u$2(ProgressCircleContainer,{children:[u$2("circle",{r:"15",cx:"18",cy:"18",fill:"#1bb240"}),u$2("polygon",{className:"uppy-Dashboard-Item-progressIcon--check",transform:"translate(2, 3)",points:"14 22.5 7 15.2457065 8.99985857 13.1732815 14 18.3547104 22.9729883 9 25 11.1005634"})]})})}):props.recoveredState?null:props.error&&!props.hideRetryButton?u$2(ProgressIndicatorButton,{...props,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon uppy-Dashboard-Item-progressIcon--retry",width:"28",height:"31",viewBox:"0 0 16 19",children:[u$2("path",{d:"M16 11a8 8 0 1 1-8-8v2a6 6 0 1 0 6 6h2z"}),u$2("path",{d:"M7.9 3H10v2H7.9z"}),u$2("path",{d:"M8.536.5l3.535 3.536-1.414 1.414L7.12 1.914z"}),u$2("path",{d:"M10.657 2.621l1.414 1.415L8.536 7.57 7.12 6.157z"})]})}):props.resumableUploads&&!props.hidePauseResumeButton?u$2(ProgressIndicatorButton,{...props,children:u$2(ProgressCircleContainer,{children:[u$2(ProgressCircle,{progress:props.file.progress.percentage}),props.file.isPaused?u$2("polygon",{className:"uppy-Dashboard-Item-progressIcon--play",transform:"translate(3, 3)",points:"12 20 12 10 20 15"}):u$2("g",{className:"uppy-Dashboard-Item-progressIcon--pause",transform:"translate(14.5, 13)",children:[u$2("rect",{x:"0",y:"0",width:"2",height:"10",rx:"0"}),u$2("rect",{x:"5",y:"0",width:"2",height:"10",rx:"0"})]})]})}):props.resumableUploads||!props.individualCancellation||props.hideCancelButton?u$2("div",{className:"uppy-Dashboard-Item-progress",children:u$2("div",{className:"uppy-Dashboard-Item-progressIndicator",children:u$2(ProgressCircleContainer,{children:u$2(ProgressCircle,{progress:props.file.progress.percentage})})})}):u$2(ProgressIndicatorButton,{...props,children:u$2(ProgressCircleContainer,{children:[u$2(ProgressCircle,{progress:props.file.progress.percentage}),u$2("polygon",{className:"cancel",transform:"translate(2, 2)",points:"19.8856516 11.0625 16 14.9481516 12.1019737 11.0625 11.0625 12.1143484 14.9481516 16 11.0625 19.8980263 12.1019737 20.9375 16 17.0518484 19.8856516 20.9375 20.9375 19.8980263 17.0518484 16 20.9375 12"})]})}):null}class FileItem extends x{componentDidMount(){const{file:file}=this.props;file.preview||this.props.handleRequestThumbnail(file)}shouldComponentUpdate(nextProps){return!function(objA,objB){if(objA===objB)return!0;if(!objA||!objB)return!1;const aKeys=Object.keys(objA),bKeys=Object.keys(objB),len=aKeys.length;if(bKeys.length!==len)return!1;for(let i=0;i<len;i++){const key=aKeys[i];if(objA[key]!==objB[key]||!Object.prototype.hasOwnProperty.call(objB,key))return!1}return!0}(this.props,nextProps)}componentDidUpdate(){const{file:file}=this.props;file.preview||this.props.handleRequestThumbnail(file)}componentWillUnmount(){const{file:file}=this.props;file.preview||this.props.handleCancelThumbnail(file)}render(){const{file:file}=this.props,isProcessing=file.progress.preprocess||file.progress.postprocess,isUploaded=!!file.progress.uploadComplete&&!isProcessing&&!file.error,uploadInProgressOrComplete=!!file.progress.uploadStarted||!!isProcessing,uploadInProgress=file.progress.uploadStarted&&!file.progress.uploadComplete||isProcessing,error=file.error||!1,{isGhost:isGhost}=file;let showRemoveButton=(this.props.individualCancellation||!uploadInProgress)&&!isUploaded;isUploaded&&this.props.showRemoveButtonAfterComplete&&(showRemoveButton=!0);return u$2("div",{className:classNames({"uppy-Dashboard-Item":!0,"is-inprogress":uploadInProgress&&!this.props.recoveredState,"is-processing":isProcessing,"is-complete":isUploaded,"is-error":!!error,"is-resumable":this.props.resumableUploads,"is-noIndividualCancellation":!this.props.individualCancellation,"is-ghost":isGhost}),id:`uppy_${file.id}`,role:this.props.role,children:[u$2("div",{className:"uppy-Dashboard-Item-preview",children:[u$2(FilePreviewAndLink,{file:file,showLinkToFileUploadResult:this.props.showLinkToFileUploadResult,i18n:this.props.i18n,toggleFileCard:this.props.toggleFileCard,metaFields:this.props.metaFields}),u$2(FileProgress,{uppy:this.props.uppy,file:file,error:error,isUploaded:isUploaded,hideRetryButton:this.props.hideRetryButton,hideCancelButton:this.props.hideCancelButton,hidePauseResumeButton:this.props.hidePauseResumeButton,recoveredState:this.props.recoveredState,resumableUploads:this.props.resumableUploads,individualCancellation:this.props.individualCancellation,i18n:this.props.i18n})]}),u$2("div",{className:"uppy-Dashboard-Item-fileInfoAndButtons",children:[u$2(FileInfo,{file:file,containerWidth:this.props.containerWidth,containerHeight:this.props.containerHeight,i18n:this.props.i18n,toggleAddFilesPanel:this.props.toggleAddFilesPanel,toggleFileCard:this.props.toggleFileCard,metaFields:this.props.metaFields,isSingleFile:this.props.isSingleFile}),u$2(Buttons,{file:file,metaFields:this.props.metaFields,showLinkToFileUploadResult:this.props.showLinkToFileUploadResult,showRemoveButton:showRemoveButton,canEditFile:this.props.canEditFile,uploadInProgressOrComplete:uploadInProgressOrComplete,toggleFileCard:this.props.toggleFileCard,openFileEditor:this.props.openFileEditor,uppy:this.props.uppy,i18n:this.props.i18n})]})]})}}function FileList({id:id,i18n:i18n,uppy:uppy,files:files,resumableUploads:resumableUploads,hideRetryButton:hideRetryButton,hidePauseResumeButton:hidePauseResumeButton,hideCancelButton:hideCancelButton,showLinkToFileUploadResult:showLinkToFileUploadResult,showRemoveButtonAfterComplete:showRemoveButtonAfterComplete,metaFields:metaFields,isSingleFile:isSingleFile,toggleFileCard:toggleFileCard,handleRequestThumbnail:handleRequestThumbnail,handleCancelThumbnail:handleCancelThumbnail,recoveredState:recoveredState,individualCancellation:individualCancellation,itemsPerRow:itemsPerRow,openFileEditor:openFileEditor,canEditFile:canEditFile,toggleAddFilesPanel:toggleAddFilesPanel,containerWidth:containerWidth,containerHeight:containerHeight}){const rowHeight=1===itemsPerRow?71:200,rows=T$1(()=>{const fileIds=Object.keys(files);return recoveredState&&fileIds.sort((file1,file2)=>Number(files[file2].isGhost)-Number(files[file1].isGhost)),function(list,size){const chunked=[];let currentChunk=[];return list.forEach(item=>{currentChunk.length<size?currentChunk.push(item):(chunked.push(currentChunk),currentChunk=[item])}),currentChunk.length&&chunked.push(currentChunk),chunked}(fileIds,itemsPerRow)},[files,itemsPerRow,recoveredState]),renderRow=row=>u$2("div",{class:"uppy-Dashboard-filesInner",role:"presentation",children:row.map(fileID=>u$2(FileItem,{uppy:uppy,id:id,i18n:i18n,resumableUploads:resumableUploads,individualCancellation:individualCancellation,hideRetryButton:hideRetryButton,hidePauseResumeButton:hidePauseResumeButton,hideCancelButton:hideCancelButton,showLinkToFileUploadResult:showLinkToFileUploadResult,showRemoveButtonAfterComplete:showRemoveButtonAfterComplete,metaFields:metaFields,recoveredState:recoveredState,isSingleFile:isSingleFile,containerWidth:containerWidth,containerHeight:containerHeight,toggleFileCard:toggleFileCard,handleRequestThumbnail:handleRequestThumbnail,handleCancelThumbnail:handleCancelThumbnail,role:"listitem",openFileEditor:openFileEditor,canEditFile:canEditFile,toggleAddFilesPanel:toggleAddFilesPanel,file:files[fileID]},fileID))},row[0]);return isSingleFile?u$2("div",{class:"uppy-Dashboard-files",children:renderRow(rows[0])}):u$2(VirtualList,{class:"uppy-Dashboard-files",role:"list",data:rows,renderRow:renderRow,rowHeight:rowHeight})}class FadeIn extends x{ref={current:null};componentWillEnter(callback){this.ref.current.style.opacity="1",this.ref.current.style.transform="none",setTimeout(callback,300)}componentWillLeave(callback){this.ref.current.style.opacity="0",this.ref.current.style.transform="translateY(350%)",setTimeout(callback,300)}render(){const{children:children}=this.props;return u$2("div",{className:"uppy-Informer-animated",ref:this.ref,children:children})}}function getKey(vnode,fallback){return vnode?.key??fallback}function getChildMapping(children){const out={};for(let i=0;i<children.length;i++)if(null!=children[i]){out[getKey(children[i],i.toString(36))]=children[i]}return out}function mergeChildMappings(prev,next){prev=prev||{},next=next||{};const getValueForKey=key=>Object.hasOwn(next,key)?next[key]:prev[key],nextKeysPending={};let pendingKeys=[];for(const prevKey in prev)Object.hasOwn(next,prevKey)?pendingKeys.length&&(nextKeysPending[prevKey]=pendingKeys,pendingKeys=[]):pendingKeys.push(prevKey);const childMapping={};for(const nextKey in next){if(Object.hasOwn(nextKeysPending,nextKey))for(let i=0;i<nextKeysPending[nextKey].length;i++){const pendingNextKey=nextKeysPending[nextKey][i];childMapping[nextKeysPending[nextKey][i]]=getValueForKey(pendingNextKey)}childMapping[nextKey]=getValueForKey(nextKey)}for(let i=0;i<pendingKeys.length;i++)childMapping[pendingKeys[i]]=getValueForKey(pendingKeys[i]);return childMapping}class TransitionGroup extends x{constructor(props,context){super(props,context),this.refs={},this.state={children:getChildMapping(H$1(H$1(this.props.children))||[])},this.performAppear=this.performAppear.bind(this),this.performEnter=this.performEnter.bind(this),this.performLeave=this.performLeave.bind(this)}componentWillMount(){this.currentlyTransitioningKeys={},this.keysToAbortLeave=[],this.keysToEnter=[],this.keysToLeave=[]}componentDidMount(){const initialChildMapping=this.state.children;for(const key in initialChildMapping)initialChildMapping[key]&&this.performAppear(key)}componentWillReceiveProps(nextProps){const nextChildMapping=getChildMapping(H$1(nextProps.children)||[]),prevChildMapping=this.state.children;let key;for(key in this.setState(prevState=>({children:mergeChildMappings(prevState.children,nextChildMapping)})),nextChildMapping)if(Object.hasOwn(nextChildMapping,key)){const hasPrev=prevChildMapping&&Object.hasOwn(prevChildMapping,key);nextChildMapping[key]&&hasPrev&&this.currentlyTransitioningKeys[key]?(this.keysToEnter.push(key),this.keysToAbortLeave.push(key)):!nextChildMapping[key]||hasPrev||this.currentlyTransitioningKeys[key]||this.keysToEnter.push(key)}for(key in prevChildMapping)if(Object.hasOwn(prevChildMapping,key)){const hasNext=nextChildMapping&&Object.hasOwn(nextChildMapping,key);!prevChildMapping[key]||hasNext||this.currentlyTransitioningKeys[key]||this.keysToLeave.push(key)}}componentDidUpdate(){const{keysToEnter:keysToEnter}=this;this.keysToEnter=[],keysToEnter.forEach(this.performEnter);const{keysToLeave:keysToLeave}=this;this.keysToLeave=[],keysToLeave.forEach(this.performLeave)}_finishAbort(key){const idx=this.keysToAbortLeave.indexOf(key);-1!==idx&&this.keysToAbortLeave.splice(idx,1)}performAppear(key){this.currentlyTransitioningKeys[key]=!0;const component=this.refs[key];component?.componentWillAppear?component.componentWillAppear(this._handleDoneAppearing.bind(this,key)):this._handleDoneAppearing(key)}_handleDoneAppearing(key){const component=this.refs[key];component?.componentDidAppear&&component.componentDidAppear(),delete this.currentlyTransitioningKeys[key],this._finishAbort(key);const currentChildMapping=getChildMapping(H$1(this.props.children)||[]);currentChildMapping&&Object.hasOwn(currentChildMapping,key)||this.performLeave(key)}performEnter(key){this.currentlyTransitioningKeys[key]=!0;const component=this.refs[key];component?.componentWillEnter?component.componentWillEnter(this._handleDoneEntering.bind(this,key)):this._handleDoneEntering(key)}_handleDoneEntering(key){const component=this.refs[key];component?.componentDidEnter&&component.componentDidEnter(),delete this.currentlyTransitioningKeys[key],this._finishAbort(key);const currentChildMapping=getChildMapping(H$1(this.props.children)||[]);currentChildMapping&&Object.hasOwn(currentChildMapping,key)||this.performLeave(key)}performLeave(key){if(-1!==this.keysToAbortLeave.indexOf(key))return;this.currentlyTransitioningKeys[key]=!0;const component=this.refs[key];component?.componentWillLeave?component.componentWillLeave(this._handleDoneLeaving.bind(this,key)):this._handleDoneLeaving(key)}_handleDoneLeaving(key){if(-1!==this.keysToAbortLeave.indexOf(key))return;const component=this.refs[key];component?.componentDidLeave&&component.componentDidLeave(),delete this.currentlyTransitioningKeys[key];const currentChildMapping=getChildMapping(H$1(this.props.children)||[]);if(currentChildMapping&&Object.hasOwn(currentChildMapping,key))this.performEnter(key);else{const children=(obj={},props=this.state.children,Object.assign(obj,props));delete children[key],this.setState({children:children})}var obj,props}render({childFactory:childFactory,transitionLeave:transitionLeave,transitionName:transitionName,transitionAppear:transitionAppear,transitionEnter:transitionEnter,transitionLeaveTimeout:transitionLeaveTimeout,transitionEnterTimeout:transitionEnterTimeout,transitionAppearTimeout:transitionAppearTimeout,component:component,...props},{children:children}){const childrenToRender=Object.entries(children).map(([key,child])=>{if(!child)return;const ref=function(component,name){const cache=component._ptgLinkedRefs||(component._ptgLinkedRefs={});return cache[name]||(cache[name]=c=>{component.refs[name]=c})}(this,key);return K$1(childFactory(child),{ref:ref,key:key})}).filter(Boolean);return _$1(component,props,childrenToRender)}}TransitionGroup.defaultProps={component:"span",childFactory:i=>i};class Informer extends x{render(){const{info:info}=this.props.uppy.getState();return u$2("div",{className:"uppy uppy-Informer",children:u$2(TransitionGroup,{children:info.map(info=>u$2(FadeIn,{children:u$2("p",{role:"alert",children:[info.message," ",info.details&&u$2("span",{"aria-label":info.details,"data-microtip-position":"top-left","data-microtip-size":"medium",role:"tooltip",onClick:()=>alert(`${info.message} \n\n ${info.details}`),children:"?"})]})},info.message))})})}}function PickerPanelContent({activePickerPanel:activePickerPanel,className:className,hideAllPanels:hideAllPanels,i18n:i18n,state:state,uppy:uppy}){const ref=A$1(null);return u$2("div",{className:classNames("uppy-DashboardContent-panel",className),role:"tabpanel","data-uppy-panelType":"PickerPanel",id:`uppy-DashboardContent-panel--${activePickerPanel.id}`,onDragOver:ignoreEvent,onDragLeave:ignoreEvent,onDrop:ignoreEvent,onPaste:ignoreEvent,children:[u$2("div",{className:"uppy-DashboardContent-bar",children:[u$2("div",{className:"uppy-DashboardContent-title",role:"heading","aria-level":1,children:i18n("importFrom",{name:activePickerPanel.name})}),u$2("button",{className:"uppy-DashboardContent-back",type:"button",onClick:hideAllPanels,children:i18n("cancel")})]}),u$2("div",{ref:ref,className:"uppy-DashboardContent-panelBody",children:uppy.getPlugin(activePickerPanel.id).render(state,ref.current)})]})}const uploadStates_STATE_ERROR="error",uploadStates_STATE_WAITING="waiting",uploadStates_STATE_PREPROCESSING="preprocessing",uploadStates_STATE_UPLOADING="uploading",uploadStates_STATE_POSTPROCESSING="postprocessing",uploadStates_STATE_COMPLETE="complete",uploadStates_STATE_PAUSED="paused";function UploadStatus({files:files,i18n:i18n,isAllComplete:isAllComplete,isAllErrored:isAllErrored,isAllPaused:isAllPaused,inProgressNotPausedFiles:inProgressNotPausedFiles,newFiles:newFiles,processingFiles:processingFiles}){const uploadingState=function(isAllErrored,isAllComplete,isAllPaused,files={}){if(isAllErrored)return uploadStates_STATE_ERROR;if(isAllComplete)return uploadStates_STATE_COMPLETE;if(isAllPaused)return uploadStates_STATE_PAUSED;let state=uploadStates_STATE_WAITING;const fileIDs=Object.keys(files);for(let i=0;i<fileIDs.length;i++){const{progress:progress}=files[fileIDs[i]];if(progress.uploadStarted&&!progress.uploadComplete)return uploadStates_STATE_UPLOADING;progress.preprocess&&state!==uploadStates_STATE_UPLOADING&&(state=uploadStates_STATE_PREPROCESSING),progress.postprocess&&state!==uploadStates_STATE_UPLOADING&&state!==uploadStates_STATE_PREPROCESSING&&(state=uploadStates_STATE_POSTPROCESSING)}return state}(isAllErrored,isAllComplete,isAllPaused,files);switch(uploadingState){case"uploading":return i18n("uploadingXFiles",{smart_count:inProgressNotPausedFiles.length});case"preprocessing":case"postprocessing":return i18n("processingXFiles",{smart_count:processingFiles.length});case"paused":return i18n("uploadPaused");case"waiting":return i18n("xFilesSelected",{smart_count:newFiles.length});case"complete":return i18n("uploadComplete");case"error":return i18n("error")}}function PanelTopBar(props){const{i18n:i18n,isAllComplete:isAllComplete,hideCancelButton:hideCancelButton,maxNumberOfFiles:maxNumberOfFiles,toggleAddFilesPanel:toggleAddFilesPanel,uppy:uppy}=props;let{allowNewUpload:allowNewUpload}=props;return allowNewUpload&&maxNumberOfFiles&&(allowNewUpload=props.totalFileCount<props.maxNumberOfFiles),u$2("div",{className:"uppy-DashboardContent-bar",children:[isAllComplete||hideCancelButton?u$2("div",{}):u$2("button",{className:"uppy-DashboardContent-back",type:"button",onClick:()=>uppy.cancelAll(),children:i18n("cancel")}),u$2("div",{className:"uppy-DashboardContent-title",children:u$2(UploadStatus,{...props})}),allowNewUpload?u$2("button",{className:"uppy-DashboardContent-addMore",type:"button","aria-label":i18n("addMoreFiles"),title:i18n("addMoreFiles"),onClick:()=>toggleAddFilesPanel(!0),children:[u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"15",height:"15",viewBox:"0 0 15 15",children:u$2("path",{d:"M8 6.5h6a.5.5 0 0 1 .5.5v.5a.5.5 0 0 1-.5.5H8v6a.5.5 0 0 1-.5.5H7a.5.5 0 0 1-.5-.5V8h-6a.5.5 0 0 1-.5-.5V7a.5.5 0 0 1 .5-.5h6v-6A.5.5 0 0 1 7 0h.5a.5.5 0 0 1 .5.5v6z"})}),u$2("span",{className:"uppy-DashboardContent-addMoreCaption",children:i18n("addMore")})]}):u$2("div",{})]})}const transitionName="uppy-transition-slideDownUp";function Slide({children:children}){const[cachedChildren,setCachedChildren]=d$1(null),[className,setClassName]=d$1(""),enterTimeoutRef=A$1(),leaveTimeoutRef=A$1(),animationFrameRef=A$1(),handleEnterTransition=q$1(()=>{setClassName(`${transitionName}-enter`),cancelAnimationFrame(animationFrameRef.current),clearTimeout(leaveTimeoutRef.current),leaveTimeoutRef.current=void 0,animationFrameRef.current=requestAnimationFrame(()=>{setClassName(`${transitionName}-enter ${transitionName}-enter-active`),enterTimeoutRef.current=setTimeout(()=>{setClassName("")},250)})},[]),handleLeaveTransition=q$1(()=>{setClassName(`${transitionName}-leave`),cancelAnimationFrame(animationFrameRef.current),clearTimeout(enterTimeoutRef.current),enterTimeoutRef.current=void 0,animationFrameRef.current=requestAnimationFrame(()=>{setClassName(`${transitionName}-leave ${transitionName}-leave-active`),leaveTimeoutRef.current=setTimeout(()=>{setCachedChildren(null),setClassName("")},250)})},[]);return y$1(()=>{const child=H$1(children)[0];cachedChildren!==child&&(child&&!cachedChildren?handleEnterTransition():!cachedChildren||child||leaveTimeoutRef.current||handleLeaveTransition(),setCachedChildren(child))},[children,cachedChildren,handleEnterTransition,handleLeaveTransition]),y$1(()=>()=>{clearTimeout(enterTimeoutRef.current),clearTimeout(leaveTimeoutRef.current),cancelAnimationFrame(animationFrameRef.current)},[]),cachedChildren?K$1(cachedChildren,{className:classNames(className,cachedChildren.props.className)}):null}var statusBarStates={STATE_ERROR:"error",STATE_WAITING:"waiting",STATE_PREPROCESSING:"preprocessing",STATE_UPLOADING:"uploading",STATE_POSTPROCESSING:"postprocessing",STATE_COMPLETE:"complete"};function UploadBtn(props){const{newFiles:newFiles,isUploadStarted:isUploadStarted,recoveredState:recoveredState,i18n:i18n,uploadState:uploadState,isSomeGhost:isSomeGhost,startUpload:startUpload}=props,uploadBtnClassNames=classNames("uppy-u-reset","uppy-c-btn","uppy-StatusBar-actionBtn","uppy-StatusBar-actionBtn--upload",{"uppy-c-btn-primary":uploadState===statusBarStates.STATE_WAITING},{"uppy-StatusBar-actionBtn--disabled":isSomeGhost}),uploadBtnText=i18n(newFiles&&isUploadStarted&&!recoveredState?"uploadXNewFiles":"uploadXFiles",{smart_count:newFiles});return u$2("button",{type:"button",className:uploadBtnClassNames,"aria-label":i18n("uploadXFiles",{smart_count:newFiles}),onClick:startUpload,disabled:isSomeGhost,"data-uppy-super-focusable":!0,children:uploadBtnText})}function RetryBtn(props){const{i18n:i18n,uppy:uppy}=props;return u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-StatusBar-actionBtn uppy-StatusBar-actionBtn--retry","aria-label":i18n("retryUpload"),onClick:()=>uppy.retryAll().catch(()=>{}),"data-uppy-super-focusable":!0,"data-cy":"retry",children:[u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"8",height:"10",viewBox:"0 0 8 10",children:u$2("path",{d:"M4 2.408a2.75 2.75 0 1 0 2.75 2.75.626.626 0 0 1 1.25.018v.023a4 4 0 1 1-4-4.041V.25a.25.25 0 0 1 .389-.208l2.299 1.533a.25.25 0 0 1 0 .416l-2.3 1.533A.25.25 0 0 1 4 3.316v-.908z"})}),i18n("retry")]})}function CancelBtn(props){const{i18n:i18n,uppy:uppy}=props;return u$2("button",{type:"button",className:"uppy-u-reset uppy-StatusBar-actionCircleBtn",title:i18n("cancel"),"aria-label":i18n("cancel"),onClick:()=>uppy.cancelAll(),"data-cy":"cancel","data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"16",height:"16",viewBox:"0 0 16 16",children:u$2("g",{fill:"none",fillRule:"evenodd",children:[u$2("circle",{fill:"#888",cx:"8",cy:"8",r:"8"}),u$2("path",{fill:"#FFF",d:"M9.283 8l2.567 2.567-1.283 1.283L8 9.283 5.433 11.85 4.15 10.567 6.717 8 4.15 5.433 5.433 4.15 8 6.717l2.567-2.567 1.283 1.283z"})]})})})}function PauseResumeButton(props){const{isAllPaused:isAllPaused,i18n:i18n,isAllComplete:isAllComplete,resumableUploads:resumableUploads,uppy:uppy}=props,title=i18n(isAllPaused?"resume":"pause");return u$2("button",{title:title,"aria-label":title,className:"uppy-u-reset uppy-StatusBar-actionCircleBtn",type:"button",onClick:function(){isAllComplete||(resumableUploads?isAllPaused?uppy.resumeAll():uppy.pauseAll():uppy.cancelAll())},"data-cy":"togglePauseResume","data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"16",height:"16",viewBox:"0 0 16 16",children:u$2("g",{fill:"none",fillRule:"evenodd",children:[u$2("circle",{fill:"#888",cx:"8",cy:"8",r:"8"}),u$2("path",{fill:"#FFF",d:isAllPaused?"M6 4.25L11.5 8 6 11.75z":"M5 4.5h2v7H5v-7zm4 0h2v7H9v-7z"})]})})})}function DoneBtn(props){const{i18n:i18n,doneButtonHandler:doneButtonHandler}=props;return u$2("button",{type:"button",className:"uppy-u-reset uppy-c-btn uppy-StatusBar-actionBtn uppy-StatusBar-actionBtn--done",onClick:doneButtonHandler,"data-uppy-super-focusable":!0,children:i18n("done")})}function LoadingSpinner(){return u$2("svg",{className:"uppy-StatusBar-spinner","aria-hidden":"true",focusable:"false",width:"14",height:"14",children:u$2("path",{d:"M13.983 6.547c-.12-2.509-1.64-4.893-3.939-5.936-2.48-1.127-5.488-.656-7.556 1.094C.524 3.367-.398 6.048.162 8.562c.556 2.495 2.46 4.52 4.94 5.183 2.932.784 5.61-.602 7.256-3.015-1.493 1.993-3.745 3.309-6.298 2.868-2.514-.434-4.578-2.349-5.153-4.84a6.226 6.226 0 0 1 2.98-6.778C6.34.586 9.74 1.1 11.373 3.493c.407.596.693 1.282.842 1.988.127.598.073 1.197.161 1.794.078.525.543 1.257 1.15.864.525-.341.49-1.05.456-1.592-.007-.15.02.3 0 0",fillRule:"evenodd"})})}function ProgressBarProcessing(props){const{progress:progress}=props,{value:value,mode:mode,message:message}=progress;return u$2("div",{className:"uppy-StatusBar-content",children:[u$2(LoadingSpinner,{}),"determinate"===mode?`${Math.round(100*value)}%  `:"",message]})}function ProgressDetails(props){const{numUploads:numUploads,complete:complete,totalUploadedSize:totalUploadedSize,totalSize:totalSize,totalETA:totalETA,i18n:i18n}=props,ifShowFilesUploadedOfTotal=numUploads>1,totalUploadedSizeStr=prettierBytes$1(totalUploadedSize);return u$2("div",{className:"uppy-StatusBar-statusSecondary",children:[ifShowFilesUploadedOfTotal&&i18n("filesUploadedOfTotal",{complete:complete,smart_count:numUploads}),u$2("span",{className:"uppy-StatusBar-additionalInfo",children:[ifShowFilesUploadedOfTotal&&"  ",null!=totalSize?i18n("dataUploadedOfTotal",{complete:totalUploadedSizeStr,total:prettierBytes$1(totalSize)}):i18n("dataUploadedOfUnknown",{complete:totalUploadedSizeStr}),"  ",null!=totalETA&&i18n("xTimeLeft",{time:prettyETA(totalETA)})]})]})}function FileUploadCount(props){const{i18n:i18n,complete:complete,numUploads:numUploads}=props;return u$2("div",{className:"uppy-StatusBar-statusSecondary",children:i18n("filesUploadedOfTotal",{complete:complete,smart_count:numUploads})})}function UploadNewlyAddedFiles(props){const{i18n:i18n,newFiles:newFiles,startUpload:startUpload}=props,uploadBtnClassNames=classNames("uppy-u-reset","uppy-c-btn","uppy-StatusBar-actionBtn","uppy-StatusBar-actionBtn--uploadNewlyAdded");return u$2("div",{className:"uppy-StatusBar-statusSecondary",children:[u$2("div",{className:"uppy-StatusBar-statusSecondaryHint",children:i18n("xMoreFilesAdded",{smart_count:newFiles})}),u$2("button",{type:"button",className:uploadBtnClassNames,"aria-label":i18n("uploadXFiles",{smart_count:newFiles}),onClick:startUpload,children:i18n("upload")})]})}function ProgressBarUploading(props){const{i18n:i18n,supportsUploadProgress:supportsUploadProgress,totalProgress:totalProgress,hideProgressDetails:hideProgressDetails,isUploadStarted:isUploadStarted,isAllComplete:isAllComplete,isAllPaused:isAllPaused,newFiles:newFiles,numUploads:numUploads,complete:complete,totalUploadedSize:totalUploadedSize,totalSize:totalSize,totalETA:totalETA,startUpload:startUpload}=props,showUploadNewlyAddedFiles=newFiles&&isUploadStarted;if(!isUploadStarted||isAllComplete)return null;const title=i18n(isAllPaused?"paused":"uploading");return u$2("div",{className:"uppy-StatusBar-content",title:title,children:[isAllPaused?null:u$2(LoadingSpinner,{}),u$2("div",{className:"uppy-StatusBar-status",children:[u$2("div",{className:"uppy-StatusBar-statusPrimary",children:supportsUploadProgress&&0!==totalProgress?`${title}: ${totalProgress}%`:title}),isAllPaused||showUploadNewlyAddedFiles||hideProgressDetails?null:supportsUploadProgress?u$2(ProgressDetails,{numUploads:numUploads,complete:complete,totalUploadedSize:totalUploadedSize,totalSize:totalSize,totalETA:totalETA,i18n:i18n}):u$2(FileUploadCount,{i18n:i18n,complete:complete,numUploads:numUploads}),showUploadNewlyAddedFiles?u$2(UploadNewlyAddedFiles,{i18n:i18n,newFiles:newFiles,startUpload:startUpload}):null]})]})}function ProgressBarComplete(props){const{i18n:i18n}=props;return u$2("div",{className:"uppy-StatusBar-content",role:"status",title:i18n("complete"),children:u$2("div",{className:"uppy-StatusBar-status",children:u$2("div",{className:"uppy-StatusBar-statusPrimary",children:[u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-StatusBar-statusIndicator uppy-c-icon",width:"15",height:"11",viewBox:"0 0 15 11",children:u$2("path",{d:"M.414 5.843L1.627 4.63l3.472 3.472L13.202 0l1.212 1.213L5.1 10.528z"})}),i18n("complete")]})})})}function ProgressBarError(props){const{error:error,i18n:i18n,complete:complete,numUploads:numUploads}=props;return u$2("div",{className:"uppy-StatusBar-content",title:i18n("uploadFailed"),children:[u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-StatusBar-statusIndicator uppy-c-icon",width:"11",height:"11",viewBox:"0 0 11 11",children:u$2("path",{d:"M4.278 5.5L0 1.222 1.222 0 5.5 4.278 9.778 0 11 1.222 6.722 5.5 11 9.778 9.778 11 5.5 6.722 1.222 11 0 9.778z"})}),u$2("div",{className:"uppy-StatusBar-status",children:[u$2("div",{className:"uppy-StatusBar-statusPrimary",children:[i18n("uploadFailed"),u$2("button",{className:"uppy-u-reset uppy-StatusBar-details","aria-label":i18n("showErrorDetails"),"data-microtip-position":"top-right","data-microtip-size":"medium",onClick:function(){const errorMessage=`${i18n("uploadFailed")} \n\n ${error}`;alert(errorMessage)},type:"button",children:"?"})]}),u$2(FileUploadCount,{i18n:i18n,complete:complete,numUploads:numUploads})]})]})}function calculateProcessingProgress(files){const values=[];let message,mode="indeterminate";for(const{progress:progress}of Object.values(files)){const{preprocess:preprocess,postprocess:postprocess}=progress;null==message&&(preprocess||postprocess)&&({mode:mode,message:message}=preprocess||postprocess),"determinate"===preprocess?.mode&&values.push(preprocess.value),"determinate"===postprocess?.mode&&values.push(postprocess.value)}return{mode:mode,message:message,value:values.reduce((total,progressValue)=>total+progressValue/values.length,0)}}const{STATE_ERROR:STATE_ERROR,STATE_WAITING:STATE_WAITING,STATE_PREPROCESSING:STATE_PREPROCESSING,STATE_UPLOADING:STATE_UPLOADING,STATE_POSTPROCESSING:STATE_POSTPROCESSING,STATE_COMPLETE:STATE_COMPLETE}=statusBarStates;function StatusBarUI({newFiles:newFiles,allowNewUpload:allowNewUpload,isUploadInProgress:isUploadInProgress,isAllPaused:isAllPaused,resumableUploads:resumableUploads,error:error,hideUploadButton:hideUploadButton,hidePauseResumeButton:hidePauseResumeButton=!1,hideCancelButton:hideCancelButton=!1,hideRetryButton:hideRetryButton=!1,recoveredState:recoveredState,uploadState:uploadState,totalProgress:totalProgress,files:files,supportsUploadProgress:supportsUploadProgress,hideAfterFinish:hideAfterFinish=!1,isSomeGhost:isSomeGhost,doneButtonHandler:doneButtonHandler,isUploadStarted:isUploadStarted,i18n:i18n,startUpload:startUpload,uppy:uppy,isAllComplete:isAllComplete,hideProgressDetails:hideProgressDetails,numUploads:numUploads,complete:complete,totalSize:totalSize,totalETA:totalETA,totalUploadedSize:totalUploadedSize}){const progressValue=function(){switch(uploadState){case STATE_POSTPROCESSING:case STATE_PREPROCESSING:{const progress=calculateProcessingProgress(files);return"determinate"===progress.mode?100*progress.value:totalProgress}case STATE_ERROR:return null;case STATE_UPLOADING:return supportsUploadProgress?totalProgress:null;default:return totalProgress}}(),width=progressValue??100,showUploadBtn=!error&&newFiles&&(!isUploadInProgress&&!isAllPaused||recoveredState)&&allowNewUpload&&!hideUploadButton,showCancelBtn=!hideCancelButton&&uploadState!==STATE_WAITING&&uploadState!==STATE_COMPLETE,showPauseResumeBtn=resumableUploads&&!hidePauseResumeButton&&uploadState===STATE_UPLOADING,showRetryBtn=error&&!isAllComplete&&!hideRetryButton,showDoneBtn=doneButtonHandler&&uploadState===STATE_COMPLETE,progressClassNames=classNames("uppy-StatusBar-progress",{"is-indeterminate":function(){switch(uploadState){case STATE_POSTPROCESSING:case STATE_PREPROCESSING:{const{mode:mode}=calculateProcessingProgress(files);return"indeterminate"===mode}case STATE_UPLOADING:return!supportsUploadProgress;default:return!1}}()}),statusBarClassNames=classNames("uppy-StatusBar",`is-${uploadState}`,{"has-ghosts":isSomeGhost}),progressBarStateEl=(()=>{switch(uploadState){case STATE_PREPROCESSING:case STATE_POSTPROCESSING:return u$2(ProgressBarProcessing,{progress:calculateProcessingProgress(files)});case STATE_COMPLETE:return u$2(ProgressBarComplete,{i18n:i18n});case STATE_ERROR:return u$2(ProgressBarError,{error:error,i18n:i18n,numUploads:numUploads,complete:complete});case STATE_UPLOADING:return u$2(ProgressBarUploading,{i18n:i18n,supportsUploadProgress:supportsUploadProgress,totalProgress:totalProgress,hideProgressDetails:hideProgressDetails,isUploadStarted:isUploadStarted,isAllComplete:isAllComplete,isAllPaused:isAllPaused,newFiles:newFiles,numUploads:numUploads,complete:complete,totalUploadedSize:totalUploadedSize,totalSize:totalSize,totalETA:totalETA,startUpload:startUpload});default:return null}})();return!(showUploadBtn||showRetryBtn||showPauseResumeBtn||showCancelBtn||showDoneBtn)&&!progressBarStateEl||uploadState===STATE_COMPLETE&&hideAfterFinish?null:u$2("div",{className:statusBarClassNames,children:[u$2("div",{className:progressClassNames,style:{width:`${width}%`},role:"progressbar","aria-label":`${width}%`,"aria-valuetext":`${width}%`,"aria-valuemin":0,"aria-valuemax":100,"aria-valuenow":progressValue}),progressBarStateEl,u$2("div",{className:"uppy-StatusBar-actions",children:[showUploadBtn?u$2(UploadBtn,{newFiles:newFiles,isUploadStarted:isUploadStarted,recoveredState:recoveredState,i18n:i18n,isSomeGhost:isSomeGhost,startUpload:startUpload,uploadState:uploadState}):null,showRetryBtn?u$2(RetryBtn,{i18n:i18n,uppy:uppy}):null,showPauseResumeBtn?u$2(PauseResumeButton,{isAllPaused:isAllPaused,i18n:i18n,isAllComplete:isAllComplete,resumableUploads:resumableUploads,uppy:uppy}):null,showCancelBtn?u$2(CancelBtn,{i18n:i18n,uppy:uppy}):null,showDoneBtn?u$2(DoneBtn,{i18n:i18n,doneButtonHandler:doneButtonHandler}):null]})]})}function getUploadingState(error,isAllComplete,recoveredState,files){if(error)return statusBarStates.STATE_ERROR;if(isAllComplete)return statusBarStates.STATE_COMPLETE;if(recoveredState)return statusBarStates.STATE_WAITING;let state=statusBarStates.STATE_WAITING;const fileIDs=Object.keys(files);for(let i=0;i<fileIDs.length;i++){const{progress:progress}=files[fileIDs[i]];if(progress.uploadStarted&&!progress.uploadComplete)return statusBarStates.STATE_UPLOADING;progress.preprocess&&(state=statusBarStates.STATE_PREPROCESSING),progress.postprocess&&state!==statusBarStates.STATE_PREPROCESSING&&(state=statusBarStates.STATE_POSTPROCESSING)}return state}class StatusBar extends x{#lastUpdateTime;#previousUploadedBytes;#previousSpeed;#previousETA;componentDidMount(){this.#lastUpdateTime=performance.now(),this.#previousUploadedBytes=this.props.uppy.getFiles().reduce((pv,file)=>pv+(file.progress.bytesUploaded||0),0),this.props.uppy.on("upload",this.#onUploadStart)}componentWillUnmount(){this.props.uppy.off("upload",this.#onUploadStart)}#onUploadStart=()=>{const{recoveredState:recoveredState}=this.props.uppy.getState();if(this.#previousSpeed=null,this.#previousETA=null,recoveredState)return this.#previousUploadedBytes=Object.values(recoveredState.files).reduce((pv,{progress:progress})=>pv+(progress.bytesUploaded||0),0),void this.props.uppy.emit("restore-confirmed");this.#lastUpdateTime=performance.now(),this.#previousUploadedBytes=0};#computeSmoothETA(totalBytes){if(null==totalBytes.total||0===totalBytes.total)return null;const remaining=totalBytes.total-totalBytes.uploaded;if(remaining<=0)return null;this.#lastUpdateTime??=performance.now();const dt=performance.now()-this.#lastUpdateTime;if(0===dt)return Math.round((this.#previousETA??0)/100)/10;if(null==this.#previousUploadedBytes)return this.#previousUploadedBytes=totalBytes.uploaded,null;const uploadedBytesSinceLastTick=totalBytes.uploaded-this.#previousUploadedBytes;if(this.#previousUploadedBytes=totalBytes.uploaded,uploadedBytesSinceLastTick<=0)return Math.round((this.#previousETA??0)/100)/10;const currentSpeed=uploadedBytesSinceLastTick/dt;if(!Number.isFinite(currentSpeed)||currentSpeed<=0)return null;const filteredSpeed=null==this.#previousSpeed?currentSpeed:emaFilter(currentSpeed,this.#previousSpeed,2e3,dt);if(!Number.isFinite(filteredSpeed)||filteredSpeed<=0)return null;this.#previousSpeed=filteredSpeed;const instantETA=remaining/filteredSpeed;if(!Number.isFinite(instantETA)||instantETA<0)return null;const updatedPreviousETA=Math.max((this.#previousETA??0)-dt,0),filteredETA=null==this.#previousETA?instantETA:emaFilter(instantETA,updatedPreviousETA,2e3,dt);return!Number.isFinite(filteredETA)||filteredETA<0?null:(this.#previousETA=filteredETA,this.#lastUpdateTime=performance.now(),Math.round(filteredETA/100)/10)}startUpload=()=>this.props.uppy.upload().catch(()=>{});render(){const{capabilities:capabilities,files:files,allowNewUpload:allowNewUpload,totalProgress:totalProgress,error:error,recoveredState:recoveredState}=this.props.uppy.getState(),{newFiles:newFiles,startedFiles:startedFiles,completeFiles:completeFiles,isUploadStarted:isUploadStarted,isAllComplete:isAllComplete,isAllPaused:isAllPaused,isUploadInProgress:isUploadInProgress,isSomeGhost:isSomeGhost}=this.props.uppy.getObjectOfFilesPerState(),newFilesOrRecovered=recoveredState?Object.values(files):newFiles,resumableUploads=!!capabilities.resumableUploads,supportsUploadProgress=!1!==capabilities.uploadProgress;let totalSize=null,totalUploadedSize=0;startedFiles.every(f=>null!=f.progress.bytesTotal&&0!==f.progress.bytesTotal)?(totalSize=0,startedFiles.forEach(file=>{totalSize+=file.progress.bytesTotal||0,totalUploadedSize+=file.progress.bytesUploaded||0})):startedFiles.forEach(file=>{totalUploadedSize+=file.progress.bytesUploaded||0});const totalETA=this.#computeSmoothETA({uploaded:totalUploadedSize,total:totalSize});return u$2(StatusBarUI,{error:error,uploadState:getUploadingState(error,isAllComplete,recoveredState,files||{}),allowNewUpload:allowNewUpload,totalProgress:totalProgress,totalSize:totalSize,totalUploadedSize:totalUploadedSize,isAllComplete:isAllComplete,isAllPaused:isAllPaused,isUploadStarted:isUploadStarted,isUploadInProgress:isUploadInProgress,isSomeGhost:isSomeGhost,recoveredState:recoveredState,complete:completeFiles.length,newFiles:newFilesOrRecovered.length,numUploads:startedFiles.length,totalETA:totalETA,files:files,i18n:this.props.i18n,uppy:this.props.uppy,startUpload:this.startUpload,doneButtonHandler:this.props.doneButtonHandler,resumableUploads:resumableUploads,supportsUploadProgress:supportsUploadProgress,hideProgressDetails:this.props.hideProgressDetails,hideUploadButton:this.props.hideUploadButton,hideRetryButton:this.props.hideRetryButton,hidePauseResumeButton:this.props.hidePauseResumeButton,hideCancelButton:this.props.hideCancelButton,hideAfterFinish:this.props.hideAfterFinish})}}var locale$5={strings:{closeModal:"Close Modal",addMoreFiles:"Add more files",addingMoreFiles:"Adding more files",importFrom:"Import from %{name}",dashboardWindowTitle:"Uppy Dashboard Window (Press escape to close)",dashboardTitle:"Uppy Dashboard",copyLinkToClipboardSuccess:"Link copied to clipboard.",copyLinkToClipboardFallback:"Copy the URL below",copyLink:"Copy link",back:"Back",removeFile:"Remove file",editFile:"Edit file",editImage:"Edit image",editing:"Editing %{file}",error:"Error",finishEditingFile:"Finish editing file",saveChanges:"Save changes",myDevice:"My Device",dropHint:"Drop your files here",uploadComplete:"Upload complete",uploadPaused:"Upload paused",resumeUpload:"Resume upload",pauseUpload:"Pause upload",retryUpload:"Retry upload",cancelUpload:"Cancel upload",xFilesSelected:{0:"%{smart_count} file selected",1:"%{smart_count} files selected"},uploadingXFiles:{0:"Uploading %{smart_count} file",1:"Uploading %{smart_count} files"},processingXFiles:{0:"Processing %{smart_count} file",1:"Processing %{smart_count} files"},poweredBy:"Powered by %{uppy}",addMore:"Add more",editFileWithFilename:"Edit file %{file}",save:"Save",cancel:"Cancel",dropPasteFiles:"Drop files here or %{browseFiles}",dropPasteFolders:"Drop files here or %{browseFolders}",dropPasteBoth:"Drop files here, %{browseFiles} or %{browseFolders}",dropPasteImportFiles:"Drop files here, %{browseFiles} or import from:",dropPasteImportFolders:"Drop files here, %{browseFolders} or import from:",dropPasteImportBoth:"Drop files here, %{browseFiles}, %{browseFolders} or import from:",importFiles:"Import files from:",browseFiles:"browse files",browseFolders:"browse folders",recoveredXFiles:{0:"We could not fully recover 1 file. Please re-select it and resume the upload.",1:"We could not fully recover %{smart_count} files. Please re-select them and resume the upload."},recoveredAllFiles:"We restored all files. You can now resume the upload.",sessionRestored:"Session restored",reSelect:"Re-select",missingRequiredMetaFields:{0:"Missing required meta field: %{fields}.",1:"Missing required meta fields: %{fields}."},takePictureBtn:"Take Picture",recordVideoBtn:"Record Video",uploading:"Uploading",complete:"Complete",uploadFailed:"Upload failed",paused:"Paused",retry:"Retry",pause:"Pause",resume:"Resume",done:"Done",filesUploadedOfTotal:{0:"%{complete} of %{smart_count} file uploaded",1:"%{complete} of %{smart_count} files uploaded"},dataUploadedOfTotal:"%{complete} of %{total}",dataUploadedOfUnknown:"%{complete} of unknown",xTimeLeft:"%{time} left",uploadXFiles:{0:"Upload %{smart_count} file",1:"Upload %{smart_count} files"},uploadXNewFiles:{0:"Upload +%{smart_count} file",1:"Upload +%{smart_count} files"},upload:"Upload",xMoreFilesAdded:{0:"%{smart_count} more file added",1:"%{smart_count} more files added"},showErrorDetails:"Show error details"}};function getActiveOverlayEl(dashboardEl,activeOverlayType){if(activeOverlayType){const overlayEl=dashboardEl.querySelector(`[data-uppy-paneltype="${activeOverlayType}"]`);if(overlayEl)return overlayEl}return dashboardEl}function focusOnFirstNode(event,nodes){const node=nodes[0];node&&(node.focus(),event.preventDefault())}function trapFocus(event,activeOverlayType,dashboardEl){const activeOverlayEl=getActiveOverlayEl(dashboardEl,activeOverlayType),focusableNodes=toArray(activeOverlayEl.querySelectorAll(FOCUSABLE_ELEMENTS)),focusedItemIndex=focusableNodes.indexOf(document.activeElement);!function(activeOverlayEl){return activeOverlayEl.contains(document.activeElement)}(activeOverlayEl)?focusOnFirstNode(event,focusableNodes):event.shiftKey&&0===focusedItemIndex?function(event,nodes){const node=nodes[nodes.length-1];node&&(node.focus(),event.preventDefault())}(event,focusableNodes):event.shiftKey||focusedItemIndex!==focusableNodes.length-1||focusOnFirstNode(event,focusableNodes)}function createPromise(){const o={};return o.promise=new Promise((resolve,reject)=>{o.resolve=resolve,o.reject=reject}),o}const defaultOptions$5={target:"body",metaFields:[],thumbnailWidth:280,thumbnailType:"image/jpeg",waitForThumbnailsBeforeUpload:!1,defaultPickerIcon:function(){return u$2("svg",{"aria-hidden":"true",focusable:"false",width:"30",height:"30",viewBox:"0 0 30 30",children:u$2("path",{d:"M15 30c8.284 0 15-6.716 15-15 0-8.284-6.716-15-15-15C6.716 0 0 6.716 0 15c0 8.284 6.716 15 15 15zm4.258-12.676v6.846h-8.426v-6.846H5.204l9.82-12.364 9.82 12.364H19.26z"})})},showLinkToFileUploadResult:!1,hideProgressDetails:!1,hideUploadButton:!1,hideCancelButton:!1,hideRetryButton:!1,hidePauseResumeButton:!1,hideProgressAfterFinish:!1,note:null,singleFileFullScreen:!0,disableStatusBar:!1,disableInformer:!1,disableThumbnailGenerator:!1,fileManagerSelectionType:"files",proudlyDisplayPoweredByUppy:!0,showSelectedFiles:!0,showRemoveButtonAfterComplete:!1,showNativePhotoCameraButton:!1,showNativeVideoCameraButton:!1,theme:"light",autoOpen:null,disabled:!1,disableLocalFiles:!1,nativeCameraFacingMode:"",onDragLeave:()=>{},onDragOver:()=>{},onDrop:()=>{},plugins:[],doneButtonHandler:void 0,onRequestCloseModal:null,inline:!1,animateOpenClose:!0,browserBackButtonClose:!1,closeAfterFinish:!1,closeModalOnClickOutside:!1,disablePageScrollWhenModalOpen:!0,trigger:null,width:750,height:550};class Dashboard extends UIPlugin{static VERSION=packageJson$8_version;#disabledNodes;modalName=`uppy-Dashboard-${nanoid()}`;superFocus=function(){let lastFocusWasOnSuperFocusableEl=!1;return debounce$2((dashboardEl,activeOverlayType)=>{const overlayEl=getActiveOverlayEl(dashboardEl,activeOverlayType),isFocusInOverlay=overlayEl.contains(document.activeElement);if(isFocusInOverlay&&lastFocusWasOnSuperFocusableEl)return;const superFocusableEl=overlayEl.querySelector("[data-uppy-super-focusable]");if(!isFocusInOverlay||superFocusableEl)if(superFocusableEl)superFocusableEl.focus({preventScroll:!0}),lastFocusWasOnSuperFocusableEl=!0;else{const firstEl=overlayEl.querySelector(FOCUSABLE_ELEMENTS);firstEl?.focus({preventScroll:!0}),lastFocusWasOnSuperFocusableEl=!1}},260)}();ifFocusedOnUppyRecently=!1;dashboardIsDisabled;savedScrollPosition;savedActiveElement;resizeObserver;darkModeMediaQuery;makeDashboardInsidesVisibleAnywayTimeout;constructor(uppy,opts){const autoOpen=opts?.autoOpen??null;super(uppy,{...defaultOptions$5,...opts,autoOpen:autoOpen}),this.id=this.opts.id||"Dashboard",this.title="Dashboard",this.type="orchestrator",this.defaultLocale=locale$5,void 0===this.opts.doneButtonHandler&&(this.opts.doneButtonHandler=()=>{this.uppy.clear(),this.requestCloseModal()}),this.opts.onRequestCloseModal??=()=>this.closeModal(),this.i18nInit()}removeTarget=plugin=>{const newTargets=this.getPluginState().targets.filter(target=>target.id!==plugin.id);this.setPluginState({targets:newTargets})};addTarget=plugin=>{const callerPluginId=plugin.id||plugin.constructor.name,callerPluginName=plugin.title||callerPluginId,callerPluginType=plugin.type;if("acquirer"!==callerPluginType&&"progressindicator"!==callerPluginType&&"editor"!==callerPluginType){const msg="Dashboard: can only be targeted by plugins of types: acquirer, progressindicator, editor";return this.uppy.log(msg,"error"),null}const target={id:callerPluginId,name:callerPluginName,type:callerPluginType},newTargets=this.getPluginState().targets.slice();return newTargets.push(target),this.setPluginState({targets:newTargets}),this.el};hideAllPanels=()=>{const state=this.getPluginState(),update={activePickerPanel:void 0,showAddFilesPanel:!1,activeOverlayType:null,fileCardFor:null,showFileEditor:!1};state.activePickerPanel===update.activePickerPanel&&state.showAddFilesPanel===update.showAddFilesPanel&&state.showFileEditor===update.showFileEditor&&state.activeOverlayType===update.activeOverlayType||(this.setPluginState(update),this.uppy.emit("dashboard:close-panel",state.activePickerPanel?.id))};showPanel=id=>{const{targets:targets}=this.getPluginState(),activePickerPanel=targets.find(target=>"acquirer"===target.type&&target.id===id);this.setPluginState({activePickerPanel:activePickerPanel,activeOverlayType:"PickerPanel"}),this.uppy.emit("dashboard:show-panel",id)};canEditFile=file=>{const{targets:targets}=this.getPluginState();return this.#getEditors(targets).some(target=>this.uppy.getPlugin(target.id).canEditFile(file))};openFileEditor=file=>{const{targets:targets}=this.getPluginState(),editors=this.#getEditors(targets);this.setPluginState({showFileEditor:!0,fileCardFor:file.id||null,activeOverlayType:"FileEditor"}),editors.forEach(editor=>{this.uppy.getPlugin(editor.id).selectFile(file)})};closeFileEditor=()=>{const{metaFields:metaFields}=this.getPluginState();metaFields&&metaFields.length>0?this.setPluginState({showFileEditor:!1,activeOverlayType:"FileCard"}):this.setPluginState({showFileEditor:!1,fileCardFor:null,activeOverlayType:"AddFiles"})};saveFileEditor=()=>{const{targets:targets}=this.getPluginState();this.#getEditors(targets).forEach(editor=>{this.uppy.getPlugin(editor.id).save()}),this.closeFileEditor()};openModal=()=>{const{promise:promise,resolve:resolve}=createPromise();if(this.savedScrollPosition=window.pageYOffset,this.savedActiveElement=document.activeElement,this.opts.disablePageScrollWhenModalOpen&&document.body.classList.add("uppy-Dashboard-isFixed"),this.opts.animateOpenClose&&this.getPluginState().isClosing){const handler=()=>{this.setPluginState({isHidden:!1}),this.el.removeEventListener("animationend",handler,!1),resolve()};this.el.addEventListener("animationend",handler,!1)}else this.setPluginState({isHidden:!1}),resolve();return this.opts.browserBackButtonClose&&this.updateBrowserHistory(),document.addEventListener("keydown",this.handleKeyDownInModal),this.uppy.emit("dashboard:modal-open"),promise};closeModal=opts=>{const manualClose=opts?.manualClose??!0,{isHidden:isHidden,isClosing:isClosing}=this.getPluginState();if(isHidden||isClosing)return;const{promise:promise,resolve:resolve}=createPromise();if(this.opts.disablePageScrollWhenModalOpen&&document.body.classList.remove("uppy-Dashboard-isFixed"),this.opts.animateOpenClose){this.setPluginState({isClosing:!0});const handler=()=>{this.setPluginState({isHidden:!0,isClosing:!1}),this.superFocus.cancel(),this.savedActiveElement.focus(),this.el.removeEventListener("animationend",handler,!1),resolve()};this.el.addEventListener("animationend",handler,!1)}else this.setPluginState({isHidden:!0}),this.superFocus.cancel(),this.savedActiveElement.focus(),resolve();return document.removeEventListener("keydown",this.handleKeyDownInModal),manualClose&&this.opts.browserBackButtonClose&&history.state?.[this.modalName]&&history.back(),this.uppy.emit("dashboard:modal-closed"),promise};isModalOpen=()=>!this.getPluginState().isHidden||!1;requestCloseModal=()=>this.opts.onRequestCloseModal?this.opts.onRequestCloseModal():this.closeModal();setDarkModeCapability=isDarkModeOn=>{const{capabilities:capabilities}=this.uppy.getState();this.uppy.setState({capabilities:{...capabilities,darkMode:isDarkModeOn}})};handleSystemDarkModeChange=event=>{const isDarkModeOnNow=event.matches;this.uppy.log("[Dashboard] Dark mode is "+(isDarkModeOnNow?"on":"off")),this.setDarkModeCapability(isDarkModeOnNow)};toggleFileCard=(show,fileID)=>{const file=this.uppy.getFile(fileID);show?this.uppy.emit("dashboard:file-edit-start",file):this.uppy.emit("dashboard:file-edit-complete",file),this.setPluginState({fileCardFor:show?fileID:null,activeOverlayType:show?"FileCard":null})};toggleAddFilesPanel=show=>{this.setPluginState({showAddFilesPanel:show,activeOverlayType:show?"AddFiles":null})};addFiles=files=>{const descriptors=files.map(file=>({source:this.id,name:file.name,type:file.type,data:file,meta:{relativePath:file.relativePath||file.webkitRelativePath||null}}));try{this.uppy.addFiles(descriptors)}catch(err){this.uppy.log(err)}};startListeningToResize=()=>{this.resizeObserver=new ResizeObserver(entries=>{const uppyDashboardInnerEl=entries[0],{width:width,height:height}=uppyDashboardInnerEl.contentRect;this.setPluginState({containerWidth:width,containerHeight:height,areInsidesReadyToBeVisible:!0})}),this.resizeObserver.observe(this.el.querySelector(".uppy-Dashboard-inner")),this.makeDashboardInsidesVisibleAnywayTimeout=setTimeout(()=>{const pluginState=this.getPluginState(),isModalAndClosed=!this.opts.inline&&pluginState.isHidden;pluginState.areInsidesReadyToBeVisible||isModalAndClosed||(this.uppy.log("[Dashboard] resize event didnt fire on time: defaulted to mobile layout","warning"),this.setPluginState({areInsidesReadyToBeVisible:!0}))},1e3)};stopListeningToResize=()=>{this.resizeObserver.disconnect(),clearTimeout(this.makeDashboardInsidesVisibleAnywayTimeout)};recordIfFocusedOnUppyRecently=event=>{this.el.contains(event.target)?this.ifFocusedOnUppyRecently=!0:(this.ifFocusedOnUppyRecently=!1,this.superFocus.cancel())};disableInteractiveElements=disable=>{const nodesToDisable=this.#disabledNodes??toArray(this.el.querySelectorAll(["a[href]","input:not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])",'[role="button"]:not([disabled])'])).filter(node=>!node.classList.contains("uppy-Dashboard-close"));for(const node of nodesToDisable)"A"===node.tagName?node.setAttribute("aria-disabled",disable):node.disabled=disable;this.#disabledNodes=disable?nodesToDisable:null,this.dashboardIsDisabled=disable};updateBrowserHistory=()=>{history.state?.[this.modalName]||history.pushState({...history.state,[this.modalName]:!0},""),window.addEventListener("popstate",this.handlePopState,!1)};handlePopState=event=>{!this.isModalOpen()||event.state&&event.state[this.modalName]||this.closeModal({manualClose:!1}),!this.isModalOpen()&&event.state?.[this.modalName]&&history.back()};handleKeyDownInModal=event=>{27===event.keyCode&&this.requestCloseModal(),9===event.keyCode&&trapFocus(event,this.getPluginState().activeOverlayType,this.el)};handleClickOutside=()=>{this.opts.closeModalOnClickOutside&&this.requestCloseModal()};handlePaste=event=>{this.uppy.iteratePlugins(plugin=>{"acquirer"===plugin.type&&plugin.handleRootPaste?.(event)});const files=toArray(event.clipboardData.files);files.length>0&&(this.uppy.log("[Dashboard] Files pasted"),this.addFiles(files))};handleInputChange=event=>{event.preventDefault();const files=toArray(event.currentTarget.files||[]);files.length>0&&(this.uppy.log("[Dashboard] Files selected through input"),this.addFiles(files))};handleDragOver=event=>{event.preventDefault(),event.stopPropagation();const somePluginCanHandleRootDrop=(()=>{let somePluginCanHandleRootDrop=!0;return this.uppy.iteratePlugins(plugin=>{plugin.canHandleRootDrop?.(event)&&(somePluginCanHandleRootDrop=!0)}),somePluginCanHandleRootDrop})(),hasFiles=(()=>{const{types:types}=event.dataTransfer;return types.some(type=>"Files"===type)})();!somePluginCanHandleRootDrop&&!hasFiles||this.opts.disabled||this.opts.disableLocalFiles&&(hasFiles||!somePluginCanHandleRootDrop)||!this.uppy.getState().allowNewUpload?event.dataTransfer.dropEffect="none":(event.dataTransfer.dropEffect="copy",this.setPluginState({isDraggingOver:!0}),this.opts.onDragOver(event))};handleDragLeave=event=>{event.preventDefault(),event.stopPropagation(),this.setPluginState({isDraggingOver:!1}),this.opts.onDragLeave(event)};handleDrop=async event=>{event.preventDefault(),event.stopPropagation(),this.setPluginState({isDraggingOver:!1}),this.uppy.iteratePlugins(plugin=>{"acquirer"===plugin.type&&plugin.handleRootDrop?.(event)});let executedDropErrorOnce=!1;this.uppy.log("[Dashboard] Processing dropped files");const files=await getDroppedFiles(event.dataTransfer,{logDropError:error=>{this.uppy.log(error,"error"),executedDropErrorOnce||(this.uppy.info(error.message,"error"),executedDropErrorOnce=!0)}});files.length>0&&(this.uppy.log("[Dashboard] Files dropped"),this.addFiles(files)),this.opts.onDrop(event)};handleRequestThumbnail=file=>{this.opts.waitForThumbnailsBeforeUpload||this.uppy.emit("thumbnail:request",file)};handleCancelThumbnail=file=>{this.opts.waitForThumbnailsBeforeUpload||this.uppy.emit("thumbnail:cancel",file)};handleKeyDownInInline=event=>{9===event.keyCode&&function(event,activeOverlayType,dashboardEl){null===activeOverlayType||trapFocus(event,activeOverlayType,dashboardEl)}(event,this.getPluginState().activeOverlayType,this.el)};handlePasteOnBody=event=>{this.el.contains(document.activeElement)&&this.handlePaste(event)};handleComplete=({failed:failed})=>{this.opts.closeAfterFinish&&!failed?.length&&this.requestCloseModal()};handleCancelRestore=()=>{this.uppy.emit("restore-canceled")};#generateLargeThumbnailIfSingleFile=()=>{if(this.opts.disableThumbnailGenerator)return;const files=this.uppy.getFiles();if(1===files.length){const thumbnailGenerator=this.uppy.getPlugin(`${this.id}:ThumbnailGenerator`);thumbnailGenerator?.setOptions({thumbnailWidth:600});const fileForThumbnail={...files[0],preview:void 0};thumbnailGenerator?.requestThumbnail(fileForThumbnail).then(()=>{thumbnailGenerator?.setOptions({thumbnailWidth:this.opts.thumbnailWidth})})}};#openFileEditorWhenFilesAdded=files=>{const firstFile=files[0],{metaFields:metaFields}=this.getPluginState(),isMetaEditorEnabled=metaFields&&metaFields.length>0,isImageEditorEnabled=this.canEditFile(firstFile);isMetaEditorEnabled&&"metaEditor"===this.opts.autoOpen?this.toggleFileCard(!0,firstFile.id):isImageEditorEnabled&&"imageEditor"===this.opts.autoOpen&&this.openFileEditor(firstFile)};initEvents=()=>{if(this.opts.trigger&&!this.opts.inline){const showModalTrigger=findAllDOMElements(this.opts.trigger);showModalTrigger?showModalTrigger.forEach(trigger=>trigger.addEventListener("click",this.openModal)):this.uppy.log("Dashboard modal trigger not found. Make sure `trigger` is set in Dashboard options, unless you are planning to call `dashboard.openModal()` method yourself","warning")}this.startListeningToResize(),document.addEventListener("paste",this.handlePasteOnBody),this.uppy.on("plugin-added",this.#addSupportedPluginIfNoTarget),this.uppy.on("plugin-remove",this.removeTarget),this.uppy.on("file-added",this.hideAllPanels),this.uppy.on("dashboard:modal-closed",this.hideAllPanels),this.uppy.on("complete",this.handleComplete),this.uppy.on("files-added",this.#generateLargeThumbnailIfSingleFile),this.uppy.on("file-removed",this.#generateLargeThumbnailIfSingleFile),document.addEventListener("focus",this.recordIfFocusedOnUppyRecently,!0),document.addEventListener("click",this.recordIfFocusedOnUppyRecently,!0),this.opts.inline&&this.el.addEventListener("keydown",this.handleKeyDownInInline),this.opts.autoOpen&&this.uppy.on("files-added",this.#openFileEditorWhenFilesAdded)};removeEvents=()=>{const showModalTrigger=findAllDOMElements(this.opts.trigger);!this.opts.inline&&showModalTrigger&&showModalTrigger.forEach(trigger=>trigger.removeEventListener("click",this.openModal)),this.stopListeningToResize(),document.removeEventListener("paste",this.handlePasteOnBody),window.removeEventListener("popstate",this.handlePopState,!1),this.uppy.off("plugin-added",this.#addSupportedPluginIfNoTarget),this.uppy.off("plugin-remove",this.removeTarget),this.uppy.off("file-added",this.hideAllPanels),this.uppy.off("dashboard:modal-closed",this.hideAllPanels),this.uppy.off("complete",this.handleComplete),this.uppy.off("files-added",this.#generateLargeThumbnailIfSingleFile),this.uppy.off("file-removed",this.#generateLargeThumbnailIfSingleFile),document.removeEventListener("focus",this.recordIfFocusedOnUppyRecently),document.removeEventListener("click",this.recordIfFocusedOnUppyRecently),this.opts.inline&&this.el.removeEventListener("keydown",this.handleKeyDownInInline),this.opts.autoOpen&&this.uppy.off("files-added",this.#openFileEditorWhenFilesAdded)};superFocusOnEachUpdate=()=>{const isFocusInUppy=this.el.contains(document.activeElement),isFocusNowhere=document.activeElement===document.body||null===document.activeElement,isInformerHidden=0===this.uppy.getState().info.length,isModal=!this.opts.inline;isInformerHidden&&(isModal||isFocusInUppy||isFocusNowhere&&this.ifFocusedOnUppyRecently)?this.superFocus(this.el,this.getPluginState().activeOverlayType):this.superFocus.cancel()};afterUpdate=()=>{!this.opts.disabled||this.dashboardIsDisabled?(!this.opts.disabled&&this.dashboardIsDisabled&&this.disableInteractiveElements(!1),this.superFocusOnEachUpdate()):this.disableInteractiveElements(!0)};saveFileCard=(meta,fileID)=>{this.uppy.setFileMeta(fileID,meta),this.toggleFileCard(!1,fileID)};#attachRenderFunctionToTarget=target=>{const plugin=this.uppy.getPlugin(target.id);return{...target,icon:plugin.icon||this.opts.defaultPickerIcon,render:plugin.render}};#isTargetSupported=target=>{const plugin=this.uppy.getPlugin(target.id);return"function"!=typeof plugin.isSupported||plugin.isSupported()};#getAcquirers=targets=>targets.filter(target=>"acquirer"===target.type&&this.#isTargetSupported(target)).map(this.#attachRenderFunctionToTarget);#getProgressIndicators=targets=>targets.filter(target=>"progressindicator"===target.type).map(this.#attachRenderFunctionToTarget);#getEditors=targets=>targets.filter(target=>"editor"===target.type).map(this.#attachRenderFunctionToTarget);render=state=>{const pluginState=this.getPluginState(),{files:files,capabilities:capabilities,allowNewUpload:allowNewUpload}=state,{newFiles:newFiles,uploadStartedFiles:uploadStartedFiles,completeFiles:completeFiles,erroredFiles:erroredFiles,inProgressFiles:inProgressFiles,inProgressNotPausedFiles:inProgressNotPausedFiles,processingFiles:processingFiles,isUploadStarted:isUploadStarted,isAllComplete:isAllComplete,isAllPaused:isAllPaused}=this.uppy.getObjectOfFilesPerState(),acquirers=this.#getAcquirers(pluginState.targets),progressindicators=this.#getProgressIndicators(pluginState.targets),editors=this.#getEditors(pluginState.targets);let theme;return theme="auto"===this.opts.theme?capabilities.darkMode?"dark":"light":this.opts.theme,["files","folders","both"].indexOf(this.opts.fileManagerSelectionType)<0&&(this.opts.fileManagerSelectionType="files",console.warn(`Unsupported option for "fileManagerSelectionType". Using default of "${this.opts.fileManagerSelectionType}".`)),function(props){const isNoFiles=0===props.totalFileCount,isSingleFile=1===props.totalFileCount,isSizeMD=props.containerWidth>576,isSizeHeightMD=props.containerHeight>330,dashboardClassName=classNames({"uppy-Dashboard":!0,"uppy-Dashboard--isDisabled":props.disabled,"uppy-Dashboard--animateOpenClose":props.animateOpenClose,"uppy-Dashboard--isClosing":props.isClosing,"uppy-Dashboard--isDraggingOver":props.isDraggingOver,"uppy-Dashboard--modal":!props.inline,"uppy-size--md":props.containerWidth>576,"uppy-size--lg":props.containerWidth>700,"uppy-size--xl":props.containerWidth>900,"uppy-size--height-md":props.containerHeight>330,"uppy-Dashboard--isAddFilesPanelVisible":props.showAddFilesPanel,"uppy-Dashboard--isInnerWrapVisible":props.areInsidesReadyToBeVisible,"uppy-Dashboard--singleFile":props.singleFileFullScreen&&isSingleFile&&isSizeHeightMD});let itemsPerRow=1;props.containerWidth>900?itemsPerRow=5:props.containerWidth>700?itemsPerRow=4:props.containerWidth>576&&(itemsPerRow=3);const showFileList=props.showSelectedFiles&&!isNoFiles,numberOfFilesForRecovery=props.recoveredState?Object.keys(props.recoveredState.files).length:null,numberOfGhosts=props.files?Object.keys(props.files).filter(fileID=>props.files[fileID].isGhost).length:0;return u$2("div",{className:dashboardClassName,"data-uppy-theme":props.theme,"data-uppy-num-acquirers":props.acquirers.length,"data-uppy-drag-drop-supported":!props.disableLocalFiles&&isDragDropSupported(),"aria-hidden":props.inline?"false":props.isHidden,"aria-disabled":props.disabled,"aria-label":props.inline?props.i18n("dashboardTitle"):props.i18n("dashboardWindowTitle"),onPaste:props.handlePaste,onDragOver:props.handleDragOver,onDragLeave:props.handleDragLeave,onDrop:props.handleDrop,children:[u$2("div",{"aria-hidden":"true",className:"uppy-Dashboard-overlay",tabIndex:-1,onClick:props.handleClickOutside}),u$2("div",{className:"uppy-Dashboard-inner",role:props.inline?void 0:"dialog",style:{width:props.inline&&props.width?props.width:"",height:props.inline&&props.height?props.height:""},children:[props.inline?null:u$2("button",{className:"uppy-u-reset uppy-Dashboard-close",type:"button","aria-label":props.i18n("closeModal"),title:props.i18n("closeModal"),onClick:props.closeModal,children:u$2("span",{"aria-hidden":"true",children:""})}),u$2("div",{className:"uppy-Dashboard-innerWrap",children:[u$2("div",{className:"uppy-Dashboard-dropFilesHereHint",children:props.i18n("dropHint")}),showFileList&&u$2(PanelTopBar,{...props}),numberOfFilesForRecovery&&u$2("div",{className:"uppy-Dashboard-serviceMsg",children:[u$2("svg",{className:"uppy-Dashboard-serviceMsg-icon","aria-hidden":"true",focusable:"false",width:"21",height:"16",viewBox:"0 0 24 19",children:u$2("g",{transform:"translate(0 -1)",fill:"none",fillRule:"evenodd",children:[u$2("path",{d:"M12.857 1.43l10.234 17.056A1 1 0 0122.234 20H1.766a1 1 0 01-.857-1.514L11.143 1.429a1 1 0 011.714 0z",fill:"#FFD300"}),u$2("path",{fill:"#000",d:"M11 6h2l-.3 8h-1.4z"}),u$2("circle",{fill:"#000",cx:"12",cy:"17",r:"1"})]})}),u$2("strong",{className:"uppy-Dashboard-serviceMsg-title",children:props.i18n("sessionRestored")}),u$2("div",{className:"uppy-Dashboard-serviceMsg-text",children:numberOfGhosts>0?props.i18n("recoveredXFiles",{smart_count:numberOfGhosts}):props.i18n("recoveredAllFiles")})]}),showFileList?u$2(FileList,{id:props.id,i18n:props.i18n,uppy:props.uppy,files:props.files,resumableUploads:props.resumableUploads,hideRetryButton:props.hideRetryButton,hidePauseResumeButton:props.hidePauseResumeButton,hideCancelButton:props.hideCancelButton,showLinkToFileUploadResult:props.showLinkToFileUploadResult,showRemoveButtonAfterComplete:props.showRemoveButtonAfterComplete,metaFields:props.metaFields,toggleFileCard:props.toggleFileCard,handleRequestThumbnail:props.handleRequestThumbnail,handleCancelThumbnail:props.handleCancelThumbnail,recoveredState:props.recoveredState,individualCancellation:props.individualCancellation,openFileEditor:props.openFileEditor,canEditFile:props.canEditFile,toggleAddFilesPanel:props.toggleAddFilesPanel,isSingleFile:isSingleFile,itemsPerRow:itemsPerRow,containerWidth:props.containerWidth,containerHeight:props.containerHeight}):u$2(AddFiles,{i18n:props.i18n,i18nArray:props.i18nArray,acquirers:props.acquirers,handleInputChange:props.handleInputChange,maxNumberOfFiles:props.maxNumberOfFiles,allowedFileTypes:props.allowedFileTypes,showNativePhotoCameraButton:props.showNativePhotoCameraButton,showNativeVideoCameraButton:props.showNativeVideoCameraButton,nativeCameraFacingMode:props.nativeCameraFacingMode,showPanel:props.showPanel,activePickerPanel:props.activePickerPanel,disableLocalFiles:props.disableLocalFiles,fileManagerSelectionType:props.fileManagerSelectionType,note:props.note,proudlyDisplayPoweredByUppy:props.proudlyDisplayPoweredByUppy}),u$2(Slide,{children:props.showAddFilesPanel?u$2(AddFilesPanel,{...props,isSizeMD:isSizeMD},"AddFiles"):null}),u$2(Slide,{children:props.fileCardFor?u$2(FileCard,{...props},"FileCard"):null}),u$2(Slide,{children:props.activePickerPanel?u$2(PickerPanelContent,{...props},"Picker"):null}),u$2(Slide,{children:props.showFileEditor?u$2(EditorPanel,{...props},"Editor"):null}),u$2("div",{className:"uppy-Dashboard-progressindicators",children:[!props.disableInformer&&u$2(Informer,{uppy:props.uppy}),!props.disableStatusBar&&u$2(StatusBar,{uppy:props.uppy,i18n:props.i18n,hideProgressDetails:props.hideProgressDetails,hideUploadButton:props.hideUploadButton,hideRetryButton:props.hideRetryButton,hidePauseResumeButton:props.hidePauseResumeButton,hideCancelButton:props.hideCancelButton,hideAfterFinish:props.hideProgressAfterFinish,doneButtonHandler:props.doneButtonHandler}),!props.disableInformer&&u$2(Informer,{uppy:props.uppy}),props.progressindicators.map(target=>props.uppy.getPlugin(target.id).render(props.state))]})]})]})]})}({state:state,isHidden:pluginState.isHidden,files:files,newFiles:newFiles,uploadStartedFiles:uploadStartedFiles,completeFiles:completeFiles,erroredFiles:erroredFiles,inProgressFiles:inProgressFiles,inProgressNotPausedFiles:inProgressNotPausedFiles,processingFiles:processingFiles,isUploadStarted:isUploadStarted,isAllComplete:isAllComplete,isAllPaused:isAllPaused,totalFileCount:Object.keys(files).length,totalProgress:state.totalProgress,allowNewUpload:allowNewUpload,acquirers:acquirers,theme:theme,disabled:this.opts.disabled,disableLocalFiles:this.opts.disableLocalFiles,direction:this.opts.direction,activePickerPanel:pluginState.activePickerPanel,showFileEditor:pluginState.showFileEditor,saveFileEditor:this.saveFileEditor,closeFileEditor:this.closeFileEditor,disableInteractiveElements:this.disableInteractiveElements,animateOpenClose:this.opts.animateOpenClose,isClosing:pluginState.isClosing,progressindicators:progressindicators,editors:editors,autoProceed:this.uppy.opts.autoProceed,id:this.id,closeModal:this.requestCloseModal,handleClickOutside:this.handleClickOutside,handleInputChange:this.handleInputChange,handlePaste:this.handlePaste,inline:this.opts.inline,showPanel:this.showPanel,hideAllPanels:this.hideAllPanels,i18n:this.i18n,i18nArray:this.i18nArray,uppy:this.uppy,note:this.opts.note,recoveredState:state.recoveredState,metaFields:pluginState.metaFields,resumableUploads:capabilities.resumableUploads||!1,individualCancellation:capabilities.individualCancellation,isMobileDevice:capabilities.isMobileDevice,fileCardFor:pluginState.fileCardFor,toggleFileCard:this.toggleFileCard,toggleAddFilesPanel:this.toggleAddFilesPanel,showAddFilesPanel:pluginState.showAddFilesPanel,saveFileCard:this.saveFileCard,openFileEditor:this.openFileEditor,canEditFile:this.canEditFile,width:this.opts.width,height:this.opts.height,showLinkToFileUploadResult:this.opts.showLinkToFileUploadResult,fileManagerSelectionType:this.opts.fileManagerSelectionType,proudlyDisplayPoweredByUppy:this.opts.proudlyDisplayPoweredByUppy,showRemoveButtonAfterComplete:this.opts.showRemoveButtonAfterComplete,containerWidth:pluginState.containerWidth,containerHeight:pluginState.containerHeight,areInsidesReadyToBeVisible:pluginState.areInsidesReadyToBeVisible,parentElement:this.el,allowedFileTypes:this.uppy.opts.restrictions.allowedFileTypes,maxNumberOfFiles:this.uppy.opts.restrictions.maxNumberOfFiles,requiredMetaFields:this.uppy.opts.restrictions.requiredMetaFields,showSelectedFiles:this.opts.showSelectedFiles,showNativePhotoCameraButton:this.opts.showNativePhotoCameraButton,showNativeVideoCameraButton:this.opts.showNativeVideoCameraButton,nativeCameraFacingMode:this.opts.nativeCameraFacingMode,singleFileFullScreen:this.opts.singleFileFullScreen,handleCancelRestore:this.handleCancelRestore,handleRequestThumbnail:this.handleRequestThumbnail,handleCancelThumbnail:this.handleCancelThumbnail,isDraggingOver:pluginState.isDraggingOver,handleDragOver:this.handleDragOver,handleDragLeave:this.handleDragLeave,handleDrop:this.handleDrop,disableInformer:this.opts.disableInformer,disableStatusBar:this.opts.disableStatusBar,hideProgressDetails:this.opts.hideProgressDetails,hideUploadButton:this.opts.hideUploadButton,hideRetryButton:this.opts.hideRetryButton,hidePauseResumeButton:this.opts.hidePauseResumeButton,hideCancelButton:this.opts.hideCancelButton,hideProgressAfterFinish:this.opts.hideProgressAfterFinish,doneButtonHandler:this.opts.doneButtonHandler})};#addSpecifiedPluginsFromOptions=()=>{const{plugins:plugins}=this.opts;plugins.forEach(pluginID=>{const plugin=this.uppy.getPlugin(pluginID);plugin?plugin.mount(this,plugin):this.uppy.log(`[Uppy] Dashboard could not find plugin '${pluginID}', make sure to uppy.use() the plugins you are specifying`,"warning")})};#autoDiscoverPlugins=()=>{this.uppy.iteratePlugins(this.#addSupportedPluginIfNoTarget)};#addSupportedPluginIfNoTarget=plugin=>{if(plugin&&!plugin.opts?.target&&["acquirer","editor"].includes(plugin.type)){this.getPluginState().targets.some(installedPlugin=>plugin.id===installedPlugin.id)||plugin.mount(this,plugin)}};#getThumbnailGeneratorOpts(){const{thumbnailWidth:thumbnailWidth,thumbnailHeight:thumbnailHeight,thumbnailType:thumbnailType,waitForThumbnailsBeforeUpload:waitForThumbnailsBeforeUpload}=this.opts;return{thumbnailWidth:thumbnailWidth,thumbnailHeight:thumbnailHeight,thumbnailType:thumbnailType,waitForThumbnailsBeforeUpload:waitForThumbnailsBeforeUpload,lazy:!waitForThumbnailsBeforeUpload}}setOptions(opts){super.setOptions(opts),this.uppy.getPlugin(this.#getThumbnailGeneratorId())?.setOptions(this.#getThumbnailGeneratorOpts())}#getThumbnailGeneratorId(){return`${this.id}:ThumbnailGenerator`}install=()=>{this.setPluginState({isHidden:!0,fileCardFor:null,activeOverlayType:null,showAddFilesPanel:!1,activePickerPanel:void 0,showFileEditor:!1,metaFields:this.opts.metaFields,targets:[],areInsidesReadyToBeVisible:!1,isDraggingOver:!1});const{inline:inline,closeAfterFinish:closeAfterFinish}=this.opts;if(inline&&closeAfterFinish)throw new Error("[Dashboard] `closeAfterFinish: true` cannot be used on an inline Dashboard, because an inline Dashboard cannot be closed at all. Either set `inline: false`, or disable the `closeAfterFinish` option.");const{allowMultipleUploads:allowMultipleUploads,allowMultipleUploadBatches:allowMultipleUploadBatches}=this.uppy.opts;(allowMultipleUploads||allowMultipleUploadBatches)&&closeAfterFinish&&this.uppy.log("[Dashboard] When using `closeAfterFinish`, we recommended setting the `allowMultipleUploadBatches` option to `false` in the Uppy constructor. See https://uppy.io/docs/uppy/#allowMultipleUploads-true","warning");const{target:target}=this.opts;target&&this.mount(target,this),this.opts.disableThumbnailGenerator||this.uppy.use(ThumbnailGenerator,{id:this.#getThumbnailGeneratorId(),...this.#getThumbnailGeneratorOpts()}),this.darkModeMediaQuery="undefined"!=typeof window&&window.matchMedia?window.matchMedia("(prefers-color-scheme: dark)"):null;const isDarkModeOnFromTheStart=!!this.darkModeMediaQuery&&this.darkModeMediaQuery.matches;this.uppy.log("[Dashboard] Dark mode is "+(isDarkModeOnFromTheStart?"on":"off")),this.setDarkModeCapability(isDarkModeOnFromTheStart),"auto"===this.opts.theme&&this.darkModeMediaQuery?.addListener(this.handleSystemDarkModeChange),this.#addSpecifiedPluginsFromOptions(),this.#autoDiscoverPlugins(),this.initEvents()};uninstall=()=>{if(!this.opts.disableThumbnailGenerator){const thumbnail=this.uppy.getPlugin(`${this.id}:ThumbnailGenerator`);thumbnail&&this.uppy.removePlugin(thumbnail)}const{plugins:plugins}=this.opts;plugins.forEach(pluginID=>{const plugin=this.uppy.getPlugin(pluginID);plugin&&plugin.unmount()}),"auto"===this.opts.theme&&this.darkModeMediaQuery?.removeListener(this.handleSystemDarkModeChange),this.opts.disablePageScrollWhenModalOpen&&document.body.classList.remove("uppy-Dashboard-isFixed"),this.unmount(),this.removeEvents()}}var packageJson$7_version="5.0.1";function getFingerprint(uppyFile){return(file,options)=>{if("undefined"!=typeof window&&(void 0!==window.PhoneGap||void 0!==window.Cordova||void 0!==window.cordova)||"undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase())return defaultOptions$8.fingerprint(file,options);const uppyFingerprint=["tus",uppyFile.id,options.endpoint].join("-");return Promise.resolve(uppyFingerprint)}}const tusDefaultOptions={endpoint:"",uploadUrl:null,metadata:{},uploadSize:null,onProgress:null,onChunkComplete:null,onSuccess:null,onError:null,overridePatchMethod:!1,headers:{},addRequestId:!1,chunkSize:1/0,retryDelays:[100,1e3,3e3,5e3],parallelUploads:1,removeFingerprintOnSuccess:!1,uploadLengthDeferred:!1,uploadDataDuringCreation:!1},defaultOptions$4={limit:20,retryDelays:tusDefaultOptions.retryDelays,withCredentials:!1,allowedMetaFields:!0};class Tus extends BasePlugin{static VERSION=packageJson$7_version;#retryDelayIterator;requests;uploaders;uploaderEvents;constructor(uppy,opts){if(super(uppy,{...defaultOptions$4,...opts}),this.type="uploader",this.id=this.opts.id||"Tus",void 0===opts?.allowedMetaFields&&"metaFields"in this.opts)throw new Error("The `metaFields` option has been renamed to `allowedMetaFields`.");if("autoRetry"in opts)throw new Error("The `autoRetry` option was deprecated and has been removed.");this.requests=this.opts.rateLimitedQueue??new RateLimitedQueue(this.opts.limit),this.#retryDelayIterator=this.opts.retryDelays?.values(),this.uploaders=Object.create(null),this.uploaderEvents=Object.create(null)}resetUploaderReferences(fileID,opts){const uploader=this.uploaders[fileID];uploader&&(uploader.abort(),opts?.abort&&uploader.abort(!0),this.uploaders[fileID]=null),this.uploaderEvents[fileID]&&(this.uploaderEvents[fileID].remove(),this.uploaderEvents[fileID]=null)}#uploadLocalFile(file){return this.resetUploaderReferences(file.id),new Promise((resolve,reject)=>{let queuedRequest,qRequest,upload;const opts={...this.opts,...file.tus||{}};"function"==typeof opts.headers&&(opts.headers=opts.headers(file));const{onShouldRetry:onShouldRetry,onBeforeRequest:onBeforeRequest,...commonOpts}=opts,uploadOptions={...tusDefaultOptions,...commonOpts};uploadOptions.fingerprint=getFingerprint(file),uploadOptions.onBeforeRequest=async req=>{let userProvidedPromise;if(req.getUnderlyingObject().withCredentials=!!opts.withCredentials,"function"==typeof onBeforeRequest&&(userProvidedPromise=onBeforeRequest(req,file)),hasProperty(queuedRequest,"shouldBeRequeued")){if(!queuedRequest.shouldBeRequeued)return Promise.reject();let done;const p=new Promise(res=>{done=res});return queuedRequest=this.requests.run(()=>(file.isPaused&&queuedRequest.abort(),done(),()=>{})),void await Promise.all([p,userProvidedPromise])}return userProvidedPromise},uploadOptions.onError=err=>{this.uppy.log(err);const xhr=null!=err.originalRequest?err.originalRequest.getUnderlyingObject():null;(function(xhr){return!!xhr&&(0!==xhr.readyState&&4!==xhr.readyState||0===xhr.status)})(xhr)&&(err=new NetworkError(err,xhr)),this.resetUploaderReferences(file.id),queuedRequest?.abort(),"function"==typeof opts.onError&&opts.onError(err),reject(err)},uploadOptions.onProgress=(bytesUploaded,bytesTotal)=>{this.onReceiveUploadUrl(file,upload.url),"function"==typeof opts.onProgress&&opts.onProgress(bytesUploaded,bytesTotal);const latestFile=this.uppy.getFile(file.id);this.uppy.emit("upload-progress",latestFile,{uploadStarted:latestFile.progress.uploadStarted??0,bytesUploaded:bytesUploaded,bytesTotal:bytesTotal})},uploadOptions.onSuccess=payload=>{const uploadResp={uploadURL:upload.url??void 0,status:200,body:{xhr:payload.lastResponse.getUnderlyingObject()}};if(this.uppy.emit("upload-success",this.uppy.getFile(file.id),uploadResp),this.resetUploaderReferences(file.id),queuedRequest.done(),upload.url){const{name:name}=upload.file;this.uppy.log(`Download ${name} from ${upload.url}`)}"function"==typeof opts.onSuccess&&opts.onSuccess(payload),resolve(upload)};const defaultOnShouldRetry=err=>{const status=err?.originalResponse?.getStatus();if(429===status){if(!this.requests.isPaused){const next=this.#retryDelayIterator?.next();if(null==next||next.done)return!1;this.requests.rateLimit(next.value)}}else{if(null!=status&&status>=400&&status<500&&409!==status&&423!==status)return!1;"undefined"!=typeof navigator&&!1===navigator.onLine&&(this.requests.isPaused||(this.requests.pause(),window.addEventListener("online",()=>{this.requests.resume()},{once:!0})))}return queuedRequest.abort(),queuedRequest={shouldBeRequeued:!0,abort(){this.shouldBeRequeued=!1},done(){throw new Error("Cannot mark a queued request as done: this indicates a bug")},fn(){throw new Error("Cannot run a queued request: this indicates a bug")}},!0};uploadOptions.onShouldRetry=null!=onShouldRetry?(error,retryAttempt)=>onShouldRetry(error,retryAttempt,opts,defaultOnShouldRetry):defaultOnShouldRetry;const copyProp=(obj,srcProp,destProp)=>{hasProperty(obj,srcProp)&&!hasProperty(obj,destProp)&&(obj[destProp]=obj[srcProp])},meta={},allowedMetaFields=function(fields,meta){return!0===fields?Object.keys(meta):Array.isArray(fields)?fields:[]}(opts.allowedMetaFields,file.meta);allowedMetaFields.forEach(item=>{meta[item]=String(file.meta[item])}),copyProp(meta,"type","filetype"),copyProp(meta,"name","filename"),uploadOptions.metadata=meta,upload=new Upload(file.data,uploadOptions),this.uploaders[file.id]=upload;const eventManager=new EventManager(this.uppy);this.uploaderEvents[file.id]=eventManager,qRequest=()=>(file.isPaused||upload.start(),()=>{}),upload.findPreviousUploads().then(previousUploads=>{const previousUpload=previousUploads[0];previousUpload&&(this.uppy.log(`[Tus] Resuming upload of ${file.id} started at ${previousUpload.creationTime}`),upload.resumeFromPreviousUpload(previousUpload)),queuedRequest=this.requests.run(qRequest)}),eventManager.onFileRemove(file.id,targetFileID=>{queuedRequest.abort(),this.resetUploaderReferences(file.id,{abort:!!upload.url}),resolve(`upload ${targetFileID} was removed`)}),eventManager.onPause(file.id,isPaused=>{queuedRequest.abort(),isPaused?upload.abort():queuedRequest=this.requests.run(qRequest)}),eventManager.onPauseAll(file.id,()=>{queuedRequest.abort(),upload.abort()}),eventManager.onCancelAll(file.id,()=>{queuedRequest.abort(),this.resetUploaderReferences(file.id,{abort:!!upload.url}),resolve(`upload ${file.id} was canceled`)}),eventManager.onResumeAll(file.id,()=>{queuedRequest.abort(),file.error&&upload.abort(),queuedRequest=this.requests.run(qRequest)})}).catch(err=>{throw this.uppy.emit("upload-error",file,err),err})}onReceiveUploadUrl(file,uploadURL){const currentFile=this.uppy.getFile(file.id);currentFile&&(currentFile.tus&&currentFile.tus.uploadUrl===uploadURL||(this.uppy.log("[Tus] Storing upload url"),this.uppy.setFileState(currentFile.id,{tus:{...currentFile.tus,uploadUrl:uploadURL}})))}#getCompanionClientArgs(file){const opts={...this.opts};return file.tus&&Object.assign(opts,file.tus),"function"==typeof opts.headers&&(opts.headers=opts.headers(file)),{...file.remote?.body,endpoint:opts.endpoint,uploadUrl:opts.uploadUrl,protocol:"tus",size:file.data.size,headers:opts.headers,metadata:file.meta}}async#uploadFiles(files){const filesFiltered=function(files){return files.filter(file=>!(file=>"error"in file&&!!file.error)(file))}(files),filesToEmit=function(files){return files.filter(file=>!file.progress?.uploadStarted||!file.isRestored)}(filesFiltered);this.uppy.emit("upload-start",filesToEmit),await Promise.allSettled(filesFiltered.map(file=>{if(file.isRemote){const getQueue=()=>this.requests,controller=new AbortController,removedHandler=removedFile=>{removedFile.id===file.id&&controller.abort()};this.uppy.on("file-removed",removedHandler);const uploadPromise=this.uppy.getRequestClientForFile(file).uploadRemoteFile(file,this.#getCompanionClientArgs(file),{signal:controller.signal,getQueue:getQueue});return this.requests.wrapSyncFunction(()=>{this.uppy.off("file-removed",removedHandler)},{priority:-1})(),uploadPromise}return this.#uploadLocalFile(file)}))}#handleUpload=async fileIDs=>{if(0===fileIDs.length)return void this.uppy.log("[Tus] No files to upload");0===this.opts.limit&&this.uppy.log("[Tus] When uploading multiple files at once, consider setting the `limit` option (to `10` for example), to limit the number of concurrent uploads, which helps prevent memory and network issues: https://uppy.io/docs/tus/#limit-0","warning"),this.uppy.log("[Tus] Uploading...");const filesToUpload=this.uppy.getFilesByIds(fileIDs);await this.#uploadFiles(filesToUpload)};install(){this.uppy.setState({capabilities:{...this.uppy.getState().capabilities,resumableUploads:!0}}),this.uppy.addUploader(this.#handleUpload)}uninstall(){this.uppy.setState({capabilities:{...this.uppy.getState().capabilities,resumableUploads:!1}}),this.uppy.removeUploader(this.#handleUpload)}}var packageJson$6_version="5.1.0";const indexedDB="undefined"!=typeof window&&(window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.OIndexedDB||window.msIndexedDB),isSupported$1=!!indexedDB;function connect(dbName){const request=indexedDB.open(dbName,3);return new Promise((resolve,reject)=>{request.onupgradeneeded=event=>{const db=event.target.result,transaction=event.currentTarget.transaction;if(event.oldVersion<2){db.createObjectStore("files",{keyPath:"id"}).createIndex("store","store",{unique:!1})}if(event.oldVersion<3){const store=transaction.objectStore("files");store.createIndex("expires","expires",{unique:!1}),function(store){store.openCursor().onsuccess=event=>{const cursor=event.target.result;if(!cursor)return;const entry=cursor.value;entry.expires=Date.now()+864e5,cursor.update(entry)}}(store)}transaction.oncomplete=()=>{resolve(db)}},request.onsuccess=event=>{resolve(event.target.result)},request.onerror=reject})}function waitForRequest(request){return new Promise((resolve,reject)=>{request.onsuccess=event=>{resolve(event.target.result)},request.onerror=reject})}let cleanedUp$1=!1;class IndexedDBStore{#ready;opts;name;static isSupported;constructor(opts){this.opts={dbName:"uppy-blobs",storeName:"default",expires:864e5,maxFileSize:10485760,maxTotalSize:314572800,...opts},this.name=this.opts.storeName;const createConnection=async()=>{const db=await connect(this.opts.dbName);return this.#ready=db,db};cleanedUp$1?this.#ready=createConnection():(cleanedUp$1=!0,this.#ready=IndexedDBStore.cleanup().then(createConnection,createConnection))}get ready(){return Promise.resolve(this.#ready)}key(fileID){return`${this.name}!${fileID}`}async list(){const request=(await this.#ready).transaction(["files"],"readonly").objectStore("files").index("store").getAll(IDBKeyRange.only(this.name)),files=await waitForRequest(request);return Object.fromEntries(files.map(file=>[file.fileID,file.data]))}async get(fileID){const request=(await this.#ready).transaction(["files"],"readonly").objectStore("files").get(this.key(fileID)),{data:data}=await waitForRequest(request);return{id:data.fileID,data:data.data}}async getSize(){const request=(await this.#ready).transaction(["files"],"readonly").objectStore("files").index("store").openCursor(IDBKeyRange.only(this.name));return new Promise((resolve,reject)=>{let size=0;request.onsuccess=event=>{const cursor=event.target.result;cursor?(size+=cursor.value.data.size,cursor.continue()):resolve(size)},request.onerror=()=>{reject(new Error("Could not retrieve stored blobs size"))}})}async put(file){if(file.data.size>this.opts.maxFileSize)throw new Error("File is too big to store.");if(await this.getSize()>this.opts.maxTotalSize)throw new Error("No space left");return waitForRequest((await this.#ready).transaction(["files"],"readwrite").objectStore("files").add({id:this.key(file.id),fileID:file.id,store:this.name,expires:Date.now()+this.opts.expires,data:file.data}))}async delete(fileID){return waitForRequest((await this.#ready).transaction(["files"],"readwrite").objectStore("files").delete(this.key(fileID)))}static async cleanup(){const db=await connect("uppy-blobs"),request=db.transaction(["files"],"readwrite").objectStore("files").index("expires").openCursor(IDBKeyRange.upperBound(Date.now()));await new Promise((resolve,reject)=>{request.onsuccess=event=>{const cursor=event.target.result;cursor?(cursor.delete(),cursor.continue()):resolve()},request.onerror=reject}),db.close()}}function maybeParse(str){try{return JSON.parse(str)}catch{return null}}IndexedDBStore.isSupported=isSupported$1;let cleanedUp=!1;class MetaDataStore{opts;name;constructor(opts){this.opts={expires:864e5,...opts},this.name=`uppyState:${opts.storeName}`,cleanedUp||(cleanedUp=!0,MetaDataStore.cleanup())}load(){const savedState=localStorage.getItem(this.name);if(!savedState)return null;const data=maybeParse(savedState);return data?data.metadata:null}save(metadata){const expires=Date.now()+this.opts.expires,state=JSON.stringify({metadata:metadata,expires:expires});localStorage.setItem(this.name,state)}static cleanup(instanceID){if(instanceID)return void localStorage.removeItem(`uppyState:${instanceID}`);const instanceIDs=function(){const instances=[];for(let i=0;i<localStorage.length;i++){const key=localStorage.key(i);key?.startsWith("uppyState:")&&instances.push(key.slice(10))}return instances}(),now=Date.now();instanceIDs.forEach(id=>{const data=localStorage.getItem(`uppyState:${id}`);if(!data)return;const obj=maybeParse(data);obj&&obj.expires&&obj.expires<now&&localStorage.removeItem(`uppyState:${id}`)})}}const isSupported="undefined"!=typeof navigator&&"serviceWorker"in navigator;class ServiceWorkerStore{#ready;name;static isSupported;constructor(opts){this.#ready=new Promise((resolve,reject)=>{isSupported?navigator.serviceWorker.controller?resolve():navigator.serviceWorker.addEventListener("controllerchange",()=>{resolve()}):reject(new Error("Unsupported"))}).then(val=>{this.#ready=val}),this.name=opts.storeName}get ready(){return Promise.resolve(this.#ready)}async list(){return await this.#ready,new Promise((resolve,reject)=>{const onMessage=event=>{if(event.data.store===this.name)if("uppy/ALL_FILES"===event.data.type)resolve(event.data.files),navigator.serviceWorker.removeEventListener("message",onMessage);else reject()};navigator.serviceWorker.addEventListener("message",onMessage),navigator.serviceWorker.controller.postMessage({type:"uppy/GET_FILES",store:this.name})})}async put(file){await this.#ready,navigator.serviceWorker.controller.postMessage({type:"uppy/ADD_FILE",store:this.name,file:file})}async delete(fileID){await this.#ready,navigator.serviceWorker.controller.postMessage({type:"uppy/REMOVE_FILE",store:this.name,fileID:fileID})}}ServiceWorkerStore.isSupported=isSupported;const defaultOptions$3={expires:864e5,serviceWorker:!1};class GoldenRetriever extends BasePlugin{static VERSION=packageJson$6_version;MetaDataStore;ServiceWorkerStore;IndexedDBStore;savedPluginData;constructor(uppy,opts){super(uppy,{...defaultOptions$3,...opts}),this.type="debugger",this.id=this.opts.id||"GoldenRetriever",this.MetaDataStore=new MetaDataStore({expires:this.opts.expires,storeName:uppy.getID()}),this.ServiceWorkerStore=null,this.opts.serviceWorker&&(this.ServiceWorkerStore=new ServiceWorkerStore({storeName:uppy.getID()})),this.IndexedDBStore=new IndexedDBStore({expires:this.opts.expires,...this.opts.indexedDB||{},storeName:uppy.getID()}),this.saveFilesStateToLocalStorage=throttle$1(this.saveFilesStateToLocalStorage.bind(this),500,{leading:!0,trailing:!0}),this.restoreState=this.restoreState.bind(this),this.loadFileBlobsFromServiceWorker=this.loadFileBlobsFromServiceWorker.bind(this),this.loadFileBlobsFromIndexedDB=this.loadFileBlobsFromIndexedDB.bind(this),this.onBlobsLoaded=this.onBlobsLoaded.bind(this)}restoreState(){const savedState=this.MetaDataStore.load();savedState&&(this.uppy.log("[GoldenRetriever] Recovered some state from Local Storage"),this.uppy.setState({currentUploads:savedState.currentUploads||{},files:savedState.files||{},recoveredState:savedState}),this.savedPluginData=savedState.pluginData)}saveFilesStateToLocalStorage(){const allFiles=[...this.uppy.getFiles().filter(file=>!file.progress||!file.progress.uploadStarted),...Object.values(this.uppy.getState().currentUploads).map(currentUpload=>currentUpload.fileIDs.map(fileID=>{const file=this.uppy.getFile(fileID);return null!=file?[file]:[]})).flat(2)],fileToSave=Object.values(Object.fromEntries(allFiles.map(file=>[file.id,file])));if(0===fileToSave.length)return null!==this.uppy.getState().recoveredState&&this.uppy.setState({recoveredState:null}),void MetaDataStore.cleanup(this.uppy.opts.id);const filesToSaveWithoutData=Object.fromEntries(fileToSave.map(fileInfo=>[fileInfo.id,fileInfo.isRemote?{...fileInfo,isRestored:!0}:{...fileInfo,isRestored:!0,data:null,preview:null}])),pluginData={};this.uppy.emit("restore:get-data",data=>{Object.assign(pluginData,data)});const{currentUploads:currentUploads}=this.uppy.getState();this.MetaDataStore.save({currentUploads:currentUploads,files:filesToSaveWithoutData,pluginData:pluginData})}loadFileBlobsFromServiceWorker(){return this.ServiceWorkerStore?this.ServiceWorkerStore.list().then(blobs=>{const numberOfFilesRecovered=Object.keys(blobs).length;return numberOfFilesRecovered>0?(this.uppy.log(`[GoldenRetriever] Successfully recovered ${numberOfFilesRecovered} blobs from Service Worker!`),blobs):(this.uppy.log("[GoldenRetriever] No blobs found in Service Worker, trying IndexedDB now..."),{})}).catch(err=>(this.uppy.log("[GoldenRetriever] Failed to recover blobs from Service Worker","warning"),this.uppy.log(err),{})):Promise.resolve({})}loadFileBlobsFromIndexedDB(){return this.IndexedDBStore.list().then(blobs=>{const numberOfFilesRecovered=Object.keys(blobs).length;return numberOfFilesRecovered>0?(this.uppy.log(`[GoldenRetriever] Successfully recovered ${numberOfFilesRecovered} blobs from IndexedDB!`),blobs):(this.uppy.log("[GoldenRetriever] No blobs found in IndexedDB"),{})}).catch(err=>(this.uppy.log("[GoldenRetriever] Failed to recover blobs from IndexedDB","warning"),this.uppy.log(err),{}))}onBlobsLoaded(blobs){const obsoleteBlobs=[],updatedFiles={...this.uppy.getState().files};Object.keys(blobs).forEach(fileID=>{const originalFile=this.uppy.getFile(fileID);if(!originalFile)return void obsoleteBlobs.push(fileID);const updatedFileData={data:blobs[fileID],isRestored:!0,isGhost:!1};updatedFiles[fileID]={...originalFile,...updatedFileData}}),Object.keys(updatedFiles).forEach(fileID=>{null===updatedFiles[fileID].data&&(updatedFiles[fileID]={...updatedFiles[fileID],isGhost:!0})}),this.uppy.setState({files:updatedFiles}),this.uppy.emit("restored",this.savedPluginData),obsoleteBlobs.length&&this.deleteBlobs(obsoleteBlobs).then(()=>{this.uppy.log(`[GoldenRetriever] Cleaned up ${obsoleteBlobs.length} old files`)}).catch(err=>{this.uppy.log(`[GoldenRetriever] Could not clean up ${obsoleteBlobs.length} old files`,"warning"),this.uppy.log(err)})}async deleteBlobs(fileIDs){await Promise.all(fileIDs.map(id=>this.ServiceWorkerStore?.delete(id)??this.IndexedDBStore?.delete(id)))}addBlobToStores=file=>{file.isRemote||(this.ServiceWorkerStore&&this.ServiceWorkerStore.put(file).catch(err=>{this.uppy.log("[GoldenRetriever] Could not store file","warning"),this.uppy.log(err)}),this.IndexedDBStore.put(file).catch(err=>{this.uppy.log("[GoldenRetriever] Could not store file","warning"),this.uppy.log(err)}))};removeBlobFromStores=file=>{this.ServiceWorkerStore&&this.ServiceWorkerStore.delete(file.id).catch(err=>{this.uppy.log("[GoldenRetriever] Failed to remove file","warning"),this.uppy.log(err)}),this.IndexedDBStore.delete(file.id).catch(err=>{this.uppy.log("[GoldenRetriever] Failed to remove file","warning"),this.uppy.log(err)})};replaceBlobInStores=file=>{this.removeBlobFromStores(file),this.addBlobToStores(file)};handleRestoreConfirmed=()=>{this.uppy.log("[GoldenRetriever] Restore confirmed, proceeding...");const{currentUploads:currentUploads}=this.uppy.getState();currentUploads&&(this.uppy.resumeAll(),Object.keys(currentUploads).forEach(uploadId=>{this.uppy.restore(uploadId)})),this.uppy.setState({recoveredState:null})};abortRestore=()=>{this.uppy.log("[GoldenRetriever] Aborting restore...");const fileIDs=Object.keys(this.uppy.getState().files);this.deleteBlobs(fileIDs).then(()=>{this.uppy.log(`[GoldenRetriever] Removed ${fileIDs.length} files`)}).catch(err=>{this.uppy.log(`[GoldenRetriever] Could not remove ${fileIDs.length} files`,"warning"),this.uppy.log(err)}),this.uppy.cancelAll(),this.uppy.setState({recoveredState:null}),MetaDataStore.cleanup(this.uppy.opts.id)};handleComplete=({successful:successful})=>{const fileIDs=successful.map(file=>file.id);this.deleteBlobs(fileIDs).then(()=>{this.uppy.log(`[GoldenRetriever] Removed ${successful.length} files that finished uploading`)}).catch(err=>{this.uppy.log(`[GoldenRetriever] Could not remove ${successful.length} files that finished uploading`,"warning"),this.uppy.log(err)}),this.uppy.setState({recoveredState:null}),MetaDataStore.cleanup(this.uppy.opts.id)};restoreBlobs=()=>{this.uppy.getFiles().length>0?Promise.all([this.loadFileBlobsFromServiceWorker(),this.loadFileBlobsFromIndexedDB()]).then(resultingArrayOfObjects=>{const blobs={...resultingArrayOfObjects[0],...resultingArrayOfObjects[1]};this.onBlobsLoaded(blobs)}):this.uppy.log("[GoldenRetriever] No files need to be loaded, only restoring processing state...")};install(){this.restoreState(),this.restoreBlobs(),this.uppy.on("file-added",this.addBlobToStores),this.uppy.on("file-editor:complete",this.replaceBlobInStores),this.uppy.on("file-removed",this.removeBlobFromStores),this.uppy.on("state-update",this.saveFilesStateToLocalStorage),this.uppy.on("restore-confirmed",this.handleRestoreConfirmed),this.uppy.on("restore-canceled",this.abortRestore),this.uppy.on("complete",this.handleComplete)}uninstall(){this.uppy.off("file-added",this.addBlobToStores),this.uppy.off("file-editor:complete",this.replaceBlobInStores),this.uppy.off("file-removed",this.removeBlobFromStores),this.uppy.off("state-update",this.saveFilesStateToLocalStorage),this.uppy.off("restore-confirmed",this.handleRestoreConfirmed),this.uppy.off("restore-canceled",this.abortRestore),this.uppy.off("complete",this.handleComplete)}}var isMobile$1={exports:{}};isMobile$1.exports=isMobile;var isMobile_2=isMobile$1.exports.isMobile=isMobile;isMobile$1.exports.default=isMobile;const mobileRE=/(android|bb\d+|meego).+mobile|armv7l|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series[46]0|samsungbrowser.*mobile|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i,notMobileRE=/CrOS/,tabletRE=/android|ipad|playbook|silk/i;function isMobile(opts){opts||(opts={});let ua=opts.ua;if(ua||"undefined"==typeof navigator||(ua=navigator.userAgent),ua&&ua.headers&&"string"==typeof ua.headers["user-agent"]&&(ua=ua.headers["user-agent"]),"string"!=typeof ua)return!1;let result=mobileRE.test(ua)&&!notMobileRE.test(ua)||!!opts.tablet&&tabletRE.test(ua);return!result&&opts.tablet&&opts.featureDetect&&navigator&&navigator.maxTouchPoints>1&&-1!==ua.indexOf("Macintosh")&&-1!==ua.indexOf("Safari")&&(result=!0),result}var packageJson$5_version="5.0.1";function CameraIcon(){return u$2("svg",{"aria-hidden":"true",focusable:"false",fill:"#0097DC",width:"66",height:"55",viewBox:"0 0 66 55",children:u$2("path",{d:"M57.3 8.433c4.59 0 8.1 3.51 8.1 8.1v29.7c0 4.59-3.51 8.1-8.1 8.1H8.7c-4.59 0-8.1-3.51-8.1-8.1v-29.7c0-4.59 3.51-8.1 8.1-8.1h9.45l4.59-7.02c.54-.54 1.35-1.08 2.16-1.08h16.2c.81 0 1.62.54 2.16 1.08l4.59 7.02h9.45zM33 14.64c-8.62 0-15.393 6.773-15.393 15.393 0 8.62 6.773 15.393 15.393 15.393 8.62 0 15.393-6.773 15.393-15.393 0-8.62-6.773-15.393-15.393-15.393zM33 40c-5.648 0-9.966-4.319-9.966-9.967 0-5.647 4.318-9.966 9.966-9.966s9.966 4.319 9.966 9.966C42.966 35.681 38.648 40 33 40z",fillRule:"evenodd"})})}function DiscardButton$2({onDiscard:onDiscard,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button uppy-Webcam-button--discard",type:"button",title:i18n("discardRecordedFile"),"aria-label":i18n("discardRecordedFile"),onClick:onDiscard,"data-uppy-super-focusable":!0,children:u$2("svg",{width:"13",height:"13",viewBox:"0 0 13 13",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon",children:u$2("g",{fill:"#FFF",fillRule:"evenodd",children:[u$2("path",{d:"M.496 11.367L11.103.76l1.414 1.414L1.911 12.781z"}),u$2("path",{d:"M11.104 12.782L.497 2.175 1.911.76l10.607 10.606z"})]})})})}function RecordButton$2({recording:recording,onStartRecording:onStartRecording,onStopRecording:onStopRecording,i18n:i18n}){return u$2("button",recording?{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button",type:"button",title:i18n("stopRecording"),"aria-label":i18n("stopRecording"),onClick:onStopRecording,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100",children:u$2("rect",{x:"15",y:"15",width:"70",height:"70"})})}:{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button",type:"button",title:i18n("startRecording"),"aria-label":i18n("startRecording"),onClick:onStartRecording,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100",children:u$2("circle",{cx:"50",cy:"50",r:"40"})})})}function RecordingLength$1({recordingLengthSeconds:recordingLengthSeconds}){var seconds;return u$2("span",{children:(seconds=recordingLengthSeconds,`${Math.floor(seconds/60)}:${String(seconds%60).padStart(2,"0")}`)})}function SnapshotButton({onSnapshot:onSnapshot,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button uppy-Webcam-button--picture",type:"button",title:i18n("takePicture"),"aria-label":i18n("takePicture"),onClick:onSnapshot,"data-uppy-super-focusable":!0,children:CameraIcon()})}function SubmitButton$2({onSubmit:onSubmit,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Webcam-button uppy-Webcam-button--submit",type:"button",title:i18n("submitRecordedFile"),"aria-label":i18n("submitRecordedFile"),onClick:onSubmit,"data-uppy-super-focusable":!0,children:u$2("svg",{width:"12",height:"9",viewBox:"0 0 12 9",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon",children:u$2("path",{fill:"#fff",fillRule:"nonzero",d:"M10.66 0L12 1.31 4.136 9 0 4.956l1.34-1.31L4.136 6.38z"})})})}function VideoSourceSelect({currentDeviceId:currentDeviceId,videoSources:videoSources,onChangeVideoSource:onChangeVideoSource}){return u$2("div",{className:"uppy-Webcam-videoSource",children:u$2("select",{className:"uppy-u-reset uppy-Webcam-videoSource-select",onChange:event=>{onChangeVideoSource(event.target.value)},children:videoSources.map(videoSource=>u$2("option",{value:videoSource.deviceId,selected:videoSource.deviceId===currentDeviceId,children:videoSource.label},videoSource.deviceId))})})}function isModeAvailable$1(modes,mode){return modes.includes(mode)}class CameraScreen extends x{videoElement;refs;componentDidMount(){const{onFocus:onFocus}=this.props;onFocus()}componentWillUnmount(){const{onStop:onStop}=this.props;onStop()}render(){const{src:src,recordedVideo:recordedVideo,capturedSnapshot:capturedSnapshot,recording:recording,modes:modes,supportsRecording:supportsRecording,videoSources:videoSources,showVideoSourceDropdown:showVideoSourceDropdown,showRecordingLength:showRecordingLength,onSubmit:onSubmit,i18n:i18n,mirror:mirror,onSnapshot:onSnapshot,onStartRecording:onStartRecording,onStopRecording:onStopRecording,onDiscardRecordedMedia:onDiscardRecordedMedia,recordingLengthSeconds:recordingLengthSeconds}=this.props,hasRecordedVideo=!!recordedVideo,hasCapturedSnapshot=!!capturedSnapshot,hasRecordedMedia=hasRecordedVideo||hasCapturedSnapshot,shouldShowRecordButton=!hasRecordedMedia&&supportsRecording&&(isModeAvailable$1(modes,"video-only")||isModeAvailable$1(modes,"audio-only")||isModeAvailable$1(modes,"video-audio")),shouldShowSnapshotButton=!hasRecordedMedia&&isModeAvailable$1(modes,"picture"),shouldShowRecordingLength=supportsRecording&&showRecordingLength&&!hasRecordedVideo,shouldShowVideoSourceDropdown=showVideoSourceDropdown&&videoSources&&videoSources.length>1,videoProps={playsInline:!0};return recordedVideo?(videoProps.muted=!1,videoProps.controls=!0,videoProps.src=recordedVideo,this.videoElement&&(this.videoElement.srcObject=null)):(videoProps.muted=!0,videoProps.autoPlay=!0,videoProps.srcObject=src),u$2("div",{className:"uppy uppy-Webcam-container",children:[u$2("div",{className:"uppy-Webcam-videoContainer",children:!capturedSnapshot||recording||recordedVideo?u$2("video",{ref:videoElement=>{this.videoElement=videoElement},className:"uppy-Webcam-video  "+(mirror?"uppy-Webcam-video--mirrored":""),...videoProps}):u$2("div",{className:"uppy-Webcam-imageContainer",children:u$2("img",{src:capturedSnapshot,className:"uppy-Webcam-video",alt:"capturedSnapshot"})})}),u$2("div",{className:"uppy-Webcam-footer",children:[u$2("div",{className:"uppy-Webcam-videoSourceContainer",children:shouldShowVideoSourceDropdown?VideoSourceSelect(this.props):null}),u$2("div",{className:"uppy-Webcam-buttonContainer",children:[shouldShowSnapshotButton&&u$2(SnapshotButton,{onSnapshot:onSnapshot,i18n:i18n}),shouldShowRecordButton&&u$2(RecordButton$2,{recording:recording,onStartRecording:onStartRecording,onStopRecording:onStopRecording,i18n:i18n}),(hasRecordedVideo||hasCapturedSnapshot)&&u$2(SubmitButton$2,{onSubmit:onSubmit,i18n:i18n}),(hasRecordedVideo||hasCapturedSnapshot)&&u$2(DiscardButton$2,{onDiscard:onDiscardRecordedMedia,i18n:i18n})]}),u$2("div",{className:"uppy-Webcam-recordingLength",children:shouldShowRecordingLength&&u$2(RecordingLength$1,{recordingLengthSeconds:recordingLengthSeconds})})]})]})}}var locale$4={strings:{pluginNameCamera:"Camera",noCameraTitle:"Camera Not Available",noCameraDescription:"In order to take pictures or record video, please connect a camera device",recordingStoppedMaxSize:"Recording stopped because the file size is about to exceed the limit",submitRecordedFile:"Submit recorded file",discardRecordedFile:"Discard recorded file",smile:"Smile!",takePicture:"Take a picture",startRecording:"Begin video recording",stopRecording:"Stop video recording",recordingLength:"Recording length %{recording_length}",allowAccessTitle:"Please allow access to your camera",allowAccessDescription:"In order to take pictures or record video with your camera, please allow camera access for this site."}};function PermissionsScreen$1({icon:icon,i18n:i18n,hasCamera:hasCamera}){return u$2("div",{className:"uppy-Webcam-permissons",children:[u$2("div",{className:"uppy-Webcam-permissonsIcon",children:icon()}),u$2("div",{className:"uppy-Webcam-title",children:i18n(hasCamera?"allowAccessTitle":"noCameraTitle")}),u$2("p",{children:i18n(hasCamera?"allowAccessDescription":"noCameraDescription")})]})}function toMimeType(fileType){return"."===fileType[0]?mimeTypes[fileType.slice(1)]:fileType}function isVideoMimeType(mimeType){return/^video\/[^*]+$/.test(mimeType)}function isImageMimeType(mimeType){return/^image\/[^*]+$/.test(mimeType)}function isModeAvailable(modes,mode){return modes.includes(mode)}const defaultOptions$2={onBeforeSnapshot:()=>Promise.resolve(),countdown:!1,modes:["video-audio","video-only","audio-only","picture"],mirror:!0,showVideoSourceDropdown:!1,preferredImageMimeType:null,preferredVideoMimeType:null,showRecordingLength:!1,mobileNativeCamera:isMobile_2({tablet:!0})};class Webcam extends UIPlugin{static VERSION=packageJson$5_version;#enableMirror;mediaDevices;supportsUserMedia;protocol;capturedMediaFile;icon;webcamActive;stream=null;recorder=null;recordingChunks=null;recordingLengthTimer;captureInProgress=!1;constructor(uppy,opts){super(uppy,{...defaultOptions$2,...opts}),this.mediaDevices=navigator.mediaDevices,this.supportsUserMedia=!!this.mediaDevices,this.protocol=location.protocol.match(/https/i)?"https":"http",this.id=this.opts.id||"Webcam",this.type="acquirer",this.capturedMediaFile=null,this.icon=()=>u$2("svg",{"aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32",children:u$2("path",{d:"M23.5 9.5c1.417 0 2.5 1.083 2.5 2.5v9.167c0 1.416-1.083 2.5-2.5 2.5h-15c-1.417 0-2.5-1.084-2.5-2.5V12c0-1.417 1.083-2.5 2.5-2.5h2.917l1.416-2.167C13 7.167 13.25 7 13.5 7h5c.25 0 .5.167.667.333L20.583 9.5H23.5zM16 11.417a4.706 4.706 0 00-4.75 4.75 4.704 4.704 0 004.75 4.75 4.703 4.703 0 004.75-4.75c0-2.663-2.09-4.75-4.75-4.75zm0 7.825c-1.744 0-3.076-1.332-3.076-3.074 0-1.745 1.333-3.077 3.076-3.077 1.744 0 3.074 1.333 3.074 3.076s-1.33 3.075-3.074 3.075z",fill:"#02B383",fillRule:"nonzero"})}),this.defaultLocale=locale$4,this.i18nInit(),this.title=this.i18n("pluginNameCamera"),this.#enableMirror=this.opts.mirror,this.install=this.install.bind(this),this.setPluginState=this.setPluginState.bind(this),this.render=this.render.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.takeSnapshot=this.takeSnapshot.bind(this),this.startRecording=this.startRecording.bind(this),this.stopRecording=this.stopRecording.bind(this),this.discardRecordedMedia=this.discardRecordedMedia.bind(this),this.submit=this.submit.bind(this),this.oneTwoThreeSmile=this.oneTwoThreeSmile.bind(this),this.focus=this.focus.bind(this),this.changeVideoSource=this.changeVideoSource.bind(this),this.webcamActive=!1,this.opts.countdown&&(this.opts.onBeforeSnapshot=this.oneTwoThreeSmile),this.setPluginState({hasCamera:!1,cameraReady:!1,cameraError:null,recordingLengthSeconds:0,videoSources:[],currentDeviceId:null,capturedSnapshot:null})}getStatus(){const{recordedVideo:recordedVideo,capturedSnapshot:capturedSnapshot,isRecording:isRecording,cameraReady:cameraReady,cameraError:cameraError}=this.getPluginState();return isRecording?"recording":null!=recordedVideo||null!=capturedSnapshot?"captured":cameraReady?"ready":cameraError?"error":"init"}setOptions(newOpts){super.setOptions({...newOpts,videoConstraints:{...this.opts.videoConstraints,...newOpts?.videoConstraints}})}hasCameraCheck(){return this.mediaDevices?this.mediaDevices.enumerateDevices().then(devices=>devices.some(device=>"videoinput"===device.kind)):Promise.resolve(!1)}isAudioOnly(){return 1===this.opts.modes.length&&"audio-only"===this.opts.modes[0]}getConstraints(deviceId=null){const acceptsAudio=-1!==this.opts.modes.indexOf("video-audio")||-1!==this.opts.modes.indexOf("audio-only"),acceptsVideo=!this.isAudioOnly()&&(-1!==this.opts.modes.indexOf("video-audio")||-1!==this.opts.modes.indexOf("video-only")||-1!==this.opts.modes.indexOf("picture")),videoConstraints={...this.opts.videoConstraints||{},...null!=deviceId&&{deviceId:deviceId}};return{audio:acceptsAudio,video:!!acceptsVideo&&videoConstraints}}start(options=null){if(!this.supportsUserMedia)return Promise.reject(new Error("Webcam access not supported"));this.webcamActive=!0,this.opts.mirror&&(this.#enableMirror=!0);const constraints=this.getConstraints(options?.deviceId);this.hasCameraCheck().then(hasCamera=>(this.setPluginState({hasCamera:hasCamera}),this.mediaDevices.getUserMedia(constraints).then(stream=>{this.stream=stream;let currentDeviceId=null;const tracks=this.isAudioOnly()?stream.getAudioTracks():stream.getVideoTracks();options&&options.deviceId?tracks.forEach(track=>{track.getSettings().deviceId===options.deviceId&&(currentDeviceId=track.getSettings().deviceId)}):currentDeviceId=tracks[0].getSettings().deviceId,this.updateVideoSources(),this.setPluginState({currentDeviceId:currentDeviceId,cameraReady:!0})}).catch(err=>{this.setPluginState({cameraReady:!1,cameraError:err}),this.uppy.info(err.message,"error")})))}getMediaRecorderOptions(){const options={};if(MediaRecorder.isTypeSupported){const{restrictions:restrictions}=this.uppy.opts;let preferredVideoMimeTypes=[];this.opts.preferredVideoMimeType?preferredVideoMimeTypes=[this.opts.preferredVideoMimeType]:restrictions.allowedFileTypes&&(preferredVideoMimeTypes=restrictions.allowedFileTypes.map(toMimeType).filter(isVideoMimeType));const filterSupportedTypes=candidateType=>MediaRecorder.isTypeSupported(candidateType)&&getFileTypeExtension(candidateType),acceptableMimeTypes=preferredVideoMimeTypes.filter(filterSupportedTypes);acceptableMimeTypes.length>0&&(options.mimeType=acceptableMimeTypes[0])}return options}startRecording(){this.recorder=new MediaRecorder(this.stream,this.getMediaRecorderOptions()),this.recordingChunks=[];let stoppingBecauseOfMaxSize=!1;this.recorder.addEventListener("dataavailable",event=>{this.recordingChunks.push(event.data);const{restrictions:restrictions}=this.uppy.opts;if(this.recordingChunks.length>1&&null!=restrictions.maxFileSize&&!stoppingBecauseOfMaxSize){const totalSize=this.recordingChunks.reduce((acc,chunk)=>acc+chunk.size,0),expectedEndChunkSize=3*((totalSize-this.recordingChunks[0].size)/(this.recordingChunks.length-1));totalSize>Math.max(0,restrictions.maxFileSize-expectedEndChunkSize)&&(stoppingBecauseOfMaxSize=!0,this.uppy.info(this.i18n("recordingStoppedMaxSize"),"warning",4e3),this.stopRecording())}}),this.recorder.start(500),this.opts.showRecordingLength&&(this.recordingLengthTimer=setInterval(()=>{const currentRecordingLength=this.getPluginState().recordingLengthSeconds;this.setPluginState({recordingLengthSeconds:currentRecordingLength+1})},1e3)),this.setPluginState({isRecording:!0})}stopRecording(){const stopped=new Promise(resolve=>{this.recorder.addEventListener("stop",()=>{resolve()}),this.recorder.stop(),this.opts.showRecordingLength&&(clearInterval(this.recordingLengthTimer),this.setPluginState({recordingLengthSeconds:0}))});return stopped.then(()=>(this.setPluginState({isRecording:!1}),this.getVideo())).then(file=>{try{this.capturedMediaFile=file,this.setPluginState({recordedVideo:URL.createObjectURL(file.data)}),this.#enableMirror=!1}catch(err){err.isRestriction||this.uppy.log(err)}}).then(()=>{this.recordingChunks=null,this.recorder=null},error=>{throw this.recordingChunks=null,this.recorder=null,error})}discardRecordedMedia(){const{recordedVideo:recordedVideo,capturedSnapshot:capturedSnapshot}=this.getPluginState();recordedVideo&&URL.revokeObjectURL(recordedVideo),capturedSnapshot&&URL.revokeObjectURL(capturedSnapshot),this.setPluginState({recordedVideo:null,capturedSnapshot:null}),this.opts.mirror&&(this.#enableMirror=!0),this.capturedMediaFile=null}submit(){try{this.capturedMediaFile&&this.uppy.addFile(this.capturedMediaFile)}catch(err){err.isRestriction||this.uppy.log(err,"error")}}async stop(){if(this.stream){const audioTracks=this.stream.getAudioTracks(),videoTracks=this.stream.getVideoTracks();audioTracks.concat(videoTracks).forEach(track=>track.stop())}this.recorder&&await new Promise(resolve=>{this.recorder.addEventListener("stop",resolve,{once:!0}),this.recorder.stop(),this.opts.showRecordingLength&&clearInterval(this.recordingLengthTimer)}),this.recordingChunks=null,this.recorder=null,this.webcamActive=!1,this.stream=null,this.setPluginState({recordedVideo:null,capturedSnapshot:null,isRecording:!1,recordingLengthSeconds:0})}getVideoElement(){return this.el.querySelector(".uppy-Webcam-video")}oneTwoThreeSmile(){return new Promise((resolve,reject)=>{let count=this.opts.countdown;const countDown=setInterval(()=>{if(!this.webcamActive)return clearInterval(countDown),this.captureInProgress=!1,reject(new Error("Webcam is not active"));count?(this.uppy.info(`${count}...`,"warning",800),count--):(clearInterval(countDown),this.uppy.info(this.i18n("smile"),"success",1500),setTimeout(()=>resolve(),1500))},1e3)})}async takeSnapshot(){if(!this.captureInProgress){this.captureInProgress=!0;try{await this.opts.onBeforeSnapshot()}catch(err){const message="object"==typeof err?err.message:err;throw this.uppy.info(message,"error",5e3),new Error(`onBeforeSnapshot: ${message}`)}try{const tagFile=await this.getImage();this.capturedMediaFile=tagFile;const capturedSnapshotUrl=URL.createObjectURL(tagFile.data);this.setPluginState({capturedSnapshot:capturedSnapshotUrl}),this.captureInProgress=!1}catch(error){this.captureInProgress=!1,error.isRestriction||this.uppy.log(error)}}}getImage(){const video=this.getVideoElement();if(!video)return Promise.reject(new Error("No video element found, likely due to the Webcam tab being closed."));const width=video.videoWidth,height=video.videoHeight,canvas=document.createElement("canvas");canvas.width=width,canvas.height=height;canvas.getContext("2d").drawImage(video,0,0);const{restrictions:restrictions}=this.uppy.opts;let preferredImageMimeTypes=[];this.opts.preferredImageMimeType?preferredImageMimeTypes=[this.opts.preferredImageMimeType]:restrictions.allowedFileTypes&&(preferredImageMimeTypes=restrictions.allowedFileTypes.map(toMimeType).filter(isImageMimeType));const mimeType=preferredImageMimeTypes[0]||"image/jpeg",ext=getFileTypeExtension(mimeType)||"jpg",name=`cam-${Date.now()}.${ext}`;return function(canvas,type,quality){return new Promise(resolve=>{canvas.toBlob(resolve,type,quality)})}(canvas,mimeType).then(blob=>({source:this.id,name:name,data:new Blob([blob],{type:mimeType}),type:mimeType}))}getVideo(){const mimeType=this.recordingChunks.find(blob=>blob.type?.length>0).type,fileExtension=getFileTypeExtension(mimeType);if(!fileExtension)return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type "${mimeType}"`));const name=`webcam-${Date.now()}.${fileExtension}`,blob=new Blob(this.recordingChunks,{type:mimeType}),file={source:this.id,name:name,data:new Blob([blob],{type:mimeType}),type:mimeType};return Promise.resolve(file)}focus(){this.opts.countdown&&setTimeout(()=>{this.uppy.info(this.i18n("smile"),"success",1500)},1e3)}changeVideoSource(deviceId){this.stop(),this.start({deviceId:deviceId})}updateVideoSources(){this.mediaDevices.enumerateDevices().then(devices=>{this.setPluginState({videoSources:devices.filter(device=>"videoinput"===device.kind)})})}render(){this.webcamActive||this.start();const webcamState=this.getPluginState();return webcamState.cameraReady&&webcamState.hasCamera?u$2(CameraScreen,{...webcamState,onChangeVideoSource:this.changeVideoSource,onSnapshot:this.takeSnapshot,onStartRecording:this.startRecording,onStopRecording:this.stopRecording,onDiscardRecordedMedia:this.discardRecordedMedia,onSubmit:this.submit,onFocus:this.focus,onStop:this.stop,i18n:this.i18n,modes:this.opts.modes,showRecordingLength:this.opts.showRecordingLength,showVideoSourceDropdown:this.opts.showVideoSourceDropdown,supportsRecording:"function"==typeof MediaRecorder&&!!MediaRecorder.prototype&&"function"==typeof MediaRecorder.prototype.start,recording:webcamState.isRecording,mirror:this.#enableMirror,src:this.stream}):u$2(PermissionsScreen$1,{icon:CameraIcon,i18n:this.i18n,hasCamera:webcamState.hasCamera})}install(){const{mobileNativeCamera:mobileNativeCamera,modes:modes,videoConstraints:videoConstraints}=this.opts,{target:target}=this.opts;mobileNativeCamera&&target?this.getTargetPlugin(target)?.setOptions({showNativeVideoCameraButton:isModeAvailable(modes,"video-only")||isModeAvailable(modes,"video-audio"),showNativePhotoCameraButton:isModeAvailable(modes,"picture"),nativeCameraFacingMode:videoConstraints?.facingMode}):(this.setPluginState({cameraReady:!1,recordingLengthSeconds:0}),target&&this.mount(target,this),this.mediaDevices&&(this.updateVideoSources(),this.mediaDevices.ondevicechange=()=>{if(this.updateVideoSources(),this.stream){let restartStream=!0;const{videoSources:videoSources,currentDeviceId:currentDeviceId}=this.getPluginState();videoSources.forEach(videoSource=>{currentDeviceId===videoSource.deviceId&&(restartStream=!1)}),restartStream&&(this.stop(),this.start())}}))}uninstall(){this.stop(),this.unmount()}onUnmount(){this.stop()}}var packageJson$4_version="5.0.1",locale$3={strings:{pluginNameScreenCapture:"Screencast",startCapturing:"Begin screen capturing",stopCapturing:"Stop screen capturing",submitRecordedFile:"Submit recorded file",streamActive:"Stream active",streamPassive:"Stream passive",micDisabled:"Microphone access denied by user",recording:"Recording",takeScreenshot:"Take Screenshot",discardMediaFile:"Discard Media"}};function DiscardButton$1({onDiscard:onDiscard,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--discard",type:"button",title:i18n("discardMediaFile"),"aria-label":i18n("discardMediaFile"),onClick:onDiscard,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round",children:[u$2("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),u$2("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})}function RecordButton$1({recording:recording,onStartRecording:onStartRecording,onStopRecording:onStopRecording,i18n:i18n}){return u$2("button",recording?{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--video uppy-ScreenCapture-button--stop-rec",type:"button",title:i18n("stopCapturing"),"aria-label":i18n("stopCapturing"),onClick:onStopRecording,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100",children:u$2("rect",{x:"15",y:"15",width:"70",height:"70"})})}:{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--video",type:"button",title:i18n("startCapturing"),"aria-label":i18n("startCapturing"),onClick:onStartRecording,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:u$2("path",{d:"M4.5 4.5a3 3 0 0 0-3 3v9a3 3 0 0 0 3 3h8.25a3 3 0 0 0 3-3v-9a3 3 0 0 0-3-3H4.5ZM19.94 18.75l-2.69-2.69V7.94l2.69-2.69c.944-.945 2.56-.276 2.56 1.06v11.38c0 1.336-1.616 2.005-2.56 1.06Z"})})})}function ScreenshotButton({onScreenshot:onScreenshot,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--screenshot",type:"button",title:i18n("takeScreenshot"),"aria-label":i18n("takeScreenshot"),onClick:onScreenshot,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:[u$2("path",{d:"M12 9a3.75 3.75 0 1 0 0 7.5A3.75 3.75 0 0 0 12 9Z"}),u$2("path",{"fill-rule":"evenodd",d:"M9.344 3.071a49.52 49.52 0 0 1 5.312 0c.967.052 1.83.585 2.332 1.39l.821 1.317c.24.383.645.643 1.11.71.386.054.77.113 1.152.177 1.432.239 2.429 1.493 2.429 2.909V18a3 3 0 0 1-3 3h-15a3 3 0 0 1-3-3V9.574c0-1.416.997-2.67 2.429-2.909.382-.064.766-.123 1.151-.178a1.56 1.56 0 0 0 1.11-.71l.822-1.315a2.942 2.942 0 0 1 2.332-1.39ZM6.75 12.75a5.25 5.25 0 1 1 10.5 0 5.25 5.25 0 0 1-10.5 0Zm12-1.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z","clip-rule":"evenodd"})]})})}class StopWatch extends x{wrapperStyle={width:"100%",height:"100%",display:"flex"};overlayStyle={position:"absolute",width:"100%",height:"100%",background:"black",opacity:.7};infoContainerStyle={marginLeft:"auto",marginRight:"auto",marginTop:"auto",marginBottom:"auto",zIndex:1,color:"white"};infotextStyle={marginLeft:"auto",marginRight:"auto",marginBottom:"1rem",fontSize:"1.5rem"};timeStyle={display:"block",fontWeight:"bold",marginLeft:"auto",marginRight:"auto",fontSize:"3rem",fontFamily:"Courier New"};timerRunning=!1;timer;constructor(props){super(props),this.state={elapsedTime:0}}startTimer(){this.timerTick(),this.timerRunning=!0}resetTimer(){clearTimeout(this.timer),this.setState({elapsedTime:0}),this.timerRunning=!1}timerTick(){this.timer=setTimeout(()=>{this.setState(state=>({elapsedTime:state.elapsedTime+1})),this.timerTick()},1e3)}render(){const{recording:recording,i18n:i18n}={...this.props},{elapsedTime:elapsedTime}=this.state,minAndSec=function(s){return(s-(s%=60))/60+(s>9?":":":0")+s}(elapsedTime);return recording&&!this.timerRunning&&this.startTimer(),!recording&&this.timerRunning&&this.resetTimer(),recording?u$2("div",{style:this.wrapperStyle,children:[u$2("div",{style:this.overlayStyle}),u$2("div",{style:this.infoContainerStyle,children:[u$2("div",{style:this.infotextStyle,children:i18n("recording")}),u$2("div",{style:this.timeStyle,children:minAndSec})]})]}):null}}function StreamStatus({streamActive:streamActive,i18n:i18n}){return u$2("div",streamActive?{title:i18n("streamActive"),className:"uppy-ScreenCapture-icon--stream uppy-ScreenCapture-icon--streamActive",children:u$2("svg",{"aria-hidden":"true",focusable:"false",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0z",opacity:".1",fill:"none"}),u$2("path",{d:"M0 0h24v24H0z",fill:"none"}),u$2("path",{d:"M1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm18-7H5v1.63c3.96 1.28 7.09 4.41 8.37 8.37H19V7zM1 10v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11zm20-7H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})]})}:{title:i18n("streamPassive"),className:"uppy-ScreenCapture-icon--stream",children:u$2("svg",{"aria-hidden":"true",focusable:"false",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0z",opacity:".1",fill:"none"}),u$2("path",{d:"M0 0h24v24H0z",fill:"none"}),u$2("path",{d:"M21 3H3c-1.1 0-2 .9-2 2v3h2V5h18v14h-7v2h7c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM1 18v3h3c0-1.66-1.34-3-3-3zm0-4v2c2.76 0 5 2.24 5 5h2c0-3.87-3.13-7-7-7zm0-4v2c4.97 0 9 4.03 9 9h2c0-6.08-4.93-11-11-11z"})]})})}function SubmitButton$1({recording:recording,recordedVideo:recordedVideo,onSubmit:onSubmit,capturedScreenshotUrl:capturedScreenshotUrl,i18n:i18n}){return!recordedVideo&&!capturedScreenshotUrl||recording?null:u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-ScreenCapture-button uppy-ScreenCapture-button--submit",type:"button",title:i18n("submitRecordedFile"),"aria-label":i18n("submitRecordedFile"),onClick:onSubmit,"data-uppy-super-focusable":!0,children:u$2("svg",{width:"12",height:"9",viewBox:"0 0 12 9",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon",children:u$2("path",{fill:"#fff",fillRule:"nonzero",d:"M10.66 0L12 1.31 4.136 9 0 4.956l1.34-1.31L4.136 6.38z"})})})}class RecorderScreen extends x{videoElement=null;componentWillUnmount(){const{onStop:onStop}=this.props;onStop()}render(){const{recording:recording,stream:videoStream,recordedVideo:recordedVideo,enableScreenshots:enableScreenshots,capturedScreenshotUrl:capturedScreenshotUrl}=this.props,videoProps={playsinline:!0};return(recording||!recordedVideo&&!recording)&&(videoProps.muted=!0,videoProps.autoplay=!0,videoProps.srcObject=videoStream),recordedVideo&&!recording&&(videoProps.muted=!1,videoProps.controls=!0,videoProps.src=recordedVideo,this.videoElement&&(this.videoElement.srcObject=null)),u$2("div",{className:"uppy uppy-ScreenCapture-container",children:[u$2("div",{className:"uppy-ScreenCapture-mediaContainer",children:[u$2(StreamStatus,{...this.props}),!capturedScreenshotUrl||recording||recordedVideo?u$2("video",{ref:videoElement=>{this.videoElement=videoElement},className:"uppy-ScreenCapture-media",...videoProps}):u$2("div",{className:"uppy-ScreenCapture-imageContainer",children:u$2("img",{src:capturedScreenshotUrl,className:"uppy-ScreenCapture-media",alt:"screenshotPreview"})}),u$2("div",{children:u$2(StopWatch,{...this.props})})]}),u$2("div",{className:"uppy-ScreenCapture-buttonContainer",children:u$2(k$2,recordedVideo||capturedScreenshotUrl?{children:[u$2(SubmitButton$1,{...this.props}),u$2(DiscardButton$1,{...this.props})]}:{children:[enableScreenshots&&!recording&&u$2(ScreenshotButton,{...this.props}),u$2(RecordButton$1,{...this.props})]})})]})}}function ScreenRecIcon(){return u$2("svg",{className:"uppy-DashboardTab-iconScreenRec","aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32",children:u$2("g",{fill:"currentcolor",fillRule:"evenodd",children:[u$2("path",{d:"M24.182 9H7.818C6.81 9 6 9.742 6 10.667v10c0 .916.81 1.666 1.818 1.666h4.546V24h7.272v-1.667h4.546c1 0 1.809-.75 1.809-1.666l.009-10C26 9.742 25.182 9 24.182 9zM24 21H8V11h16v10z"}),u$2("circle",{cx:"16",cy:"16",r:"2"})]})})}const SUPPORTED_IMAGE_TYPES=["image/png","image/jpeg","image/webp"],defaultOptions$1={displayMediaConstraints:{video:{width:1280,height:720,frameRate:{ideal:3,max:5},cursor:"motion",displaySurface:"monitor"}},userMediaConstraints:{audio:!0},preferredVideoMimeType:"video/webm",preferredImageMimeType:"image/png",enableScreenshots:!0};class ScreenCapture extends UIPlugin{static VERSION=packageJson$4_version;mediaDevices;protocol;icon;streamInterrupted;captureActive;capturedMediaFile;videoStream=null;audioStream=null;userDenied=!1;recorder=null;outputStream=null;recordingChunks=null;constructor(uppy,opts){super(uppy,{...defaultOptions$1,...opts}),this.mediaDevices=window.MediaRecorder&&navigator.mediaDevices,this.protocol="https:"===location.protocol?"https":"http",this.id=this.opts.id||"ScreenCapture",this.type="acquirer",this.icon=ScreenRecIcon,this.defaultLocale=locale$3,this.i18nInit(),this.title=this.i18n("pluginNameScreenCapture"),this.install=this.install.bind(this),this.setPluginState=this.setPluginState.bind(this),this.render=this.render.bind(this),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this.startRecording=this.startRecording.bind(this),this.stopRecording=this.stopRecording.bind(this),this.submit=this.submit.bind(this),this.streamInterrupted=this.streamInactivated.bind(this),this.captureScreenshot=this.captureScreenshot.bind(this),this.discardRecordedMedia=this.discardRecordedMedia.bind(this),this.captureActive=!1,this.capturedMediaFile=null,this.setPluginState({streamActive:!1,audioStreamActive:!1,recording:!1,recordedVideo:null,screenRecError:null,capturedScreenshotUrl:null,status:"init"})}install(){if(!window.MediaRecorder||!navigator.mediaDevices?.getDisplayMedia)return this.uppy.log("Screen recorder access is not supported","warning"),null;this.setPluginState({streamActive:!1,audioStreamActive:!1,status:"init"});const{target:target}=this.opts;target&&this.mount(target,this)}uninstall(){this.videoStream&&this.stop(),this.unmount()}start(){return this.mediaDevices?(this.captureActive=!0,this.selectAudioStreamSource(),this.selectVideoStreamSource().then(res=>{!1===res&&this.parent?.hideAllPanels&&(this.parent.hideAllPanels(),this.captureActive=!1)})):Promise.reject(new Error("Screen recorder access not supported"))}selectVideoStreamSource(){return this.videoStream?new Promise(resolve=>resolve(this.videoStream)):this.mediaDevices.getDisplayMedia(this.opts.displayMediaConstraints).then(videoStream=>(this.videoStream=videoStream,this.videoStream.addEventListener("inactive",()=>{this.streamInactivated()}),this.setPluginState({streamActive:!0,status:"ready",screenRecError:null}),videoStream)).catch(err=>(this.setPluginState({screenRecError:err,status:"error"}),this.userDenied=!0,setTimeout(()=>{this.userDenied=!1},1e3),!1))}selectAudioStreamSource(){return this.audioStream?new Promise(resolve=>resolve(this.audioStream)):this.mediaDevices.getUserMedia(this.opts.userMediaConstraints).then(audioStream=>(this.audioStream=audioStream,this.setPluginState({audioStreamActive:!0}),audioStream)).catch(err=>("NotAllowedError"===err.name&&(this.uppy.info(this.i18n("micDisabled"),"error",5e3),this.uppy.log(this.i18n("micDisabled"),"warning")),!1))}startRecording(){const options={};this.capturedMediaFile=null,this.recordingChunks=[];const{preferredVideoMimeType:preferredVideoMimeType}=this.opts;this.selectVideoStreamSource().then(videoStream=>{if(!1===videoStream)throw new Error("No video stream available");preferredVideoMimeType&&MediaRecorder.isTypeSupported(preferredVideoMimeType)&&getFileTypeExtension(preferredVideoMimeType)&&(options.mimeType=preferredVideoMimeType);const tracks=[videoStream.getVideoTracks()[0]];this.audioStream&&tracks.push(this.audioStream.getAudioTracks()[0]),this.outputStream=new MediaStream(tracks),this.recorder=new MediaRecorder(this.outputStream,options),this.recorder.addEventListener("dataavailable",event=>{this.recordingChunks.push(event.data)}),this.recorder.start(),this.setPluginState({recording:!0,status:"recording"})}).catch(err=>{this.uppy.log(err,"error"),this.setPluginState({screenRecError:err,status:"error"})})}streamInactivated(){const{recordedVideo:recordedVideo,recording:recording}={...this.getPluginState()};recordedVideo||recording?recording&&(this.uppy.log("Capture stream inactive  stop recording"),this.stopRecording()):(this.parent?.hideAllPanels&&this.parent.hideAllPanels(),this.setPluginState({status:"init"})),this.videoStream=null,this.audioStream=null,this.setPluginState({streamActive:!1,audioStreamActive:!1})}stopRecording(){const stopped=new Promise(resolve=>{this.recorder.addEventListener("stop",()=>{resolve()}),this.recorder.stop()});return stopped.then(()=>(this.setPluginState({recording:!1}),this.getVideo())).then(file=>{this.capturedMediaFile=file,this.setPluginState({recordedVideo:URL.createObjectURL(file.data),status:"captured"})}).then(()=>{this.recordingChunks=null,this.recorder=null},error=>{throw this.recordingChunks=null,this.recorder=null,error})}discardRecordedMedia(){const{capturedScreenshotUrl:capturedScreenshotUrl,recordedVideo:recordedVideo}=this.getPluginState();capturedScreenshotUrl&&URL.revokeObjectURL(capturedScreenshotUrl),recordedVideo&&URL.revokeObjectURL(recordedVideo),this.capturedMediaFile=null,this.setPluginState({recordedVideo:null,capturedScreenshotUrl:null,status:this.getPluginState().streamActive?"ready":"init"})}submit(){try{this.capturedMediaFile&&this.uppy.addFile(this.capturedMediaFile)}catch(err){err.isRestriction||this.uppy.log(err,"warning")}}stop(){this.videoStream&&(this.videoStream.getVideoTracks().forEach(track=>{track.stop()}),this.videoStream.getAudioTracks().forEach(track=>{track.stop()}),this.videoStream=null),this.audioStream&&(this.audioStream.getAudioTracks().forEach(track=>{track.stop()}),this.audioStream.getVideoTracks().forEach(track=>{track.stop()}),this.audioStream=null),this.outputStream&&(this.outputStream.getAudioTracks().forEach(track=>{track.stop()}),this.outputStream.getVideoTracks().forEach(track=>{track.stop()}),this.outputStream=null);const{capturedScreenshotUrl:capturedScreenshotUrl,recordedVideo:recordedVideo}=this.getPluginState();capturedScreenshotUrl&&URL.revokeObjectURL(capturedScreenshotUrl),recordedVideo&&URL.revokeObjectURL(recordedVideo),this.setPluginState({recording:!1,streamActive:!1,audioStreamActive:!1,recordedVideo:null,capturedScreenshotUrl:null,status:"init"}),this.captureActive=!1}getVideo(){const mimeType=this.recordingChunks[0].type,fileExtension=getFileTypeExtension(mimeType);if(!fileExtension)return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type "${mimeType}"`));const name=`screencap-${Date.now()}.${fileExtension}`,blob=new Blob(this.recordingChunks,{type:mimeType}),file={source:this.id,name:name,data:new Blob([blob],{type:mimeType}),type:mimeType};return Promise.resolve(file)}async captureScreenshot(){if(!this.mediaDevices?.getDisplayMedia)throw new Error("Screen capture is not supported");try{let stream=this.videoStream;if(!stream){const newStream=await this.selectVideoStreamSource();if(!newStream)throw new Error("Failed to get screen capture stream");stream=newStream}const video=document.createElement("video");video.srcObject=stream,await new Promise(resolve=>{video.onloadedmetadata=()=>{video.play(),resolve(null)}});const canvas=document.createElement("canvas");canvas.width=video.videoWidth,canvas.height=video.videoHeight;const ctx=canvas.getContext("2d");if(!ctx)throw new Error("Failed to get canvas context");ctx.drawImage(video,0,0,canvas.width,canvas.height);let mimeType=this.opts.preferredImageMimeType;mimeType&&SUPPORTED_IMAGE_TYPES.includes(mimeType)||(this.uppy.log(`Unsupported image type "${mimeType}", falling back to image/png`,"warning"),mimeType="image/png");const quality=1;return new Promise((resolve,reject)=>{canvas.toBlob(blob=>{if(!blob)return void reject(new Error("Failed to create screenshot blob"));const fileExtension=getFileTypeExtension(mimeType)||"png",file={source:this.id,name:`Screenshot ${(new Date).toISOString()}.${fileExtension}`,type:mimeType,data:blob};try{this.capturedMediaFile=file;const screenshotUrl=URL.createObjectURL(blob);this.setPluginState({capturedScreenshotUrl:screenshotUrl,status:"captured"}),resolve()}catch(err){this.getPluginState().capturedScreenshotUrl&&this.setPluginState({capturedScreenshotUrl:null}),err.isRestriction||this.uppy.log(err,"error"),reject(err)}finally{video.srcObject=null,canvas.remove(),video.remove()}},mimeType,quality)})}catch(err){throw this.uppy.log(err,"error"),err}}render(){const recorderState=this.getPluginState();return recorderState.streamActive||this.captureActive||this.userDenied||this.start(),u$2(RecorderScreen,{...recorderState,onStartRecording:this.startRecording,onStopRecording:this.stopRecording,enableScreenshots:this.opts.enableScreenshots,onScreenshot:this.captureScreenshot,onStop:this.stop,onSubmit:this.submit,i18n:this.i18n,stream:this.videoStream,onDiscard:this.discardRecordedMedia})}}var packageJson$3_version="4.0.1",cropper={exports:{}};!function(module){module.exports=function(){function ownKeys(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),t.push.apply(t,o)}return t}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?ownKeys(Object(t),!0).forEach(function(r){_defineProperty(e,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ownKeys(Object(t)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))})}return e}function _toPrimitive(t,r){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,r);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}function _toPropertyKey(t){var i=_toPrimitive(t,"string");return"symbol"==typeof i?i:i+""}function _typeof(o){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Object.defineProperty(Constructor,"prototype",{writable:!1}),Constructor}function _defineProperty(obj,key,value){return(key=_toPropertyKey(key))in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_unsupportedIterableToArray(arr)||_nonIterableSpread()}function _arrayWithoutHoles(arr){if(Array.isArray(arr))return _arrayLikeToArray(arr)}function _iterableToArray(iter){if("undefined"!=typeof Symbol&&null!=iter[Symbol.iterator]||null!=iter["@@iterator"])return Array.from(iter)}function _unsupportedIterableToArray(o,minLen){if(o){if("string"==typeof o)return _arrayLikeToArray(o,minLen);var n=Object.prototype.toString.call(o).slice(8,-1);return"Object"===n&&o.constructor&&(n=o.constructor.name),"Map"===n||"Set"===n?Array.from(o):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(o,minLen):void 0}}function _arrayLikeToArray(arr,len){(null==len||len>arr.length)&&(len=arr.length);for(var i=0,arr2=new Array(len);i<len;i++)arr2[i]=arr[i];return arr2}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var IS_BROWSER="undefined"!=typeof window&&void 0!==window.document,WINDOW=IS_BROWSER?window:{},IS_TOUCH_DEVICE=!(!IS_BROWSER||!WINDOW.document.documentElement)&&"ontouchstart"in WINDOW.document.documentElement,HAS_POINTER_EVENT=!!IS_BROWSER&&"PointerEvent"in WINDOW,NAMESPACE="cropper",ACTION_ALL="all",ACTION_CROP="crop",ACTION_MOVE="move",ACTION_ZOOM="zoom",ACTION_EAST="e",ACTION_WEST="w",ACTION_SOUTH="s",ACTION_NORTH="n",ACTION_NORTH_EAST="ne",ACTION_NORTH_WEST="nw",ACTION_SOUTH_EAST="se",ACTION_SOUTH_WEST="sw",CLASS_CROP="".concat(NAMESPACE,"-crop"),CLASS_DISABLED="".concat(NAMESPACE,"-disabled"),CLASS_HIDDEN="".concat(NAMESPACE,"-hidden"),CLASS_HIDE="".concat(NAMESPACE,"-hide"),CLASS_INVISIBLE="".concat(NAMESPACE,"-invisible"),CLASS_MODAL="".concat(NAMESPACE,"-modal"),CLASS_MOVE="".concat(NAMESPACE,"-move"),DATA_ACTION="".concat(NAMESPACE,"Action"),DATA_PREVIEW="".concat(NAMESPACE,"Preview"),DRAG_MODE_CROP="crop",DRAG_MODE_MOVE="move",DRAG_MODE_NONE="none",EVENT_CROP="crop",EVENT_CROP_END="cropend",EVENT_CROP_MOVE="cropmove",EVENT_CROP_START="cropstart",EVENT_DBLCLICK="dblclick",EVENT_TOUCH_START=IS_TOUCH_DEVICE?"touchstart":"mousedown",EVENT_TOUCH_MOVE=IS_TOUCH_DEVICE?"touchmove":"mousemove",EVENT_TOUCH_END=IS_TOUCH_DEVICE?"touchend touchcancel":"mouseup",EVENT_POINTER_DOWN=HAS_POINTER_EVENT?"pointerdown":EVENT_TOUCH_START,EVENT_POINTER_MOVE=HAS_POINTER_EVENT?"pointermove":EVENT_TOUCH_MOVE,EVENT_POINTER_UP=HAS_POINTER_EVENT?"pointerup pointercancel":EVENT_TOUCH_END,EVENT_READY="ready",EVENT_RESIZE="resize",EVENT_WHEEL="wheel",EVENT_ZOOM="zoom",MIME_TYPE_JPEG="image/jpeg",REGEXP_ACTIONS=/^e|w|s|n|se|sw|ne|nw|all|crop|move|zoom$/,REGEXP_DATA_URL=/^data:/,REGEXP_DATA_URL_JPEG=/^data:image\/jpeg;base64,/,REGEXP_TAG_NAME=/^img|canvas$/i,MIN_CONTAINER_WIDTH=200,MIN_CONTAINER_HEIGHT=100,DEFAULTS={viewMode:0,dragMode:DRAG_MODE_CROP,initialAspectRatio:NaN,aspectRatio:NaN,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:MIN_CONTAINER_WIDTH,minContainerHeight:MIN_CONTAINER_HEIGHT,ready:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},TEMPLATE='<div class="cropper-container" touch-action="none"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-cropper-action="e"></span><span class="cropper-line line-n" data-cropper-action="n"></span><span class="cropper-line line-w" data-cropper-action="w"></span><span class="cropper-line line-s" data-cropper-action="s"></span><span class="cropper-point point-e" data-cropper-action="e"></span><span class="cropper-point point-n" data-cropper-action="n"></span><span class="cropper-point point-w" data-cropper-action="w"></span><span class="cropper-point point-s" data-cropper-action="s"></span><span class="cropper-point point-ne" data-cropper-action="ne"></span><span class="cropper-point point-nw" data-cropper-action="nw"></span><span class="cropper-point point-sw" data-cropper-action="sw"></span><span class="cropper-point point-se" data-cropper-action="se"></span></div></div>',isNaN=Number.isNaN||WINDOW.isNaN;function isNumber(value){return"number"==typeof value&&!isNaN(value)}var isPositiveNumber=function(value){return value>0&&value<1/0};function isUndefined(value){return void 0===value}function isObject(value){return"object"===_typeof(value)&&null!==value}var hasOwnProperty=Object.prototype.hasOwnProperty;function isPlainObject(value){if(!isObject(value))return!1;try{var _constructor=value.constructor,prototype=_constructor.prototype;return _constructor&&prototype&&hasOwnProperty.call(prototype,"isPrototypeOf")}catch(error){return!1}}function isFunction(value){return"function"==typeof value}var slice=Array.prototype.slice;function toArray(value){return Array.from?Array.from(value):slice.call(value)}function forEach(data,callback){return data&&isFunction(callback)&&(Array.isArray(data)||isNumber(data.length)?toArray(data).forEach(function(value,key){callback.call(data,value,key,data)}):isObject(data)&&Object.keys(data).forEach(function(key){callback.call(data,data[key],key,data)})),data}var assign=Object.assign||function(target){for(var _len=arguments.length,args=new Array(_len>1?_len-1:0),_key=1;_key<_len;_key++)args[_key-1]=arguments[_key];return isObject(target)&&args.length>0&&args.forEach(function(arg){isObject(arg)&&Object.keys(arg).forEach(function(key){target[key]=arg[key]})}),target},REGEXP_DECIMALS=/\.\d*(?:0|9){12}\d*$/;function normalizeDecimalNumber(value){var times=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return REGEXP_DECIMALS.test(value)?Math.round(value*times)/times:value}var REGEXP_SUFFIX=/^width|height|left|top|marginLeft|marginTop$/;function setStyle(element,styles){var style=element.style;forEach(styles,function(value,property){REGEXP_SUFFIX.test(property)&&isNumber(value)&&(value="".concat(value,"px")),style[property]=value})}function hasClass(element,value){return element.classList?element.classList.contains(value):element.className.indexOf(value)>-1}function addClass(element,value){if(value)if(isNumber(element.length))forEach(element,function(elem){addClass(elem,value)});else if(element.classList)element.classList.add(value);else{var className=element.className.trim();className?className.indexOf(value)<0&&(element.className="".concat(className," ").concat(value)):element.className=value}}function removeClass(element,value){value&&(isNumber(element.length)?forEach(element,function(elem){removeClass(elem,value)}):element.classList?element.classList.remove(value):element.className.indexOf(value)>=0&&(element.className=element.className.replace(value,"")))}function toggleClass(element,value,added){value&&(isNumber(element.length)?forEach(element,function(elem){toggleClass(elem,value,added)}):added?addClass(element,value):removeClass(element,value))}var REGEXP_CAMEL_CASE=/([a-z\d])([A-Z])/g;function toParamCase(value){return value.replace(REGEXP_CAMEL_CASE,"$1-$2").toLowerCase()}function getData(element,name){return isObject(element[name])?element[name]:element.dataset?element.dataset[name]:element.getAttribute("data-".concat(toParamCase(name)))}function setData(element,name,data){isObject(data)?element[name]=data:element.dataset?element.dataset[name]=data:element.setAttribute("data-".concat(toParamCase(name)),data)}function removeData(element,name){if(isObject(element[name]))try{delete element[name]}catch(error){element[name]=void 0}else if(element.dataset)try{delete element.dataset[name]}catch(error){element.dataset[name]=void 0}else element.removeAttribute("data-".concat(toParamCase(name)))}var REGEXP_SPACES=/\s\s*/,onceSupported=function(){var supported=!1;if(IS_BROWSER){var once=!1,listener=function(){},options=Object.defineProperty({},"once",{get:function(){return supported=!0,once},set:function(value){once=value}});WINDOW.addEventListener("test",listener,options),WINDOW.removeEventListener("test",listener,options)}return supported}();function removeListener(element,type,listener){var options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},handler=listener;type.trim().split(REGEXP_SPACES).forEach(function(event){if(!onceSupported){var listeners=element.listeners;listeners&&listeners[event]&&listeners[event][listener]&&(handler=listeners[event][listener],delete listeners[event][listener],0===Object.keys(listeners[event]).length&&delete listeners[event],0===Object.keys(listeners).length&&delete element.listeners)}element.removeEventListener(event,handler,options)})}function addListener(element,type,listener){var options=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},_handler=listener;type.trim().split(REGEXP_SPACES).forEach(function(event){if(options.once&&!onceSupported){var _element$listeners=element.listeners,listeners=void 0===_element$listeners?{}:_element$listeners;_handler=function(){delete listeners[event][listener],element.removeEventListener(event,_handler,options);for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++)args[_key2]=arguments[_key2];listener.apply(element,args)},listeners[event]||(listeners[event]={}),listeners[event][listener]&&element.removeEventListener(event,listeners[event][listener],options),listeners[event][listener]=_handler,element.listeners=listeners}element.addEventListener(event,_handler,options)})}function dispatchEvent(element,type,data){var event;return isFunction(Event)&&isFunction(CustomEvent)?event=new CustomEvent(type,{detail:data,bubbles:!0,cancelable:!0}):(event=document.createEvent("CustomEvent")).initCustomEvent(type,!0,!0,data),element.dispatchEvent(event)}function getOffset(element){var box=element.getBoundingClientRect();return{left:box.left+(window.pageXOffset-document.documentElement.clientLeft),top:box.top+(window.pageYOffset-document.documentElement.clientTop)}}var location=WINDOW.location,REGEXP_ORIGINS=/^(\w+:)\/\/([^:/?#]*):?(\d*)/i;function isCrossOriginURL(url){var parts=url.match(REGEXP_ORIGINS);return null!==parts&&(parts[1]!==location.protocol||parts[2]!==location.hostname||parts[3]!==location.port)}function addTimestamp(url){var timestamp="timestamp=".concat((new Date).getTime());return url+(-1===url.indexOf("?")?"?":"&")+timestamp}function getTransforms(_ref){var rotate=_ref.rotate,scaleX=_ref.scaleX,scaleY=_ref.scaleY,translateX=_ref.translateX,translateY=_ref.translateY,values=[];isNumber(translateX)&&0!==translateX&&values.push("translateX(".concat(translateX,"px)")),isNumber(translateY)&&0!==translateY&&values.push("translateY(".concat(translateY,"px)")),isNumber(rotate)&&0!==rotate&&values.push("rotate(".concat(rotate,"deg)")),isNumber(scaleX)&&1!==scaleX&&values.push("scaleX(".concat(scaleX,")")),isNumber(scaleY)&&1!==scaleY&&values.push("scaleY(".concat(scaleY,")"));var transform=values.length?values.join(" "):"none";return{WebkitTransform:transform,msTransform:transform,transform:transform}}function getMaxZoomRatio(pointers){var pointers2=_objectSpread2({},pointers),maxRatio=0;return forEach(pointers,function(pointer,pointerId){delete pointers2[pointerId],forEach(pointers2,function(pointer2){var x1=Math.abs(pointer.startX-pointer2.startX),y1=Math.abs(pointer.startY-pointer2.startY),x2=Math.abs(pointer.endX-pointer2.endX),y2=Math.abs(pointer.endY-pointer2.endY),z1=Math.sqrt(x1*x1+y1*y1),ratio=(Math.sqrt(x2*x2+y2*y2)-z1)/z1;Math.abs(ratio)>Math.abs(maxRatio)&&(maxRatio=ratio)})}),maxRatio}function getPointer(_ref2,endOnly){var pageX=_ref2.pageX,pageY=_ref2.pageY,end={endX:pageX,endY:pageY};return endOnly?end:_objectSpread2({startX:pageX,startY:pageY},end)}function getPointersCenter(pointers){var pageX=0,pageY=0,count=0;return forEach(pointers,function(_ref3){var startX=_ref3.startX,startY=_ref3.startY;pageX+=startX,pageY+=startY,count+=1}),{pageX:pageX/=count,pageY:pageY/=count}}function getAdjustedSizes(_ref4){var aspectRatio=_ref4.aspectRatio,height=_ref4.height,width=_ref4.width,type=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"contain",isValidWidth=isPositiveNumber(width),isValidHeight=isPositiveNumber(height);if(isValidWidth&&isValidHeight){var adjustedWidth=height*aspectRatio;"contain"===type&&adjustedWidth>width||"cover"===type&&adjustedWidth<width?height=width/aspectRatio:width=height*aspectRatio}else isValidWidth?height=width/aspectRatio:isValidHeight&&(width=height*aspectRatio);return{width:width,height:height}}function getRotatedSizes(_ref5){var width=_ref5.width,height=_ref5.height,degree=_ref5.degree;if(90==(degree=Math.abs(degree)%180))return{width:height,height:width};var arc=degree%90*Math.PI/180,sinArc=Math.sin(arc),cosArc=Math.cos(arc),newWidth=width*cosArc+height*sinArc,newHeight=width*sinArc+height*cosArc;return degree>90?{width:newHeight,height:newWidth}:{width:newWidth,height:newHeight}}function getSourceCanvas(image,_ref6,_ref7,_ref8){var imageAspectRatio=_ref6.aspectRatio,imageNaturalWidth=_ref6.naturalWidth,imageNaturalHeight=_ref6.naturalHeight,_ref6$rotate=_ref6.rotate,rotate=void 0===_ref6$rotate?0:_ref6$rotate,_ref6$scaleX=_ref6.scaleX,scaleX=void 0===_ref6$scaleX?1:_ref6$scaleX,_ref6$scaleY=_ref6.scaleY,scaleY=void 0===_ref6$scaleY?1:_ref6$scaleY,aspectRatio=_ref7.aspectRatio,naturalWidth=_ref7.naturalWidth,naturalHeight=_ref7.naturalHeight,_ref8$fillColor=_ref8.fillColor,fillColor=void 0===_ref8$fillColor?"transparent":_ref8$fillColor,_ref8$imageSmoothingE=_ref8.imageSmoothingEnabled,imageSmoothingEnabled=void 0===_ref8$imageSmoothingE||_ref8$imageSmoothingE,_ref8$imageSmoothingQ=_ref8.imageSmoothingQuality,imageSmoothingQuality=void 0===_ref8$imageSmoothingQ?"low":_ref8$imageSmoothingQ,_ref8$maxWidth=_ref8.maxWidth,maxWidth=void 0===_ref8$maxWidth?1/0:_ref8$maxWidth,_ref8$maxHeight=_ref8.maxHeight,maxHeight=void 0===_ref8$maxHeight?1/0:_ref8$maxHeight,_ref8$minWidth=_ref8.minWidth,minWidth=void 0===_ref8$minWidth?0:_ref8$minWidth,_ref8$minHeight=_ref8.minHeight,minHeight=void 0===_ref8$minHeight?0:_ref8$minHeight,canvas=document.createElement("canvas"),context=canvas.getContext("2d"),maxSizes=getAdjustedSizes({aspectRatio:aspectRatio,width:maxWidth,height:maxHeight}),minSizes=getAdjustedSizes({aspectRatio:aspectRatio,width:minWidth,height:minHeight},"cover"),width=Math.min(maxSizes.width,Math.max(minSizes.width,naturalWidth)),height=Math.min(maxSizes.height,Math.max(minSizes.height,naturalHeight)),destMaxSizes=getAdjustedSizes({aspectRatio:imageAspectRatio,width:maxWidth,height:maxHeight}),destMinSizes=getAdjustedSizes({aspectRatio:imageAspectRatio,width:minWidth,height:minHeight},"cover"),destWidth=Math.min(destMaxSizes.width,Math.max(destMinSizes.width,imageNaturalWidth)),destHeight=Math.min(destMaxSizes.height,Math.max(destMinSizes.height,imageNaturalHeight)),params=[-destWidth/2,-destHeight/2,destWidth,destHeight];return canvas.width=normalizeDecimalNumber(width),canvas.height=normalizeDecimalNumber(height),context.fillStyle=fillColor,context.fillRect(0,0,width,height),context.save(),context.translate(width/2,height/2),context.rotate(rotate*Math.PI/180),context.scale(scaleX,scaleY),context.imageSmoothingEnabled=imageSmoothingEnabled,context.imageSmoothingQuality=imageSmoothingQuality,context.drawImage.apply(context,[image].concat(_toConsumableArray(params.map(function(param){return Math.floor(normalizeDecimalNumber(param))})))),context.restore(),canvas}var fromCharCode=String.fromCharCode;function getStringFromCharCode(dataView,start,length){var str="";length+=start;for(var i=start;i<length;i+=1)str+=fromCharCode(dataView.getUint8(i));return str}var REGEXP_DATA_URL_HEAD=/^data:.*,/;function dataURLToArrayBuffer(dataURL){var base64=dataURL.replace(REGEXP_DATA_URL_HEAD,""),binary=atob(base64),arrayBuffer=new ArrayBuffer(binary.length),uint8=new Uint8Array(arrayBuffer);return forEach(uint8,function(value,i){uint8[i]=binary.charCodeAt(i)}),arrayBuffer}function arrayBufferToDataURL(arrayBuffer,mimeType){for(var chunks=[],chunkSize=8192,uint8=new Uint8Array(arrayBuffer);uint8.length>0;)chunks.push(fromCharCode.apply(null,toArray(uint8.subarray(0,chunkSize)))),uint8=uint8.subarray(chunkSize);return"data:".concat(mimeType,";base64,").concat(btoa(chunks.join("")))}function resetAndGetOrientation(arrayBuffer){var orientation,dataView=new DataView(arrayBuffer);try{var littleEndian,app1Start,ifdStart;if(255===dataView.getUint8(0)&&216===dataView.getUint8(1))for(var length=dataView.byteLength,offset=2;offset+1<length;){if(255===dataView.getUint8(offset)&&225===dataView.getUint8(offset+1)){app1Start=offset;break}offset+=1}if(app1Start){var tiffOffset=app1Start+10;if("Exif"===getStringFromCharCode(dataView,app1Start+4,4)){var endianness=dataView.getUint16(tiffOffset);if(((littleEndian=18761===endianness)||19789===endianness)&&42===dataView.getUint16(tiffOffset+2,littleEndian)){var firstIFDOffset=dataView.getUint32(tiffOffset+4,littleEndian);firstIFDOffset>=8&&(ifdStart=tiffOffset+firstIFDOffset)}}}if(ifdStart){var _offset,i,_length=dataView.getUint16(ifdStart,littleEndian);for(i=0;i<_length;i+=1)if(_offset=ifdStart+12*i+2,274===dataView.getUint16(_offset,littleEndian)){_offset+=8,orientation=dataView.getUint16(_offset,littleEndian),dataView.setUint16(_offset,1,littleEndian);break}}}catch(error){orientation=1}return orientation}function parseOrientation(orientation){var rotate=0,scaleX=1,scaleY=1;switch(orientation){case 2:scaleX=-1;break;case 3:rotate=-180;break;case 4:scaleY=-1;break;case 5:rotate=90,scaleY=-1;break;case 6:rotate=90;break;case 7:rotate=90,scaleX=-1;break;case 8:rotate=-90}return{rotate:rotate,scaleX:scaleX,scaleY:scaleY}}var render={render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.cropped&&this.renderCropBox()},initContainer:function(){var element=this.element,options=this.options,container=this.container,cropper=this.cropper,minWidth=Number(options.minContainerWidth),minHeight=Number(options.minContainerHeight);addClass(cropper,CLASS_HIDDEN),removeClass(element,CLASS_HIDDEN);var containerData={width:Math.max(container.offsetWidth,minWidth>=0?minWidth:MIN_CONTAINER_WIDTH),height:Math.max(container.offsetHeight,minHeight>=0?minHeight:MIN_CONTAINER_HEIGHT)};this.containerData=containerData,setStyle(cropper,{width:containerData.width,height:containerData.height}),addClass(element,CLASS_HIDDEN),removeClass(cropper,CLASS_HIDDEN)},initCanvas:function(){var containerData=this.containerData,imageData=this.imageData,viewMode=this.options.viewMode,rotated=Math.abs(imageData.rotate)%180==90,naturalWidth=rotated?imageData.naturalHeight:imageData.naturalWidth,naturalHeight=rotated?imageData.naturalWidth:imageData.naturalHeight,aspectRatio=naturalWidth/naturalHeight,canvasWidth=containerData.width,canvasHeight=containerData.height;containerData.height*aspectRatio>containerData.width?3===viewMode?canvasWidth=containerData.height*aspectRatio:canvasHeight=containerData.width/aspectRatio:3===viewMode?canvasHeight=containerData.width/aspectRatio:canvasWidth=containerData.height*aspectRatio;var canvasData={aspectRatio:aspectRatio,naturalWidth:naturalWidth,naturalHeight:naturalHeight,width:canvasWidth,height:canvasHeight};this.canvasData=canvasData,this.limited=1===viewMode||2===viewMode,this.limitCanvas(!0,!0),canvasData.width=Math.min(Math.max(canvasData.width,canvasData.minWidth),canvasData.maxWidth),canvasData.height=Math.min(Math.max(canvasData.height,canvasData.minHeight),canvasData.maxHeight),canvasData.left=(containerData.width-canvasData.width)/2,canvasData.top=(containerData.height-canvasData.height)/2,canvasData.oldLeft=canvasData.left,canvasData.oldTop=canvasData.top,this.initialCanvasData=assign({},canvasData)},limitCanvas:function(sizeLimited,positionLimited){var options=this.options,containerData=this.containerData,canvasData=this.canvasData,cropBoxData=this.cropBoxData,viewMode=options.viewMode,aspectRatio=canvasData.aspectRatio,cropped=this.cropped&&cropBoxData;if(sizeLimited){var minCanvasWidth=Number(options.minCanvasWidth)||0,minCanvasHeight=Number(options.minCanvasHeight)||0;viewMode>1?(minCanvasWidth=Math.max(minCanvasWidth,containerData.width),minCanvasHeight=Math.max(minCanvasHeight,containerData.height),3===viewMode&&(minCanvasHeight*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio)):viewMode>0&&(minCanvasWidth?minCanvasWidth=Math.max(minCanvasWidth,cropped?cropBoxData.width:0):minCanvasHeight?minCanvasHeight=Math.max(minCanvasHeight,cropped?cropBoxData.height:0):cropped&&(minCanvasWidth=cropBoxData.width,(minCanvasHeight=cropBoxData.height)*aspectRatio>minCanvasWidth?minCanvasWidth=minCanvasHeight*aspectRatio:minCanvasHeight=minCanvasWidth/aspectRatio));var _getAdjustedSizes=getAdjustedSizes({aspectRatio:aspectRatio,width:minCanvasWidth,height:minCanvasHeight});minCanvasWidth=_getAdjustedSizes.width,minCanvasHeight=_getAdjustedSizes.height,canvasData.minWidth=minCanvasWidth,canvasData.minHeight=minCanvasHeight,canvasData.maxWidth=1/0,canvasData.maxHeight=1/0}if(positionLimited)if(viewMode>(cropped?0:1)){var newCanvasLeft=containerData.width-canvasData.width,newCanvasTop=containerData.height-canvasData.height;canvasData.minLeft=Math.min(0,newCanvasLeft),canvasData.minTop=Math.min(0,newCanvasTop),canvasData.maxLeft=Math.max(0,newCanvasLeft),canvasData.maxTop=Math.max(0,newCanvasTop),cropped&&this.limited&&(canvasData.minLeft=Math.min(cropBoxData.left,cropBoxData.left+(cropBoxData.width-canvasData.width)),canvasData.minTop=Math.min(cropBoxData.top,cropBoxData.top+(cropBoxData.height-canvasData.height)),canvasData.maxLeft=cropBoxData.left,canvasData.maxTop=cropBoxData.top,2===viewMode&&(canvasData.width>=containerData.width&&(canvasData.minLeft=Math.min(0,newCanvasLeft),canvasData.maxLeft=Math.max(0,newCanvasLeft)),canvasData.height>=containerData.height&&(canvasData.minTop=Math.min(0,newCanvasTop),canvasData.maxTop=Math.max(0,newCanvasTop))))}else canvasData.minLeft=-canvasData.width,canvasData.minTop=-canvasData.height,canvasData.maxLeft=containerData.width,canvasData.maxTop=containerData.height},renderCanvas:function(changed,transformed){var canvasData=this.canvasData,imageData=this.imageData;if(transformed){var _getRotatedSizes=getRotatedSizes({width:imageData.naturalWidth*Math.abs(imageData.scaleX||1),height:imageData.naturalHeight*Math.abs(imageData.scaleY||1),degree:imageData.rotate||0}),naturalWidth=_getRotatedSizes.width,naturalHeight=_getRotatedSizes.height,width=canvasData.width*(naturalWidth/canvasData.naturalWidth),height=canvasData.height*(naturalHeight/canvasData.naturalHeight);canvasData.left-=(width-canvasData.width)/2,canvasData.top-=(height-canvasData.height)/2,canvasData.width=width,canvasData.height=height,canvasData.aspectRatio=naturalWidth/naturalHeight,canvasData.naturalWidth=naturalWidth,canvasData.naturalHeight=naturalHeight,this.limitCanvas(!0,!1)}(canvasData.width>canvasData.maxWidth||canvasData.width<canvasData.minWidth)&&(canvasData.left=canvasData.oldLeft),(canvasData.height>canvasData.maxHeight||canvasData.height<canvasData.minHeight)&&(canvasData.top=canvasData.oldTop),canvasData.width=Math.min(Math.max(canvasData.width,canvasData.minWidth),canvasData.maxWidth),canvasData.height=Math.min(Math.max(canvasData.height,canvasData.minHeight),canvasData.maxHeight),this.limitCanvas(!1,!0),canvasData.left=Math.min(Math.max(canvasData.left,canvasData.minLeft),canvasData.maxLeft),canvasData.top=Math.min(Math.max(canvasData.top,canvasData.minTop),canvasData.maxTop),canvasData.oldLeft=canvasData.left,canvasData.oldTop=canvasData.top,setStyle(this.canvas,assign({width:canvasData.width,height:canvasData.height},getTransforms({translateX:canvasData.left,translateY:canvasData.top}))),this.renderImage(changed),this.cropped&&this.limited&&this.limitCropBox(!0,!0)},renderImage:function(changed){var canvasData=this.canvasData,imageData=this.imageData,width=imageData.naturalWidth*(canvasData.width/canvasData.naturalWidth),height=imageData.naturalHeight*(canvasData.height/canvasData.naturalHeight);assign(imageData,{width:width,height:height,left:(canvasData.width-width)/2,top:(canvasData.height-height)/2}),setStyle(this.image,assign({width:imageData.width,height:imageData.height},getTransforms(assign({translateX:imageData.left,translateY:imageData.top},imageData)))),changed&&this.output()},initCropBox:function(){var options=this.options,canvasData=this.canvasData,aspectRatio=options.aspectRatio||options.initialAspectRatio,autoCropArea=Number(options.autoCropArea)||.8,cropBoxData={width:canvasData.width,height:canvasData.height};aspectRatio&&(canvasData.height*aspectRatio>canvasData.width?cropBoxData.height=cropBoxData.width/aspectRatio:cropBoxData.width=cropBoxData.height*aspectRatio),this.cropBoxData=cropBoxData,this.limitCropBox(!0,!0),cropBoxData.width=Math.min(Math.max(cropBoxData.width,cropBoxData.minWidth),cropBoxData.maxWidth),cropBoxData.height=Math.min(Math.max(cropBoxData.height,cropBoxData.minHeight),cropBoxData.maxHeight),cropBoxData.width=Math.max(cropBoxData.minWidth,cropBoxData.width*autoCropArea),cropBoxData.height=Math.max(cropBoxData.minHeight,cropBoxData.height*autoCropArea),cropBoxData.left=canvasData.left+(canvasData.width-cropBoxData.width)/2,cropBoxData.top=canvasData.top+(canvasData.height-cropBoxData.height)/2,cropBoxData.oldLeft=cropBoxData.left,cropBoxData.oldTop=cropBoxData.top,this.initialCropBoxData=assign({},cropBoxData)},limitCropBox:function(sizeLimited,positionLimited){var options=this.options,containerData=this.containerData,canvasData=this.canvasData,cropBoxData=this.cropBoxData,limited=this.limited,aspectRatio=options.aspectRatio;if(sizeLimited){var minCropBoxWidth=Number(options.minCropBoxWidth)||0,minCropBoxHeight=Number(options.minCropBoxHeight)||0,maxCropBoxWidth=limited?Math.min(containerData.width,canvasData.width,canvasData.width+canvasData.left,containerData.width-canvasData.left):containerData.width,maxCropBoxHeight=limited?Math.min(containerData.height,canvasData.height,canvasData.height+canvasData.top,containerData.height-canvasData.top):containerData.height;minCropBoxWidth=Math.min(minCropBoxWidth,containerData.width),minCropBoxHeight=Math.min(minCropBoxHeight,containerData.height),aspectRatio&&(minCropBoxWidth&&minCropBoxHeight?minCropBoxHeight*aspectRatio>minCropBoxWidth?minCropBoxHeight=minCropBoxWidth/aspectRatio:minCropBoxWidth=minCropBoxHeight*aspectRatio:minCropBoxWidth?minCropBoxHeight=minCropBoxWidth/aspectRatio:minCropBoxHeight&&(minCropBoxWidth=minCropBoxHeight*aspectRatio),maxCropBoxHeight*aspectRatio>maxCropBoxWidth?maxCropBoxHeight=maxCropBoxWidth/aspectRatio:maxCropBoxWidth=maxCropBoxHeight*aspectRatio),cropBoxData.minWidth=Math.min(minCropBoxWidth,maxCropBoxWidth),cropBoxData.minHeight=Math.min(minCropBoxHeight,maxCropBoxHeight),cropBoxData.maxWidth=maxCropBoxWidth,cropBoxData.maxHeight=maxCropBoxHeight}positionLimited&&(limited?(cropBoxData.minLeft=Math.max(0,canvasData.left),cropBoxData.minTop=Math.max(0,canvasData.top),cropBoxData.maxLeft=Math.min(containerData.width,canvasData.left+canvasData.width)-cropBoxData.width,cropBoxData.maxTop=Math.min(containerData.height,canvasData.top+canvasData.height)-cropBoxData.height):(cropBoxData.minLeft=0,cropBoxData.minTop=0,cropBoxData.maxLeft=containerData.width-cropBoxData.width,cropBoxData.maxTop=containerData.height-cropBoxData.height))},renderCropBox:function(){var options=this.options,containerData=this.containerData,cropBoxData=this.cropBoxData;(cropBoxData.width>cropBoxData.maxWidth||cropBoxData.width<cropBoxData.minWidth)&&(cropBoxData.left=cropBoxData.oldLeft),(cropBoxData.height>cropBoxData.maxHeight||cropBoxData.height<cropBoxData.minHeight)&&(cropBoxData.top=cropBoxData.oldTop),cropBoxData.width=Math.min(Math.max(cropBoxData.width,cropBoxData.minWidth),cropBoxData.maxWidth),cropBoxData.height=Math.min(Math.max(cropBoxData.height,cropBoxData.minHeight),cropBoxData.maxHeight),this.limitCropBox(!1,!0),cropBoxData.left=Math.min(Math.max(cropBoxData.left,cropBoxData.minLeft),cropBoxData.maxLeft),cropBoxData.top=Math.min(Math.max(cropBoxData.top,cropBoxData.minTop),cropBoxData.maxTop),cropBoxData.oldLeft=cropBoxData.left,cropBoxData.oldTop=cropBoxData.top,options.movable&&options.cropBoxMovable&&setData(this.face,DATA_ACTION,cropBoxData.width>=containerData.width&&cropBoxData.height>=containerData.height?ACTION_MOVE:ACTION_ALL),setStyle(this.cropBox,assign({width:cropBoxData.width,height:cropBoxData.height},getTransforms({translateX:cropBoxData.left,translateY:cropBoxData.top}))),this.cropped&&this.limited&&this.limitCanvas(!0,!0),this.disabled||this.output()},output:function(){this.preview(),dispatchEvent(this.element,EVENT_CROP,this.getData())}},preview={initPreview:function(){var element=this.element,crossOrigin=this.crossOrigin,preview=this.options.preview,url=crossOrigin?this.crossOriginUrl:this.url,alt=element.alt||"The image to preview",image=document.createElement("img");if(crossOrigin&&(image.crossOrigin=crossOrigin),image.src=url,image.alt=alt,this.viewBox.appendChild(image),this.viewBoxImage=image,preview){var previews=preview;"string"==typeof preview?previews=element.ownerDocument.querySelectorAll(preview):preview.querySelector&&(previews=[preview]),this.previews=previews,forEach(previews,function(el){var img=document.createElement("img");setData(el,DATA_PREVIEW,{width:el.offsetWidth,height:el.offsetHeight,html:el.innerHTML}),crossOrigin&&(img.crossOrigin=crossOrigin),img.src=url,img.alt=alt,img.style.cssText='display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;"',el.innerHTML="",el.appendChild(img)})}},resetPreview:function(){forEach(this.previews,function(element){var data=getData(element,DATA_PREVIEW);setStyle(element,{width:data.width,height:data.height}),element.innerHTML=data.html,removeData(element,DATA_PREVIEW)})},preview:function(){var imageData=this.imageData,canvasData=this.canvasData,cropBoxData=this.cropBoxData,cropBoxWidth=cropBoxData.width,cropBoxHeight=cropBoxData.height,width=imageData.width,height=imageData.height,left=cropBoxData.left-canvasData.left-imageData.left,top=cropBoxData.top-canvasData.top-imageData.top;this.cropped&&!this.disabled&&(setStyle(this.viewBoxImage,assign({width:width,height:height},getTransforms(assign({translateX:-left,translateY:-top},imageData)))),forEach(this.previews,function(element){var data=getData(element,DATA_PREVIEW),originalWidth=data.width,originalHeight=data.height,newWidth=originalWidth,newHeight=originalHeight,ratio=1;cropBoxWidth&&(newHeight=cropBoxHeight*(ratio=originalWidth/cropBoxWidth)),cropBoxHeight&&newHeight>originalHeight&&(newWidth=cropBoxWidth*(ratio=originalHeight/cropBoxHeight),newHeight=originalHeight),setStyle(element,{width:newWidth,height:newHeight}),setStyle(element.getElementsByTagName("img")[0],assign({width:width*ratio,height:height*ratio},getTransforms(assign({translateX:-left*ratio,translateY:-top*ratio},imageData))))}))}},events={bind:function(){var element=this.element,options=this.options,cropper=this.cropper;isFunction(options.cropstart)&&addListener(element,EVENT_CROP_START,options.cropstart),isFunction(options.cropmove)&&addListener(element,EVENT_CROP_MOVE,options.cropmove),isFunction(options.cropend)&&addListener(element,EVENT_CROP_END,options.cropend),isFunction(options.crop)&&addListener(element,EVENT_CROP,options.crop),isFunction(options.zoom)&&addListener(element,EVENT_ZOOM,options.zoom),addListener(cropper,EVENT_POINTER_DOWN,this.onCropStart=this.cropStart.bind(this)),options.zoomable&&options.zoomOnWheel&&addListener(cropper,EVENT_WHEEL,this.onWheel=this.wheel.bind(this),{passive:!1,capture:!0}),options.toggleDragModeOnDblclick&&addListener(cropper,EVENT_DBLCLICK,this.onDblclick=this.dblclick.bind(this)),addListener(element.ownerDocument,EVENT_POINTER_MOVE,this.onCropMove=this.cropMove.bind(this)),addListener(element.ownerDocument,EVENT_POINTER_UP,this.onCropEnd=this.cropEnd.bind(this)),options.responsive&&addListener(window,EVENT_RESIZE,this.onResize=this.resize.bind(this))},unbind:function(){var element=this.element,options=this.options,cropper=this.cropper;isFunction(options.cropstart)&&removeListener(element,EVENT_CROP_START,options.cropstart),isFunction(options.cropmove)&&removeListener(element,EVENT_CROP_MOVE,options.cropmove),isFunction(options.cropend)&&removeListener(element,EVENT_CROP_END,options.cropend),isFunction(options.crop)&&removeListener(element,EVENT_CROP,options.crop),isFunction(options.zoom)&&removeListener(element,EVENT_ZOOM,options.zoom),removeListener(cropper,EVENT_POINTER_DOWN,this.onCropStart),options.zoomable&&options.zoomOnWheel&&removeListener(cropper,EVENT_WHEEL,this.onWheel,{passive:!1,capture:!0}),options.toggleDragModeOnDblclick&&removeListener(cropper,EVENT_DBLCLICK,this.onDblclick),removeListener(element.ownerDocument,EVENT_POINTER_MOVE,this.onCropMove),removeListener(element.ownerDocument,EVENT_POINTER_UP,this.onCropEnd),options.responsive&&removeListener(window,EVENT_RESIZE,this.onResize)}},handlers={resize:function(){if(!this.disabled){var canvasData,cropBoxData,options=this.options,container=this.container,containerData=this.containerData,ratioX=container.offsetWidth/containerData.width,ratioY=container.offsetHeight/containerData.height,ratio=Math.abs(ratioX-1)>Math.abs(ratioY-1)?ratioX:ratioY;1!==ratio&&(options.restore&&(canvasData=this.getCanvasData(),cropBoxData=this.getCropBoxData()),this.render(),options.restore&&(this.setCanvasData(forEach(canvasData,function(n,i){canvasData[i]=n*ratio})),this.setCropBoxData(forEach(cropBoxData,function(n,i){cropBoxData[i]=n*ratio}))))}},dblclick:function(){this.disabled||this.options.dragMode===DRAG_MODE_NONE||this.setDragMode(hasClass(this.dragBox,CLASS_CROP)?DRAG_MODE_MOVE:DRAG_MODE_CROP)},wheel:function(event){var _this=this,ratio=Number(this.options.wheelZoomRatio)||.1,delta=1;this.disabled||(event.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(function(){_this.wheeling=!1},50),event.deltaY?delta=event.deltaY>0?1:-1:event.wheelDelta?delta=-event.wheelDelta/120:event.detail&&(delta=event.detail>0?1:-1),this.zoom(-delta*ratio,event)))},cropStart:function(event){var buttons=event.buttons,button=event.button;if(!(this.disabled||("mousedown"===event.type||"pointerdown"===event.type&&"mouse"===event.pointerType)&&(isNumber(buttons)&&1!==buttons||isNumber(button)&&0!==button||event.ctrlKey))){var action,options=this.options,pointers=this.pointers;event.changedTouches?forEach(event.changedTouches,function(touch){pointers[touch.identifier]=getPointer(touch)}):pointers[event.pointerId||0]=getPointer(event),action=Object.keys(pointers).length>1&&options.zoomable&&options.zoomOnTouch?ACTION_ZOOM:getData(event.target,DATA_ACTION),REGEXP_ACTIONS.test(action)&&!1!==dispatchEvent(this.element,EVENT_CROP_START,{originalEvent:event,action:action})&&(event.preventDefault(),this.action=action,this.cropping=!1,action===ACTION_CROP&&(this.cropping=!0,addClass(this.dragBox,CLASS_MODAL)))}},cropMove:function(event){var action=this.action;if(!this.disabled&&action){var pointers=this.pointers;event.preventDefault(),!1!==dispatchEvent(this.element,EVENT_CROP_MOVE,{originalEvent:event,action:action})&&(event.changedTouches?forEach(event.changedTouches,function(touch){assign(pointers[touch.identifier]||{},getPointer(touch,!0))}):assign(pointers[event.pointerId||0]||{},getPointer(event,!0)),this.change(event))}},cropEnd:function(event){if(!this.disabled){var action=this.action,pointers=this.pointers;event.changedTouches?forEach(event.changedTouches,function(touch){delete pointers[touch.identifier]}):delete pointers[event.pointerId||0],action&&(event.preventDefault(),Object.keys(pointers).length||(this.action=""),this.cropping&&(this.cropping=!1,toggleClass(this.dragBox,CLASS_MODAL,this.cropped&&this.options.modal)),dispatchEvent(this.element,EVENT_CROP_END,{originalEvent:event,action:action}))}}},change={change:function(event){var offset,options=this.options,canvasData=this.canvasData,containerData=this.containerData,cropBoxData=this.cropBoxData,pointers=this.pointers,action=this.action,aspectRatio=options.aspectRatio,left=cropBoxData.left,top=cropBoxData.top,width=cropBoxData.width,height=cropBoxData.height,right=left+width,bottom=top+height,minLeft=0,minTop=0,maxWidth=containerData.width,maxHeight=containerData.height,renderable=!0;!aspectRatio&&event.shiftKey&&(aspectRatio=width&&height?width/height:1),this.limited&&(minLeft=cropBoxData.minLeft,minTop=cropBoxData.minTop,maxWidth=minLeft+Math.min(containerData.width,canvasData.width,canvasData.left+canvasData.width),maxHeight=minTop+Math.min(containerData.height,canvasData.height,canvasData.top+canvasData.height));var pointer=pointers[Object.keys(pointers)[0]],range={x:pointer.endX-pointer.startX,y:pointer.endY-pointer.startY},check=function(side){switch(side){case ACTION_EAST:right+range.x>maxWidth&&(range.x=maxWidth-right);break;case ACTION_WEST:left+range.x<minLeft&&(range.x=minLeft-left);break;case ACTION_NORTH:top+range.y<minTop&&(range.y=minTop-top);break;case ACTION_SOUTH:bottom+range.y>maxHeight&&(range.y=maxHeight-bottom)}};switch(action){case ACTION_ALL:left+=range.x,top+=range.y;break;case ACTION_EAST:if(range.x>=0&&(right>=maxWidth||aspectRatio&&(top<=minTop||bottom>=maxHeight))){renderable=!1;break}check(ACTION_EAST),(width+=range.x)<0&&(action=ACTION_WEST,left-=width=-width),aspectRatio&&(height=width/aspectRatio,top+=(cropBoxData.height-height)/2);break;case ACTION_NORTH:if(range.y<=0&&(top<=minTop||aspectRatio&&(left<=minLeft||right>=maxWidth))){renderable=!1;break}check(ACTION_NORTH),height-=range.y,top+=range.y,height<0&&(action=ACTION_SOUTH,top-=height=-height),aspectRatio&&(width=height*aspectRatio,left+=(cropBoxData.width-width)/2);break;case ACTION_WEST:if(range.x<=0&&(left<=minLeft||aspectRatio&&(top<=minTop||bottom>=maxHeight))){renderable=!1;break}check(ACTION_WEST),width-=range.x,left+=range.x,width<0&&(action=ACTION_EAST,left-=width=-width),aspectRatio&&(height=width/aspectRatio,top+=(cropBoxData.height-height)/2);break;case ACTION_SOUTH:if(range.y>=0&&(bottom>=maxHeight||aspectRatio&&(left<=minLeft||right>=maxWidth))){renderable=!1;break}check(ACTION_SOUTH),(height+=range.y)<0&&(action=ACTION_NORTH,top-=height=-height),aspectRatio&&(width=height*aspectRatio,left+=(cropBoxData.width-width)/2);break;case ACTION_NORTH_EAST:if(aspectRatio){if(range.y<=0&&(top<=minTop||right>=maxWidth)){renderable=!1;break}check(ACTION_NORTH),height-=range.y,top+=range.y,width=height*aspectRatio}else check(ACTION_NORTH),check(ACTION_EAST),range.x>=0?right<maxWidth?width+=range.x:range.y<=0&&top<=minTop&&(renderable=!1):width+=range.x,range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);width<0&&height<0?(action=ACTION_SOUTH_WEST,top-=height=-height,left-=width=-width):width<0?(action=ACTION_NORTH_WEST,left-=width=-width):height<0&&(action=ACTION_SOUTH_EAST,top-=height=-height);break;case ACTION_NORTH_WEST:if(aspectRatio){if(range.y<=0&&(top<=minTop||left<=minLeft)){renderable=!1;break}check(ACTION_NORTH),height-=range.y,top+=range.y,width=height*aspectRatio,left+=cropBoxData.width-width}else check(ACTION_NORTH),check(ACTION_WEST),range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y<=0&&top<=minTop&&(renderable=!1):(width-=range.x,left+=range.x),range.y<=0?top>minTop&&(height-=range.y,top+=range.y):(height-=range.y,top+=range.y);width<0&&height<0?(action=ACTION_SOUTH_EAST,top-=height=-height,left-=width=-width):width<0?(action=ACTION_NORTH_EAST,left-=width=-width):height<0&&(action=ACTION_SOUTH_WEST,top-=height=-height);break;case ACTION_SOUTH_WEST:if(aspectRatio){if(range.x<=0&&(left<=minLeft||bottom>=maxHeight)){renderable=!1;break}check(ACTION_WEST),width-=range.x,left+=range.x,height=width/aspectRatio}else check(ACTION_SOUTH),check(ACTION_WEST),range.x<=0?left>minLeft?(width-=range.x,left+=range.x):range.y>=0&&bottom>=maxHeight&&(renderable=!1):(width-=range.x,left+=range.x),range.y>=0?bottom<maxHeight&&(height+=range.y):height+=range.y;width<0&&height<0?(action=ACTION_NORTH_EAST,top-=height=-height,left-=width=-width):width<0?(action=ACTION_SOUTH_EAST,left-=width=-width):height<0&&(action=ACTION_NORTH_WEST,top-=height=-height);break;case ACTION_SOUTH_EAST:if(aspectRatio){if(range.x>=0&&(right>=maxWidth||bottom>=maxHeight)){renderable=!1;break}check(ACTION_EAST),height=(width+=range.x)/aspectRatio}else check(ACTION_SOUTH),check(ACTION_EAST),range.x>=0?right<maxWidth?width+=range.x:range.y>=0&&bottom>=maxHeight&&(renderable=!1):width+=range.x,range.y>=0?bottom<maxHeight&&(height+=range.y):height+=range.y;width<0&&height<0?(action=ACTION_NORTH_WEST,top-=height=-height,left-=width=-width):width<0?(action=ACTION_SOUTH_WEST,left-=width=-width):height<0&&(action=ACTION_NORTH_EAST,top-=height=-height);break;case ACTION_MOVE:this.move(range.x,range.y),renderable=!1;break;case ACTION_ZOOM:this.zoom(getMaxZoomRatio(pointers),event),renderable=!1;break;case ACTION_CROP:if(!range.x||!range.y){renderable=!1;break}offset=getOffset(this.cropper),left=pointer.startX-offset.left,top=pointer.startY-offset.top,width=cropBoxData.minWidth,height=cropBoxData.minHeight,range.x>0?action=range.y>0?ACTION_SOUTH_EAST:ACTION_NORTH_EAST:range.x<0&&(left-=width,action=range.y>0?ACTION_SOUTH_WEST:ACTION_NORTH_WEST),range.y<0&&(top-=height),this.cropped||(removeClass(this.cropBox,CLASS_HIDDEN),this.cropped=!0,this.limited&&this.limitCropBox(!0,!0))}renderable&&(cropBoxData.width=width,cropBoxData.height=height,cropBoxData.left=left,cropBoxData.top=top,this.action=action,this.renderCropBox()),forEach(pointers,function(p){p.startX=p.endX,p.startY=p.endY})}},methods={crop:function(){return!this.ready||this.cropped||this.disabled||(this.cropped=!0,this.limitCropBox(!0,!0),this.options.modal&&addClass(this.dragBox,CLASS_MODAL),removeClass(this.cropBox,CLASS_HIDDEN),this.setCropBoxData(this.initialCropBoxData)),this},reset:function(){return this.ready&&!this.disabled&&(this.imageData=assign({},this.initialImageData),this.canvasData=assign({},this.initialCanvasData),this.cropBoxData=assign({},this.initialCropBoxData),this.renderCanvas(),this.cropped&&this.renderCropBox()),this},clear:function(){return this.cropped&&!this.disabled&&(assign(this.cropBoxData,{left:0,top:0,width:0,height:0}),this.cropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),removeClass(this.dragBox,CLASS_MODAL),addClass(this.cropBox,CLASS_HIDDEN)),this},replace:function(url){var hasSameSize=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.disabled&&url&&(this.isImg&&(this.element.src=url),hasSameSize?(this.url=url,this.image.src=url,this.ready&&(this.viewBoxImage.src=url,forEach(this.previews,function(element){element.getElementsByTagName("img")[0].src=url}))):(this.isImg&&(this.replaced=!0),this.options.data=null,this.uncreate(),this.load(url))),this},enable:function(){return this.ready&&this.disabled&&(this.disabled=!1,removeClass(this.cropper,CLASS_DISABLED)),this},disable:function(){return this.ready&&!this.disabled&&(this.disabled=!0,addClass(this.cropper,CLASS_DISABLED)),this},destroy:function(){var element=this.element;return element[NAMESPACE]?(element[NAMESPACE]=void 0,this.isImg&&this.replaced&&(element.src=this.originalUrl),this.uncreate(),this):this},move:function(offsetX){var offsetY=arguments.length>1&&void 0!==arguments[1]?arguments[1]:offsetX,_this$canvasData=this.canvasData,left=_this$canvasData.left,top=_this$canvasData.top;return this.moveTo(isUndefined(offsetX)?offsetX:left+Number(offsetX),isUndefined(offsetY)?offsetY:top+Number(offsetY))},moveTo:function(x){var y=arguments.length>1&&void 0!==arguments[1]?arguments[1]:x,canvasData=this.canvasData,changed=!1;return x=Number(x),y=Number(y),this.ready&&!this.disabled&&this.options.movable&&(isNumber(x)&&(canvasData.left=x,changed=!0),isNumber(y)&&(canvasData.top=y,changed=!0),changed&&this.renderCanvas(!0)),this},zoom:function(ratio,_originalEvent){var canvasData=this.canvasData;return ratio=(ratio=Number(ratio))<0?1/(1-ratio):1+ratio,this.zoomTo(canvasData.width*ratio/canvasData.naturalWidth,null,_originalEvent)},zoomTo:function(ratio,pivot,_originalEvent){var options=this.options,canvasData=this.canvasData,width=canvasData.width,height=canvasData.height,naturalWidth=canvasData.naturalWidth,naturalHeight=canvasData.naturalHeight;if((ratio=Number(ratio))>=0&&this.ready&&!this.disabled&&options.zoomable){var newWidth=naturalWidth*ratio,newHeight=naturalHeight*ratio;if(!1===dispatchEvent(this.element,EVENT_ZOOM,{ratio:ratio,oldRatio:width/naturalWidth,originalEvent:_originalEvent}))return this;if(_originalEvent){var pointers=this.pointers,offset=getOffset(this.cropper),center=pointers&&Object.keys(pointers).length?getPointersCenter(pointers):{pageX:_originalEvent.pageX,pageY:_originalEvent.pageY};canvasData.left-=(newWidth-width)*((center.pageX-offset.left-canvasData.left)/width),canvasData.top-=(newHeight-height)*((center.pageY-offset.top-canvasData.top)/height)}else isPlainObject(pivot)&&isNumber(pivot.x)&&isNumber(pivot.y)?(canvasData.left-=(newWidth-width)*((pivot.x-canvasData.left)/width),canvasData.top-=(newHeight-height)*((pivot.y-canvasData.top)/height)):(canvasData.left-=(newWidth-width)/2,canvasData.top-=(newHeight-height)/2);canvasData.width=newWidth,canvasData.height=newHeight,this.renderCanvas(!0)}return this},rotate:function(degree){return this.rotateTo((this.imageData.rotate||0)+Number(degree))},rotateTo:function(degree){return isNumber(degree=Number(degree))&&this.ready&&!this.disabled&&this.options.rotatable&&(this.imageData.rotate=degree%360,this.renderCanvas(!0,!0)),this},scaleX:function(_scaleX){var scaleY=this.imageData.scaleY;return this.scale(_scaleX,isNumber(scaleY)?scaleY:1)},scaleY:function(_scaleY){var scaleX=this.imageData.scaleX;return this.scale(isNumber(scaleX)?scaleX:1,_scaleY)},scale:function(scaleX){var scaleY=arguments.length>1&&void 0!==arguments[1]?arguments[1]:scaleX,imageData=this.imageData,transformed=!1;return scaleX=Number(scaleX),scaleY=Number(scaleY),this.ready&&!this.disabled&&this.options.scalable&&(isNumber(scaleX)&&(imageData.scaleX=scaleX,transformed=!0),isNumber(scaleY)&&(imageData.scaleY=scaleY,transformed=!0),transformed&&this.renderCanvas(!0,!0)),this},getData:function(){var data,rounded=arguments.length>0&&void 0!==arguments[0]&&arguments[0],options=this.options,imageData=this.imageData,canvasData=this.canvasData,cropBoxData=this.cropBoxData;if(this.ready&&this.cropped){data={x:cropBoxData.left-canvasData.left,y:cropBoxData.top-canvasData.top,width:cropBoxData.width,height:cropBoxData.height};var ratio=imageData.width/imageData.naturalWidth;if(forEach(data,function(n,i){data[i]=n/ratio}),rounded){var bottom=Math.round(data.y+data.height),right=Math.round(data.x+data.width);data.x=Math.round(data.x),data.y=Math.round(data.y),data.width=right-data.x,data.height=bottom-data.y}}else data={x:0,y:0,width:0,height:0};return options.rotatable&&(data.rotate=imageData.rotate||0),options.scalable&&(data.scaleX=imageData.scaleX||1,data.scaleY=imageData.scaleY||1),data},setData:function(data){var options=this.options,imageData=this.imageData,canvasData=this.canvasData,cropBoxData={};if(this.ready&&!this.disabled&&isPlainObject(data)){var transformed=!1;options.rotatable&&isNumber(data.rotate)&&data.rotate!==imageData.rotate&&(imageData.rotate=data.rotate,transformed=!0),options.scalable&&(isNumber(data.scaleX)&&data.scaleX!==imageData.scaleX&&(imageData.scaleX=data.scaleX,transformed=!0),isNumber(data.scaleY)&&data.scaleY!==imageData.scaleY&&(imageData.scaleY=data.scaleY,transformed=!0)),transformed&&this.renderCanvas(!0,!0);var ratio=imageData.width/imageData.naturalWidth;isNumber(data.x)&&(cropBoxData.left=data.x*ratio+canvasData.left),isNumber(data.y)&&(cropBoxData.top=data.y*ratio+canvasData.top),isNumber(data.width)&&(cropBoxData.width=data.width*ratio),isNumber(data.height)&&(cropBoxData.height=data.height*ratio),this.setCropBoxData(cropBoxData)}return this},getContainerData:function(){return this.ready?assign({},this.containerData):{}},getImageData:function(){return this.sized?assign({},this.imageData):{}},getCanvasData:function(){var canvasData=this.canvasData,data={};return this.ready&&forEach(["left","top","width","height","naturalWidth","naturalHeight"],function(n){data[n]=canvasData[n]}),data},setCanvasData:function(data){var canvasData=this.canvasData,aspectRatio=canvasData.aspectRatio;return this.ready&&!this.disabled&&isPlainObject(data)&&(isNumber(data.left)&&(canvasData.left=data.left),isNumber(data.top)&&(canvasData.top=data.top),isNumber(data.width)?(canvasData.width=data.width,canvasData.height=data.width/aspectRatio):isNumber(data.height)&&(canvasData.height=data.height,canvasData.width=data.height*aspectRatio),this.renderCanvas(!0)),this},getCropBoxData:function(){var data,cropBoxData=this.cropBoxData;return this.ready&&this.cropped&&(data={left:cropBoxData.left,top:cropBoxData.top,width:cropBoxData.width,height:cropBoxData.height}),data||{}},setCropBoxData:function(data){var widthChanged,heightChanged,cropBoxData=this.cropBoxData,aspectRatio=this.options.aspectRatio;return this.ready&&this.cropped&&!this.disabled&&isPlainObject(data)&&(isNumber(data.left)&&(cropBoxData.left=data.left),isNumber(data.top)&&(cropBoxData.top=data.top),isNumber(data.width)&&data.width!==cropBoxData.width&&(widthChanged=!0,cropBoxData.width=data.width),isNumber(data.height)&&data.height!==cropBoxData.height&&(heightChanged=!0,cropBoxData.height=data.height),aspectRatio&&(widthChanged?cropBoxData.height=cropBoxData.width/aspectRatio:heightChanged&&(cropBoxData.width=cropBoxData.height*aspectRatio)),this.renderCropBox()),this},getCroppedCanvas:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.ready||!window.HTMLCanvasElement)return null;var canvasData=this.canvasData,source=getSourceCanvas(this.image,this.imageData,canvasData,options);if(!this.cropped)return source;var _this$getData=this.getData(options.rounded),initialX=_this$getData.x,initialY=_this$getData.y,initialWidth=_this$getData.width,initialHeight=_this$getData.height,ratio=source.width/Math.floor(canvasData.naturalWidth);1!==ratio&&(initialX*=ratio,initialY*=ratio,initialWidth*=ratio,initialHeight*=ratio);var aspectRatio=initialWidth/initialHeight,maxSizes=getAdjustedSizes({aspectRatio:aspectRatio,width:options.maxWidth||1/0,height:options.maxHeight||1/0}),minSizes=getAdjustedSizes({aspectRatio:aspectRatio,width:options.minWidth||0,height:options.minHeight||0},"cover"),_getAdjustedSizes=getAdjustedSizes({aspectRatio:aspectRatio,width:options.width||(1!==ratio?source.width:initialWidth),height:options.height||(1!==ratio?source.height:initialHeight)}),width=_getAdjustedSizes.width,height=_getAdjustedSizes.height;width=Math.min(maxSizes.width,Math.max(minSizes.width,width)),height=Math.min(maxSizes.height,Math.max(minSizes.height,height));var canvas=document.createElement("canvas"),context=canvas.getContext("2d");canvas.width=normalizeDecimalNumber(width),canvas.height=normalizeDecimalNumber(height),context.fillStyle=options.fillColor||"transparent",context.fillRect(0,0,width,height);var _options$imageSmoothi=options.imageSmoothingEnabled,imageSmoothingEnabled=void 0===_options$imageSmoothi||_options$imageSmoothi,imageSmoothingQuality=options.imageSmoothingQuality;context.imageSmoothingEnabled=imageSmoothingEnabled,imageSmoothingQuality&&(context.imageSmoothingQuality=imageSmoothingQuality);var srcWidth,srcHeight,dstX,dstY,dstWidth,dstHeight,sourceWidth=source.width,sourceHeight=source.height,srcX=initialX,srcY=initialY;srcX<=-initialWidth||srcX>sourceWidth?(srcX=0,srcWidth=0,dstX=0,dstWidth=0):srcX<=0?(dstX=-srcX,srcX=0,dstWidth=srcWidth=Math.min(sourceWidth,initialWidth+srcX)):srcX<=sourceWidth&&(dstX=0,dstWidth=srcWidth=Math.min(initialWidth,sourceWidth-srcX)),srcWidth<=0||srcY<=-initialHeight||srcY>sourceHeight?(srcY=0,srcHeight=0,dstY=0,dstHeight=0):srcY<=0?(dstY=-srcY,srcY=0,dstHeight=srcHeight=Math.min(sourceHeight,initialHeight+srcY)):srcY<=sourceHeight&&(dstY=0,dstHeight=srcHeight=Math.min(initialHeight,sourceHeight-srcY));var params=[srcX,srcY,srcWidth,srcHeight];if(dstWidth>0&&dstHeight>0){var scale=width/initialWidth;params.push(dstX*scale,dstY*scale,dstWidth*scale,dstHeight*scale)}return context.drawImage.apply(context,[source].concat(_toConsumableArray(params.map(function(param){return Math.floor(normalizeDecimalNumber(param))})))),canvas},setAspectRatio:function(aspectRatio){var options=this.options;return this.disabled||isUndefined(aspectRatio)||(options.aspectRatio=Math.max(0,aspectRatio)||NaN,this.ready&&(this.initCropBox(),this.cropped&&this.renderCropBox())),this},setDragMode:function(mode){var options=this.options,dragBox=this.dragBox,face=this.face;if(this.ready&&!this.disabled){var croppable=mode===DRAG_MODE_CROP,movable=options.movable&&mode===DRAG_MODE_MOVE;mode=croppable||movable?mode:DRAG_MODE_NONE,options.dragMode=mode,setData(dragBox,DATA_ACTION,mode),toggleClass(dragBox,CLASS_CROP,croppable),toggleClass(dragBox,CLASS_MOVE,movable),options.cropBoxMovable||(setData(face,DATA_ACTION,mode),toggleClass(face,CLASS_CROP,croppable),toggleClass(face,CLASS_MOVE,movable))}return this}},AnotherCropper=WINDOW.Cropper,Cropper=function(){function Cropper(element){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,Cropper),!element||!REGEXP_TAG_NAME.test(element.tagName))throw new Error("The first argument is required and must be an <img> or <canvas> element.");this.element=element,this.options=assign({},DEFAULTS,isPlainObject(options)&&options),this.cropped=!1,this.disabled=!1,this.pointers={},this.ready=!1,this.reloading=!1,this.replaced=!1,this.sized=!1,this.sizing=!1,this.init()}return _createClass(Cropper,[{key:"init",value:function(){var url,element=this.element,tagName=element.tagName.toLowerCase();if(!element[NAMESPACE]){if(element[NAMESPACE]=this,"img"===tagName){if(this.isImg=!0,url=element.getAttribute("src")||"",this.originalUrl=url,!url)return;url=element.src}else"canvas"===tagName&&window.HTMLCanvasElement&&(url=element.toDataURL());this.load(url)}}},{key:"load",value:function(url){var _this=this;if(url){this.url=url,this.imageData={};var element=this.element,options=this.options;if(options.rotatable||options.scalable||(options.checkOrientation=!1),options.checkOrientation&&window.ArrayBuffer)if(REGEXP_DATA_URL.test(url))REGEXP_DATA_URL_JPEG.test(url)?this.read(dataURLToArrayBuffer(url)):this.clone();else{var xhr=new XMLHttpRequest,clone=this.clone.bind(this);this.reloading=!0,this.xhr=xhr,xhr.onabort=clone,xhr.onerror=clone,xhr.ontimeout=clone,xhr.onprogress=function(){xhr.getResponseHeader("content-type")!==MIME_TYPE_JPEG&&xhr.abort()},xhr.onload=function(){_this.read(xhr.response)},xhr.onloadend=function(){_this.reloading=!1,_this.xhr=null},options.checkCrossOrigin&&isCrossOriginURL(url)&&element.crossOrigin&&(url=addTimestamp(url)),xhr.open("GET",url,!0),xhr.responseType="arraybuffer",xhr.withCredentials="use-credentials"===element.crossOrigin,xhr.send()}else this.clone()}}},{key:"read",value:function(arrayBuffer){var options=this.options,imageData=this.imageData,orientation=resetAndGetOrientation(arrayBuffer),rotate=0,scaleX=1,scaleY=1;if(orientation>1){this.url=arrayBufferToDataURL(arrayBuffer,MIME_TYPE_JPEG);var _parseOrientation=parseOrientation(orientation);rotate=_parseOrientation.rotate,scaleX=_parseOrientation.scaleX,scaleY=_parseOrientation.scaleY}options.rotatable&&(imageData.rotate=rotate),options.scalable&&(imageData.scaleX=scaleX,imageData.scaleY=scaleY),this.clone()}},{key:"clone",value:function(){var element=this.element,url=this.url,crossOrigin=element.crossOrigin,crossOriginUrl=url;this.options.checkCrossOrigin&&isCrossOriginURL(url)&&(crossOrigin||(crossOrigin="anonymous"),crossOriginUrl=addTimestamp(url)),this.crossOrigin=crossOrigin,this.crossOriginUrl=crossOriginUrl;var image=document.createElement("img");crossOrigin&&(image.crossOrigin=crossOrigin),image.src=crossOriginUrl||url,image.alt=element.alt||"The image to crop",this.image=image,image.onload=this.start.bind(this),image.onerror=this.stop.bind(this),addClass(image,CLASS_HIDE),element.parentNode.insertBefore(image,element.nextSibling)}},{key:"start",value:function(){var _this2=this,image=this.image;image.onload=null,image.onerror=null,this.sizing=!0;var isIOSWebKit=WINDOW.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(WINDOW.navigator.userAgent),done=function(naturalWidth,naturalHeight){assign(_this2.imageData,{naturalWidth:naturalWidth,naturalHeight:naturalHeight,aspectRatio:naturalWidth/naturalHeight}),_this2.initialImageData=assign({},_this2.imageData),_this2.sizing=!1,_this2.sized=!0,_this2.build()};if(!image.naturalWidth||isIOSWebKit){var sizingImage=document.createElement("img"),body=document.body||document.documentElement;this.sizingImage=sizingImage,sizingImage.onload=function(){done(sizingImage.width,sizingImage.height),isIOSWebKit||body.removeChild(sizingImage)},sizingImage.src=image.src,isIOSWebKit||(sizingImage.style.cssText="left:0;max-height:none!important;max-width:none!important;min-height:0!important;min-width:0!important;opacity:0;position:absolute;top:0;z-index:-1;",body.appendChild(sizingImage))}else done(image.naturalWidth,image.naturalHeight)}},{key:"stop",value:function(){var image=this.image;image.onload=null,image.onerror=null,image.parentNode.removeChild(image),this.image=null}},{key:"build",value:function(){if(this.sized&&!this.ready){var element=this.element,options=this.options,image=this.image,container=element.parentNode,template=document.createElement("div");template.innerHTML=TEMPLATE;var cropper=template.querySelector(".".concat(NAMESPACE,"-container")),canvas=cropper.querySelector(".".concat(NAMESPACE,"-canvas")),dragBox=cropper.querySelector(".".concat(NAMESPACE,"-drag-box")),cropBox=cropper.querySelector(".".concat(NAMESPACE,"-crop-box")),face=cropBox.querySelector(".".concat(NAMESPACE,"-face"));this.container=container,this.cropper=cropper,this.canvas=canvas,this.dragBox=dragBox,this.cropBox=cropBox,this.viewBox=cropper.querySelector(".".concat(NAMESPACE,"-view-box")),this.face=face,canvas.appendChild(image),addClass(element,CLASS_HIDDEN),container.insertBefore(cropper,element.nextSibling),removeClass(image,CLASS_HIDE),this.initPreview(),this.bind(),options.initialAspectRatio=Math.max(0,options.initialAspectRatio)||NaN,options.aspectRatio=Math.max(0,options.aspectRatio)||NaN,options.viewMode=Math.max(0,Math.min(3,Math.round(options.viewMode)))||0,addClass(cropBox,CLASS_HIDDEN),options.guides||addClass(cropBox.getElementsByClassName("".concat(NAMESPACE,"-dashed")),CLASS_HIDDEN),options.center||addClass(cropBox.getElementsByClassName("".concat(NAMESPACE,"-center")),CLASS_HIDDEN),options.background&&addClass(cropper,"".concat(NAMESPACE,"-bg")),options.highlight||addClass(face,CLASS_INVISIBLE),options.cropBoxMovable&&(addClass(face,CLASS_MOVE),setData(face,DATA_ACTION,ACTION_ALL)),options.cropBoxResizable||(addClass(cropBox.getElementsByClassName("".concat(NAMESPACE,"-line")),CLASS_HIDDEN),addClass(cropBox.getElementsByClassName("".concat(NAMESPACE,"-point")),CLASS_HIDDEN)),this.render(),this.ready=!0,this.setDragMode(options.dragMode),options.autoCrop&&this.crop(),this.setData(options.data),isFunction(options.ready)&&addListener(element,EVENT_READY,options.ready,{once:!0}),dispatchEvent(element,EVENT_READY)}}},{key:"unbuild",value:function(){if(this.ready){this.ready=!1,this.unbind(),this.resetPreview();var parentNode=this.cropper.parentNode;parentNode&&parentNode.removeChild(this.cropper),removeClass(this.element,CLASS_HIDDEN)}}},{key:"uncreate",value:function(){this.ready?(this.unbuild(),this.ready=!1,this.cropped=!1):this.sizing?(this.sizingImage.onload=null,this.sizing=!1,this.sized=!1):this.reloading?(this.xhr.onabort=null,this.xhr.abort()):this.image&&this.stop()}}],[{key:"noConflict",value:function(){return window.Cropper=AnotherCropper,Cropper}},{key:"setDefaults",value:function(options){assign(DEFAULTS,isPlainObject(options)&&options)}}])}();return assign(Cropper.prototype,render,preview,events,handlers,change,methods),Cropper}()}(cropper);var Cropper=getDefaultExportFromCjs(cropper.exports);function getScaleFactorThatRemovesDarkCorners(w,h,granularAngle){const =Math.abs(granularAngle*(Math.PI/180));return Math.max((Math.sin()*w+Math.cos()*h)/h,(Math.sin()*h+Math.cos()*w)/w)}class Editor extends x{imgElement;cropper;constructor(props){super(props),this.state={angle90Deg:0,angleGranular:0,prevCropboxData:null},this.storePrevCropboxData=this.storePrevCropboxData.bind(this),this.limitCropboxMovement=this.limitCropboxMovement.bind(this)}componentDidMount(){const{opts:opts,storeCropperInstance:storeCropperInstance}=this.props;this.cropper=new Cropper(this.imgElement,opts.cropperOptions),this.imgElement.addEventListener("cropstart",this.storePrevCropboxData),this.imgElement.addEventListener("cropend",this.limitCropboxMovement),storeCropperInstance(this.cropper)}componentWillUnmount(){this.cropper.destroy(),this.imgElement.removeEventListener("cropstart",this.storePrevCropboxData),this.imgElement.removeEventListener("cropend",this.limitCropboxMovement)}storePrevCropboxData(){this.setState({prevCropboxData:this.cropper.getCropBoxData()})}limitCropboxMovement(event){const canvasData=this.cropper.getCanvasData(),cropboxData=this.cropper.getCropBoxData(),{prevCropboxData:prevCropboxData}=this.state;if("all"===event.detail.action){const newCropboxData=(canvas=canvasData,prevCropbox=prevCropboxData,(cropbox=cropboxData).left<canvas.left?{left:canvas.left,width:prevCropbox.width}:cropbox.top<canvas.top?{top:canvas.top,height:prevCropbox.height}:cropbox.left+cropbox.width>canvas.left+canvas.width?{left:canvas.left+canvas.width-prevCropbox.width,width:prevCropbox.width}:cropbox.top+cropbox.height>canvas.top+canvas.height?{top:canvas.top+canvas.height-prevCropbox.height,height:prevCropbox.height}:null);newCropboxData&&this.cropper.setCropBoxData(newCropboxData)}else{const newCropboxData=function(canvas,cropboxData,prevCropbox){return cropboxData.left<canvas.left?{left:canvas.left,width:prevCropbox.left+prevCropbox.width-canvas.left}:cropboxData.top<canvas.top?{top:canvas.top,height:prevCropbox.top+prevCropbox.height-canvas.top}:cropboxData.left+cropboxData.width>canvas.left+canvas.width?{left:prevCropbox.left,width:canvas.left+canvas.width-prevCropbox.left}:cropboxData.top+cropboxData.height>canvas.top+canvas.height?{top:prevCropbox.top,height:canvas.top+canvas.height-prevCropbox.top}:null}(canvasData,cropboxData,prevCropboxData);newCropboxData&&this.cropper.setCropBoxData(newCropboxData)}var canvas,cropbox,prevCropbox}onRotate90Deg=()=>{const{angle90Deg:angle90Deg}=this.state,newAngle=angle90Deg-90;this.setState({angle90Deg:newAngle,angleGranular:0}),this.cropper.scale(1),this.cropper.rotateTo(newAngle);const canvasData=this.cropper.getCanvasData(),newCanvasData=function(containerData,canvasData){const widthRatio=containerData.width/canvasData.width,heightRatio=containerData.height/canvasData.height,scaleFactor=Math.min(widthRatio,heightRatio),newWidth=canvasData.width*scaleFactor,newHeight=canvasData.height*scaleFactor;return{width:newWidth,height:newHeight,left:(containerData.width-newWidth)/2,top:(containerData.height-newHeight)/2}}(this.cropper.getContainerData(),canvasData);this.cropper.setCanvasData(newCanvasData),this.cropper.setCropBoxData(newCanvasData)};onRotateGranular=ev=>{const newGranularAngle=Number(ev.target.value);this.setState({angleGranular:newGranularAngle});const{angle90Deg:angle90Deg}=this.state,newAngle=angle90Deg+newGranularAngle;this.cropper.rotateTo(newAngle);const image=this.cropper.getImageData(),scaleFactor=getScaleFactorThatRemovesDarkCorners(image.naturalWidth,image.naturalHeight,newGranularAngle),scaleFactorX=this.cropper.getImageData().scaleX<0?-scaleFactor:scaleFactor;this.cropper.scale(scaleFactorX,scaleFactor)};renderGranularRotate(){const{i18n:i18n}=this.props,{angleGranular:angleGranular}=this.state;return u$2("label",{role:"tooltip","aria-label":`${angleGranular}`,"data-microtip-position":"top",className:"uppy-ImageCropper-rangeWrapper",children:u$2("input",{className:"uppy-ImageCropper-range uppy-u-reset",type:"range",onInput:this.onRotateGranular,onChange:this.onRotateGranular,value:angleGranular,min:"-45",max:"45","aria-label":i18n("rotate")})})}renderRevert(){const{i18n:i18n,opts:opts}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("revert"),onClick:()=>{this.cropper.reset(),this.cropper.setAspectRatio(opts.cropperOptions.initialAspectRatio),this.setState({angle90Deg:0,angleGranular:0})},children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0z",fill:"none"}),u$2("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"})]})})}renderRotate(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("rotate"),onClick:this.onRotate90Deg,children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0V0zm0 0h24v24H0V0z",fill:"none"}),u$2("path",{d:"M14 10a2 2 0 012 2v7a2 2 0 01-2 2H6a2 2 0 01-2-2v-7a2 2 0 012-2h8zm0 1.75H6a.25.25 0 00-.243.193L5.75 12v7a.25.25 0 00.193.243L6 19.25h8a.25.25 0 00.243-.193L14.25 19v-7a.25.25 0 00-.193-.243L14 11.75zM12 .76V4c2.3 0 4.61.88 6.36 2.64a8.95 8.95 0 012.634 6.025L21 13a1 1 0 01-1.993.117L19 13h-.003a6.979 6.979 0 00-2.047-4.95 6.97 6.97 0 00-4.652-2.044L12 6v3.24L7.76 5 12 .76z"})]})})}renderFlip(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("flipHorizontal"),onClick:()=>this.cropper.scaleX(-this.cropper.getData().scaleX||-1),children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0z",fill:"none"}),u$2("path",{d:"M15 21h2v-2h-2v2zm4-12h2V7h-2v2zM3 5v14c0 1.1.9 2 2 2h4v-2H5V5h4V3H5c-1.1 0-2 .9-2 2zm16-2v2h2c0-1.1-.9-2-2-2zm-8 20h2V1h-2v22zm8-6h2v-2h-2v2zM15 5h2V3h-2v2zm4 8h2v-2h-2v2zm0 8c1.1 0 2-.9 2-2h-2v2z"})]})})}renderZoomIn(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("zoomIn"),onClick:()=>this.cropper.zoom(.1),children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",height:"24",viewBox:"0 0 24 24",width:"24",children:[u$2("path",{d:"M0 0h24v24H0V0z",fill:"none"}),u$2("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"}),u$2("path",{d:"M12 10h-2v2H9v-2H7V9h2V7h1v2h2v1z"})]})})}renderZoomOut(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("zoomOut"),onClick:()=>this.cropper.zoom(-.1),children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0V0z",fill:"none"}),u$2("path",{d:"M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14zM7 9h5v1H7z"})]})})}renderCropSquare(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("aspectRatioSquare"),onClick:()=>this.cropper.setAspectRatio(1),children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M0 0h24v24H0z",fill:"none"}),u$2("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"})]})})}renderCropWidescreen(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button",className:"uppy-u-reset uppy-c-btn","aria-label":i18n("aspectRatioLandscape"),onClick:()=>this.cropper.setAspectRatio(16/9),children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M 19,4.9999992 V 17.000001 H 4.9999998 V 6.9999992 H 19 m 0,-2 H 4.9999998 c -1.0999999,0 -1.9999999,0.9000001 -1.9999999,2 V 17.000001 c 0,1.1 0.9,2 1.9999999,2 H 19 c 1.1,0 2,-0.9 2,-2 V 6.9999992 c 0,-1.0999999 -0.9,-2 -2,-2 z"}),u$2("path",{fill:"none",d:"M0 0h24v24H0z"})]})})}renderCropWidescreenVertical(){const{i18n:i18n}=this.props;return u$2("button",{"data-microtip-position":"top",type:"button","aria-label":i18n("aspectRatioPortrait"),className:"uppy-u-reset uppy-c-btn",onClick:()=>this.cropper.setAspectRatio(9/16),children:u$2("svg",{"aria-hidden":"true",className:"uppy-c-icon",width:"24",height:"24",viewBox:"0 0 24 24",children:[u$2("path",{d:"M 19.000001,19 H 6.999999 V 5 h 10.000002 v 14 m 2,0 V 5 c 0,-1.0999999 -0.9,-1.9999999 -2,-1.9999999 H 6.999999 c -1.1,0 -2,0.9 -2,1.9999999 v 14 c 0,1.1 0.9,2 2,2 h 10.000002 c 1.1,0 2,-0.9 2,-2 z"}),u$2("path",{d:"M0 0h24v24H0z",fill:"none"})]})})}render(){const{currentImage:currentImage,opts:opts}=this.props,{actions:actions}=opts,imageURL=URL.createObjectURL(currentImage.data);return u$2("div",{className:"uppy-ImageCropper",children:[u$2("div",{className:"uppy-ImageCropper-container",children:u$2("img",{className:"uppy-ImageCropper-image",alt:currentImage.name,src:imageURL,ref:ref=>{this.imgElement=ref}})}),u$2("div",{className:"uppy-ImageCropper-controls",children:[actions.revert&&this.renderRevert(),actions.rotate&&this.renderRotate(),actions.granularRotate&&this.renderGranularRotate(),actions.flip&&this.renderFlip(),actions.zoomIn&&this.renderZoomIn(),actions.zoomOut&&this.renderZoomOut(),actions.cropSquare&&this.renderCropSquare(),actions.cropWidescreen&&this.renderCropWidescreen(),actions.cropWidescreenVertical&&this.renderCropWidescreenVertical()]})]})}}var locale$2={strings:{revert:"Reset",rotate:"Rotate 90",zoomIn:"Zoom in",zoomOut:"Zoom out",flipHorizontal:"Flip horizontally",aspectRatioSquare:"Crop square",aspectRatioLandscape:"Crop landscape (16:9)",aspectRatioPortrait:"Crop portrait (9:16)"}};const defaultCropperOptions={viewMode:0,background:!1,autoCropArea:1,responsive:!0,minCropBoxWidth:70,minCropBoxHeight:70,croppedCanvasOptions:{},initialAspectRatio:0},defaultActions={revert:!0,rotate:!0,granularRotate:!0,flip:!0,zoomIn:!0,zoomOut:!0,cropSquare:!0,cropWidescreen:!0,cropWidescreenVertical:!0},defaultOptions={quality:.8,actions:defaultActions,cropperOptions:defaultCropperOptions};class ImageEditor extends UIPlugin{static VERSION=packageJson$3_version;cropper;constructor(uppy,opts){super(uppy,{...defaultOptions,...opts,actions:{...defaultActions,...opts?.actions},cropperOptions:{...defaultCropperOptions,...opts?.cropperOptions}}),this.id=this.opts.id||"ImageEditor",this.title="Image Editor",this.type="editor",this.defaultLocale=locale$2,this.i18nInit()}canEditFile(file){if(!file.type||file.isRemote)return!1;const fileTypeSpecific=file.type.split("/")[1];return!!/^(jpe?g|gif|png|bmp|webp)$/.test(fileTypeSpecific)}save=()=>{const{currentImage:currentImage}=this.getPluginState(),croppedCanvas=this.cropper.getCroppedCanvas({});croppedCanvas.width%2!=0&&this.cropper.setData({width:croppedCanvas.width-1}),croppedCanvas.height%2!=0&&this.cropper.setData({height:croppedCanvas.height-1}),this.cropper.getCroppedCanvas(this.opts.cropperOptions.croppedCanvasOptions).toBlob(blob=>{const{currentImage:currentImage}=this.getPluginState();this.uppy.setFileState(currentImage.id,{data:new File([blob],currentImage.name??this.i18n("unnamed"),{type:blob.type}),size:blob.size,preview:void 0});const updatedFile=this.uppy.getFile(currentImage.id);this.uppy.emit("thumbnail:request",updatedFile),this.setPluginState({currentImage:updatedFile}),this.uppy.emit("file-editor:complete",updatedFile)},currentImage.type,this.opts.quality)};storeCropperInstance=cropper=>{this.cropper=cropper};selectFile=file=>{this.uppy.emit("file-editor:start",file),this.setPluginState({currentImage:file})};install(){this.setPluginState({currentImage:null});const{target:target}=this.opts;target&&this.mount(target,this)}uninstall(){const{currentImage:currentImage}=this.getPluginState();if(currentImage){const file=this.uppy.getFile(currentImage.id);this.uppy.emit("file-editor:cancel",file)}this.unmount()}render(){const{currentImage:currentImage}=this.getPluginState();return null===currentImage||currentImage.isRemote?null:u$2(Editor,{currentImage:currentImage,storeCropperInstance:this.storeCropperInstance,save:this.save,opts:this.opts,i18n:this.i18n})}}var packageJson$2_version="3.0.1",locale$1={strings:{pluginNameAudio:"Audio",startAudioRecording:"Begin audio recording",stopAudioRecording:"Stop audio recording",allowAudioAccessTitle:"Please allow access to your microphone",allowAudioAccessDescription:"In order to record audio, please allow microphone access for this site.",noAudioTitle:"Microphone Not Available",noAudioDescription:"In order to record audio, please connect a microphone or another audio input device",recordingStoppedMaxSize:"Recording stopped because the file size is about to exceed the limit",recordingLength:"Recording length %{recording_length}",submitRecordedFile:"Submit recorded file",discardRecordedFile:"Discard recorded file"}},PermissionsScreen=props=>{const{icon:icon,hasAudio:hasAudio,i18n:i18n}=props;return u$2("div",{className:"uppy-Audio-permissons",children:[u$2("div",{className:"uppy-Audio-permissonsIcon",children:icon()}),u$2("div",{className:"uppy-Audio-title",children:i18n(hasAudio?"allowAudioAccessTitle":"noAudioTitle")}),u$2("p",{children:i18n(hasAudio?"allowAudioAccessDescription":"noAudioDescription")})]})},AudioSourceSelect=({currentDeviceId:currentDeviceId,audioSources:audioSources,onChangeSource:onChangeSource})=>u$2("div",{className:"uppy-Audio-videoSource",children:u$2("select",{className:"uppy-u-reset uppy-Audio-audioSource-select",onChange:event=>{onChangeSource(event.target.value)},children:audioSources.map(audioSource=>u$2("option",{value:audioSource.deviceId,selected:audioSource.deviceId===currentDeviceId,children:audioSource.label},audioSource.deviceId))})});function isFunction(v){return"function"==typeof v}function result(v){return isFunction(v)?v():v}class AudioOscilloscope{canvas;canvasContext;width;height;analyser;bufferLength;dataArray;onDrawFrame;streamSource;audioContext;source;constructor(canvas,options={}){const canvasOptions=options.canvas||{},canvasContextOptions=options.canvasContext||{};this.analyser=null,this.bufferLength=0,this.canvas=canvas,this.width=result(canvasOptions.width)||this.canvas.width,this.height=result(canvasOptions.height)||this.canvas.height,this.canvas.width=this.width,this.canvas.height=this.height,this.canvasContext=this.canvas.getContext("2d"),this.canvasContext.fillStyle=result(canvasContextOptions.fillStyle)||"rgb(255, 255, 255)",this.canvasContext.strokeStyle=result(canvasContextOptions.strokeStyle)||"rgb(0, 0, 0)",this.canvasContext.lineWidth=result(canvasContextOptions.lineWidth)||1,this.onDrawFrame=isFunction(options.onDrawFrame)?options.onDrawFrame:()=>{}}addSource(streamSource){this.streamSource=streamSource,this.audioContext=this.streamSource.context,this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=2048,this.bufferLength=this.analyser.frequencyBinCount,this.source=this.audioContext.createBufferSource(),this.dataArray=new Uint8Array(this.bufferLength),this.analyser.getByteTimeDomainData(this.dataArray),this.streamSource.connect(this.analyser)}draw(){const{analyser:analyser,dataArray:dataArray,bufferLength:bufferLength}=this,ctx=this.canvasContext,w=this.width,h=this.height;analyser&&analyser.getByteTimeDomainData(dataArray),ctx.fillRect(0,0,w,h),ctx.beginPath();const sliceWidth=1*w/bufferLength;let x=0;bufferLength||ctx.moveTo(0,this.height/2);for(let i=0;i<bufferLength;i++){const y=dataArray[i]/128*(h/2);0===i?ctx.moveTo(x,y):ctx.lineTo(x,y),x+=sliceWidth}ctx.lineTo(w,h/2),ctx.stroke(),this.onDrawFrame(this),requestAnimationFrame(this.#draw)}#draw=()=>this.draw()}function DiscardButton({onDiscard:onDiscard,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Audio-button",type:"button",title:i18n("discardRecordedFile"),"aria-label":i18n("discardRecordedFile"),onClick:onDiscard,"data-uppy-super-focusable":!0,children:u$2("svg",{width:"13",height:"13",viewBox:"0 0 13 13",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",className:"uppy-c-icon",children:u$2("g",{fill:"#FFF",fillRule:"evenodd",children:[u$2("path",{d:"M.496 11.367L11.103.76l1.414 1.414L1.911 12.781z"}),u$2("path",{d:"M11.104 12.782L.497 2.175 1.911.76l10.607 10.606z"})]})})})}function RecordButton({recording:recording,onStartRecording:onStartRecording,onStopRecording:onStopRecording,i18n:i18n}){return u$2("button",recording?{className:"uppy-u-reset uppy-c-btn uppy-Audio-button",type:"button",title:i18n("stopAudioRecording"),"aria-label":i18n("stopAudioRecording"),onClick:onStopRecording,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"100",height:"100",viewBox:"0 0 100 100",children:u$2("rect",{x:"15",y:"15",width:"70",height:"70"})})}:{className:"uppy-u-reset uppy-c-btn uppy-Audio-button",type:"button",title:i18n("startAudioRecording"),"aria-label":i18n("startAudioRecording"),onClick:onStartRecording,"data-uppy-super-focusable":!0,children:u$2("svg",{"aria-hidden":"true",focusable:"false",className:"uppy-c-icon",width:"14px",height:"20px",viewBox:"0 0 14 20",children:u$2("path",{d:"M7 14c2.21 0 4-1.71 4-3.818V3.818C11 1.71 9.21 0 7 0S3 1.71 3 3.818v6.364C3 12.29 4.79 14 7 14zm6.364-7h-.637a.643.643 0 0 0-.636.65V9.6c0 3.039-2.565 5.477-5.6 5.175-2.645-.264-4.582-2.692-4.582-5.407V7.65c0-.36-.285-.65-.636-.65H.636A.643.643 0 0 0 0 7.65v1.631c0 3.642 2.544 6.888 6.045 7.382v1.387H3.818a.643.643 0 0 0-.636.65v.65c0 .36.285.65.636.65h6.364c.351 0 .636-.29.636-.65v-.65c0-.36-.285-.65-.636-.65H7.955v-1.372C11.363 16.2 14 13.212 14 9.6V7.65c0-.36-.285-.65-.636-.65z",fill:"#FFF","fill-rule":"nonzero"})})})}function RecordingLength({recordingLengthSeconds:recordingLengthSeconds}){var seconds;return u$2("span",{children:(seconds=recordingLengthSeconds,`${Math.floor(seconds/60)}:${String(seconds%60).padStart(2,"0")}`)})}function SubmitButton({onSubmit:onSubmit,i18n:i18n}){return u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-Audio-button uppy-Audio-button--submit",type:"button",title:i18n("submitRecordedFile"),"aria-label":i18n("submitRecordedFile"),onClick:onSubmit,"data-uppy-super-focusable":!0,children:u$2("svg",{width:"12",height:"9",viewBox:"0 0 12 9",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",focusable:"false",className:"uppy-c-icon",children:u$2("path",{fill:"#fff",fillRule:"nonzero",d:"M10.66 0L12 1.31 4.136 9 0 4.956l1.34-1.31L4.136 6.38z"})})})}function RecordingScreen(props){const{stream:stream,recordedAudio:recordedAudio,onStop:onStop,recording:recording,supportsRecording:supportsRecording,audioSources:audioSources,showAudioSourceDropdown:showAudioSourceDropdown,onSubmit:onSubmit,i18n:i18n,onStartRecording:onStartRecording,onStopRecording:onStopRecording,onDiscardRecordedAudio:onDiscardRecordedAudio,recordingLengthSeconds:recordingLengthSeconds}=props,canvasEl=A$1(null),oscilloscope=A$1();y$1(()=>()=>{oscilloscope.current=null,onStop()},[onStop]),y$1(()=>{if(!recordedAudio&&(oscilloscope.current=new AudioOscilloscope(canvasEl.current,{canvas:{width:600,height:600},canvasContext:{lineWidth:2,fillStyle:"rgb(0,0,0)",strokeStyle:"green"}}),oscilloscope.current.draw(),stream)){const source=(new AudioContext).createMediaStreamSource(stream);oscilloscope.current.addSource(source)}},[recordedAudio,stream]);const hasRecordedAudio=null!=recordedAudio,shouldShowRecordButton=!hasRecordedAudio&&supportsRecording,shouldShowAudioSourceDropdown=showAudioSourceDropdown&&!hasRecordedAudio&&audioSources&&audioSources.length>1;return u$2("div",{className:"uppy-Audio-container",children:[u$2("div",{className:"uppy-Audio-audioContainer",children:hasRecordedAudio?u$2("audio",{className:"uppy-Audio-player",controls:!0,src:recordedAudio}):u$2("canvas",{ref:canvasEl,className:"uppy-Audio-canvas"})}),u$2("div",{className:"uppy-Audio-footer",children:[u$2("div",{className:"uppy-Audio-audioSourceContainer",children:shouldShowAudioSourceDropdown?AudioSourceSelect(props):null}),u$2("div",{className:"uppy-Audio-buttonContainer",children:[shouldShowRecordButton&&u$2(RecordButton,{recording:recording,onStartRecording:onStartRecording,onStopRecording:onStopRecording,i18n:i18n}),hasRecordedAudio&&u$2(SubmitButton,{onSubmit:onSubmit,i18n:i18n}),hasRecordedAudio&&u$2(DiscardButton,{onDiscard:onDiscardRecordedAudio,i18n:i18n})]}),u$2("div",{className:"uppy-Audio-recordingLength",children:!hasRecordedAudio&&u$2(RecordingLength,{recordingLengthSeconds:recordingLengthSeconds})})]})]})}class Audio extends UIPlugin{static VERSION=packageJson$2_version;#recordingLengthTimer;icon;#stream=null;#audioActive=!1;#recordingChunks=null;#recorder=null;#capturedMediaFile=null;#mediaDevices;#supportsUserMedia;constructor(uppy,opts){super(uppy,opts),this.#mediaDevices=navigator.mediaDevices,this.#supportsUserMedia=null!=this.#mediaDevices,this.id=this.opts.id||"Audio",this.type="acquirer",this.icon=()=>u$2("svg",{className:"uppy-DashboardTab-iconAudio","aria-hidden":"true",focusable:"false",width:"32px",height:"32px",viewBox:"0 0 32 32",children:u$2("path",{d:"M21.143 12.297c.473 0 .857.383.857.857v2.572c0 3.016-2.24 5.513-5.143 5.931v2.64h2.572a.857.857 0 110 1.714H12.57a.857.857 0 110-1.714h2.572v-2.64C12.24 21.24 10 18.742 10 15.726v-2.572a.857.857 0 111.714 0v2.572A4.29 4.29 0 0016 20.01a4.29 4.29 0 004.286-4.285v-2.572c0-.474.384-.857.857-.857zM16 6.5a3 3 0 013 3v6a3 3 0 01-6 0v-6a3 3 0 013-3z",fill:"currentcolor","fill-rule":"nonzero"})}),this.defaultLocale=locale$1,this.opts={...opts},this.i18nInit(),this.title=this.i18n("pluginNameAudio"),this.setPluginState({hasAudio:!1,audioReady:!1,cameraError:null,recordingLengthSeconds:0,audioSources:[],currentDeviceId:null})}#hasAudioCheck(){return this.#mediaDevices?this.#mediaDevices.enumerateDevices().then(devices=>devices.some(device=>"audioinput"===device.kind)):Promise.resolve(!1)}#start=options=>{if(!this.#supportsUserMedia)return Promise.reject(new Error("Microphone access not supported"));this.#audioActive=!0,this.#hasAudioCheck().then(hasAudio=>(this.setPluginState({hasAudio:hasAudio}),this.#mediaDevices.getUserMedia({audio:!0}).then(stream=>{this.#stream=stream;let currentDeviceId=null;const tracks=stream.getAudioTracks();currentDeviceId=options?.deviceId?tracks.findLast(track=>track.getSettings().deviceId===options.deviceId):tracks[0].getSettings().deviceId,this.#updateSources(),this.setPluginState({currentDeviceId:currentDeviceId,audioReady:!0})}).catch(err=>{this.setPluginState({audioReady:!1,cameraError:err}),this.uppy.info(err.message,"error")})))};#startRecording=()=>{this.#recorder=new MediaRecorder(this.#stream),this.#recordingChunks=[];let stoppingBecauseOfMaxSize=!1;this.#recorder.addEventListener("dataavailable",event=>{this.#recordingChunks.push(event.data);const{restrictions:restrictions}=this.uppy.opts;if(this.#recordingChunks.length>1&&null!=restrictions.maxFileSize&&!stoppingBecauseOfMaxSize){const totalSize=this.#recordingChunks.reduce((acc,chunk)=>acc+chunk.size,0),expectedEndChunkSize=3*((totalSize-this.#recordingChunks[0].size)/(this.#recordingChunks.length-1));totalSize>Math.max(0,restrictions.maxFileSize-expectedEndChunkSize)&&(stoppingBecauseOfMaxSize=!0,this.uppy.info(this.i18n("recordingStoppedMaxSize"),"warning",4e3),this.#stopRecording())}}),this.#recorder.start(500),this.#recordingLengthTimer=setInterval(()=>{const currentRecordingLength=this.getPluginState().recordingLengthSeconds;this.setPluginState({recordingLengthSeconds:currentRecordingLength+1})},1e3),this.setPluginState({isRecording:!0})};#stopRecording=()=>{const stopped=new Promise(resolve=>{this.#recorder.addEventListener("stop",()=>{resolve()}),this.#recorder.stop(),clearInterval(this.#recordingLengthTimer),this.setPluginState({recordingLengthSeconds:0})});return stopped.then(()=>(this.setPluginState({isRecording:!1}),this.#getAudio())).then(file=>{try{this.#capturedMediaFile=file,this.setPluginState({recordedAudio:URL.createObjectURL(file.data)})}catch(err){err.isRestriction||this.uppy.log(err)}}).then(()=>{this.#recordingChunks=null,this.#recorder=null},error=>{throw this.#recordingChunks=null,this.#recorder=null,error})};#discardRecordedAudio=()=>{this.setPluginState({recordedAudio:null}),this.#capturedMediaFile=null};#submit=()=>{try{this.#capturedMediaFile&&this.uppy.addFile(this.#capturedMediaFile)}catch(err){err.isRestriction||this.uppy.log(err,"warning")}};#stop=async()=>{if(this.#stream){this.#stream.getAudioTracks().forEach(track=>track.stop())}this.#recorder&&await new Promise(resolve=>{this.#recorder.addEventListener("stop",resolve,{once:!0}),this.#recorder.stop(),clearInterval(this.#recordingLengthTimer)}),this.#recordingChunks=null,this.#recorder=null,this.#audioActive=!1,this.#stream=null,this.setPluginState({recordedAudio:null,isRecording:!1,recordingLengthSeconds:0})};#getAudio(){const mimeType=this.#recordingChunks.find(blob=>blob.type?.length>0).type,fileExtension=getFileTypeExtension(mimeType);if(!fileExtension)return Promise.reject(new Error(`Could not retrieve recording: Unsupported media type "${mimeType}"`));const name=`audio-${Date.now()}.${fileExtension}`,blob=new Blob(this.#recordingChunks,{type:mimeType}),file={source:this.id,name:name,data:new Blob([blob],{type:mimeType}),type:mimeType};return Promise.resolve(file)}#changeSource=deviceId=>{this.#stop(),this.#start({deviceId:deviceId})};#updateSources=()=>{this.#mediaDevices.enumerateDevices().then(devices=>{this.setPluginState({audioSources:devices.filter(device=>"audioinput"===device.kind)})})};render(){this.#audioActive||this.#start();const audioState=this.getPluginState();return audioState.audioReady&&audioState.hasAudio?u$2(RecordingScreen,{...audioState,onChangeSource:this.#changeSource,onStartRecording:this.#startRecording,onStopRecording:this.#stopRecording,onDiscardRecordedAudio:this.#discardRecordedAudio,onSubmit:this.#submit,onStop:this.#stop,i18n:this.i18n,showAudioSourceDropdown:this.opts.showAudioSourceDropdown,supportsRecording:"function"==typeof MediaRecorder&&"function"==typeof MediaRecorder.prototype?.start,recording:audioState.isRecording,stream:this.#stream}):u$2(PermissionsScreen,{icon:this.icon,i18n:this.i18n,hasAudio:audioState.hasAudio})}install(){this.setPluginState({audioReady:!1,recordingLengthSeconds:0});const{target:target}=this.opts;target&&this.mount(target,this),this.#mediaDevices&&(this.#updateSources(),this.#mediaDevices.ondevicechange=()=>{if(this.#updateSources(),this.#stream){let restartStream=!0;const{audioSources:audioSources,currentDeviceId:currentDeviceId}=this.getPluginState();audioSources.forEach(audioSource=>{currentDeviceId===audioSource.deviceId&&(restartStream=!1)}),restartStream&&(this.#stop(),this.#start())}})}uninstall(){this.#stream&&this.#stop(),this.unmount()}}var retry$2={};function RetryOperation(timeouts,options){"boolean"==typeof options&&(options={forever:options}),this._originalTimeouts=JSON.parse(JSON.stringify(timeouts)),this._timeouts=timeouts,this._options=options||{},this._maxRetryTime=options&&options.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var retry_operation=RetryOperation;RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(err){if(this._timeout&&clearTimeout(this._timeout),!err)return!1;var currentTime=(new Date).getTime();if(err&&currentTime-this._operationStart>=this._maxRetryTime)return this._errors.push(err),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(err);var timeout=this._timeouts.shift();if(void 0===timeout){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),timeout=this._cachedTimeouts.slice(-1)}var self=this;return this._timer=setTimeout(function(){self._attempts++,self._operationTimeoutCb&&(self._timeout=setTimeout(function(){self._operationTimeoutCb(self._attempts)},self._operationTimeout),self._options.unref&&self._timeout.unref()),self._fn(self._attempts)},timeout),this._options.unref&&this._timer.unref(),!0},RetryOperation.prototype.attempt=function(fn,timeoutOps){this._fn=fn,timeoutOps&&(timeoutOps.timeout&&(this._operationTimeout=timeoutOps.timeout),timeoutOps.cb&&(this._operationTimeoutCb=timeoutOps.cb));var self=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){self._operationTimeoutCb()},self._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(fn){console.log("Using RetryOperation.try() is deprecated"),this.attempt(fn)},RetryOperation.prototype.start=function(fn){console.log("Using RetryOperation.start() is deprecated"),this.attempt(fn)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var counts={},mainError=null,mainErrorCount=0,i=0;i<this._errors.length;i++){var error=this._errors[i],message=error.message,count=(counts[message]||0)+1;counts[message]=count,count>=mainErrorCount&&(mainError=error,mainErrorCount=count)}return mainError},function(exports){var RetryOperation=retry_operation;exports.operation=function(options){var timeouts=exports.timeouts(options);return new RetryOperation(timeouts,{forever:options&&(options.forever||options.retries===1/0),unref:options&&options.unref,maxRetryTime:options&&options.maxRetryTime})},exports.timeouts=function(options){if(options instanceof Array)return[].concat(options);var opts={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var key in options)opts[key]=options[key];if(opts.minTimeout>opts.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var timeouts=[],i=0;i<opts.retries;i++)timeouts.push(this.createTimeout(i,opts));return options&&options.forever&&!timeouts.length&&timeouts.push(this.createTimeout(i,opts)),timeouts.sort(function(a,b){return a-b}),timeouts},exports.createTimeout=function(attempt,opts){var random=opts.randomize?Math.random()+1:1,timeout=Math.round(random*Math.max(opts.minTimeout,1)*Math.pow(opts.factor,attempt));return timeout=Math.min(timeout,opts.maxTimeout)},exports.wrap=function(obj,options,methods){if(options instanceof Array&&(methods=options,options=null),!methods)for(var key in methods=[],obj)"function"==typeof obj[key]&&methods.push(key);for(var i=0;i<methods.length;i++){var method=methods[i],original=obj[method];obj[method]=function(original){var op=exports.operation(options),args=Array.prototype.slice.call(arguments,1),callback=args.pop();args.push(function(err){op.retry(err)||(err&&(arguments[0]=op.mainError()),callback.apply(this,arguments))}),op.attempt(function(){original.apply(obj,args)})}.bind(obj,original),obj[method].options=options}}}(retry$2);var retry$1=getDefaultExportFromCjs(retry$2);const objectToString=Object.prototype.toString,errorMessages=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed","fetch failed","terminated"," A network error occurred.","Network connection lost"]);function isNetworkError(error){var value;if(!(error&&(value=error,"[object Error]"===objectToString.call(value))&&"TypeError"===error.name&&"string"==typeof error.message))return!1;const{message:message,stack:stack}=error;return"Load failed"===message?void 0===stack||"__sentry_captured__"in error:!!message.startsWith("error sending request for url")||errorMessages.has(message)}class AbortError extends Error{constructor(message){super(),message instanceof Error?(this.originalError=message,({message:message}=message)):(this.originalError=new Error(message),this.originalError.stack=this.stack),this.name="AbortError",this.message=message}}const decorateErrorWithCounts=(error,attemptNumber,options)=>{const retriesLeft=options.retries-(attemptNumber-1);return error.attemptNumber=attemptNumber,error.retriesLeft=retriesLeft,error};async function pRetry(input,options){return new Promise((resolve,reject)=>{options={...options},options.onFailedAttempt??=()=>{},options.shouldRetry??=()=>!0,options.retries??=10;const operation=retry$1.operation(options),abortHandler=()=>{operation.stop(),reject(options.signal?.reason)};options.signal&&!options.signal.aborted&&options.signal.addEventListener("abort",abortHandler,{once:!0});const cleanUp=()=>{options.signal?.removeEventListener("abort",abortHandler),operation.stop()};operation.attempt(async attemptNumber=>{try{const result=await input(attemptNumber);cleanUp(),resolve(result)}catch(error){try{if(!(error instanceof Error))throw new TypeError(`Non-error was thrown: "${error}". You should only throw errors.`);if(error instanceof AbortError)throw error.originalError;if(error instanceof TypeError&&!isNetworkError(error))throw error;if(decorateErrorWithCounts(error,attemptNumber,options),await options.shouldRetry(error)||(operation.stop(),reject(error)),await options.onFailedAttempt(error),!operation.retry(error))throw operation.mainError()}catch(finalError){decorateErrorWithCounts(finalError,attemptNumber,options),cleanUp(),reject(finalError)}}})})}var packageJson$1_version="5.1.0";class AuthError extends Error{isAuthError;constructor(){super("Authorization required"),this.name="AuthError",this.isAuthError=!0}}class HttpError extends Error{statusCode;constructor({statusCode:statusCode,message:message}){super(message),this.name="HttpError",this.statusCode=statusCode}}class RequestClient{static VERSION=packageJson$1_version;#companionHeaders;uppy;opts;constructor(uppy,opts){this.uppy=uppy,this.opts=opts,this.onReceiveResponse=this.onReceiveResponse.bind(this),this.#companionHeaders=opts.companionHeaders}setCompanionHeaders(headers){this.#companionHeaders=headers}[Symbol.for("uppy test: getCompanionHeaders")](){return this.#companionHeaders}get hostname(){const{companion:companion}=this.uppy.getState(),host=this.opts.companionUrl;return(companion?.[host]?companion[host]:host).replace(/\/$/,"")}async headers(emptyBody=!1){return{...{Accept:"application/json",...emptyBody?void 0:{"Content-Type":"application/json"}},...this.#companionHeaders}}onReceiveResponse(res){const{headers:headers}=res,companion=this.uppy.getState().companion||{},host=this.opts.companionUrl;headers.has("i-am")&&headers.get("i-am")!==companion[host]&&this.uppy.setState({companion:{...companion,[host]:headers.get("i-am")}})}#getUrl(url){return/^(https?:|)\/\//.test(url)?url:`${this.hostname}/${url}`}async request({path:path,method:method="GET",data:data,skipPostResponse:skipPostResponse,signal:signal}){try{const headers=await this.headers(!data),response=await function(...options){return fetch(...options).catch(err=>{throw"AbortError"===err.name?err:new NetworkError(err)})}(this.#getUrl(path),{method:method,signal:signal,headers:headers,credentials:this.opts.companionCookiesRule||"same-origin",body:data?JSON.stringify(data):null});return skipPostResponse||this.onReceiveResponse(response),await async function(res){if(401===res.status)throw new AuthError;if(res.ok)return res.json();let errData,errMsg=`Failed request with status: ${res.status}. ${res.statusText}`;try{errData=await res.json(),errData.message&&(errMsg=`${errMsg} message: ${errData.message}`),errData.requestId&&(errMsg=`${errMsg} request-Id: ${errData.requestId}`)}catch(cause){throw new Error(errMsg,{cause:cause})}if(res.status>=400&&res.status<=499&&errData.message)throw new UserFacingApiError(errData.message);throw new HttpError({statusCode:res.status,message:errMsg})}(response)}catch(err){if(err.isAuthError||"UserFacingApiError"===err.name||"AbortError"===err.name)throw err;throw new ErrorWithCause(`Could not ${method} ${this.#getUrl(path)}`,{cause:err})}}async get(path,options){return this.request({...options,path:path})}async post(path,data,options){return this.request({...options,path:path,method:"POST",data:data})}async delete(path,data,options){return this.request({...options,path:path,method:"DELETE",data:data})}async uploadRemoteFile(file,reqBody,options){try{const{signal:signal,getQueue:getQueue}=options||{};return await pRetry(async()=>{const existingServerToken=this.uppy.getFile(file.id)?.serverToken;if(null!=existingServerToken)return this.uppy.log(`Connecting to exiting websocket ${existingServerToken}`),this.#awaitRemoteFileUpload({file:file,queue:getQueue(),signal:signal});const queueRequestSocketToken=getQueue().wrapPromiseFunction(async(...args)=>{try{return await this.#requestSocketToken(...args)}catch(outerErr){if(outerErr.isAuthError)throw new AbortError(outerErr);if(null==outerErr.cause)throw outerErr;const err=outerErr.cause,isRetryableHttpError=()=>[408,409,429,418,423].includes(err.statusCode)||err.statusCode>=500&&err.statusCode<=599&&![501,505].includes(err.statusCode);if("HttpError"===err.name&&!isRetryableHttpError())throw new AbortError(err);throw err}},{priority:-1}),serverToken=await queueRequestSocketToken({file:file,postBody:reqBody,signal:signal}).abortOn(signal);return this.uppy.getFile(file.id)?(this.uppy.setFileState(file.id,{serverToken:serverToken}),this.#awaitRemoteFileUpload({file:this.uppy.getFile(file.id),queue:getQueue(),signal:signal})):void 0},{retries:10,signal:signal,onFailedAttempt:err=>this.uppy.log(`Retrying upload due to: ${err.message}`,"warning")})}catch(err){if("AbortError"===err.name)return;throw this.uppy.emit("upload-error",file,err),err}}#requestSocketToken=async({file:file,postBody:postBody,signal:signal})=>{if(null==file.remote?.url)throw new Error("Cannot connect to an undefined URL");return(await this.post(file.remote.url,{...file.remote.body,...postBody},{signal:signal})).token};async#awaitRemoteFileUpload({file:file,queue:queue,signal:signal}){let removeEventHandlers;const{capabilities:capabilities}=this.uppy.getState();try{return await new Promise((resolve,reject)=>{const token=file.serverToken,host=function(url){const host=/^(?:https?:\/\/|\/\/)?(?:[^@\n]+@)?([^\n]+)/i.exec(url)?.[1];return`${/^http:\/\//i.test(url)?"ws":"wss"}://${host}`}(file.remote.companionUrl);let socket,socketAbortController,activityTimeout,{isPaused:isPaused}=file;const socketSend=(action,payload)=>{null!=socket&&socket.readyState===socket.OPEN?socket.send(JSON.stringify({action:action,payload:payload??{}})):this.uppy.log(`Cannot send "${action}" to socket ${file.id} because the socket state was ${String(socket?.readyState)}`,"warning")};function sendState(){capabilities.resumableUploads&&socketSend(isPaused?"pause":"resume")}const pause=newPausedState=>{capabilities.resumableUploads&&(isPaused=newPausedState,socket&&sendState())},onFileRemove=targetFile=>{capabilities.individualCancellation&&targetFile.id===file.id&&(socketSend("cancel"),socketAbortController?.abort?.(),this.uppy.log(`upload ${file.id} was removed`),resolve())},onCancelAll=()=>{socketSend("cancel"),socketAbortController?.abort?.(),this.uppy.log(`upload ${file.id} was canceled`),resolve()},onFilePausedChange=(targetFile,newPausedState)=>{targetFile?.id===file.id&&pause(newPausedState)},onPauseAll=()=>pause(!0),onResumeAll=()=>pause(!1);this.uppy.on("file-removed",onFileRemove),this.uppy.on("cancel-all",onCancelAll),this.uppy.on("upload-pause",onFilePausedChange),this.uppy.on("pause-all",onPauseAll),this.uppy.on("resume-all",onResumeAll),removeEventHandlers=()=>{this.uppy.off("file-removed",onFileRemove),this.uppy.off("cancel-all",onCancelAll),this.uppy.off("upload-pause",onFilePausedChange),this.uppy.off("pause-all",onPauseAll),this.uppy.off("resume-all",onResumeAll)},signal.addEventListener("abort",()=>{socketAbortController?.abort()}),(async()=>{socketAbortController&&socketAbortController.abort(),socketAbortController=new AbortController;const onFatalError=err=>{this.uppy.setFileState(file.id,{serverToken:null}),socketAbortController?.abort?.(),reject(err)};function resetActivityTimeout(){clearTimeout(activityTimeout),isPaused||(activityTimeout=setTimeout(()=>onFatalError(new Error("Timeout waiting for message from Companion socket")),3e5))}try{await queue.wrapPromiseFunction(async()=>{await pRetry(async()=>new Promise((_,rejectSocket)=>{socket=new WebSocket(`${host}/api/${token}`),resetActivityTimeout(),socket.addEventListener("close",()=>{socket=void 0,rejectSocket(new Error("Socket closed unexpectedly"))}),socket.addEventListener("error",error=>{this.uppy.log(`Companion socket error ${JSON.stringify(error)}, closing socket`,"warning"),socket?.close()}),socket.addEventListener("open",()=>{sendState()}),socket.addEventListener("message",e=>{resetActivityTimeout();try{const{action:action,payload:payload}=JSON.parse(e.data);switch(action){case"progress":!function(uploader,progressData,file){const{progress:progress,bytesUploaded:bytesUploaded,bytesTotal:bytesTotal}=progressData;progress&&(uploader.uppy.log(`Upload progress: ${progress}`),uploader.uppy.emit("upload-progress",file,{uploadStarted:file.progress.uploadStarted??0,bytesUploaded:bytesUploaded,bytesTotal:bytesTotal}))}(this,payload,this.uppy.getFile(file.id));break;case"success":{const text=payload.response?.responseText;this.uppy.emit("upload-success",this.uppy.getFile(file.id),{uploadURL:payload.url,status:payload.response?.status??200,body:text?JSON.parse(text):void 0}),socketAbortController?.abort?.(),resolve();break}case"error":{const{message:message}=payload.error;throw Object.assign(new Error(message),{cause:payload.error})}default:this.uppy.log(`Companion socket unknown action ${action}`,"warning")}}catch(err){onFatalError(err)}});const closeSocket=()=>{this.uppy.log(`Closing socket ${file.id}`),clearTimeout(activityTimeout),socket&&socket.close(),socket=void 0};socketAbortController.signal.addEventListener("abort",()=>{closeSocket()})}),{retries:10,signal:socketAbortController.signal,onFailedAttempt:()=>{socketAbortController.signal.aborted||this.uppy.log(`Retrying websocket ${file.id}`)}})})().abortOn(socketAbortController.signal)}catch(err){if(socketAbortController.signal.aborted)return;onFatalError(err)}})()})}finally{removeEventHandlers?.()}}}var packageJson_version="5.0.1",locale={strings:{pluginNameUrl:"Link",import:"Import",enterUrlToImport:"Enter URL to import a file",failedToFetch:"Companion failed to fetch this URL, please make sure its correct",enterCorrectUrl:"Incorrect URL: Please make sure you are entering a direct link to a file"}};class UrlUI extends x{form=document.createElement("form");input;constructor(props){super(props),this.form.id=nanoid()}componentDidMount(){this.input.value="",this.form.addEventListener("submit",this.#handleSubmit),document.body.appendChild(this.form)}componentWillUnmount(){this.form.removeEventListener("submit",this.#handleSubmit),document.body.removeChild(this.form)}#handleSubmit=ev=>{ev.preventDefault();const{addFile:addFile}=this.props;addFile(this.input.value.trim())};render(){const{i18n:i18n}=this.props;return u$2("div",{className:"uppy-Url",children:[u$2("input",{className:"uppy-u-reset uppy-c-textInput uppy-Url-input",type:"text","aria-label":i18n("enterUrlToImport"),placeholder:i18n("enterUrlToImport"),ref:input=>{this.input=input},"data-uppy-super-focusable":!0,form:this.form.id}),u$2("button",{className:"uppy-u-reset uppy-c-btn uppy-c-btn-primary uppy-Url-importButton",type:"submit",form:this.form.id,children:i18n("import")})]})}}function forEachDroppedOrPastedUrl(dataTransfer,isDropOrPaste,callback){const items=toArray(dataTransfer.items);let urlItems;switch(isDropOrPaste){case"paste":if(items.some(item=>"file"===item.kind))return;urlItems=items.filter(item=>"string"===item.kind&&"text/plain"===item.type);break;case"drop":urlItems=items.filter(item=>"string"===item.kind&&"text/uri-list"===item.type);break;default:throw new Error(`isDropOrPaste must be either 'drop' or 'paste', but it's ${isDropOrPaste}`)}urlItems.forEach(item=>{item.getAsString(urlString=>callback(urlString))})}function UrlIcon(){return u$2("svg",{"aria-hidden":"true",focusable:"false",width:"32",height:"32",viewBox:"0 0 32 32",children:u$2("path",{d:"M23.637 15.312l-2.474 2.464a3.582 3.582 0 01-.577.491c-.907.657-1.897.986-2.968.986a4.925 4.925 0 01-3.959-1.971c-.248-.329-.164-.902.165-1.149.33-.247.907-.164 1.155.164 1.072 1.478 3.133 1.724 4.618.656a.642.642 0 00.33-.328l2.473-2.463c1.238-1.313 1.238-3.366-.082-4.597a3.348 3.348 0 00-4.618 0l-1.402 1.395a.799.799 0 01-1.154 0 .79.79 0 010-1.15l1.402-1.394a4.843 4.843 0 016.843 0c2.062 1.805 2.144 5.007.248 6.896zm-8.081 5.664l-1.402 1.395a3.348 3.348 0 01-4.618 0c-1.319-1.23-1.319-3.365-.082-4.596l2.475-2.464.328-.328c.743-.492 1.567-.739 2.475-.657.906.165 1.648.574 2.143 1.314.248.329.825.411 1.155.165.33-.248.412-.822.165-1.15-.825-1.068-1.98-1.724-3.216-1.888-1.238-.247-2.556.082-3.628.902l-.495.493-2.474 2.464c-1.897 1.969-1.814 5.09.083 6.977.99.904 2.226 1.396 3.463 1.396s2.473-.492 3.463-1.395l1.402-1.396a.79.79 0 000-1.15c-.33-.328-.908-.41-1.237-.082z",fill:"#FF753E","fill-rule":"nonzero"})})}function getFileNameFromUrl(url){const{pathname:pathname}=new URL(url);return pathname.substring(pathname.lastIndexOf("/")+1)}class Url extends UIPlugin{static VERSION=packageJson_version;static requestClientId=Url.name;icon;hostname;client;canHandleRootDrop;constructor(uppy,opts){if(super(uppy,opts),this.id=this.opts.id||"Url",this.type="acquirer",this.icon=()=>u$2(UrlIcon,{}),this.defaultLocale=locale,this.i18nInit(),this.title=this.i18n("pluginNameUrl"),this.hostname=this.opts.companionUrl,!this.hostname)throw new Error("Companion hostname is required, please consult https://uppy.io/docs/companion");this.client=new RequestClient(uppy,{pluginId:this.id,provider:"url",companionUrl:this.opts.companionUrl,companionHeaders:this.opts.companionHeaders,companionCookiesRule:this.opts.companionCookiesRule}),this.uppy.registerRequestClient(Url.requestClientId,this.client)}getMeta=url=>this.client.post("url/meta",{url:url});addFile=async(protocollessUrl,optionalMeta)=>{if(protocollessUrl.startsWith("blob"))return;const url=function(url){return/^[a-z0-9]+:\/\//.test(url)?url:"http://"+url}(protocollessUrl);if(!function(url){return url?.startsWith("http://")||url?.startsWith("https://")}(url))return this.uppy.log(`[URL] Incorrect URL entered: ${url}`),void this.uppy.info(this.i18n("enterCorrectUrl"),"error",4e3);this.uppy.log(`[URL] Adding file from dropped/pasted url: ${url}`);try{const meta=await this.getMeta(url),tagFile={meta:optionalMeta,source:this.id,name:meta.name||getFileNameFromUrl(url),type:meta.type,data:{size:meta.size},isRemote:!0,body:{url:url},remote:{companionUrl:this.opts.companionUrl,url:`${this.hostname}/url/get`,body:{fileId:url,url:url},requestClientId:Url.requestClientId}};this.uppy.log("[Url] Adding remote file");try{return this.uppy.addFile(tagFile)}catch(err){return err.isRestriction||this.uppy.log(err),err}}catch(err){return this.uppy.log(err),this.uppy.info({message:this.i18n("failedToFetch"),details:err},"error",4e3),err}};handleRootDrop=e=>{forEachDroppedOrPastedUrl(e.dataTransfer,"drop",url=>{this.addFile(url)})};handleRootPaste=e=>{forEachDroppedOrPastedUrl(e.clipboardData,"paste",url=>{this.addFile(url)})};render(){return u$2(UrlUI,{i18n:this.i18n,addFile:this.addFile})}install(){const{target:target}=this.opts;target&&this.mount(target,this)}uninstall(){this.unmount()}}Url.prototype.canHandleRootDrop=function(e){return toArray(e.dataTransfer.items).filter(item=>"string"===item.kind&&"text/uri-list"===item.type).length>0};const FileComponent$1=js.Components.components.file;class UppyFileUploadComponent extends FileComponent$1{static schema(...extend){return FileComponent$1.schema({type:"uppyupload",label:"Uppy File Upload",key:"uppyupload",storage:"url",url:"",options:{uploadOnly:!1},filePattern:"*",fileMinSize:"0KB",fileMaxSize:"1GB",uppyOptions:{inline:!0,height:450,showProgressDetails:!0,showLinkToFileUploadResult:!0,proudlyDisplayPoweredByUppy:!1,plugins:["Webcam","ScreenCapture","ImageEditor","Audio","Url"]},...extend})}static get builderInfo(){return{title:"Uppy File Upload",icon:"cloud-upload-alt",group:"premium",documentation:"/userguide/forms/premium-components#uppy-file-upload",weight:101,schema:UppyFileUploadComponent.schema()}}static editForm(){return FileComponent$1.editForm([{key:"display",components:[{key:"displayBasic",components:[{type:"checkbox",key:"uppyOptions.inline",label:"Inline Dashboard",defaultValue:!0,weight:25,tooltip:"Show dashboard inline vs modal",input:!0},{type:"number",key:"uppyOptions.height",label:"Dashboard Height",defaultValue:450,weight:26,conditional:{json:{"===":[{var:"data.uppyOptions.inline"},!0]}},input:!0},{type:"checkbox",key:"uppyOptions.showProgressDetails",label:"Show Progress Details",defaultValue:!0,weight:27,input:!0},{type:"checkbox",key:"uppyOptions.autoProceed",label:"Auto Proceed",defaultValue:!1,weight:28,tooltip:"Automatically start upload after adding files",input:!0},{type:"checkbox",key:"uppyOptions.allowMultipleUploadBatches",label:"Allow Multiple Upload Batches",defaultValue:!0,weight:29,input:!0}]}]},{key:"data",components:[{key:"dataBasic",components:[{type:"select",key:"uppyOptions.plugins",label:"Enabled Plugins",multiple:!0,weight:30,data:{values:[{label:"Webcam",value:"Webcam"},{label:"Screen Capture",value:"ScreenCapture"},{label:"Image Editor",value:"ImageEditor"},{label:"Audio Recording",value:"Audio"},{label:"Import from URL",value:"Url"},{label:"Google Drive",value:"GoogleDrive"},{label:"Dropbox",value:"Dropbox"},{label:"Instagram",value:"Instagram"}]},defaultValue:["Webcam","ScreenCapture","ImageEditor","Audio","Url"],input:!0}]}]}])}constructor(component,options,data){super(component,options,data),this.uppy=null,this.dashboardElement=null,this.component.storage=this.component.storage||"url"}init(){super.init()}attach(element){const superAttach=super.attach(element);this.dashboardElement=document.createElement("div"),this.dashboardElement.className="uppy-dashboard-container";return(element.querySelector(".formio-component-file")||element).appendChild(this.dashboardElement),this.initializeUppy(),superAttach}initializeUppy(){const uppyConfig={autoProceed:this.component.uppyOptions?.autoProceed||!1,allowMultipleUploadBatches:!1!==this.component.uppyOptions?.allowMultipleUploadBatches,restrictions:{maxFileSize:this.parseFileSize(this.component.fileMaxSize)??void 0,minFileSize:this.parseFileSize(this.component.fileMinSize)??void 0,maxNumberOfFiles:this.component.multiple?10:1,allowedFileTypes:this.parseFilePattern(this.component.filePattern)??void 0},meta:{formId:this.root?.formId||"",submissionId:this.root?.submissionId||"",fieldKey:this.component.key||""}};this.uppy=new Uppy({id:`uppy_${this.id}`,debug:!1,autoProceed:uppyConfig.autoProceed,allowMultipleUploadBatches:uppyConfig.allowMultipleUploadBatches,restrictions:uppyConfig.restrictions,meta:uppyConfig.meta}),this.uppy.use(Dashboard,{target:this.dashboardElement,inline:!1!==this.component.uppyOptions?.inline,height:this.component.uppyOptions?.height||450,width:"100%",hideProgressDetails:!1===this.component.uppyOptions?.showProgressDetails,showLinkToFileUploadResult:!1!==this.component.uppyOptions?.showLinkToFileUploadResult,proudlyDisplayPoweredByUppy:!1,hideUploadButton:uppyConfig.autoProceed,hideRetryButton:!1,hidePauseResumeButton:!1,hideCancelButton:!1,hideProgressAfterFinish:!1,doneButtonHandler:null,note:this.component.description||null,closeModalOnClickOutside:!0,closeAfterFinish:!1,disableThumbnailGenerator:!1,disablePageScrollWhenModalOpen:!0,animateOpenClose:!0,browserBackButtonClose:!0}),this.uppy.use(Tus,{endpoint:this.component.url||"/files",chunkSize:1024*(this.component.chunkSize||8)*1024,retryDelays:[0,3e3,5e3,1e4,2e4],headers:this.getHeaders()}),this.uppy.use(GoldenRetriever,{serviceWorker:!1});const plugins=this.component.uppyOptions?.plugins||[];plugins.includes("Webcam")&&this.uppy.use(Webcam,{target:Dashboard}),plugins.includes("ScreenCapture")&&this.uppy.use(ScreenCapture,{target:Dashboard}),plugins.includes("ImageEditor")&&this.uppy.use(ImageEditor,{target:Dashboard}),plugins.includes("Audio")&&this.uppy.use(Audio,{target:Dashboard}),plugins.includes("Url")&&this.uppy.use(Url,{target:Dashboard,companionUrl:this.component.companionUrl||null}),this.setupUppyEventHandlers()}setupUppyEventHandlers(){this.uppy&&(this.handleFileAdded=async file=>{const safeName=sanitizeFilename(file.name,{addTimestamp:!0,preserveExtension:!1});if(!await verifyFileType(file.data,file.type))return logger.error("[Uppy Security] File type verification failed:",file.name),this.uppy?.info(`Security: File "${file.name}" content does not match declared type`,"error",5e3),void this.uppy?.removeFile(file.id);this.uppy?.setFileMeta(file.id,{name:safeName,originalName:file.name}),this.emit("fileAdded",file)},this.handleUpload=()=>{this.emit("uploadStart")},this.handleUploadProgress=(file,progress)=>{this.emit("uploadProgress",{file:file,progress:progress})},this.handleUploadSuccess=(file,response)=>{const uploadFile={id:file.id,name:file.name,size:file.size,type:file.type,url:response.uploadURL,storage:this.component.storage,status:exports.UploadStatus.COMPLETED,createdAt:new Date,updatedAt:new Date},currentValue=this.getValue()||[];this.component.multiple?this.setValue([...currentValue,uploadFile]):this.setValue(uploadFile),this.emit("uploadSuccess",uploadFile)},this.handleUploadError=(file,error)=>{logger.error("[Uppy] Upload error:",{fileName:file?.name,error:error}),this.emit("uploadError",{file:file,error:error})},this.handleComplete=result=>{if(result.successful.length>0&&0===result.failed.length){const uppyId=this.uppy.getID();try{localStorage.removeItem(`uppy/${uppyId}`)}catch(error){logger.warn("[Uppy] Failed to clean recovery state:",{error:error})}}this.emit("uploadComplete",result)},this.handleError=error=>{logger.error("[Uppy] Error:",{error:error}),this.emit("error",error)},this.handleCancelAll=()=>{this.emit("uploadCancelled")},this.uppy.on("file-added",this.handleFileAdded),this.uppy.on("upload",this.handleUpload),this.uppy.on("upload-progress",this.handleUploadProgress),this.uppy.on("upload-success",this.handleUploadSuccess),this.uppy.on("upload-error",this.handleUploadError),this.uppy.on("complete",this.handleComplete),this.uppy.on("error",this.handleError),this.uppy.on("cancel-all",this.handleCancelAll))}getHeaders(){return{Authorization:`Bearer ${this.root?.token||""}`,"x-jwt-token":this.root?.token||""}}parseFileSize(size){if(!size)return null;const match=size.match(/^(\d+(?:\.\d+)?)\s*([KMGT]?B)$/i);if(!match)return null;return parseFloat(match[1])*({B:1,KB:1024,MB:1048576,GB:1073741824}[match[2].toUpperCase()]||1)}parseFilePattern(pattern){return pattern&&"*"!==pattern?pattern.split(",").map(p=>{const trimmed=p.trim();return trimmed.startsWith("*.")?`.${trimmed.substring(2)}`:trimmed}):null}getValue(){return this.dataValue}setValue(value){this.dataValue=value}detach(){return this.uppy&&(this.handleFileAdded&&this.uppy.off("file-added",this.handleFileAdded),this.handleUpload&&this.uppy.off("upload",this.handleUpload),this.handleUploadProgress&&this.uppy.off("upload-progress",this.handleUploadProgress),this.handleUploadSuccess&&this.uppy.off("upload-success",this.handleUploadSuccess),this.handleUploadError&&this.uppy.off("upload-error",this.handleUploadError),this.handleComplete&&this.uppy.off("complete",this.handleComplete),this.handleError&&this.uppy.off("error",this.handleError),this.handleCancelAll&&this.uppy.off("cancel-all",this.handleCancelAll),this.uppy.cancelAll(),this.uppy=null),super.detach()}destroy(){this.uppy&&(this.handleFileAdded&&this.uppy.off("file-added",this.handleFileAdded),this.handleUpload&&this.uppy.off("upload",this.handleUpload),this.handleUploadProgress&&this.uppy.off("upload-progress",this.handleUploadProgress),this.handleUploadSuccess&&this.uppy.off("upload-success",this.handleUploadSuccess),this.handleUploadError&&this.uppy.off("upload-error",this.handleUploadError),this.handleComplete&&this.uppy.off("complete",this.handleComplete),this.handleError&&this.uppy.off("error",this.handleError),this.handleCancelAll&&this.uppy.off("cancel-all",this.handleCancelAll),this.uppy.cancelAll(),this.uppy=null),super.destroy()}}const UPLOAD_CONSTANTS={DEFAULT_TUS_ENDPOINT:"http://localhost:1080/files/",DEFAULT_CHUNK_SIZE:5242880,RETRY_DELAYS:[0,1e3,3e3,5e3],DEFAULT_MAX_FILES:20,DEFAULT_MAX_FILE_SIZE:10485760,DEFAULT_ALLOWED_TYPES:["image/*","video/*"],DEFAULT_COMPRESSION_QUALITY:.8,MAX_IMAGE_WIDTH:1920,MAX_IMAGE_HEIGHT:1080,COMPRESSION_CONVERT_SIZE:1e6,COMPRESSION_MIME_TYPE:"image/jpeg",DEFAULT_PERSISTENCE_EXPIRY:864e5,GEOLOCATION_TIMEOUT:1e4,GEOLOCATION_MAX_AGE:0},WHITELABEL_CONFIG_CLASSES={UPLOAD_WIDGET:"qrius-upload-container"},WHITELABEL_CONFIG_SELECTORS={UPLOAD_AREA:".form-field-upload, .formio-component-file"},WHITELABEL_CONFIG_ID_PATTERNS={UPLOAD_CONTAINER:key=>`${key}-upload-widget`,REACT_ROOT:key=>`${key}-root`},FileComponent=js.Components.components.file;class MultiImageUploadComponent extends FileComponent{constructor(component,options,data){console.log(" [MultiImageUpload] constructor() START",{timestamp:(new Date).toISOString(),componentKey:component?.key,componentType:component?.type,hasOptions:!!options,hasData:!!data}),super(component,options,data),this.reactContainer=null,this.mountedReactComponent=null,console.log(" [MultiImageUpload] constructor() COMPLETE",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,reactContainer:this.reactContainer,mountedReactComponent:this.mountedReactComponent}),logger.info("MultiImageUploadComponent constructor called",{componentKey:component?.key,componentType:component?.type})}static get type(){return"multiimageupload"}static registerReactComponent(factory){MultiImageUploadComponent.reactComponentFactory=factory}static schema(...extend){return FileComponent.schema({type:"multiimageupload",label:"Multi-Image Upload",key:"site_images",storage:"url",url:UPLOAD_CONSTANTS.DEFAULT_TUS_ENDPOINT,maxFiles:UPLOAD_CONSTANTS.DEFAULT_MAX_FILES,compressionQuality:UPLOAD_CONSTANTS.DEFAULT_COMPRESSION_QUALITY,autoNumbering:!0,extractMetadata:!0,filePattern:"image/*,video/*",fileMaxSize:"10MB"},...extend)}static get builderInfo(){return{title:"Multi-Image Upload",icon:"images",group:"premium",documentation:"/userguide/forms/premium-components#multi-image-upload",weight:102,schema:MultiImageUploadComponent.schema()}}static editForm(){return FileComponent.editForm()}attach(element){console.log(" [MultiImageUpload] attach() START",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,elementReceived:element});const superResult=super.attach(element);console.log(" [MultiImageUpload] attach() super.attach() complete, creating React container",{timestamp:(new Date).toISOString()}),this.reactContainer=document.createElement("div"),this.reactContainer.className=WHITELABEL_CONFIG_CLASSES.UPLOAD_WIDGET,this.reactContainer.id=WHITELABEL_CONFIG_ID_PATTERNS.UPLOAD_CONTAINER(this.component.key);return(element.querySelector(WHITELABEL_CONFIG_SELECTORS.UPLOAD_AREA)||element).appendChild(this.reactContainer),console.log(" [MultiImageUpload] attach() React container appended to DOM",{timestamp:(new Date).toISOString(),containerInDocument:document.contains(this.reactContainer),containerParent:this.reactContainer.parentNode}),this.loadReactComponent(),console.log(" [MultiImageUpload] attach() COMPLETE",{timestamp:(new Date).toISOString()}),superResult}detach(){if(console.log(" [MultiImageUpload] detach() START",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,hasMountedReactComponent:!!this.mountedReactComponent,hasReactContainer:!!this.reactContainer,containerInDocument:!!this.reactContainer&&document.contains(this.reactContainer)}),this.mountedReactComponent){console.log(" [MultiImageUpload] detach() unmounting React component",{timestamp:(new Date).toISOString(),mountedComponent:this.mountedReactComponent});try{this.mountedReactComponent.unmount(),console.log(" [MultiImageUpload] detach() React component unmounted successfully",{timestamp:(new Date).toISOString()})}catch(error){console.error(" [MultiImageUpload] detach() error unmounting React component",{timestamp:(new Date).toISOString(),error:error,errorMessage:error instanceof Error?error.message:String(error),errorStack:error instanceof Error?error.stack:void 0}),logger.warn("Error unmounting React component during detach",{componentKey:this.component?.key,error:error instanceof Error?error.message:String(error)})}this.mountedReactComponent=null}else console.log(" [MultiImageUpload] detach() no mounted React component to unmount",{timestamp:(new Date).toISOString()});console.log(" [MultiImageUpload] detach() clearing reactContainer reference",{timestamp:(new Date).toISOString()}),this.reactContainer=null,console.log(" [MultiImageUpload] detach() COMPLETE",{timestamp:(new Date).toISOString(),cleanupComplete:!0})}async loadReactComponent(){if(console.log(" [MultiImageUpload] loadReactComponent() START",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,hasReactContainer:!!this.reactContainer,reactContainer:this.reactContainer}),!this.reactContainer)return console.error(" [MultiImageUpload] loadReactComponent() ABORTED - reactContainer is null",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,thisObject:this}),void logger.error("loadReactComponent called but reactContainer is null",{componentKey:this.component?.key});console.log(" [MultiImageUpload] loadReactComponent() checking DOM state",{timestamp:(new Date).toISOString(),containerInDocument:document.contains(this.reactContainer),containerParent:this.reactContainer.parentNode,containerParentTagName:this.reactContainer.parentNode?this.reactContainer.parentNode.tagName:null,documentBodyContains:document.body.contains(this.reactContainer)}),console.log(" [MultiImageUpload] loadReactComponent() checking factory",{timestamp:(new Date).toISOString(),hasFactory:!!MultiImageUploadComponent.reactComponentFactory,factoryType:typeof MultiImageUploadComponent.reactComponentFactory,factory:MultiImageUploadComponent.reactComponentFactory}),logger.info("loadReactComponent called",{componentKey:this.component?.key,hasFactory:!!MultiImageUploadComponent.reactComponentFactory,containerInDocument:document.contains(this.reactContainer)});try{if(!MultiImageUploadComponent.reactComponentFactory)throw console.error(" [MultiImageUpload] loadReactComponent() ABORTED - factory not registered",{timestamp:(new Date).toISOString()}),new Error("React component factory not registered");console.log(" [MultiImageUpload] loadReactComponent() calling factory()",{timestamp:(new Date).toISOString()});const{React:React,ReactDOM:ReactDOM,MultiImageUpload:MultiImageUpload}=MultiImageUploadComponent.reactComponentFactory();console.log(" [MultiImageUpload] loadReactComponent() factory returned dependencies",{timestamp:(new Date).toISOString(),hasReact:!!React,hasReactDOM:!!ReactDOM,hasMultiImageUpload:!!MultiImageUpload,ReactType:typeof React,ReactDOMType:typeof ReactDOM,MultiImageUploadType:typeof MultiImageUpload,ReactDOMHasCreateRoot:ReactDOM&&"function"==typeof ReactDOM.createRoot}),logger.info("React dependencies loaded",{hasReact:!!React,hasReactDOM:!!ReactDOM,hasMultiImageUpload:!!MultiImageUpload}),this.mountedReactComponent?console.log(" [MultiImageUpload] loadReactComponent() reusing existing React root",{timestamp:(new Date).toISOString()}):(console.log(" [MultiImageUpload] loadReactComponent() creating NEW React root",{timestamp:(new Date).toISOString()}),this.mountedReactComponent=ReactDOM.createRoot(this.reactContainer)),console.log(" [MultiImageUpload] loadReactComponent() preparing props for render",{timestamp:(new Date).toISOString(),componentProps:{formKey:this.component.key||"site_images",maxFiles:this.component.maxFiles||UPLOAD_CONSTANTS.DEFAULT_MAX_FILES,compressionQuality:this.component.compressionQuality||UPLOAD_CONSTANTS.DEFAULT_COMPRESSION_QUALITY,autoNumbering:this.component.autoNumbering??!0,extractMetadata:this.component.extractMetadata??!0,value:this.dataValue||[]}}),console.log(" [MultiImageUpload] loadReactComponent() calling render()",{timestamp:(new Date).toISOString()}),this.mountedReactComponent.render(React.createElement(MultiImageUpload,{formKey:this.component.key||"site_images",maxFiles:this.component.maxFiles||UPLOAD_CONSTANTS.DEFAULT_MAX_FILES,compressionQuality:this.component.compressionQuality||UPLOAD_CONSTANTS.DEFAULT_COMPRESSION_QUALITY,autoNumbering:this.component.autoNumbering??!0,extractMetadata:this.component.extractMetadata??!0,onChange:files=>{console.log(" [MultiImageUpload] React onChange callback triggered",{timestamp:(new Date).toISOString(),filesCount:files?.length,files:files}),this.setValue(files)},value:this.dataValue||[]})),console.log(" [MultiImageUpload] loadReactComponent() render() called",{timestamp:(new Date).toISOString()}),console.log(" [MultiImageUpload] loadReactComponent() SUCCESS - React component mounted",{timestamp:(new Date).toISOString(),mountedReactComponent:this.mountedReactComponent,containerStillInDocument:document.contains(this.reactContainer)})}catch(error){console.error(" [MultiImageUpload] loadReactComponent() FAILED with error",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,error:error,errorMessage:error instanceof Error?error.message:String(error),errorStack:error instanceof Error?error.stack:void 0,errorType:error?error.constructor.name:"unknown"}),logger.error("Failed to load React component",{componentKey:this.component?.key,error:error instanceof Error?error.message:String(error),stack:error instanceof Error?error.stack:void 0}),this.reactContainer&&(console.log(" [MultiImageUpload] loadReactComponent() displaying error message in container",{timestamp:(new Date).toISOString()}),this.reactContainer.innerHTML='\n          <div class="alert alert-danger">\n            Failed to load Multi-Image Upload component. Please check console for details.\n          </div>\n        ')}}destroy(){if(console.log(" [MultiImageUpload] destroy() START",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,hasMountedReactComponent:!!this.mountedReactComponent,hasReactContainer:!!this.reactContainer,containerInDocument:!!this.reactContainer&&document.contains(this.reactContainer)}),this.mountedReactComponent){console.log(" [MultiImageUpload] destroy() unmounting React component",{timestamp:(new Date).toISOString(),mountedComponent:this.mountedReactComponent});try{this.mountedReactComponent.unmount(),console.log(" [MultiImageUpload] destroy() React component unmounted successfully",{timestamp:(new Date).toISOString()})}catch(error){console.error(" [MultiImageUpload] destroy() error unmounting React component",{timestamp:(new Date).toISOString(),error:error,errorMessage:error instanceof Error?error.message:String(error),errorStack:error instanceof Error?error.stack:void 0}),logger.warn("Error unmounting React component",{componentKey:this.component?.key,error:error instanceof Error?error.message:String(error)})}this.mountedReactComponent=null}else console.log(" [MultiImageUpload] destroy() no mounted React component to unmount",{timestamp:(new Date).toISOString()});console.log(" [MultiImageUpload] destroy() clearing reactContainer reference",{timestamp:(new Date).toISOString()}),this.reactContainer=null,console.log(" [MultiImageUpload] destroy() calling super.destroy()",{timestamp:(new Date).toISOString()}),super.destroy(),console.log(" [MultiImageUpload] destroy() COMPLETE",{timestamp:(new Date).toISOString(),fullCleanupComplete:!0})}getValue(){return this.dataValue||[]}setValue(value,flags={}){console.log(" [MultiImageUpload] setValue() called",{timestamp:(new Date).toISOString(),componentKey:this.component?.key,newValue:value,flags:flags,previousValue:this.dataValue});const changed=super.setValue(value,flags);return console.log(" [MultiImageUpload] setValue() super.setValue() result",{timestamp:(new Date).toISOString(),valueChanged:changed,updatedDataValue:this.dataValue}),changed&&(console.log(" [MultiImageUpload] setValue() value changed, triggering change event",{timestamp:(new Date).toISOString(),willTriggerChange:!0}),this.triggerChange(),console.log(" [MultiImageUpload] setValue() React will sync via useEffect",{timestamp:(new Date).toISOString(),reactComponentMounted:!!this.mountedReactComponent})),changed}}MultiImageUploadComponent.reactComponentFactory=null;class FileStorageProvider{constructor(config={}){this.name="file",this.title="File Storage Provider",this.config={endpoint:"/files",...config}}async uploadFile(file,options={}){const formData=new FormData;formData.append("file",file),formData.append("name",file.name),formData.append("size",file.size.toString()),formData.append("type",file.type),options.metadata&&Object.keys(options.metadata).forEach(key=>{formData.append(`metadata[${key}]`,options.metadata[key])});const response=await fetch(this.config.endpoint,{method:"POST",headers:{"x-jwt-token":options.token||""},body:formData});if(!response.ok)throw new Error(`Upload failed: ${response.statusText}`);const result=await response.json();return{id:result.id,name:file.name,size:file.size,type:file.type,url:result.url,storage:"file",status:"completed",createdAt:new Date,updatedAt:new Date}}async downloadFile(file){const response=await fetch(file.url);if(!response.ok)throw new Error(`Download failed: ${response.statusText}`);return response.blob()}async deleteFile(file){const response=await fetch(`${this.config.endpoint}/${file.id}`,{method:"DELETE",headers:{"x-jwt-token":this.config.token||""}});if(!response.ok)throw new Error(`Delete failed: ${response.statusText}`)}async getFileUrl(file){if(file.url)return file.url;const response=await fetch(`${this.config.endpoint}/${file.id}/url`,{headers:{"x-jwt-token":this.config.token||""}});if(!response.ok)throw new Error(`Failed to get file URL: ${response.statusText}`);return(await response.json()).url}static register(Formio){Formio.Providers.addProvider("storage","file",FileStorageProvider)}}const FormioFileUploadModule={components:{tusupload:TusFileUploadComponent,uppyupload:UppyFileUploadComponent,multiimageupload:MultiImageUploadComponent}};exports.FILE_SIGNATURES=FILE_SIGNATURES,exports.FileStorageProvider=FileStorageProvider,exports.MultiImageUploadComponent=MultiImageUploadComponent,exports.TusFileUploadComponent=TusFileUploadComponent,exports.UPLOAD_CONSTANTS=UPLOAD_CONSTANTS,exports.UppyFileUploadComponent=UppyFileUploadComponent,exports.default=FormioFileUploadModule,exports.detectFileType=async function(file,allowedTypes){try{const buffer=await file.slice(0,12).arrayBuffer(),bytes=new Uint8Array(buffer);for(const mimeType of allowedTypes){const signature=FILE_SIGNATURES[mimeType];if(!signature)continue;if(signature.signatures.some(sig=>matchesSignature(bytes,sig)))return mimeType}return null}catch(error){return logger.error("[Security] Error detecting file type:",{error:error}),null}},exports.hasSignatureSupport=function(mimeType){return mimeType in FILE_SIGNATURES},exports.logger=logger,exports.registerTemplates=function(framework="default"){const templates={tusupload:{form:'\n<div class="tus-upload-component">\n  <style>\n    .tus-upload-component { margin: 1rem 0; font-family: system-ui, -apple-system, sans-serif; }\n    .tus-upload-component label { display: block; margin-bottom: 0.5rem; font-weight: 500; }\n    .upload-dropzone {\n      border: 2px dashed #ccc;\n      border-radius: 8px;\n      padding: 2rem;\n      text-align: center;\n      background: #fafafa;\n      transition: all 0.2s;\n    }\n    .upload-dropzone:hover { border-color: #666; background: #f0f0f0; }\n    .upload-dropzone.dragover { border-color: #4CAF50; background: #e8f5e9; }\n    .upload-icon { font-size: 3rem; color: #999; margin-bottom: 1rem; }\n    .browse-button {\n      background: #2196F3;\n      color: white;\n      border: none;\n      padding: 0.75rem 1.5rem;\n      border-radius: 4px;\n      cursor: pointer;\n      font-size: 1rem;\n    }\n    .browse-button:hover { background: #1976D2; }\n    .file-input { display: none; }\n    .file-list { margin-top: 1rem; }\n    .file-item {\n      display: flex;\n      align-items: center;\n      padding: 0.75rem;\n      border: 1px solid #ddd;\n      border-radius: 4px;\n      margin-bottom: 0.5rem;\n      background: white;\n    }\n    .file-name { flex: 1; margin: 0 1rem; }\n    .file-size { color: #666; font-size: 0.875rem; }\n    .progress-bar {\n      height: 20px;\n      background: #e0e0e0;\n      border-radius: 10px;\n      overflow: hidden;\n      margin: 0 1rem;\n      flex: 1;\n    }\n    .progress-fill {\n      height: 100%;\n      background: #4CAF50;\n      transition: width 0.3s;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: white;\n      font-size: 0.75rem;\n    }\n    .remove-button {\n      background: #f44336;\n      color: white;\n      border: none;\n      padding: 0.5rem 1rem;\n      border-radius: 4px;\n      cursor: pointer;\n    }\n    .remove-button:hover { background: #d32f2f; }\n    .description { display: block; margin-top: 0.5rem; font-size: 0.875rem; color: #666; }\n  </style>\n\n  <label for="{{ instance.id }}-{{ key }}">{{ t(label) }}</label>\n\n  <div class="upload-dropzone" ref="fileDrop">\n    <div class="upload-icon"></div>\n    <p>{{ t(\'Drag and drop files here or\') }}</p>\n    <button type="button" class="browse-button" ref="fileBrowse">\n      {{ t(\'Browse Files\') }}\n    </button>\n    <input type="file" class="file-input" ref="hiddenFileInputElement"\n      {% if (multiple) { %}multiple{% } %}\n      {% if (filePattern && filePattern !== \'*\') { %}accept="{{ filePattern }}"{% } %} />\n  </div>\n\n  <div class="file-list" ref="fileList">\n    {% if (files && files.length) { %}\n      {% files.forEach(function(file, index) { %}\n        <div class="file-item">\n          <span></span>\n          <span class="file-name">{{ file.name }}</span>\n          <span class="file-size">{{ formatBytes(file.size) }}</span>\n          {% if (file.progress && file.progress < 100) { %}\n            <div class="progress-bar">\n              <div class="progress-fill" ref="fileProgress" style="width: {{ file.progress }}%">\n                {{ file.progress }}%\n              </div>\n            </div>\n          {% } %}\n          {% if (file.status === \'completed\') { %}\n            <span style="color: #4CAF50;"></span>\n          {% } %}\n          <button type="button" class="remove-button" ref="removeLink"></button>\n        </div>\n      {% }); %}\n    {% } %}\n  </div>\n\n  {% if (description) { %}\n    <small class="description">{{ t(description) }}</small>\n  {% } %}\n</div>\n  '},uppyupload:{form:'\n<div class="uppy-upload-component">\n  <style>\n    .uppy-upload-component { margin: 1rem 0; font-family: system-ui, -apple-system, sans-serif; }\n    .uppy-upload-component label { display: block; margin-bottom: 0.5rem; font-weight: 500; }\n    .uppy-dashboard-container {\n      border: 1px solid #ddd;\n      border-radius: 8px;\n      overflow: hidden;\n    }\n    .description { display: block; margin-top: 0.5rem; font-size: 0.875rem; color: #666; }\n  </style>\n\n  <label for="{{ instance.id }}-{{ key }}">{{ t(label) }}</label>\n\n  <div class="uppy-dashboard-container"></div>\n\n  {% if (description) { %}\n    <small class="description">{{ t(description) }}</small>\n  {% } %}\n</div>\n  '}};return templates},exports.registerValidators=function(){return{fileSize:fileSizeValidator,fileType:fileTypeValidator,virusScan:virusScanValidator,imageResolution:imageResolutionValidator}},exports.sanitizeFilename=sanitizeFilename,exports.verifyFileType=verifyFileType,Object.defineProperty(exports,"__esModule",{value:!0})});
//# sourceMappingURL=formio-file-upload.min.js.map
